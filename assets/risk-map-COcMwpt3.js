const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/maplibre-gl-Buh2kDHp.js","assets/vendor-react-ChnU68HB.js"])))=>i.map(i=>d[i]);
var e,t,n=Object.defineProperty,i=(e,t,i)=>((e,t,i)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);import{j as r}from"./vendor-ui-BuuLDXGn.js";import{a as s,g as o,b as a}from"./vendor-react-ChnU68HB.js";import{_ as A,a as l}from"./index-lhm59BYg.js";import{X as c,K as u,a as h,c as d}from"./vendor-icons-DLa0eLQi.js";import"./vendor-charts-BrSaxJ5v.js";function f(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const p=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),g="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);g&&parseFloat(g[1]);const m=globalThis,_=globalThis.process||{},v=globalThis.navigator||{};function y(e){var t,n;if("undefined"!=typeof window&&"renderer"===(null==(t=window.process)?void 0:t.type))return!0;if("undefined"!=typeof process&&Boolean(null==(n=process.versions)?void 0:n.electron))return!0;const i="undefined"!=typeof navigator&&navigator.userAgent;return Boolean(i&&i.indexOf("Electron")>=0)}function b(){return!("object"==typeof process&&"[object process]"===String(process)&&!(null==process?void 0:process.browser))||y()}const w="4.1.0";class E{constructor(e,t,n="sessionStorage"){this.storage=function(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(Ar){return null}}(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}var x,T;(T=x||(x={}))[T.BLACK=30]="BLACK",T[T.RED=31]="RED",T[T.GREEN=32]="GREEN",T[T.YELLOW=33]="YELLOW",T[T.BLUE=34]="BLUE",T[T.MAGENTA=35]="MAGENTA",T[T.CYAN=36]="CYAN",T[T.WHITE=37]="WHITE",T[T.BRIGHT_BLACK=90]="BRIGHT_BLACK",T[T.BRIGHT_RED=91]="BRIGHT_RED",T[T.BRIGHT_GREEN=92]="BRIGHT_GREEN",T[T.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",T[T.BRIGHT_BLUE=94]="BRIGHT_BLUE",T[T.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",T[T.BRIGHT_CYAN=96]="BRIGHT_CYAN",T[T.BRIGHT_WHITE=97]="BRIGHT_WHITE";function S(e){return"string"!=typeof e?e:(e=e.toUpperCase(),x[e]||x.WHITE)}function C(e,t){if(!e)throw new Error("Assertion failed")}function P(){var e,t,n;let i;if(b()&&m.performance)i=null==(t=null==(e=null==m?void 0:m.performance)?void 0:e.now)?void 0:t.call(e);else if("hrtime"in _){const e=null==(n=null==_?void 0:_.hrtime)?void 0:n.call(_);i=1e3*e[0]+e[1]/1e6}else i=Date.now();return i}const R={debug:b()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},I={enabled:!0,level:0};function M(){}const k={},L={once:!0};class B{constructor({id:e}={id:""}){this.VERSION=w,this._startTs=P(),this._deltaTs=P(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new E(`__probe-${this.id}__`,I),this.timeStamp(`${this.id} started`),function(e,t=["constructor"]){const n=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(n),r=e;for(const s of i){const n=r[s];"function"==typeof n&&(t.find(e=>s===e)||(r[s]=n.bind(e)))}}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((P()-this._startTs).toPrecision(10))}getDelta(){return Number((P()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,R.warn,arguments,L)}error(e){return this._getLogFunction(0,e,R.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,R.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,R.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,R.debug||R.info,arguments,L)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||M,n&&[n],{tag:N(t)}):M}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||M)}group(e,t,n={collapsed:!1}){const i=O({logLevel:e,message:t,opts:n}),{collapsed:r}=n;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||M)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=D(e)}_getLogFunction(e,t,n,i,r){if(this._shouldLog(e)){r=O({logLevel:e,message:t,args:i,opts:r}),C(n=n||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=P();const s=r.tag||r.message;if(r.once&&s){if(k[s])return M;k[s]=P()}return t=function(e,t,n){if("string"==typeof t){const i=n.time?function(e,t=8){const n=Math.max(t-e.length,0);return`${" ".repeat(n)}${e}`}(function(e){let t;return t=e<10?`${e.toFixed(2)}ms`:e<100?`${e.toFixed(1)}ms`:e<1e3?`${e.toFixed(0)}ms`:`${(e/1e3).toFixed(2)}s`,t}(n.total)):"";t=function(e,t,n){b||"string"!=typeof e||(t&&(e=`[${S(t)}m${e}[39m`),n&&(e=`[${S(n)+10}m${e}[49m`));return e}(t=n.time?`${e}: ${i}  ${t}`:`${e}: ${t}`,n.color,n.background)}return t}(this.id,r.message,r),n.bind(console,t,...r.args)}return M}}function D(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return C(Number.isFinite(t)&&t>=0),t}function O(e){const{logLevel:t,message:n}=e;e.logLevel=D(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==n;);switch(typeof t){case"string":case"function":void 0!==n&&i.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const r=typeof e.message;return C("string"===r||"object"===r),Object.assign(e,{args:i},e.opts)}function N(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}B.VERSION=w;const F="4.3.3",U=F[0]>="0"&&F[0]<="9"?`v${F}`:"";const G=function(){const e=new B({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=U,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}();function z(e,t){return V(e||{},t)}function V(e,t,n=0){if(n>3)return t;const i={...e};for(const[r,s]of Object.entries(t))s&&"object"==typeof s&&!Array.isArray(s)?i[r]=V(i[r]||{},t[r],n+1):i[r]=t[r];return i}(null==(W=globalThis._loadersgl_)?void 0:W.version)||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version;var W;function j(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const H="object"!=typeof process||"[object process]"!==String(process)||process.browser,X="undefined"!=typeof window&&void 0!==window.orientation,Q="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Q&&parseFloat(Q[1]);class ${constructor(e,t){i(this,"name"),i(this,"workerThread"),i(this,"isRunning",!0),i(this,"result"),i(this,"_resolve",()=>{}),i(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){j(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){j(this.isRunning),this.isRunning=!1,this._reject(e)}}class Y{terminate(){}}const K=new Map;function Z(e){j(e.source&&!e.url||!e.source&&e.url);let t=K.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return q((t=e,`try {\n  importScripts('${t}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`));var t}(e.url),K.set(e.url,t)),e.source&&(t=q(e.source),K.set(e.source,t))),j(t),t}function q(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function J(e,t=!0,n){const i=n||new Set;if(e){if(ee(e))i.add(e);else if(ee(e.buffer))i.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const r in e)J(e[r],t,i)}else;return void 0===n?Array.from(i):[]}function ee(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const te=()=>{};class ne{constructor(e){i(this,"name"),i(this,"source"),i(this,"url"),i(this,"terminated",!1),i(this,"worker"),i(this,"onMessage"),i(this,"onError"),i(this,"_loadableURL","");const{name:t,source:n,url:r}=e;j(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=te,this.onError=e=>{},this.worker=H?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return"undefined"!=typeof Worker&&H||void 0!==Y&&!H}destroy(){this.onMessage=te,this.onError=te,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||J(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=Z({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>{},e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Y(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new Y(this.source,{eval:!0})}return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class ie{constructor(e){i(this,"name","unnamed"),i(this,"source"),i(this,"url"),i(this,"maxConcurrency",1),i(this,"maxMobileConcurrency",1),i(this,"onDebug",()=>{}),i(this,"reuseWorkers",!0),i(this,"props",{}),i(this,"jobQueue",[]),i(this,"idleQueue",[]),i(this,"count",0),i(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return ne.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=(e,t,n)=>e.done(n),n=(e,t)=>e.error(t)){const i=new Promise(i=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:i}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new $(t.name,e);e.onMessage=e=>t.onMessage(i,e.type,e.payload),e.onError=e=>t.onError(i,e),t.onStart(i);try{await i.result}catch(n){}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!H||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new ne({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return X?this.maxMobileConcurrency:this.maxConcurrency}}const re={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},se=class e{constructor(e){i(this,"props"),i(this,"workerPools",new Map),this.props={...re},this.setProps(e),this.workerPools=new Map}static isSupported(){return ne.isSupported()}static getWorkerFarm(t={}){return e._workerFarm=e._workerFarm||new e({}),e._workerFarm.setProps(t),e._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let r=this.workerPools.get(t);return r||(r=new ie({name:t,source:n,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};i(se,"_workerFarm");let oe=se;async function ae(e,t,n,i,r){const s=e.id,o=function(e,t={}){const n=t[e.id]||{},i=H?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=n.workerUrl;if(r||"compression"!==e.id||(r=t.workerUrl),"test"===t._workerType&&(r=H?`modules/${e.module}/dist/${i}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let t=e.version;"latest"===t&&(t="latest");const n=t?`@${t}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${n}/dist/${i}`}return j(r),r}(e,n),a=oe.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const A=await a.startJob("process-on-worker",Ae.bind(null,r));A.postMessage("process",{input:t,options:n,context:i});const l=await A.result;return await l.result}async function Ae(e,t,n,i){switch(n){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:n,input:s,options:o}=i;try{const i=await e(s,o);t.postMessage("done",{id:n,result:i})}catch(r){const e=r instanceof Error?r.message:"unknown error";t.postMessage("error",{id:n,error:e})}}}function le(...e){return function(e){const t=e.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),n=t.reduce((e,t)=>e+t.byteLength,0),i=new Uint8Array(n);let r=0;for(const s of t)i.set(s,r),r+=s.byteLength;return i.buffer}(e)}function ce(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}class ue{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ce(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ce()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class he{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(e=>this._getOrCreate(e))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(i=e instanceof ue?e:new ue(t,n),this.stats[t]=i),i}}const de={};function fe(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return e;var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function pe(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}const ge=e=>"function"==typeof e,me=e=>null!==e&&"object"==typeof e,_e=e=>me(e)&&e.constructor==={}.constructor,ve=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,ye=e=>"undefined"!=typeof Blob&&e instanceof Blob,be=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||me(e)&&ge(e.tee)&&ge(e.cancel)&&ge(e.getReader))(e)||(e=>me(e)&&ge(e.read)&&ge(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e);class we extends Error{constructor(e,t){super(e),i(this,"reason"),i(this,"url"),i(this,"response"),this.reason=t.reason,this.url=t.url,this.response=t.response}}const Ee=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,xe=/^([-\w.]+\/[-\w.+]+)/;function Te(e,t){return e.toLowerCase()===t.toLowerCase()}function Se(e){const t=Ee.exec(e);return t?t[1]:""}const Ce=/\?.*/;function Pe(e){return e.replace(Ce,"")}function Re(e){if(ve(e)){return e.url}if(ye(e)){return e.name||""}return"string"==typeof e?e:""}function Ie(e){if(ve(e)){const t=e,n=t.headers.get("content-type")||"",i=Pe(t.url);return function(e){const t=xe.exec(e);return t?t[1]:e}(n)||Se(i)}if(ye(e)){return e.type||""}return"string"==typeof e?Se(e):""}async function Me(e){if(ve(e))return e;const t={},n=function(e){if(ve(e))return e.headers["content-length"]||-1;if(ye(e))return e.size;return"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);n>=0&&(t["content-length"]=String(n));const i=Re(e),r=Ie(e);r&&(t["content-type"]=r);const s=await async function(e){const t=5;if("string"==typeof e)return`data:,${e.slice(0,t)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(e=>{const n=new FileReader;n.onload=t=>{var n;return e(null==(n=null==t?void 0:t.target)?void 0:n.result)},n.readAsDataURL(t)})}if(e instanceof ArrayBuffer){return`data:base64,${function(e){let t="";const n=new Uint8Array(e);for(let i=0;i<n.byteLength;i++)t+=String.fromCharCode(n[i]);return btoa(t)}(e.slice(0,t))}`}return null}(e);s&&(t["x-first-bytes"]=s),"string"==typeof e&&(e=(new TextEncoder).encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:i}),o}async function ke(e){if(!e.ok){const t=await async function(e){const n=function(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}(e.url);let i=`Failed to fetch resource (${e.status}) ${e.statusText}: ${n}`;i=i.length>100?`${i.slice(0,100)}...`:i;const r={reason:e.statusText,url:e.url,response:e};try{const t=e.headers.get("Content-Type");r.reason=!e.bodyUsed&&(null==t?void 0:t.includes("application/json"))?await e.json():await e.text()}catch(t){}return new we(i,r)}(e);throw t}}async function Le(e,t){var n,i;if("string"==typeof e){const r=function(e){for(const t in de)if(e.startsWith(t)){const n=de[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${e}`),e}(e);return function(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}(r)&&(null==(n=globalThis.loaders)?void 0:n.fetchNode)?null==(i=globalThis.loaders)?void 0:i.fetchNode(r,t):await fetch(r,t)}return await Me(e)}const Be=new B({id:"loaders.gl"});class De{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const Oe={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){i(this,"console"),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:p,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Ne={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Fe(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function Ue(){const e=Fe();return e.globalOptions=e.globalOptions||{...Oe},e.globalOptions}function Ge(e,t,n,i){return n=n||[],function(e,t){ze(e,null,Oe,Ne,t);for(const n of t){const i=e&&e[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};ze(i,n.id,r,s,t)}}(e,n=Array.isArray(n)?n:[n]),function(e,t,n){const i=e.options||{},r={...i};(function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)})(r,n),null===r.log&&(r.log=new De);return We(r,Ue()),We(r,t),r}(t,e,i)}function ze(e,t,n,i,r){const s=t||"Top level",o=t?`${t}.`:"";for(const a in e){const A=!t&&me(e[a]);if(!(a in n)&&!("baseUri"===a&&!t)&&!("workerUrl"===a&&t))if(a in i)Be.warn(`${s} loader option '${o}${a}' no longer supported, use '${i[a]}'`)();else if(!A){const e=Ve(a,r);Be.warn(`${s} loader option '${o}${a}' not recognized. ${e}`)()}}}function Ve(e,t){const n=e.toLowerCase();let i="";for(const r of t)for(const t in r.options){if(e===t)return`Did you mean '${r.id}.${t}'?`;const s=t.toLowerCase();(n.startsWith(s)||s.startsWith(n))&&(i=i||`Did you mean '${r.id}.${t}'?`)}return i}function We(e,t){for(const n in t)if(n in t){const i=t[n];_e(i)&&_e(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function je(e){if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(null==e?void 0:e.extensions)}function He(e){let t;return f(e,"null loader"),f(je(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),((null==e?void 0:e.parseTextSync)||(null==e?void 0:e.parseText))&&(e.text=!0),e.text||(e.binary=!0),e}const Xe=()=>{const e=Fe();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};const Qe=/\.([^.]+)$/;function $e(e,t=[],n,i){if(!Ye(e))return null;if(t&&!Array.isArray(t))return He(t);let r=[];t&&(r=r.concat(t)),(null==n?void 0:n.ignoreRegisteredLoaders)||r.push(...Xe()),function(e){for(const t of e)He(t)}(r);const s=function(e,t,n,i){const r=Re(e),s=Ie(e),o=Pe(r)||(null==i?void 0:i.url);let a=null,A="";(null==n?void 0:n.mimeType)&&(a=Ze(t,null==n?void 0:n.mimeType),A=`match forced by supplied MIME type ${null==n?void 0:n.mimeType}`);a=a||function(e,t){const n=t&&Qe.exec(t),i=n&&n[1];return i?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,i):null}(t,o),A=A||(a?`matched url ${o}`:""),a=a||Ze(t,s),A=A||(a?`matched MIME type ${s}`:""),a=a||function(e,t){if(!t)return null;for(const n of e)if("string"==typeof t){if(qe(t,n))return n}else if(ArrayBuffer.isView(t)){if(Je(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer){if(Je(t,0,n))return n}return null}(t,e),A=A||(a?`matched initial data ${et(e)}`:""),(null==n?void 0:n.fallbackMimeType)&&(a=a||Ze(t,null==n?void 0:n.fallbackMimeType),A=A||(a?`matched fallback MIME type ${s}`:""));A&&G.log(1,`selectLoader selected ${null==a?void 0:a.name}: ${A}.`);return a}(e,r,n,i);if(!s&&!(null==n?void 0:n.nothrow))throw new Error(Ke(e));return s}function Ye(e){return!(e instanceof Response&&204===e.status)}function Ke(e){const t=Re(e),n=Ie(e);let i="No valid loader found (";i+=t?`${pe(t)}, `:"no url provided, ",i+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=e?et(e):"";return i+=r?` first bytes: "${r}"`:"first bytes: not available",i+=")",i}function Ze(e,t){var n;for(const i of e){if(null==(n=i.mimeTypes)?void 0:n.some(e=>Te(t,e)))return i;if(Te(t,`application/x.${i.id}`))return i}return null}function qe(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}function Je(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(n=>function(e,t,n,i){if(i instanceof ArrayBuffer)return function(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const i=new Uint8Array(e),r=new Uint8Array(t);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(i,e,i.byteLength);switch(typeof i){case"function":return i(e);case"string":return i===tt(e,t,i.length);default:return!1}}(e,t,0,n))}function et(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return tt(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return tt(e,0,t)}return""}function tt(e,t,n){if(e.byteLength<t+n)return"";const i=new DataView(e);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(t+s));return r}const nt=262144;function it(e,t){return p?async function*(e,t){const n=e.getReader();let i;try{for(;;){const e=i||n.read();(null==t?void 0:t._streamReadAhead)&&(i=n.read());const{done:r,value:s}=await e;if(r)return;yield fe(s)}}catch(r){n.releaseLock()}}(e,t):async function*(e){for await(const t of e)yield fe(t)}(e)}function rt(e,t){if("string"==typeof e)return function*(e,t){const n=(null==t?void 0:t.chunkSize)||262144;let i=0;const r=new TextEncoder;for(;i<e.length;){const t=Math.min(e.length-i,n),s=e.slice(i,i+t);i+=t,yield r.encode(s)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){const{chunkSize:n=nt}=t;let i=0;for(;i<e.byteLength;){const t=Math.min(e.byteLength-i,n),r=new ArrayBuffer(t),s=new Uint8Array(e,i,t);new Uint8Array(r).set(s),i+=t,yield r}}(e,t);if(ye(e))return async function*(e,t){const n=(null==t?void 0:t.chunkSize)||1048576;let i=0;for(;i<e.size;){const t=i+n,r=await e.slice(i,t).arrayBuffer();i=t,yield r}}(e,t);if(be(e))return it(e,t);if(ve(e)){return it(e.body,t)}throw new Error("makeIterator")}const st="Cannot convert supplied data type";async function ot(e,t,n){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||i)return function(e,t){if(t.text&&"string"==typeof e)return e;var n;if((n=e)&&"object"==typeof n&&n.isBuffer&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const i=e.byteLength||e.length;return 0===e.byteOffset&&i===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+i)),n}throw new Error(st)}(e,t);if(ye(e)&&(e=await Me(e)),ve(e)){const n=e;return await ke(n),t.binary?await n.arrayBuffer():await n.text()}if(be(e)&&(e=rt(e,n)),r=e,Boolean(r)&&"function"==typeof r[Symbol.iterator]||(e=>e&&"function"==typeof e[Symbol.asyncIterator])(e))return async function(e){const t=[];for await(const n of e)t.push(n);return le(...t)}(e);var r;throw new Error(st)}function at(e,t){const n=Ue(),i=e||n;return"function"==typeof i.fetch?i.fetch:me(i.fetch)?e=>Le(e,i.fetch):(null==t?void 0:t.fetch)?null==t?void 0:t.fetch:Le}function At(e,t,n){if(n)return n;const i={fetch:at(t,e),...e};if(i.url){const e=Pe(i.url);i.baseUrl=e,i.queryString=function(e){const t=e.match(Ce);return t&&t[0]}(i.url),i.filename=pe(e),i.baseUrl=function(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}(e)}return Array.isArray(i.loaders)||(i.loaders=null),i}async function lt(e,t,n,i){!t||Array.isArray(t)||je(t)||(i=void 0,n=t,t=void 0),n=n||{};const r=Re(e=await e),s=function(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:void 0}(t,i),o=await async function(e,t=[],n,i){if(!Ye(e))return null;let r=$e(e,t,{...n,nothrow:!0},i);if(r)return r;if(ye(e)&&(r=$e(e=await e.slice(0,10).arrayBuffer(),t,n,i)),!r&&!(null==n?void 0:n.nothrow))throw new Error(Ke(e));return r}(e,s,n);return o?(i=At({url:r,_parse:lt,loaders:s},n=Ge(n,o,s,r),i||null),await async function(e,t,n,i){if(function(e){j(e,"no worker provided");const t=e.version}(e),n=z(e.options,n),ve(t)){const e=t,{ok:n,redirected:r,status:s,statusText:o,type:a,url:A}=e,l=Object.fromEntries(e.headers.entries());i.response={headers:l,ok:n,redirected:r,status:s,statusText:o,type:a,url:A}}t=await ot(t,e,n);const r=e;if(r.parseTextSync&&"string"==typeof t)return r.parseTextSync(t,n,i);if(function(e,t){return!!oe.isSupported()&&!(!H&&!(null==t?void 0:t._nodeWorkers))&&e.worker&&(null==t?void 0:t.worker)}(e,n))return await ae(e,t,n,i,lt);if(r.parseText&&"string"==typeof t)return await r.parseText(t,n,i);if(r.parse)return await r.parse(t,n,i);throw j(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(o,e,n,i)):null}async function ct(e,t,n,i){let r,s;Array.isArray(t)||je(t)?(r=t,s=n):(r=[],s=t);const o=at(s);let a=e;return"string"==typeof e&&(a=await o(e)),ye(e)&&(a=await o(e)),Array.isArray(r),await lt(a,r,s)}const ut=null==(e=globalThis.loaders)?void 0:e.parseImageNode,ht="undefined"!=typeof Image,dt="undefined"!=typeof ImageBitmap,ft=Boolean(ut),pt=!!p||ft;function gt(e){const t=function(e){if("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&e instanceof Image)return"image";if(e&&"object"==typeof e&&e.data&&e.width&&e.height)return"data";return null}(e);if(!t)throw new Error("Not an image");return t}const mt=/^data:image\/svg\+xml/,_t=/\.svg((\?|#).*)?$/;function vt(e){return e&&(mt.test(e)||_t.test(e))}function yt(e,t){if(vt(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function bt(e,t,n){const i=function(e,t){if(vt(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return yt(e,t)}(e,n),r=self.URL||self.webkitURL,s="string"!=typeof i&&r.createObjectURL(i);try{return await async function(e,t){const n=new Image;if(n.src=e,t.image&&t.image.decode&&n.decode)return await n.decode(),n;return await new Promise((e,t)=>{try{n.onload=()=>e(n),n.onerror=e=>{const n=e instanceof Error?e.message:"error";t(new Error(n))}}catch(i){t(i)}})}(s||i,t)}finally{s&&r.revokeObjectURL(s)}}const wt={};let Et=!0;async function xt(e,t,n){let i;if(vt(n)){i=await bt(e,t,n)}else i=yt(e,n);const r=t&&t.imagebitmap;return await async function(e,t=null){!function(e){for(const t in e||wt)return!1;return!0}(t)&&Et||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(n){Et=!1}return await createImageBitmap(e)}(i,r)}function Tt(e){return function(e,t,n=0){const i=(r=t,[...r].map(e=>e.charCodeAt(0)));var r;for(let s=0;s<i.length;++s)if(i[s]!==e[s+n])return!1;return!0}(e,"ftyp",4)&&96&e[8]?function(e){switch((t=e,n=8,i=12,String.fromCharCode(...t.slice(n,i))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var t,n,i}(e):null}const St=!1,Ct=!0;function Pt(e){const t=Rt(e);return function(e){const t=Rt(e),n=t.byteLength>=24&&2303741511===t.getUint32(0,St);if(!n)return null;return{mimeType:"image/png",width:t.getUint32(16,St),height:t.getUint32(20,St)}}(t)||function(e){const t=Rt(e),n=t.byteLength>=3&&65496===t.getUint16(0,St)&&255===t.getUint8(2);if(!n)return null;const{tableMarkers:i,sofMarkers:r}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)e.add(n);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let s=2;for(;s+9<t.byteLength;){const e=t.getUint16(s,St);if(r.has(e))return{mimeType:"image/jpeg",height:t.getUint16(s+5,St),width:t.getUint16(s+7,St)};if(!i.has(e))return null;s+=2,s+=t.getUint16(s,St)}return null}(t)||function(e){const t=Rt(e),n=t.byteLength>=10&&1195984440===t.getUint32(0,St);if(!n)return null;return{mimeType:"image/gif",width:t.getUint16(6,Ct),height:t.getUint16(8,Ct)}}(t)||function(e){const t=Rt(e),n=t.byteLength>=14&&16973===t.getUint16(0,St)&&t.getUint32(2,Ct)===t.byteLength;if(!n)return null;return{mimeType:"image/bmp",width:t.getUint32(18,Ct),height:t.getUint32(22,Ct)}}(t)||function(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),n=Tt(t);if(!n)return null;return{mimeType:n.mimeType,width:0,height:0}}(t)}function Rt(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const It={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(e,t,n){const i=((t=t||{}).image||{}).type||"auto",{url:r}=n||{};let s;switch(function(e){switch(e){case"auto":case"data":return function(){if(dt)return"imagebitmap";if(ht)return"image";if(pt)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return dt||ht||pt;case"imagebitmap":return dt;case"image":return ht;case"data":return pt;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(i)){case"imagebitmap":s=await xt(e,t,r);break;case"image":s=await bt(e,t,r);break;case"data":s=await async function(e){var t;const{mimeType:n}=Pt(e)||{},i=null==(t=globalThis.loaders)?void 0:t.parseImageNode;return f(i),await i(e,n)}(e);break;default:f(!1)}return"data"===i&&(s=function(e){switch(gt(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(s)),s},tests:[e=>Boolean(Pt(new DataView(e)))],options:{image:{type:"auto",decode:!0}}},Mt=new B({id:"deck"});let kt={};function Lt(e){kt=e}function Bt(e,t,n,i){Mt.level>0&&kt[e]&&kt[e].call(null,t,n,i)}const Dt={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){const t=e[0],n=e[e.length-1];return"{"===t&&"}"===n||"["===t&&"]"===n},parseTextSync:JSON.parse};const Ot=function(){const e="9.2.5",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(Mt.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:Mt,_registerLoggers:Lt},function(e){const t=Xe();e=Array.isArray(e)?e:[e];for(const n of e){const e=He(n);t.find(t=>e===t)||t.unshift(e)}}([Dt,[It,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}();function Nt(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const Ft={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function Ut(e){let t=Gt(e);if("object"!==t)return{value:e,...Ft[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...Ft[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=Gt(e.value),{...e,...Ft[t],type:t}):{type:"object",value:null};throw new Error("props")}function Gt(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const zt={vertex:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",fragment:"#ifdef MODULE_MATERIAL\n  fragColor = material_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  fragColor = lighting_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_FOG\n  fragColor = fog_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  fragColor = picking_filterHighlightColor(fragColor);\n  fragColor = picking_filterPickingColor(fragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},Vt=/void\s+main\s*\([^)]*\)\s*\{\n?/,Wt=/}\n?[^{}]*$/,jt=[],Ht="__LUMA_INJECT_DECLARATIONS__";function Xt(e){const t={vertex:{},fragment:{}};for(const n in e){let i=e[n];"string"==typeof i&&(i={order:0,injection:i}),t[Qt(n)][n]=i}return t}function Qt(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function $t(e,t,n,i=!1){const r="vertex"===t;for(const s in n){const t=n[s];t.sort((e,t)=>e.order-t.order),jt.length=t.length;for(let e=0,n=t.length;e<n;++e)jt[e]=t[e].injection;const i=`${jt.join("\n")}\n`;switch(s){case"vs:#decl":r&&(e=e.replace(Ht,i));break;case"vs:#main-start":r&&(e=e.replace(Vt,e=>e+i));break;case"vs:#main-end":r&&(e=e.replace(Wt,e=>i+e));break;case"fs:#decl":r||(e=e.replace(Ht,i));break;case"fs:#main-start":r||(e=e.replace(Vt,e=>e+i));break;case"fs:#main-end":r||(e=e.replace(Wt,e=>i+e));break;default:e=e.replace(s,e=>e+i)}}return e=e.replace(Ht,""),i&&(e=e.replace(/\}\s*$/,e=>e+zt[t])),e}function Yt(e){e.map(e=>function(e){if(e.instance)return;Yt(e.dependencies||[]);const{propTypes:t={},deprecations:n=[],inject:i={}}=e,r={normalizedInjections:Xt(i),parsedDeprecations:Zt(n)};t&&(r.propValidators=function(e){const t={};for(const[n,i]of Object.entries(e))t[n]=Ut(i);return t}(t));e.instance=r;let s={};t&&(s=Object.entries(t).reduce((e,[t,n])=>{const i=null==n?void 0:n.value;return i&&(e[t]=i),e},{}));e.defaultUniforms={...e.defaultUniforms,...s}}(e))}function Kt(e,t,n){var i;null==(i=e.deprecations)||i.forEach(e=>{var i;(null==(i=e.regex)?void 0:i.test(t))&&(e.deprecated?n.deprecated(e.old,e.new)():n.removed(e.old,e.new)())})}function Zt(e){return e.forEach(e=>{if("function"===e.type)e.regex=new RegExp(`\\b${e.old}\\(`);else e.regex=new RegExp(`${e.type} ${e.old};`)}),e}function qt(e){Yt(e);const t={},n={};Jt({modules:e,level:0,moduleMap:t,moduleDepth:n});const i=Object.keys(n).sort((e,t)=>n[t]-n[e]).map(e=>t[e]);return Yt(i),i}function Jt(e){const{modules:t,level:n,moduleMap:i,moduleDepth:r}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)i[s.name]=s,(void 0===r[s.name]||r[s.name]<n)&&(r[s.name]=n);for(const s of t)s.dependencies&&Jt({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}const en=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],tn=[...en,[sn("attribute"),"in $1"],[sn("varying"),"out $1"]],nn=[...en,[sn("varying"),"in $1"]];function rn(e,t){for(const[n,i]of t)e=e.replace(n,i);return e}function sn(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function on(e,t){let n="";for(const i in e){const r=e[i];if(n+=`void ${r.signature} {\n`,r.header&&(n+=`  ${r.header}`),t[i]){const e=t[i];e.sort((e,t)=>e.order-t.order);for(const t of e)n+=`  ${t.injection}\n`}r.footer&&(n+=`  ${r.footer}`),n+="}\n"}return n}function an(e){const t={vertex:{},fragment:{}};for(const n of e){let e,i;"string"!=typeof n?(e=n,i=e.hook):(e={},i=n),i=i.trim();const[r,s]=i.split(":"),o=i.replace(/\(.+/,""),a=Object.assign(e,{signature:s});switch(r){case"vs":t.vertex[o]=a;break;case"fs":t.fragment[o]=a;break;default:throw new Error(r)}}return t}function An(e,t="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function ln(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error(`Invalid GLSL version ${t}`);return t}const cn=`\n\n${Ht}\n`;function un(e,t){var n;const{source:i,stage:r,modules:s,hookFunctions:o=[],inject:a={},log:A}=t;Nt("string"==typeof i,"shader source must be a string");const l=i;let c="";const u=an(o),h={},d={},f={};for(const g in a){const e="string"==typeof a[g]?{injection:a[g],order:0}:a[g],t=/^(v|f)s:(#)?([\w-]+)$/.exec(g);if(t){const n=t[2],i=t[3];n?"decl"===i?d[g]=[e]:f[g]=[e]:h[g]=[e]}else f[g]=[e]}const p=s;for(const g of p){A&&Kt(g,l,A);c+=fn(g,"wgsl");const e=(null==(n=g.injections)?void 0:n[r])||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const i="decl"===n[2]?d:f;i[t]=i[t]||[],i[t].push(e[t])}else h[t]=h[t]||[],h[t].push(e[t])}}return c+=cn,c=$t(c,r,d),c+=on(u[r],h),c+=l,c=$t(c,r,f),c}function hn(e,t){var n;const{source:i,stage:r,language:s="glsl",modules:o,defines:a={},hookFunctions:A=[],inject:l={},prologue:c=!0,log:u}=t;Nt("string"==typeof i,"shader source must be a string");const h="glsl"===s?function(e,t){return{name:An(e,t),language:"glsl",version:ln(e)}}(i).version:-1,d=e.shaderLanguageVersion,f=100===h?"#version 100":"#version 300 es",p=i.split("\n").slice(1).join("\n"),g={};o.forEach(e=>{Object.assign(g,e.defines)}),Object.assign(g,a);let m="";switch(s){case"wgsl":break;case"glsl":m=c?`${f}\n\n// ----- PROLOGUE -------------------------\n#define SHADER_TYPE_${r.toUpperCase()}\n\n${function(e){switch(null==e?void 0:e.gpu.toLowerCase()){case"apple":return"#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e)}\n${"fragment"===r?"precision highp float;\n":""}\n\n// ----- APPLICATION DEFINES -------------------------\n\n${function(e={}){let t="";for(const n in e){const i=e[n];(i||Number.isFinite(i))&&(t+=`#define ${n.toUpperCase()} ${e[n]}\n`)}return t}(g)}\n\n`:`${f}\n`}const _=an(A),v={},y={},b={};for(const w in l){const e="string"==typeof l[w]?{injection:l[w],order:0}:l[w],t=/^(v|f)s:(#)?([\w-]+)$/.exec(w);if(t){const n=t[2],i=t[3];n?"decl"===i?y[w]=[e]:b[w]=[e]:v[w]=[e]}else b[w]=[e]}for(const w of o){u&&Kt(w,p,u);m+=fn(w,r);const e=(null==(n=w.instance)?void 0:n.normalizedInjections[r])||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const i="decl"===n[2]?y:b;i[t]=i[t]||[],i[t].push(e[t])}else v[t]=v[t]||[],v[t].push(e[t])}}return m+="// ----- MAIN SHADER SOURCE -------------------------",m+=cn,m=$t(m,r,y),m+=on(_[r],v),m+=p,m=$t(m,r,b),"glsl"===s&&h!==d&&(m=function(e,t){var n;if(300!==Number((null==(n=e.match(/^#version[ \t]+(\d+)/m))?void 0:n[1])||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return rn(e,tn);case"fragment":return rn(e,nn);default:throw new Error(t)}}(m,r)),m.trim()}function dn(e){return function(t){var n;const i={};for(const r of e){const e=null==(n=r.getUniforms)?void 0:n.call(r,t,i);Object.assign(i,e)}return i}}function fn(e,t){let n;switch(t){case"vertex":n=e.vs||"";break;case"fragment":n=e.fs||"";break;case"wgsl":n=e.source||"";break;default:Nt(!1)}if(!e.name)throw new Error("Shader module must have a name");const i=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${e.name} ---------------\n\n`;return"wgsl"!==t&&(r+=`#define MODULE_${i}\n`),r+=`${n}\n`,r}const pn=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,gn=/^\s*\#\s*endif\s*$/;const mn=class e{constructor(){i(this,"_hookFunctions",[]),i(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return e.defaultShaderAssembler=e.defaultShaderAssembler||new e,e.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===("string"==typeof e?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:r}=function(e){const t=qt(e.modules||[]);return{source:un(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:dn(t)}}({...e,source:e.source,modules:t,hookFunctions:n}),s="wgsl"===e.platformInfo.shaderLanguage?function(e,t){var n;const i=e.split("\n"),r=[];let s=!0,o=null;for(const a of i){const e=a.match(pn),i=a.match(gn);e?(o=e[1],s=Boolean(null==(n=null==t?void 0:t.defines)?void 0:n[o])):i?s=!0:s&&r.push(a)}return r.join("\n")}(i):i;return{source:s,getUniforms:r,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,i=function(e){const{vs:t,fs:n}=e,i=qt(e.modules||[]);return{vs:hn(e.platformInfo,{...e,source:t,stage:"vertex",modules:i}),fs:hn(e.platformInfo,{...e,source:n,stage:"fragment",modules:i}),getUniforms:dn(i)}}({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n});return{...i,modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let r=0,s=this._defaultModules.length;r<s;++r){const e=this._defaultModules[r],s=e.name;t[i++]=e,n[s]=!0}for(let r=0,s=e.length;r<s;++r){const s=e[r],o=s.name;n[o]||(t[i++]=s,n[o]=!0)}return t.length=i,Yt(t),t}};i(mn,"defaultShaderAssembler");let _n=mn;function vn(e){const{input:t,inputChannels:n,output:i}=e||{};if(!t)return"#version 300 es\nout vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}";if(!n)throw new Error("inputChannels");return`#version 300 es\nin ${function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}(n)} ${t};\nout vec4 ${i};\nvoid main() {\n  ${i} = ${function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}(t,n)};\n}`}const yn=new class{constructor(){i(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new he({id:e})),this.stats.get(e)}},bn=new B({id:"luma.gl"}),wn={};function En(e="id"){wn[e]=wn[e]||1;return`${e}-${wn[e]++}`}let xn=(t=class{constructor(e,t,n){if(i(this,"id"),i(this,"props"),i(this,"userData",{}),i(this,"_device"),i(this,"destroyed",!1),i(this,"allocatedBytes",0),i(this,"_attachedResources",new Set),!e)throw new Error("no device");this._device=e,this.props=function(e,t){const n={...t};for(const i in e)void 0!==e[i]&&(n[i]=e[i]);return n}(t,n);const r="undefined"!==this.props.id?this.props.id:En(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},i(t,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),t);const Tn=class e extends xn{constructor(t,n){const r={...n};(n.usage||0)&e.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?r.indexType="uint32":n.data instanceof Uint16Array&&(r.indexType="uint16")),delete r.data,super(t,r,e.defaultProps),i(this,"usage"),i(this,"indexType"),i(this,"updateTimestamp"),i(this,"debugData",new ArrayBuffer(0)),this.usage=r.usage||0,this.indexType=r.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(e){return this.device.createBuffer({...this.props,...e})}_setDebugData(t,n,i){const r=ArrayBuffer.isView(t)?t.buffer:t,s=Math.min(t?t.byteLength:i,e.DEBUG_DATA_MAX_LENGTH);null===r?this.debugData=new ArrayBuffer(s):0===n&&i===r.byteLength?this.debugData=r.slice(0,s):this.debugData=r.slice(n,n+s)}};i(Tn,"INDEX",16),i(Tn,"VERTEX",32),i(Tn,"UNIFORM",64),i(Tn,"STORAGE",128),i(Tn,"INDIRECT",256),i(Tn,"QUERY_RESOLVE",512),i(Tn,"MAP_READ",1),i(Tn,"MAP_WRITE",2),i(Tn,"COPY_SRC",4),i(Tn,"COPY_DST",8),i(Tn,"DEBUG_DATA_MAX_LENGTH",32),i(Tn,"defaultProps",{...xn.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0});let Sn=Tn;function Cn(e){const[t,n,i]=Mn[e],r=e.includes("norm");return{signedType:t,primitiveType:n,byteLength:i,normalized:r,integer:!r&&!e.startsWith("float"),signed:e.startsWith("s")}}function Pn(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}function Rn(e){const t=ArrayBuffer.isView(e)?e.constructor:e;if(t===Uint8ClampedArray)return"uint8";const n=Object.values(Mn).find(e=>t===e[4]);if(!n)throw new Error(t.name);return n[0]}function In(e){const[,,,,t]=Mn[e];return t}const Mn={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function kn(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[n,i]=e.split("x"),r=n,s=i?parseInt(i):1,o=Cn(r),a={type:r,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return t&&(a.webglOnly=!0),a}function Ln(e,t,n){if(!t||t>4)throw new Error(`size ${t}`);const i=t;return function(e,t,n){const i=n?function(e){const t=e;switch(t){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return t}}(e):e;switch(i){case"unorm8":return 1===t?"unorm8":3===t?"unorm8x3-webgl":`${i}x${t}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(1===t||3===t)throw new Error(`size: ${t}`);return`${i}x${t}`;default:return 1===t?i:`${i}x${t}`}}(Rn(e),i,n)}const Bn="texture-compression-bc",Dn="texture-compression-astc",On="texture-compression-etc2",Nn="texture-compression-pvrtc-webgl",Fn="texture-compression-atc-webgl",Un="float32-renderable-webgl",Gn="float16-renderable-webgl",zn="snorm8-renderable-webgl",Vn="norm16-renderable-webgl",Wn="snorm16-renderable-webgl",jn="float32-filterable",Hn="float16-filterable-webgl";function Xn(e){const t=Qn[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}const Qn={...{r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:zn},rg8snorm:{render:zn},"rgb8snorm-webgl":{},rgba8snorm:{render:zn},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:Vn},rg16unorm:{render:Vn},"rgb16unorm-webgl":{f:Vn},rgba16unorm:{render:Vn},r16snorm:{f:Wn},rg16snorm:{render:Wn},"rgb16snorm-webgl":{f:Vn},rgba16snorm:{render:Wn},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:Gn,filter:"float16-filterable-webgl"},rg16float:{render:Gn,filter:Hn},rgba16float:{render:Gn,filter:Hn},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:Un,filter:jn},rg32float:{render:!1,filter:jn},"rgb32float-webgl":{render:Un,filter:jn},rgba32float:{render:Un,filter:jn},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:"rgb9e5ufloat-renderable-webgl"},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Un},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},...{"bc1-rgb-unorm-webgl":{f:Bn},"bc1-rgb-unorm-srgb-webgl":{f:Bn},"bc1-rgba-unorm":{f:Bn},"bc1-rgba-unorm-srgb":{f:Bn},"bc2-rgba-unorm":{f:Bn},"bc2-rgba-unorm-srgb":{f:Bn},"bc3-rgba-unorm":{f:Bn},"bc3-rgba-unorm-srgb":{f:Bn},"bc4-r-unorm":{f:Bn},"bc4-r-snorm":{f:Bn},"bc5-rg-unorm":{f:Bn},"bc5-rg-snorm":{f:Bn},"bc6h-rgb-ufloat":{f:Bn},"bc6h-rgb-float":{f:Bn},"bc7-rgba-unorm":{f:Bn},"bc7-rgba-unorm-srgb":{f:Bn},"etc2-rgb8unorm":{f:On},"etc2-rgb8unorm-srgb":{f:On},"etc2-rgb8a1unorm":{f:On},"etc2-rgb8a1unorm-srgb":{f:On},"etc2-rgba8unorm":{f:On},"etc2-rgba8unorm-srgb":{f:On},"eac-r11unorm":{f:On},"eac-r11snorm":{f:On},"eac-rg11unorm":{f:On},"eac-rg11snorm":{f:On},"astc-4x4-unorm":{f:Dn},"astc-4x4-unorm-srgb":{f:Dn},"astc-5x4-unorm":{f:Dn},"astc-5x4-unorm-srgb":{f:Dn},"astc-5x5-unorm":{f:Dn},"astc-5x5-unorm-srgb":{f:Dn},"astc-6x5-unorm":{f:Dn},"astc-6x5-unorm-srgb":{f:Dn},"astc-6x6-unorm":{f:Dn},"astc-6x6-unorm-srgb":{f:Dn},"astc-8x5-unorm":{f:Dn},"astc-8x5-unorm-srgb":{f:Dn},"astc-8x6-unorm":{f:Dn},"astc-8x6-unorm-srgb":{f:Dn},"astc-8x8-unorm":{f:Dn},"astc-8x8-unorm-srgb":{f:Dn},"astc-10x5-unorm":{f:Dn},"astc-10x5-unorm-srgb":{f:Dn},"astc-10x6-unorm":{f:Dn},"astc-10x6-unorm-srgb":{f:Dn},"astc-10x8-unorm":{f:Dn},"astc-10x8-unorm-srgb":{f:Dn},"astc-10x10-unorm":{f:Dn},"astc-10x10-unorm-srgb":{f:Dn},"astc-12x10-unorm":{f:Dn},"astc-12x10-unorm-srgb":{f:Dn},"astc-12x12-unorm":{f:Dn},"astc-12x12-unorm-srgb":{f:Dn},"pvrtc-rgb4unorm-webgl":{f:Nn},"pvrtc-rgba4unorm-webgl":{f:Nn},"pvrtc-rbg2unorm-webgl":{f:Nn},"pvrtc-rgba2unorm-webgl":{f:Nn},"etc1-rbg-unorm-webgl":{f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{f:Fn},"atc-rgba-unorm-webgl":{f:Fn},"atc-rgbai-unorm-webgl":{f:Fn}}},$n=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Yn=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;const Kn=new class{getInfo(e){return Zn(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return $n.some(t=>e.startsWith(t))}getCapabilities(e){const t=Xn(e),n={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},i=Zn(e),r=e.startsWith("depth")||e.startsWith("stencil"),s=null==i?void 0:i.signed,o=null==i?void 0:i.integer,a=null==i?void 0:i.webgl;return n.render&&(n.render=!s),n.filter&&(n.filter=!(r||s||o||a)),n}};function Zn(e){let t=function(e){var t;const n=Xn(e),i=n.bytesPerPixel||1,r=n.bitsPerChannel||[8,8,8,8];delete n.bitsPerChannel,delete n.bytesPerPixel,delete n.f,delete n.render,delete n.filter,delete n.blend,delete n.store;const s={...n,format:e,attachment:n.attachment||"color",channels:n.channels||"r",components:n.components||(null==(t=n.channels)?void 0:t.length)||1,bytesPerPixel:i,bitsPerChannel:r,dataType:n.dataType||"uint8",srgb:n.srgb??!1,packed:n.packed??!1,webgl:n.webgl??!1,integer:n.integer??!1,signed:n.signed??!1,normalized:n.normalized??!1,compressed:n.compressed??!1};return s}(e);if(Kn.isCompressed(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=function(e){const t=/.*-(\d+)x(\d+)-.*/.exec(e);if(t){const[,e,n]=t;return{blockWidth:Number(e),blockHeight:Number(n)}}return null}(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const n=Yn.exec(e);if(n){const[,i,r,s,o,a]=n,A=Cn(`${s}${r}`),l=8*A.byteLength,c=i.length,u=[l,c>=2?l:0,c>=3?l:0,c>=4?l:0];t={format:e,attachment:t.attachment,dataType:A.signedType,components:c,channels:i,integer:A.integer,signed:A.signed,normalized:A.normalized,bitsPerChannel:u,bytesPerPixel:A.byteLength*i.length,packed:t.packed,srgb:t.srgb},"-webgl"===a&&(t.webgl=!0),"-srgb"===o&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}class qn{}class Jn{constructor(e=[],t){i(this,"features"),i(this,"disabledFeatures"),this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!(null==(t=this.disabledFeatures)?void 0:t[e])&&this.features.has(e)}}const ei=class e{constructor(t){i(this,"id"),i(this,"props"),i(this,"userData",{}),i(this,"statsManager",yn),i(this,"timestamp",0),i(this,"_reused",!1),i(this,"_lumaData",{}),i(this,"_textureCaps",{}),this.props={...e.defaultProps,...t},this.id=this.props.id||En(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}getVertexFormatInfo(e){return kn(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return Kn.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const n=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,n=1){const i=Math.max(e,t,n);return 1+Math.floor(Math.log2(i))}isExternalImage(e){return function(e){return"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas}(e)}getExternalImageSize(e){return function(e){if("undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if("undefined"!=typeof VideoFrame&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return Kn.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){var e;null==(e=this.commandEncoder)||e.popDebugGroup()}insertDebugMarker(e){var t;null==(t=this.commandEncoder)||t.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...n){return this.props.onError(e,t)?()=>{}:bn.error(e.message,t,...n)}debug(){if(this.props.debug);else{const e="'Type luma.log.set({debug: true}) in console to enable debug breakpoints',\nor create a device with the 'debug: true' prop.";bn.once(0,e)()}}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return!0===e.createCanvasContext?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=Kn.getCapabilities(e),n=e=>("string"==typeof e?this.features.has(e):e)??!0,i=n(t.create);return{format:e,create:i,render:i&&n(t.render),filter:i&&n(t.filter),blend:i&&n(t.blend),store:i&&n(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&Sn.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array&&(t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}};i(ei,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[n,i]=e.getDevicePixelSize();bn.log(1,`${e} resized => ${n}x${i}px`)()},onPositionChange:(e,t)=>{const[n,i]=e.getPosition();bn.log(1,`${e} repositioned => ${n},${i}`)()},onVisibilityChange:e=>bn.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>bn.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:bn.get("debug")||void 0,debugShaders:bn.get("debug-shaders")||void 0,debugFramebuffers:Boolean(bn.get("debug-framebuffers")),debugFactories:Boolean(bn.get("debug-factories")),debugWebGL:Boolean(bn.get("debug-webgl")),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0});let ti=ei;const ni="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",ii=class e{constructor(){if(i(this,"stats",yn),i(this,"log",bn),i(this,"VERSION","9.2.5"),i(this,"spector"),i(this,"preregisteredAdapters",new Map),globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw bn.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),bn.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");bn.error("This version of luma.gl has already been initialized")()}bn.log(1,`${this.VERSION} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=this}async createDevice(t={}){const n={...e.defaultProps,...t},i=this.selectAdapter(n.type,n.adapters);if(!i)throw new Error(ni);return n.waitForPageLoad&&await i.pageLoaded,await i.create(n)}async attachDevice(e,t){var n;const i=this._getTypeFromHandle(e,t.adapters),r=i&&this.selectAdapter(i,t.adapters);if(!r)throw new Error(ni);return await(null==(n=null==r?void 0:r.attach)?void 0:n.call(r,e,t))}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,e])=>e).filter(e=>{var t;return null==(t=e.isSupported)?void 0:t.call(e)}).map(e=>e.type)}getBestAvailableAdapterType(e=[]){var t,n;const i=["webgpu","webgl","null"],r=this._getAdapterMap(e);for(const s of i)if(null==(n=null==(t=r.get(s))?void 0:t.isSupported)?void 0:n.call(t))return s;return null}selectAdapter(e,t=[]){let n=e;"best-available"===e&&(n=this.getBestAvailableAdapterType(t));const i=this._getAdapterMap(t);return n&&i.get(n)||null}enforceWebGL2(e=!0,t=[]){var n;const i=this._getAdapterMap(t).get("webgl");i||bn.warn("enforceWebGL2: webgl adapter not found")(),null==(n=null==i?void 0:i.enforceWebGL2)||n.call(i,e)}setDefaultDeviceProps(t){Object.assign(e.defaultProps,t)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":"undefined"!=typeof GPUDevice&&e instanceof GPUDevice||(null==e?void 0:e.queue)?"webgpu":null===e?"null":(e instanceof WebGLRenderingContext?bn.warn("WebGL1 is not supported",e)():bn.warn("Unknown handle type",e)(),null)}};i(ii,"defaultProps",{...ti.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0});const ri=new ii;class si{get pageLoaded(){return function(){Ai||(Ai=ai()||"undefined"==typeof window?Promise.resolve():new Promise(e=>window.addEventListener("load",()=>e())));return Ai}()}}const oi=b()&&"undefined"!=typeof document,ai=()=>oi&&"complete"===document.readyState;let Ai=null;const li=class e{constructor(t){var n,r;if(i(this,"id"),i(this,"props"),i(this,"canvas"),i(this,"htmlCanvas"),i(this,"offscreenCanvas"),i(this,"type"),i(this,"initialized"),i(this,"isInitialized",!1),i(this,"isVisible",!0),i(this,"cssWidth"),i(this,"cssHeight"),i(this,"devicePixelRatio"),i(this,"devicePixelWidth"),i(this,"devicePixelHeight"),i(this,"drawingBufferWidth"),i(this,"drawingBufferHeight"),i(this,"_initializedResolvers",function(){let e,t;return{promise:new Promise((n,i)=>{e=n,t=i}),resolve:e,reject:t}}()),i(this,"_resizeObserver"),i(this,"_intersectionObserver"),i(this,"_position"),i(this,"destroyed",!1),this.props={...e.defaultProps,...t},t=this.props,this.initialized=this._initializedResolvers.promise,b()?t.canvas?"string"==typeof t.canvas?this.canvas=function(e){const t=document.getElementById(e);if(!ci.isHTMLCanvas(t))throw new Error("Object is not a canvas element");return t}(t.canvas):this.canvas=t.canvas:this.canvas=function(e){const{width:t,height:n}=e,i=document.createElement("canvas");i.id=En("lumagl-auto-created-canvas"),i.width=t||1,i.height=n||1,i.style.width=Number.isFinite(t)?`${t}px`:"100%",i.style.height=Number.isFinite(n)?`${n}px`:"100%",(null==e?void 0:e.visible)||(i.style.visibility="hidden");const r=function(e){if("string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error(`${e} is not an HTML element`);return t}if(e)return e;return document.body}((null==e?void 0:e.container)||null);return r.insertBefore(i,r.firstChild),i}(t):this.canvas={width:t.width||1,height:t.height||1},e.isHTMLCanvas(this.canvas)?(this.id=t.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):e.isOffscreenCanvas(this.canvas)?(this.id=t.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=t.id||"node-canvas-context",this.type="node"),this.cssWidth=(null==(n=this.htmlCanvas)?void 0:n.clientWidth)||this.canvas.width,this.cssHeight=(null==(r=this.htmlCanvas)?void 0:r.clientHeight)||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],e.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(e=>this._handleIntersection(e)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(e=>this._handleResize(e));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}static isHTMLCanvas(e){return"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return"undefined"!=typeof window&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){const n=this.cssToDeviceRatio(),[i,r]=this.getDrawingBufferSize();return function(e,t,n,i,r){const s=e,o=ui(s[0],t,n);let a=hi(s[1],t,i,r),A=ui(s[0]+1,t,n);const l=A===n-1?A:A-1;let c;A=hi(s[1]+1,t,i,r),r?(A=0===A?A:A+1,c=a,a=A):c=A===i-1?A:A-1;return{x:o,y:a,width:Math.max(l-o+1,1),height:Math.max(c-a+1,1)}}(e,n,i,r,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){var t;"lumagl-auto-created-canvas"===(null==(t=this.htmlCanvas)?void 0:t.id)&&(this.htmlCanvas.id=e)}_handleIntersection(e){const t=e.find(e=>e.target===this.canvas);if(!t)return;const n=t.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}_handleResize(e){var t,n;const i=e.find(e=>e.target===this.canvas);if(!i)return;this.cssWidth=i.contentBoxSize[0].inlineSize,this.cssHeight=i.contentBoxSize[0].blockSize;const r=this.getDevicePixelSize(),s=(null==(t=i.devicePixelContentBoxSize)?void 0:t[0].inlineSize)||i.contentBoxSize[0].inlineSize*devicePixelRatio,o=(null==(n=i.devicePixelContentBoxSize)?void 0:n[0].blockSize)||i.contentBoxSize[0].blockSize*devicePixelRatio,[a,A]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(s,a)),this.devicePixelHeight=Math.max(1,Math.min(o,A)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:r})}_updateDrawingBufferSize(){if(this.props.autoResize){if("number"==typeof this.props.useDevicePixels){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){var e,t,n;const i=null==(e=this.htmlCanvas)?void 0:e.getBoundingClientRect();if(i){const e=[i.left,i.top];this._position??(this._position=e);if(e[0]!==this._position[0]||e[1]!==this._position[1]){const i=this._position;this._position=e,null==(n=(t=this.device.props).onPositionChange)||n.call(t,this,{oldPosition:i})}}}};i(li,"defaultProps",{id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1});let ci=li;function ui(e,t,n){return Math.min(Math.round(e*t),n-1)}function hi(e,t,n,i){return i?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}const di=class e extends xn{get[Symbol.toStringTag](){return"Sampler"}constructor(t,n){super(t,n=e.normalizeProps(t,n),e.defaultProps)}static normalizeProps(e,t){return t}};i(di,"defaultProps",{...xn.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let fi=di;const pi={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"},gi=class e extends xn{constructor(t,n){if(super(t,n=e.normalizeProps(t,n),e.defaultProps),i(this,"dimension"),i(this,"baseDimension"),i(this,"format"),i(this,"width"),i(this,"height"),i(this,"depth"),i(this,"mipLevels"),i(this,"updateTimestamp"),this.dimension=this.props.dimension,this.baseDimension=pi[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,void 0===this.props.width||void 0===this.props.height)if(t.isExternalImage(n.data)){const e=t.getExternalImageSize(n.data);this.width=(null==e?void 0:e.width)||1,this.height=(null==e?void 0:e.height)||1}else this.width=1,this.height=1,void 0!==this.props.width&&void 0!==this.props.height||bn.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}setSampler(e){this.sampler=e instanceof fi?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const n={...t},{width:i,height:r}=n;return"number"==typeof i&&(n.width=Math.max(1,Math.ceil(i))),"number"==typeof r&&(n.height=Math.max(1,Math.ceil(r))),n}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(t){const{width:n,height:i,depth:r}=this,s={...e.defaultCopyDataOptions,width:n,height:i,depth:r,...t},o=this.device.getTextureFormatInfo(this.format);if(!t.bytesPerRow&&!o.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return s.bytesPerRow=t.bytesPerRow||n*(o.bytesPerPixel||4),s.rowsPerImage=t.rowsPerImage||i,s}_normalizeCopyExternalImageOptions(t){const n=this.device.getExternalImageSize(t.image),i={...e.defaultCopyExternalImageOptions,...n,...t};return i.width=Math.min(i.width,this.width-i.x),i.height=Math.min(i.height,this.height-i.y),i}};i(gi,"SAMPLE",4),i(gi,"STORAGE",8),i(gi,"RENDER",16),i(gi,"COPY_SRC",1),i(gi,"COPY_DST",2),i(gi,"TEXTURE",4),i(gi,"RENDER_ATTACHMENT",16),i(gi,"defaultProps",{...xn.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:gi.TEXTURE|gi.RENDER_ATTACHMENT|gi.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0}),i(gi,"defaultCopyDataOptions",{data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"}),i(gi,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let mi=gi;const _i=class e extends xn{get[Symbol.toStringTag](){return"TextureView"}constructor(t,n){super(t,n,e.defaultProps)}};i(_i,"defaultProps",{...xn.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let vi=_i;function yi(e,t,n,i){if(null==i?void 0:i.inlineSource){const i=function(e,t,n){let i="";for(let r=t-2;r<=t;r++){const s=e[r-1];void 0!==s&&(i+=bi(s,t,n))}return i}(t,n);return`\n${i}${e.linePos>0?`${" ".repeat(e.linePos+5)}^^^\n`:""}${e.type.toUpperCase()}: ${e.message}\n\n`}const r="error"===e.type?"red":"#8B4000";return(null==i?void 0:i.html)?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function bi(e,t,n){const i=(null==n?void 0:n.html)?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return`${function(e,t){let n="";for(let i=e.length;i<t;++i)n+=" ";return n+e}(String(t),4)}: ${i}${(null==n?void 0:n.html)?"<br/>":"\n"}`}const wi=class e extends xn{constructor(t,n){super(t,{id:xi(n={...n,debugShaders:n.debugShaders||t.props.debugShaders||"errors"}),...n},e.defaultProps),i(this,"stage"),i(this,"source"),i(this,"compilationStatus","pending"),this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if("success"===this.compilationStatus)return}const t=await this.getCompilationInfo();"warnings"===e&&0===(null==t?void 0:t.length)||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){var n;if("undefined"==typeof document||!(null==document?void 0:document.createElement))return;const i=t,r=`${this.stage} shader "${i}"`;let s=function(e,t,n){let i="";const r=t.split(/\r?\n/),s=e.slice().sort((e,t)=>e.lineNum-t.lineNum);switch((null==n?void 0:n.showSourceCode)||"no"){case"all":let t=0;for(let e=1;e<=r.length;e++)for(i+=bi(r[e-1],e,n);s.length>t&&s[t].lineNum===e;){const e=s[t++];i+=yi(e,r,e.lineNum,{...n,inlineSource:!1})}for(;s.length>t;)i+=yi(s[t++],[],0,{...n,inlineSource:!1});return i;case"issues":case"no":for(const s of e)i+=yi(s,r,s.lineNum,{inlineSource:"no"!==(null==n?void 0:n.showSourceCode)});return i}}(e,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`\n<h1>Compilation error in ${r}</h1><br /><br />\n<code style="user-select:text;"><pre>\n${s}\n</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);null==(n=document.getElementsByClassName("luma-compiler-log-error")[0])||n.scrollIntoView(),a.onclick=()=>{const e=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(e)}}};i(wi,"defaultProps",{...xn.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Ei=wi;function xi(e){return function(e,t="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}(e.source)||e.id||En(`unnamed ${e.stage}-shader`)}const Ti=class e extends xn{constructor(t,n={}){super(t,n,e.defaultProps),i(this,"width"),i(this,"height"),this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(e){const t=this.colorAttachments.map(t=>t.texture.clone(e)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:n})}resize(e){let t=!e;if(e){const[n,i]=Array.isArray(e)?e:[e.width,e.height];t=t||i!==this.height||n!==this.width,this.width=n,this.height=i}t&&(bn.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(0===this.props.colorAttachments.length&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e,t)=>{if("string"==typeof e){const n=this.createColorTexture(e,t);return this.attachResource(n),n.view}return e instanceof mi?e.view:e});const e=this.props.depthStencilAttachment;if(e)if("string"==typeof e){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else this.depthStencilAttachment=e instanceof mi?e.view:e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:mi.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:mi.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const i=this.colorAttachments[n].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}};i(Ti,"defaultProps",{...xn.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Si=Ti;const Ci=class e extends xn{constructor(t,n){super(t,n,e.defaultProps),i(this,"shaderLayout"),i(this,"bufferLayout"),i(this,"linkStatus","pending"),i(this,"hash",""),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}};i(Ci,"defaultProps",{...xn.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}});let Pi=Ci;const Ri=class e extends xn{get[Symbol.toStringTag](){return"RenderPass"}constructor(t,n){super(t,n=e.normalizeProps(t,n),e.defaultProps)}static normalizeProps(e,t){return t}};i(Ri,"defaultClearColor",[0,0,0,1]),i(Ri,"defaultClearDepth",1),i(Ri,"defaultClearStencil",0),i(Ri,"defaultProps",{...xn.defaultProps,framebuffer:null,parameters:void 0,clearColor:Ri.defaultClearColor,clearColors:void 0,clearDepth:Ri.defaultClearDepth,clearStencil:Ri.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Ii=Ri;const Mi=class e extends xn{constructor(t,n){super(t,n,e.defaultProps),i(this,"hash",""),i(this,"shaderLayout"),this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};i(Mi,"defaultProps",{...xn.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let ki=Mi;const Li=class e extends xn{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,n){super(t,n,e.defaultProps)}};i(Li,"defaultProps",{...xn.defaultProps,measureExecutionTime:void 0});let Bi=Li;const Di=class e extends xn{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,n){super(t,n,e.defaultProps)}};i(Di,"defaultProps",{...xn.defaultProps});let Oi=Di;function Ni(e){return Gi[e]}const Fi={f32:4,f16:2,i32:4,u32:4},Ui={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Gi={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function zi(e,t){const n={};for(const i of e.attributes){const r=Vi(e,t,i.name);r&&(n[i.name]=r)}return n}function Vi(e,t,n){const i=function(e,t){const n=e.attributes.find(e=>e.name===t);n||bn.warn(`shader layout attribute "${t}" not present in shader`);return n||null}(e,n),r=function(e,t){!function(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&bn.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}(e);let n=function(e,t){for(const n of e)if(n.format&&n.name===t)return{attributeName:n.name,bufferName:t,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}(e,t);if(n)return n;if(n=function(e,t){var n;for(const i of e){let e=i.byteStride;if("number"!=typeof i.byteStride)for(const t of i.attributes||[]){e+=kn(t.format).byteLength}const r=null==(n=i.attributes)?void 0:n.find(e=>e.attribute===t);if(r)return{attributeName:r.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:e}}return null}(e,t),n)return n;return bn.warn(`layout for attribute "${t}" not present in buffer layout`),null}(t,n);if(!i)return null;const s=function(e){const[t,n]=Ui[e],i="i32"===t||"u32"===t,r="u32"!==t;return{primitiveType:t,components:n,byteLength:Fi[t]*n,integer:i,signed:r}}(i.type),o=function(e){let t;switch(e.primitiveType){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e.components<=2?"float16x2":"float16x4"}return 1===e.components?t:`${t}x${e.components}`}(s),a=(null==r?void 0:r.vertexFormat)||o,A=kn(a);return{attributeName:(null==r?void 0:r.attributeName)||i.name,bufferName:(null==r?void 0:r.bufferName)||i.name,location:i.location,shaderType:i.type,primitiveType:s.primitiveType,shaderComponents:s.components,vertexFormat:a,bufferDataType:A.type,bufferComponents:A.components,normalized:A.normalized,integer:s.integer,stepMode:(null==r?void 0:r.stepMode)||i.stepMode||"vertex",byteOffset:(null==r?void 0:r.byteOffset)||0,byteStride:(null==r?void 0:r.byteStride)||0}}const Wi=class e extends xn{constructor(t,n){super(t,n,e.defaultProps),i(this,"maxVertexAttributes"),i(this,"attributeInfos"),i(this,"indexBuffer",null),i(this,"attributes"),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=function(e,t,n=16){const i=zi(e,t),r=new Array(n).fill(null);for(const s of Object.values(i))r[s.location]=s;return r}(n.shaderLayout,n.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()}};i(Wi,"defaultProps",{...xn.defaultProps,shaderLayout:void 0,bufferLayout:[]});let ji=Wi;const Hi=class e extends xn{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,n){super(t,n,e.defaultProps)}};i(Hi,"defaultProps",{...xn.defaultProps,layout:void 0,buffers:{}});let Xi=Hi;const Qi=class e extends xn{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,n){super(t,n,e.defaultProps)}};i(Qi,"defaultProps",{...xn.defaultProps,type:void 0,count:void 0});let $i,Yi=Qi;function Ki(e){return(!$i||$i.byteLength<e)&&($i=new ArrayBuffer(e)),$i}function Zi(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)}class qi{constructor(e,t={}){i(this,"layout",{}),i(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const e=Ni(s),{type:r,components:o}=e,a=o*((null==t?void 0:t[i])??1);n=Pn(n,a);const A=n;n+=a,this.layout[i]={type:r,size:a,offset:A}}n+=(4-n%4)%4;const r=4*n;this.byteLength=Math.max(r,1024)}getData(e){const t=Ki(this.byteLength),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[i,r]of Object.entries(e)){const e=this.layout[i];if(!e){bn.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}const{type:t,size:s,offset:o}=e,a=n[t];if(1===s){if("number"!=typeof r&&"boolean"!=typeof r){bn.warn(`Supplied value for single component uniform ${i} is not a number: ${r}`)();continue}a[o]=Number(r)}else{if(!Zi(r)){bn.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${r}`)();continue}a.set(r,o)}}return new Uint8Array(t,0,this.byteLength)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}}class Ji{constructor(e){var t;if(i(this,"name"),i(this,"uniforms",{}),i(this,"modifiedUniforms",{}),i(this,"modified",!0),i(this,"bindingLayout",{}),i(this,"needsRedraw","initialized"),this.name=(null==e?void 0:e.name)||"unnamed",(null==e?void 0:e.name)&&(null==e?void 0:e.shaderLayout)){const n=null==(t=null==e?void 0:e.shaderLayout.bindings)?void 0:t.find(t=>"uniform"===t.type&&t.name===(null==e?void 0:e.name));if(!n)throw new Error(null==e?void 0:e.name);const i=n;for(const e of i.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){var n;(function(e,t){if(e!==t)return!1;const n=e,i=t;if(!Zi(n))return!1;if(Zi(i)&&n.length===i.length)for(let r=0;r<n.length;++r)if(i[r]!==n[r])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=Zi(n=t)?n.slice():n,this.modifiedUniforms[e]=!0,this.modified=!0)}}class er{constructor(e){i(this,"uniformBlocks",new Map),i(this,"uniformBufferLayouts",new Map),i(this,"uniformBuffers",new Map);for(const[t,n]of Object.entries(e)){const e=t,i=new qi(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(e,i);const r=new Ji({name:t});r.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,r)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[n,i]of Object.entries(e))null==(t=this.uniformBlocks.get(n))||t.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return(null==(t=this.uniformBufferLayouts.get(e))?void 0:t.byteLength)||0}getUniformBufferData(e){var t,n;const i=(null==(t=this.uniformBlocks.get(e))?void 0:t.getAllUniforms())||{};return null==(n=this.uniformBufferLayouts.get(e))?void 0:n.getData(i)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:Sn.UNIFORM|Sn.COPY_DST,byteLength:i}),s=this.getUniformBufferData(t);return r.write(s),r}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:Sn.UNIFORM|Sn.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&bn.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var t;const n=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),r=!1;if(i&&(null==n?void 0:n.needsRedraw)){r||(r=n.needsRedraw);const s=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),null==i||i.write(s);const o=null==(t=this.uniformBlocks.get(e))?void 0:t.getAllUniforms();bn.log(4,`Writing to uniform buffer ${String(e)}`,s,o)()}return r}}class tr{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class nr{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ir extends tr{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class rr extends tr{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class sr extends tr{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class or extends tr{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}var ar,Ar;(Ar=ar||(ar={}))[Ar.Uniform=0]="Uniform",Ar[Ar.Storage=1]="Storage",Ar[Ar.Texture=2]="Texture",Ar[Ar.Sampler=3]="Sampler",Ar[Ar.StorageTexture=4]="StorageTexture";class lr{constructor(e,t,n,i,r,s,o){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=r,this.resourceType=s,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class cr{constructor(e,t){this.name=e,this.type=t}}class ur{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}class hr{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}class dr{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}}class fr{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class pr{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class gr{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function mr(e){var t=(32768&e)>>15,n=(31744&e)>>10,i=1023&e;return 0==n?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):31==n?i?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+i/Math.pow(2,10))}const _r=new Float32Array(1),vr=new Int32Array(_r.buffer),yr=new Uint16Array(1);function br(e){_r[0]=e;const t=vr[0],n=t>>31&1;let i=t>>23&255,r=8388607&t;if(255===i)return yr[0]=n<<15|31744|(0!==r?512:0),yr[0];if(0===i){if(0===r)return yr[0]=n<<15,yr[0];r|=8388608;let e=113;for(;!(8388608&r);)r<<=1,e--;return i=127-e,r&=8388607,i>0?(r=(r>>126-i)+(r>>127-i&1),yr[0]=n<<15|i<<10|r>>13,yr[0]):(yr[0]=n<<15,yr[0])}return i=i-127+15,i>=31?(yr[0]=n<<15|31744,yr[0]):i<=0?i<-10?(yr[0]=n<<15,yr[0]):(r=(8388608|r)>>1-i,yr[0]=n<<15|r>>13,yr[0]):(r>>=13,yr[0]=n<<15|i<<10|r,yr[0])}const wr=new Uint32Array(1),Er=new Float32Array(wr.buffer,0,1);function xr(e){const t=112+(e>>6&31)<<23|(63&e)<<17;return wr[0]=t,Er[0]}function Tr(e,t,n,i){const r=[0,0,0,0];for(let s=0;s<i;++s)switch(n){case"8unorm":r[s]=e[t]/255,t++;break;case"8snorm":r[s]=e[t]/255*2-1,t++;break;case"8uint":r[s]=e[t],t++;break;case"8sint":r[s]=e[t]-127,t++;break;case"16uint":r[s]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":r[s]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":r[s]=mr(e[t]|e[t+1]<<8),t+=2;break;case"32uint":case"32sint":r[s]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":r[s]=new Float32Array(e.buffer,t,1)[0],t+=4}return r}function Sr(e,t,n,i,r){for(let s=0;s<i;++s)switch(n){case"8unorm":e[t]=255*r[s],t++;break;case"8snorm":e[t]=.5*(r[s]+1)*255,t++;break;case"8uint":e[t]=r[s],t++;break;case"8sint":e[t]=r[s]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=r[s],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=r[s],t+=2;break;case"16float":{const n=br(r[s]);new Uint16Array(e.buffer,t,1)[0]=n,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=r[s],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=r[s],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=r[s],t+=4}return r}const Cr={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Pr{constructor(){this.id=Pr._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Rr.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(Ir.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Pr._id=0;class Rr extends Pr{}Rr.instance=new Rr;class Ir extends Pr{}Ir.instance=new Ir;const Mr=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class kr extends Pr{constructor(){super()}}class Lr extends kr{constructor(e,t,n,i,r,s){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=i,this.startLine=r,this.endLine=s}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class Br extends kr{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Dr extends kr{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Or extends kr{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Nr extends kr{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var t,n,i;null===(t=this.init)||void 0===t||t.search(e),null===(n=this.condition)||void 0===n||n.search(e),null===(i=this.increment)||void 0===i||i.search(e),this.searchBlock(this.body,e)}}class Fr extends kr{constructor(e,t,n,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"var"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class Ur extends kr{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class Gr extends kr{constructor(e,t,n,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"let"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class zr extends kr{constructor(e,t,n,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}var Vr,Wr,jr,Hr;(e=>{e.increment="++",e.decrement="--"})(Vr||(Vr={})),(e=>{e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}})(Vr||(Vr={}));class Xr extends kr{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(Wr||(Wr={})),(Wr||(Wr={})).parse=function(e){const t=e;if("parse"==t)throw new Error("Invalid value for AssignOperator");return t};class Qr extends kr{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class $r extends kr{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return Mr.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class Yr extends kr{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),null===(t=this.continuing)||void 0===t||t.search(e)}}class Kr extends kr{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class Zr extends kr{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class qr extends kr{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class Jr extends kr{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class es extends kr{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class ts extends kr{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class ns extends kr{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class is extends kr{constructor(){super()}get astNodeType(){return"discard"}}class rs extends kr{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class ss extends kr{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class os extends kr{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const i=os._priority.get(t.name);os._priority.get(e[n].name)<i&&(t=e[n])}return"x32"===t.name?os.i32:t}getTypeName(){return this.name}}os.x32=new os("x32"),os.f32=new os("f32"),os.i32=new os("i32"),os.u32=new os("u32"),os.f16=new os("f16"),os.bool=new os("bool"),os.void=new os("void"),os._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class as extends os{constructor(e){super(e)}}class As extends os{constructor(e,t,n,i){super(e),this.members=t,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class ls extends os{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}ls.vec2f=new ls("vec2",os.f32,null),ls.vec3f=new ls("vec3",os.f32,null),ls.vec4f=new ls("vec4",os.f32,null),ls.vec2i=new ls("vec2",os.i32,null),ls.vec3i=new ls("vec3",os.i32,null),ls.vec4i=new ls("vec4",os.i32,null),ls.vec2u=new ls("vec2",os.u32,null),ls.vec3u=new ls("vec3",os.u32,null),ls.vec4u=new ls("vec4",os.u32,null),ls.vec2h=new ls("vec2",os.f16,null),ls.vec3h=new ls("vec3",os.f16,null),ls.vec4h=new ls("vec4",os.f16,null),ls.vec2b=new ls("vec2",os.bool,null),ls.vec3b=new ls("vec3",os.bool,null),ls.vec4b=new ls("vec4",os.bool,null),ls.mat2x2f=new ls("mat2x2",os.f32,null),ls.mat2x3f=new ls("mat2x3",os.f32,null),ls.mat2x4f=new ls("mat2x4",os.f32,null),ls.mat3x2f=new ls("mat3x2",os.f32,null),ls.mat3x3f=new ls("mat3x3",os.f32,null),ls.mat3x4f=new ls("mat3x4",os.f32,null),ls.mat4x2f=new ls("mat4x2",os.f32,null),ls.mat4x3f=new ls("mat4x3",os.f32,null),ls.mat4x4f=new ls("mat4x4",os.f32,null),ls.mat2x2h=new ls("mat2x2",os.f16,null),ls.mat2x3h=new ls("mat2x3",os.f16,null),ls.mat2x4h=new ls("mat2x4",os.f16,null),ls.mat3x2h=new ls("mat3x2",os.f16,null),ls.mat3x3h=new ls("mat3x3",os.f16,null),ls.mat3x4h=new ls("mat3x4",os.f16,null),ls.mat4x2h=new ls("mat4x2",os.f16,null),ls.mat4x3h=new ls("mat4x3",os.f16,null),ls.mat4x4h=new ls("mat4x4",os.f16,null),ls.mat2x2i=new ls("mat2x2",os.i32,null),ls.mat2x3i=new ls("mat2x3",os.i32,null),ls.mat2x4i=new ls("mat2x4",os.i32,null),ls.mat3x2i=new ls("mat3x2",os.i32,null),ls.mat3x3i=new ls("mat3x3",os.i32,null),ls.mat3x4i=new ls("mat3x4",os.i32,null),ls.mat4x2i=new ls("mat4x2",os.i32,null),ls.mat4x3i=new ls("mat4x3",os.i32,null),ls.mat4x4i=new ls("mat4x4",os.i32,null),ls.mat2x2u=new ls("mat2x2",os.u32,null),ls.mat2x3u=new ls("mat2x3",os.u32,null),ls.mat2x4u=new ls("mat2x4",os.u32,null),ls.mat3x2u=new ls("mat3x2",os.u32,null),ls.mat3x3u=new ls("mat3x3",os.u32,null),ls.mat3x4u=new ls("mat3x4",os.u32,null),ls.mat4x2u=new ls("mat4x2",os.u32,null),ls.mat4x3u=new ls("mat4x3",os.u32,null),ls.mat4x4u=new ls("mat4x4",os.u32,null);class cs extends os{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class us extends os{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class hs extends os{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class ds extends Pr{constructor(){super(),this.postfix=null}}class fs extends ds{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class ps extends ds{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class gs extends ds{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return Mr.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class ms extends ds{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class _s extends ds{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const t=e.evalExpression(this.initializer,e.context);return null!==t&&this.postfix?t.getSubData(e,this.postfix,e.context):t}return null}search(e){this.initializer.search(e)}}class vs extends ds{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return void 0!==t&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof Os}get isVector(){return this.value instanceof Fs||this.value instanceof Us}get scalarValue(){return this.value instanceof Os?this.value.value:0}get vectorValue(){return this.value instanceof Fs||this.value instanceof Us?this.value.data:new Float32Array(0)}}class ys extends ds{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class bs extends ds{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class ws extends ds{constructor(){super()}}class Es extends ws{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class xs extends ws{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:"f32"===e.name||"f32"===t.name?os.f32:"u32"===e.name||"u32"===t.name?os.u32:os.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Ts extends Pr{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Ss extends ds{constructor(){super()}get astNodeType(){return"default"}}class Cs extends Ts{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Ps extends Ts{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Rs extends Pr{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class Is extends Pr{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Ms extends Pr{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class ks extends Pr{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Ls{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Ls._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,i){}getSubData(e,t,n){return null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Ls._id=0;class Bs extends Ls{constructor(){super(new tr("void",null),null)}toString(){return"void"}}Bs.void=new Bs;class Ds extends Ls{constructor(e){super(new sr("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,i){this.reference.setDataValue(e,t,n,i)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}}class Os extends Ls{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:"x32"===this.typeInfo.name?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([e]):"u32"===this.typeInfo.name?this.data=new Uint32Array([e]):("f32"===this.typeInfo.name||"f16"===this.typeInfo.name)&&(this.data=new Float32Array([e]))}clone(){if(this.data instanceof Float32Array)return new Os(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Os(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Os(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,i){if(n)return;if(!(t instanceof Os))return;let r=t.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?r=Math.floor(r):"bool"===this.typeInfo.name&&(r=r?1:0),this.data[0]=r}getSubData(e,t,n){return t?null:this}toString(){return`${this.value}`}}function Ns(e,t,n){const i=t.length;return 2===i?"f32"===n?new Fs(new Float32Array(t),e.getTypeInfo("vec2f")):"i32"===n||"bool"===n?new Fs(new Int32Array(t),e.getTypeInfo("vec2i")):"u32"===n?new Fs(new Uint32Array(t),e.getTypeInfo("vec2u")):"f16"===n?new Fs(new Float32Array(t),e.getTypeInfo("vec2h")):null:3===i?"f32"===n?new Fs(new Float32Array(t),e.getTypeInfo("vec3f")):"i32"===n||"bool"===n?new Fs(new Int32Array(t),e.getTypeInfo("vec3i")):"u32"===n?new Fs(new Uint32Array(t),e.getTypeInfo("vec3u")):"f16"===n?new Fs(new Float32Array(t),e.getTypeInfo("vec3h")):null:4===i?"f32"===n?new Fs(new Float32Array(t),e.getTypeInfo("vec4f")):"i32"===n||"bool"===n?new Fs(new Int32Array(t),e.getTypeInfo("vec4i")):"u32"===n?new Fs(new Uint32Array(t),e.getTypeInfo("vec4u")):"f16"===n?new Fs(new Float32Array(t),e.getTypeInfo("vec4h")):null:null}class Fs extends Ls{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?this.data=new Float32Array(e):"vec2i"===t||"vec3i"===t||"vec4i"===t?this.data=new Int32Array(e):"vec2u"===t||"vec3u"===t||"vec4u"===t?this.data=new Uint32Array(e):"vec2h"===t||"vec3h"===t||"vec4h"===t?this.data=new Float32Array(e):"vec2b"===t||"vec3b"===t||"vec4b"===t?this.data=new Int32Array(e):("vec2"===t||"vec3"===t||"vec4"===t)&&(this.data=new Float32Array(e))}}clone(){if(this.data instanceof Float32Array)return new Fs(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Fs(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Fs(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,i){n instanceof fs||t instanceof Fs&&(this.data=t.data)}getSubData(e,t,n){if(null===t)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof or)i=this.typeInfo.format||i;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?i=e.getTypeInfo("f32"):"vec2i"===t||"vec3i"===t||"vec4i"===t?i=e.getTypeInfo("i32"):"vec2b"===t||"vec3b"===t||"vec4b"===t?i=e.getTypeInfo("bool"):"vec2u"===t||"vec3u"===t||"vec4u"===t?i=e.getTypeInfo("u32"):("vec2h"===t||"vec3h"===t||"vec4h"===t)&&(i=e.getTypeInfo("f16"))}let r=this;for(;null!==t&&null!==r;){if(t instanceof bs){const s=t.index;let o=-1;if(s instanceof vs){if(!(s.value instanceof Os))return null;o=s.value.value}else{const t=e.evalExpression(s,n);if(!(t instanceof Os))return null;o=t.value}if(o<0||o>=r.data.length)return null;if(r.data instanceof Float32Array){const e=new Float32Array(r.data.buffer,r.data.byteOffset+4*o,1);return new Os(e,i)}if(r.data instanceof Int32Array){const e=new Int32Array(r.data.buffer,r.data.byteOffset+4*o,1);return new Os(e,i)}if(r.data instanceof Uint32Array){const e=new Uint32Array(r.data.buffer,r.data.byteOffset+4*o,1);return new Os(e,i)}throw"GetSubData: Invalid data type"}if(!(t instanceof fs))return null;{const n=t.value.toLowerCase();if(1===n.length){let e=0;if("x"===n||"r"===n)e=0;else if("y"===n||"g"===n)e=1;else if("z"===n||"b"===n)e=2;else{if("w"!==n&&"a"!==n)return null;e=3}if(this.data instanceof Float32Array){let t=new Float32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new Os(t,i,this)}if(this.data instanceof Int32Array){let t=new Int32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new Os(t,i,this)}if(this.data instanceof Uint32Array){let t=new Uint32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new Os(t,i,this)}}const s=[];for(const e of n)"x"===e||"r"===e?s.push(this.data[0]):"y"===e||"g"===e?s.push(this.data[1]):"z"===e||"b"===e?s.push(this.data[2]):("w"===e||"a"===e)&&s.push(this.data[3]);r=Ns(e,s,i.name)}t=t.postfix}return r}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Us extends Ls{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Us(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,i){n instanceof fs||t instanceof Us&&(this.data=t.data)}getSubData(e,t,n){if(null===t)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof or)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return null;e.getTypeInfo("f16")}if(t instanceof bs){const r=t.index;let s=-1;if(r instanceof vs){if(!(r.value instanceof Os))return null;s=r.value.value}else{const t=e.evalExpression(r,n);if(!(t instanceof Os))return null;s=t.value}if(s<0||s>=this.data.length)return null;const o=i.endsWith("h")?"h":"f";let a;if("mat2x2"===i||"mat2x2f"===i||"mat2x2h"===i||"mat3x2"===i||"mat3x2f"===i||"mat3x2h"===i||"mat4x2"===i||"mat4x2f"===i||"mat4x2h"===i)a=new Fs(new Float32Array(this.data.buffer,this.data.byteOffset+2*s*4,2),e.getTypeInfo(`vec2${o}`));else if("mat2x3"===i||"mat2x3f"===i||"mat2x3h"===i||"mat3x3"===i||"mat3x3f"===i||"mat3x3h"===i||"mat4x3"===i||"mat4x3f"===i||"mat4x3h"===i)a=new Fs(new Float32Array(this.data.buffer,this.data.byteOffset+3*s*4,3),e.getTypeInfo(`vec3${o}`));else{if("mat2x4"!==i&&"mat2x4f"!==i&&"mat2x4h"!==i&&"mat3x4"!==i&&"mat3x4f"!==i&&"mat3x4h"!==i&&"mat4x4"!==i&&"mat4x4f"!==i&&"mat4x4h"!==i)return null;a=new Fs(new Float32Array(this.data.buffer,this.data.byteOffset+4*s*4,4),e.getTypeInfo(`vec4${o}`))}return t.postfix?a.getSubData(e,t.postfix,n):a}return null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Gs extends Ls{constructor(e,t,n=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Gs(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,i){if(null===t)return;let r=this.offset,s=this.typeInfo;for(;n;){if(n instanceof bs){if(s instanceof rr){const t=n.index;if(t instanceof vs){if(!(t.value instanceof Os))return;r+=t.value.value*s.stride}else{const n=e.evalExpression(t,i);if(!(n instanceof Os))return;r+=n.value*s.stride}s=s.format}}else{if(!(n instanceof fs))return;{const e=n.value;if(s instanceof ir){let t=!1;for(const n of s.members)if(n.name===e){r+=n.offset,s=n.type,t=!0;break}if(!t)return}else if(s instanceof tr){const n=s.getTypeName();let i=0;if("x"===e||"r"===e)i=0;else if("y"===e||"g"===e)i=1;else if("z"===e||"b"===e)i=2;else{if("w"!==e&&"a"!==e)return;i=3}if(!(t instanceof Os))return;const o=t.value;return"vec2f"===n?void(new Float32Array(this.buffer,r,2)[i]=o):"vec3f"===n?void(new Float32Array(this.buffer,r,3)[i]=o):"vec4f"===n?void(new Float32Array(this.buffer,r,4)[i]=o):"vec2i"===n?void(new Int32Array(this.buffer,r,2)[i]=o):"vec3i"===n?void(new Int32Array(this.buffer,r,3)[i]=o):"vec4i"===n?void(new Int32Array(this.buffer,r,4)[i]=o):"vec2u"===n?void(new Uint32Array(this.buffer,r,2)[i]=o):"vec3u"===n?void(new Uint32Array(this.buffer,r,3)[i]=o):"vec4u"===n?void(new Uint32Array(this.buffer,r,4)[i]=o):void 0}}}n=n.postfix}this.setData(e,t,s,r,i)}setData(e,t,n,i,r){const s=n.getTypeName();if("f32"!==s&&"f16"!==s)if("i32"!==s&&"atomic<i32>"!==s&&"x32"!==s)if("u32"!==s&&"atomic<u32>"!==s)if("bool"!==s){if("vec2f"===s||"vec2h"===s){const e=new Float32Array(this.buffer,i,2);return void(t instanceof Fs?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3f"===s||"vec3h"===s){const e=new Float32Array(this.buffer,i,3);return void(t instanceof Fs?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4f"===s||"vec4h"===s){const e=new Float32Array(this.buffer,i,4);return void(t instanceof Fs?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2i"===s){const e=new Int32Array(this.buffer,i,2);return void(t instanceof Fs?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3i"===s){const e=new Int32Array(this.buffer,i,3);return void(t instanceof Fs?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4i"===s){const e=new Int32Array(this.buffer,i,4);return void(t instanceof Fs?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2u"===s){const e=new Uint32Array(this.buffer,i,2);return void(t instanceof Fs?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3u"===s){const e=new Uint32Array(this.buffer,i,3);return void(t instanceof Fs?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4u"===s){const e=new Uint32Array(this.buffer,i,4);return void(t instanceof Fs?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2b"===s){const e=new Uint32Array(this.buffer,i,2);return void(t instanceof Fs?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3b"===s){const e=new Uint32Array(this.buffer,i,3);return void(t instanceof Fs?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4b"===s){const e=new Uint32Array(this.buffer,i,4);return void(t instanceof Fs?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x2f"===s||"mat2x2h"===s){const e=new Float32Array(this.buffer,i,4);return void(t instanceof Us?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x3f"===s||"mat2x3h"===s){const e=new Float32Array(this.buffer,i,6);return void(t instanceof Us?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat2x4f"===s||"mat2x4h"===s){const e=new Float32Array(this.buffer,i,8);return void(t instanceof Us?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat3x2f"===s||"mat3x2h"===s){const e=new Float32Array(this.buffer,i,6);return void(t instanceof Us?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat3x3f"===s||"mat3x3h"===s){const e=new Float32Array(this.buffer,i,9);return void(t instanceof Us?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]))}if("mat3x4f"===s||"mat3x4h"===s){const e=new Float32Array(this.buffer,i,12);return void(t instanceof Us?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x2f"===s||"mat4x2h"===s){const e=new Float32Array(this.buffer,i,8);return void(t instanceof Us?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat4x3f"===s||"mat4x3h"===s){const e=new Float32Array(this.buffer,i,12);return void(t instanceof Us?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x4f"===s||"mat4x4h"===s){const e=new Float32Array(this.buffer,i,16);return void(t instanceof Us?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11],e[12]=t.data[12],e[13]=t.data[13],e[14]=t.data[14],e[15]=t.data[15]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}if(t instanceof Gs&&n===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer))}else t instanceof Os&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof Os&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof Os&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof Os&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,n){var i,r;if(null===t)return this;let s=this.offset,o=this.typeInfo;for(;t;){if(t instanceof bs){const i=t.index,r=i instanceof ds?e.evalExpression(i,n):i;let a=0;if(r instanceof Os?a=r.value:"number"==typeof r&&(a=r),o instanceof rr)s+=a*o.stride,o=o.format;else{const t=o.getTypeName();("mat4x4"===t||"mat4x4f"===t||"mat4x4h"===t)&&(s+=16*a,o=e.getTypeInfo("vec4f"))}}else{if(!(t instanceof fs))return null;{const n=t.value;if(o instanceof ir){let e=!1;for(const t of o.members)if(t.name===n){s+=t.offset,o=t.type,e=!0;break}if(!e)return null}else if(o instanceof tr){const t=o.getTypeName();if("vec2f"===t||"vec3f"===t||"vec4f"===t||"vec2i"===t||"vec3i"===t||"vec4i"===t||"vec2u"===t||"vec3u"===t||"vec4u"===t||"vec2b"===t||"vec3b"===t||"vec4b"===t||"vec2h"===t||"vec3h"===t||"vec4h"===t||"vec2"===t||"vec3"===t||"vec4"===t){if(n.length>0&&n.length<5){let i="f";const r=[];for(let o=0;o<n.length;++o){const a=n[o].toLowerCase();let A=0;if("x"===a||"r"===a)A=0;else if("y"===a||"g"===a)A=1;else if("z"===a||"b"===a)A=2;else{if("w"!==a&&"a"!==a)return null;A=3}if(1===n.length){if(t.endsWith("f"))return this.buffer.byteLength<s+4*A+4?null:new Os(new Float32Array(this.buffer,s+4*A,1),e.getTypeInfo("f32"),this);if(t.endsWith("h"))return new Os(new Float32Array(this.buffer,s+4*A,1),e.getTypeInfo("f16"),this);if(t.endsWith("i"))return new Os(new Int32Array(this.buffer,s+4*A,1),e.getTypeInfo("i32"),this);if(t.endsWith("b"))return new Os(new Int32Array(this.buffer,s+4*A,1),e.getTypeInfo("bool"),this);if(t.endsWith("u"))return new Os(new Uint32Array(this.buffer,s+4*A,1),e.getTypeInfo("i32"),this)}if("vec2f"===t)r.push(new Float32Array(this.buffer,s,2)[A]);else if("vec3f"===t){if(s+12>=this.buffer.byteLength)return null;const e=new Float32Array(this.buffer,s,3);r.push(e[A])}else if("vec4f"===t)r.push(new Float32Array(this.buffer,s,4)[A]);else if("vec2i"===t)i="i",r.push(new Int32Array(this.buffer,s,2)[A]);else if("vec3i"===t)i="i",r.push(new Int32Array(this.buffer,s,3)[A]);else if("vec4i"===t)i="i",r.push(new Int32Array(this.buffer,s,4)[A]);else if("vec2u"===t){i="u";const e=new Uint32Array(this.buffer,s,2);r.push(e[A])}else"vec3u"===t?(i="u",r.push(new Uint32Array(this.buffer,s,3)[A])):"vec4u"===t&&(i="u",r.push(new Uint32Array(this.buffer,s,4)[A]))}return 2===r.length?o=e.getTypeInfo(`vec2${i}`):3===r.length?o=e.getTypeInfo(`vec3${i}`):4===r.length&&(o=e.getTypeInfo(`vec4${i}`)),new Fs(r,o,null)}return null}return null}}}t=t.postfix}const a=o.getTypeName();return"f32"===a?new Os(new Float32Array(this.buffer,s,1),o,this):"i32"===a?new Os(new Int32Array(this.buffer,s,1),o,this):"u32"===a?new Os(new Uint32Array(this.buffer,s,1),o,this):"vec2f"===a?new Fs(new Float32Array(this.buffer,s,2),o,this):"vec3f"===a?new Fs(new Float32Array(this.buffer,s,3),o,this):"vec4f"===a?new Fs(new Float32Array(this.buffer,s,4),o,this):"vec2i"===a?new Fs(new Int32Array(this.buffer,s,2),o,this):"vec3i"===a?new Fs(new Int32Array(this.buffer,s,3),o,this):"vec4i"===a?new Fs(new Int32Array(this.buffer,s,4),o,this):"vec2u"===a?new Fs(new Uint32Array(this.buffer,s,2),o,this):"vec3u"===a?new Fs(new Uint32Array(this.buffer,s,3),o,this):"vec4u"===a?new Fs(new Uint32Array(this.buffer,s,4),o,this):o instanceof or&&"atomic"===o.name?"u32"===(null===(i=o.format)||void 0===i?void 0:i.name)?new Os(new Uint32Array(this.buffer,s,1)[0],o.format,this):"i32"===(null===(r=o.format)||void 0===r?void 0:r.name)?new Os(new Int32Array(this.buffer,s,1)[0],o.format,this):null:new Gs(this.buffer,o,s,this)}toString(){let e="";if(this.typeInfo instanceof rr)if("f32"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("i32"===this.typeInfo.format.name){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("u32"===this.typeInfo.format.name){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("vec2f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if("vec3f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if("vec4f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof ir?e+="{...}":e="[...]";return e}}class zs extends Ls{constructor(e,t,n,i){super(t,null),this.data=e,this.descriptor=n,this.view=i}clone(){return new zs(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?null!==(e=n[0])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.width)&&void 0!==t?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?null!==(e=n[1])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.height)&&void 0!==t?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?null!==(e=n[2])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.depthOrArrayLayers)&&void 0!==t?t:0}get format(){var e;return this.descriptor&&null!==(e=this.descriptor.format)&&void 0!==e?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&null!==(e=this.descriptor.sampleCount)&&void 0!==e?e:1}get mipLevelCount(){var e;return this.descriptor&&null!==(e=this.descriptor.mipLevelCount)&&void 0!==e?e:1}get dimension(){var e;return this.descriptor&&null!==(e=this.descriptor.dimension)&&void 0!==e?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=Cr[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Cr[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Cr[e],n=this.width;if(!e||n<=0||!t)return-1;const i=this.height,r=this.depthOrArrayLayers,s=this.dimension;return n/t.blockWidth*("1d"===s?1:i/t.blockHeight)*t.bytesPerBlock*r}getPixel(e,t,n=0,i=0){const r=this.texelByteSize,s=this.bytesPerRow,o=this.height,a=this.data[i];return function(e,t,n,i,r,s,o,a,A){const l=i*(o>>=r)*(s>>=r)+n*o+t*a;switch(A){case"r8unorm":return[Tr(e,l,"8unorm",1)[0]];case"r8snorm":return[Tr(e,l,"8snorm",1)[0]];case"r8uint":return[Tr(e,l,"8uint",1)[0]];case"r8sint":return[Tr(e,l,"8sint",1)[0]];case"rg8unorm":{const t=Tr(e,l,"8unorm",2);return[t[0],t[1]]}case"rg8snorm":{const t=Tr(e,l,"8snorm",2);return[t[0],t[1]]}case"rg8uint":{const t=Tr(e,l,"8uint",2);return[t[0],t[1]]}case"rg8sint":{const t=Tr(e,l,"8sint",2);return[t[0],t[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const t=Tr(e,l,"8unorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8snorm":{const t=Tr(e,l,"8snorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8uint":{const t=Tr(e,l,"8uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba8sint":{const t=Tr(e,l,"8sint",4);return[t[0],t[1],t[2],t[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const t=Tr(e,l,"8unorm",4);return[t[2],t[1],t[0],t[3]]}case"r16uint":return[Tr(e,l,"16uint",1)[0]];case"r16sint":return[Tr(e,l,"16sint",1)[0]];case"r16float":return[Tr(e,l,"16float",1)[0]];case"rg16uint":{const t=Tr(e,l,"16uint",2);return[t[0],t[1]]}case"rg16sint":{const t=Tr(e,l,"16sint",2);return[t[0],t[1]]}case"rg16float":{const t=Tr(e,l,"16float",2);return[t[0],t[1]]}case"rgba16uint":{const t=Tr(e,l,"16uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16sint":{const t=Tr(e,l,"16sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16float":{const t=Tr(e,l,"16float",4);return[t[0],t[1],t[2],t[3]]}case"r32uint":return[Tr(e,l,"32uint",1)[0]];case"r32sint":return[Tr(e,l,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Tr(e,l,"32float",1)[0]];case"rg32uint":{const t=Tr(e,l,"32uint",2);return[t[0],t[1]]}case"rg32sint":{const t=Tr(e,l,"32sint",2);return[t[0],t[1]]}case"rg32float":{const t=Tr(e,l,"32float",2);return[t[0],t[1]]}case"rgba32uint":{const t=Tr(e,l,"32uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32sint":{const t=Tr(e,l,"32sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32float":{const t=Tr(e,l,"32float",4);return[t[0],t[1],t[2],t[3]]}case"rg11b10ufloat":{const t=new Uint32Array(e.buffer,l,1)[0],n=(4192256&t)>>11,i=(4290772992&t)>>22;return[xr(2047&t),xr(n),function(e){const t=112+(e>>5&31)<<23|(31&e)<<18;return wr[0]=t,Er[0]}(i),1]}}return null}(new Uint8Array(a),e,t,n,i,o,s,r,this.format)}setPixel(e,t,n,i,r){const s=this.texelByteSize,o=this.bytesPerRow,a=this.height,A=this.data[i];!function(e,t,n,i,r,s,o,a,A,l){const c=i*(o>>=r)*(s>>=r)+n*o+t*a;switch(A){case"r8unorm":return void Sr(e,c,"8unorm",1,l);case"r8snorm":return void Sr(e,c,"8snorm",1,l);case"r8uint":return void Sr(e,c,"8uint",1,l);case"r8sint":return void Sr(e,c,"8sint",1,l);case"rg8unorm":return void Sr(e,c,"8unorm",2,l);case"rg8snorm":return void Sr(e,c,"8snorm",2,l);case"rg8uint":return void Sr(e,c,"8uint",2,l);case"rg8sint":return void Sr(e,c,"8sint",2,l);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Sr(e,c,"8unorm",4,l);case"rgba8snorm":return void Sr(e,c,"8snorm",4,l);case"rgba8uint":return void Sr(e,c,"8uint",4,l);case"rgba8sint":return void Sr(e,c,"8sint",4,l);case"r16uint":return void Sr(e,c,"16uint",1,l);case"r16sint":return void Sr(e,c,"16sint",1,l);case"r16float":return void Sr(e,c,"16float",1,l);case"rg16uint":return void Sr(e,c,"16uint",2,l);case"rg16sint":return void Sr(e,c,"16sint",2,l);case"rg16float":return void Sr(e,c,"16float",2,l);case"rgba16uint":return void Sr(e,c,"16uint",4,l);case"rgba16sint":return void Sr(e,c,"16sint",4,l);case"rgba16float":return void Sr(e,c,"16float",4,l);case"r32uint":return void Sr(e,c,"32uint",1,l);case"r32sint":return void Sr(e,c,"32sint",1,l);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Sr(e,c,"32float",1,l);case"rg32uint":return void Sr(e,c,"32uint",2,l);case"rg32sint":return void Sr(e,c,"32sint",2,l);case"rg32float":return void Sr(e,c,"32float",2,l);case"rgba32uint":return void Sr(e,c,"32uint",4,l);case"rgba32sint":return void Sr(e,c,"32sint",4,l);case"rgba32float":Sr(e,c,"32float",4,l)}}(new Uint8Array(A),e,t,n,i,a,o,s,this.format,r)}}(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(Hr||(Hr={}));class Vs{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class Ws{}jr=Ws,Ws.none=new Vs("",Hr.reserved,""),Ws.eof=new Vs("EOF",Hr.token,""),Ws.reserved={asm:new Vs("asm",Hr.reserved,"asm"),bf16:new Vs("bf16",Hr.reserved,"bf16"),do:new Vs("do",Hr.reserved,"do"),enum:new Vs("enum",Hr.reserved,"enum"),f16:new Vs("f16",Hr.reserved,"f16"),f64:new Vs("f64",Hr.reserved,"f64"),handle:new Vs("handle",Hr.reserved,"handle"),i8:new Vs("i8",Hr.reserved,"i8"),i16:new Vs("i16",Hr.reserved,"i16"),i64:new Vs("i64",Hr.reserved,"i64"),mat:new Vs("mat",Hr.reserved,"mat"),premerge:new Vs("premerge",Hr.reserved,"premerge"),regardless:new Vs("regardless",Hr.reserved,"regardless"),typedef:new Vs("typedef",Hr.reserved,"typedef"),u8:new Vs("u8",Hr.reserved,"u8"),u16:new Vs("u16",Hr.reserved,"u16"),u64:new Vs("u64",Hr.reserved,"u64"),unless:new Vs("unless",Hr.reserved,"unless"),using:new Vs("using",Hr.reserved,"using"),vec:new Vs("vec",Hr.reserved,"vec"),void:new Vs("void",Hr.reserved,"void")},Ws.keywords={array:new Vs("array",Hr.keyword,"array"),atomic:new Vs("atomic",Hr.keyword,"atomic"),bool:new Vs("bool",Hr.keyword,"bool"),f32:new Vs("f32",Hr.keyword,"f32"),i32:new Vs("i32",Hr.keyword,"i32"),mat2x2:new Vs("mat2x2",Hr.keyword,"mat2x2"),mat2x3:new Vs("mat2x3",Hr.keyword,"mat2x3"),mat2x4:new Vs("mat2x4",Hr.keyword,"mat2x4"),mat3x2:new Vs("mat3x2",Hr.keyword,"mat3x2"),mat3x3:new Vs("mat3x3",Hr.keyword,"mat3x3"),mat3x4:new Vs("mat3x4",Hr.keyword,"mat3x4"),mat4x2:new Vs("mat4x2",Hr.keyword,"mat4x2"),mat4x3:new Vs("mat4x3",Hr.keyword,"mat4x3"),mat4x4:new Vs("mat4x4",Hr.keyword,"mat4x4"),ptr:new Vs("ptr",Hr.keyword,"ptr"),sampler:new Vs("sampler",Hr.keyword,"sampler"),sampler_comparison:new Vs("sampler_comparison",Hr.keyword,"sampler_comparison"),struct:new Vs("struct",Hr.keyword,"struct"),texture_1d:new Vs("texture_1d",Hr.keyword,"texture_1d"),texture_2d:new Vs("texture_2d",Hr.keyword,"texture_2d"),texture_2d_array:new Vs("texture_2d_array",Hr.keyword,"texture_2d_array"),texture_3d:new Vs("texture_3d",Hr.keyword,"texture_3d"),texture_cube:new Vs("texture_cube",Hr.keyword,"texture_cube"),texture_cube_array:new Vs("texture_cube_array",Hr.keyword,"texture_cube_array"),texture_multisampled_2d:new Vs("texture_multisampled_2d",Hr.keyword,"texture_multisampled_2d"),texture_storage_1d:new Vs("texture_storage_1d",Hr.keyword,"texture_storage_1d"),texture_storage_2d:new Vs("texture_storage_2d",Hr.keyword,"texture_storage_2d"),texture_storage_2d_array:new Vs("texture_storage_2d_array",Hr.keyword,"texture_storage_2d_array"),texture_storage_3d:new Vs("texture_storage_3d",Hr.keyword,"texture_storage_3d"),texture_depth_2d:new Vs("texture_depth_2d",Hr.keyword,"texture_depth_2d"),texture_depth_2d_array:new Vs("texture_depth_2d_array",Hr.keyword,"texture_depth_2d_array"),texture_depth_cube:new Vs("texture_depth_cube",Hr.keyword,"texture_depth_cube"),texture_depth_cube_array:new Vs("texture_depth_cube_array",Hr.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Vs("texture_depth_multisampled_2d",Hr.keyword,"texture_depth_multisampled_2d"),texture_external:new Vs("texture_external",Hr.keyword,"texture_external"),u32:new Vs("u32",Hr.keyword,"u32"),vec2:new Vs("vec2",Hr.keyword,"vec2"),vec3:new Vs("vec3",Hr.keyword,"vec3"),vec4:new Vs("vec4",Hr.keyword,"vec4"),bitcast:new Vs("bitcast",Hr.keyword,"bitcast"),block:new Vs("block",Hr.keyword,"block"),break:new Vs("break",Hr.keyword,"break"),case:new Vs("case",Hr.keyword,"case"),continue:new Vs("continue",Hr.keyword,"continue"),continuing:new Vs("continuing",Hr.keyword,"continuing"),default:new Vs("default",Hr.keyword,"default"),diagnostic:new Vs("diagnostic",Hr.keyword,"diagnostic"),discard:new Vs("discard",Hr.keyword,"discard"),else:new Vs("else",Hr.keyword,"else"),enable:new Vs("enable",Hr.keyword,"enable"),fallthrough:new Vs("fallthrough",Hr.keyword,"fallthrough"),false:new Vs("false",Hr.keyword,"false"),fn:new Vs("fn",Hr.keyword,"fn"),for:new Vs("for",Hr.keyword,"for"),function:new Vs("function",Hr.keyword,"function"),if:new Vs("if",Hr.keyword,"if"),let:new Vs("let",Hr.keyword,"let"),const:new Vs("const",Hr.keyword,"const"),loop:new Vs("loop",Hr.keyword,"loop"),while:new Vs("while",Hr.keyword,"while"),private:new Vs("private",Hr.keyword,"private"),read:new Vs("read",Hr.keyword,"read"),read_write:new Vs("read_write",Hr.keyword,"read_write"),return:new Vs("return",Hr.keyword,"return"),requires:new Vs("requires",Hr.keyword,"requires"),storage:new Vs("storage",Hr.keyword,"storage"),switch:new Vs("switch",Hr.keyword,"switch"),true:new Vs("true",Hr.keyword,"true"),alias:new Vs("alias",Hr.keyword,"alias"),type:new Vs("type",Hr.keyword,"type"),uniform:new Vs("uniform",Hr.keyword,"uniform"),var:new Vs("var",Hr.keyword,"var"),override:new Vs("override",Hr.keyword,"override"),workgroup:new Vs("workgroup",Hr.keyword,"workgroup"),write:new Vs("write",Hr.keyword,"write"),r8unorm:new Vs("r8unorm",Hr.keyword,"r8unorm"),r8snorm:new Vs("r8snorm",Hr.keyword,"r8snorm"),r8uint:new Vs("r8uint",Hr.keyword,"r8uint"),r8sint:new Vs("r8sint",Hr.keyword,"r8sint"),r16uint:new Vs("r16uint",Hr.keyword,"r16uint"),r16sint:new Vs("r16sint",Hr.keyword,"r16sint"),r16float:new Vs("r16float",Hr.keyword,"r16float"),rg8unorm:new Vs("rg8unorm",Hr.keyword,"rg8unorm"),rg8snorm:new Vs("rg8snorm",Hr.keyword,"rg8snorm"),rg8uint:new Vs("rg8uint",Hr.keyword,"rg8uint"),rg8sint:new Vs("rg8sint",Hr.keyword,"rg8sint"),r32uint:new Vs("r32uint",Hr.keyword,"r32uint"),r32sint:new Vs("r32sint",Hr.keyword,"r32sint"),r32float:new Vs("r32float",Hr.keyword,"r32float"),rg16uint:new Vs("rg16uint",Hr.keyword,"rg16uint"),rg16sint:new Vs("rg16sint",Hr.keyword,"rg16sint"),rg16float:new Vs("rg16float",Hr.keyword,"rg16float"),rgba8unorm:new Vs("rgba8unorm",Hr.keyword,"rgba8unorm"),rgba8unorm_srgb:new Vs("rgba8unorm_srgb",Hr.keyword,"rgba8unorm_srgb"),rgba8snorm:new Vs("rgba8snorm",Hr.keyword,"rgba8snorm"),rgba8uint:new Vs("rgba8uint",Hr.keyword,"rgba8uint"),rgba8sint:new Vs("rgba8sint",Hr.keyword,"rgba8sint"),bgra8unorm:new Vs("bgra8unorm",Hr.keyword,"bgra8unorm"),bgra8unorm_srgb:new Vs("bgra8unorm_srgb",Hr.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Vs("rgb10a2unorm",Hr.keyword,"rgb10a2unorm"),rg11b10float:new Vs("rg11b10float",Hr.keyword,"rg11b10float"),rg32uint:new Vs("rg32uint",Hr.keyword,"rg32uint"),rg32sint:new Vs("rg32sint",Hr.keyword,"rg32sint"),rg32float:new Vs("rg32float",Hr.keyword,"rg32float"),rgba16uint:new Vs("rgba16uint",Hr.keyword,"rgba16uint"),rgba16sint:new Vs("rgba16sint",Hr.keyword,"rgba16sint"),rgba16float:new Vs("rgba16float",Hr.keyword,"rgba16float"),rgba32uint:new Vs("rgba32uint",Hr.keyword,"rgba32uint"),rgba32sint:new Vs("rgba32sint",Hr.keyword,"rgba32sint"),rgba32float:new Vs("rgba32float",Hr.keyword,"rgba32float"),static_assert:new Vs("static_assert",Hr.keyword,"static_assert")},Ws.tokens={decimal_float_literal:new Vs("decimal_float_literal",Hr.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new Vs("hex_float_literal",Hr.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new Vs("int_literal",Hr.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Vs("uint_literal",Hr.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new Vs("name",Hr.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new Vs("ident",Hr.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Vs("and",Hr.token,"&"),and_and:new Vs("and_and",Hr.token,"&&"),arrow:new Vs("arrow ",Hr.token,"->"),attr:new Vs("attr",Hr.token,"@"),forward_slash:new Vs("forward_slash",Hr.token,"/"),bang:new Vs("bang",Hr.token,"!"),bracket_left:new Vs("bracket_left",Hr.token,"["),bracket_right:new Vs("bracket_right",Hr.token,"]"),brace_left:new Vs("brace_left",Hr.token,"{"),brace_right:new Vs("brace_right",Hr.token,"}"),colon:new Vs("colon",Hr.token,":"),comma:new Vs("comma",Hr.token,","),equal:new Vs("equal",Hr.token,"="),equal_equal:new Vs("equal_equal",Hr.token,"=="),not_equal:new Vs("not_equal",Hr.token,"!="),greater_than:new Vs("greater_than",Hr.token,">"),greater_than_equal:new Vs("greater_than_equal",Hr.token,">="),shift_right:new Vs("shift_right",Hr.token,">>"),less_than:new Vs("less_than",Hr.token,"<"),less_than_equal:new Vs("less_than_equal",Hr.token,"<="),shift_left:new Vs("shift_left",Hr.token,"<<"),modulo:new Vs("modulo",Hr.token,"%"),minus:new Vs("minus",Hr.token,"-"),minus_minus:new Vs("minus_minus",Hr.token,"--"),period:new Vs("period",Hr.token,"."),plus:new Vs("plus",Hr.token,"+"),plus_plus:new Vs("plus_plus",Hr.token,"++"),or:new Vs("or",Hr.token,"|"),or_or:new Vs("or_or",Hr.token,"||"),paren_left:new Vs("paren_left",Hr.token,"("),paren_right:new Vs("paren_right",Hr.token,")"),semicolon:new Vs("semicolon",Hr.token,";"),star:new Vs("star",Hr.token,"*"),tilde:new Vs("tilde",Hr.token,"~"),underscore:new Vs("underscore",Hr.token,"_"),xor:new Vs("xor",Hr.token,"^"),plus_equal:new Vs("plus_equal",Hr.token,"+="),minus_equal:new Vs("minus_equal",Hr.token,"-="),times_equal:new Vs("times_equal",Hr.token,"*="),division_equal:new Vs("division_equal",Hr.token,"/="),modulo_equal:new Vs("modulo_equal",Hr.token,"%="),and_equal:new Vs("and_equal",Hr.token,"&="),or_equal:new Vs("or_equal",Hr.token,"|="),xor_equal:new Vs("xor_equal",Hr.token,"^="),shift_right_equal:new Vs("shift_right_equal",Hr.token,">>="),shift_left_equal:new Vs("shift_left_equal",Hr.token,"<<=")},Ws.simpleTokens={"@":jr.tokens.attr,"{":jr.tokens.brace_left,"}":jr.tokens.brace_right,":":jr.tokens.colon,",":jr.tokens.comma,"(":jr.tokens.paren_left,")":jr.tokens.paren_right,";":jr.tokens.semicolon},Ws.literalTokens={"&":jr.tokens.and,"&&":jr.tokens.and_and,"->":jr.tokens.arrow,"/":jr.tokens.forward_slash,"!":jr.tokens.bang,"[":jr.tokens.bracket_left,"]":jr.tokens.bracket_right,"=":jr.tokens.equal,"==":jr.tokens.equal_equal,"!=":jr.tokens.not_equal,">":jr.tokens.greater_than,">=":jr.tokens.greater_than_equal,">>":jr.tokens.shift_right,"<":jr.tokens.less_than,"<=":jr.tokens.less_than_equal,"<<":jr.tokens.shift_left,"%":jr.tokens.modulo,"-":jr.tokens.minus,"--":jr.tokens.minus_minus,".":jr.tokens.period,"+":jr.tokens.plus,"++":jr.tokens.plus_plus,"|":jr.tokens.or,"||":jr.tokens.or_or,"*":jr.tokens.star,"~":jr.tokens.tilde,_:jr.tokens.underscore,"^":jr.tokens.xor,"+=":jr.tokens.plus_equal,"-=":jr.tokens.minus_equal,"*=":jr.tokens.times_equal,"/=":jr.tokens.division_equal,"%=":jr.tokens.modulo_equal,"&=":jr.tokens.and_equal,"|=":jr.tokens.or_equal,"^=":jr.tokens.xor_equal,">>=":jr.tokens.shift_right_equal,"<<=":jr.tokens.shift_left_equal},Ws.regexTokens={decimal_float_literal:jr.tokens.decimal_float_literal,hex_float_literal:jr.tokens.hex_float_literal,int_literal:jr.tokens.int_literal,uint_literal:jr.tokens.uint_literal,ident:jr.tokens.ident},Ws.storage_class=[jr.keywords.function,jr.keywords.private,jr.keywords.workgroup,jr.keywords.uniform,jr.keywords.storage],Ws.access_mode=[jr.keywords.read,jr.keywords.write,jr.keywords.read_write],Ws.sampler_type=[jr.keywords.sampler,jr.keywords.sampler_comparison],Ws.sampled_texture_type=[jr.keywords.texture_1d,jr.keywords.texture_2d,jr.keywords.texture_2d_array,jr.keywords.texture_3d,jr.keywords.texture_cube,jr.keywords.texture_cube_array],Ws.multisampled_texture_type=[jr.keywords.texture_multisampled_2d],Ws.storage_texture_type=[jr.keywords.texture_storage_1d,jr.keywords.texture_storage_2d,jr.keywords.texture_storage_2d_array,jr.keywords.texture_storage_3d],Ws.depth_texture_type=[jr.keywords.texture_depth_2d,jr.keywords.texture_depth_2d_array,jr.keywords.texture_depth_cube,jr.keywords.texture_depth_cube_array,jr.keywords.texture_depth_multisampled_2d],Ws.texture_external_type=[jr.keywords.texture_external],Ws.any_texture_type=[...jr.sampled_texture_type,...jr.multisampled_texture_type,...jr.storage_texture_type,...jr.depth_texture_type,...jr.texture_external_type],Ws.texel_format=[jr.keywords.r8unorm,jr.keywords.r8snorm,jr.keywords.r8uint,jr.keywords.r8sint,jr.keywords.r16uint,jr.keywords.r16sint,jr.keywords.r16float,jr.keywords.rg8unorm,jr.keywords.rg8snorm,jr.keywords.rg8uint,jr.keywords.rg8sint,jr.keywords.r32uint,jr.keywords.r32sint,jr.keywords.r32float,jr.keywords.rg16uint,jr.keywords.rg16sint,jr.keywords.rg16float,jr.keywords.rgba8unorm,jr.keywords.rgba8unorm_srgb,jr.keywords.rgba8snorm,jr.keywords.rgba8uint,jr.keywords.rgba8sint,jr.keywords.bgra8unorm,jr.keywords.bgra8unorm_srgb,jr.keywords.rgb10a2unorm,jr.keywords.rg11b10float,jr.keywords.rg32uint,jr.keywords.rg32sint,jr.keywords.rg32float,jr.keywords.rgba16uint,jr.keywords.rgba16sint,jr.keywords.rgba16float,jr.keywords.rgba32uint,jr.keywords.rgba32sint,jr.keywords.rgba32float],Ws.const_literal=[jr.tokens.int_literal,jr.tokens.uint_literal,jr.tokens.decimal_float_literal,jr.tokens.hex_float_literal,jr.keywords.true,jr.keywords.false],Ws.literal_or_ident=[jr.tokens.ident,jr.tokens.int_literal,jr.tokens.uint_literal,jr.tokens.decimal_float_literal,jr.tokens.hex_float_literal,jr.tokens.name],Ws.element_count_expression=[jr.tokens.int_literal,jr.tokens.uint_literal,jr.tokens.ident],Ws.template_types=[jr.keywords.vec2,jr.keywords.vec3,jr.keywords.vec4,jr.keywords.mat2x2,jr.keywords.mat2x3,jr.keywords.mat2x4,jr.keywords.mat3x2,jr.keywords.mat3x3,jr.keywords.mat3x4,jr.keywords.mat4x2,jr.keywords.mat4x3,jr.keywords.mat4x4,jr.keywords.atomic,jr.keywords.bitcast,...jr.any_texture_type],Ws.attribute_name=[jr.tokens.ident,jr.keywords.block,jr.keywords.diagnostic],Ws.assignment_operators=[jr.tokens.equal,jr.tokens.plus_equal,jr.tokens.minus_equal,jr.tokens.times_equal,jr.tokens.division_equal,jr.tokens.modulo_equal,jr.tokens.and_equal,jr.tokens.or_equal,jr.tokens.xor_equal,jr.tokens.shift_right_equal,jr.tokens.shift_left_equal],Ws.increment_operators=[jr.tokens.plus_plus,jr.tokens.minus_minus];class js{constructor(e,t,n,i,r){this.type=e,this.lexeme=t,this.line=n,this.start=i,this.end=r}toString(){return this.lexeme}isTemplateType(){return-1!=Ws.template_types.indexOf(this.type)}isArrayType(){return this.type==Ws.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Hs{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new js(Ws.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}const t=Ws.simpleTokens[e];if(t)return this._addToken(t),!0;let n=Ws.none;const i=this._isAlpha(e),r="_"===e;if(this._isAlphaNumeric(e)){let t=this._peekAhead();for(;this._isAlphaNumeric(t);)e+=this._advance(),t=this._peekAhead()}if(i){const t=Ws.keywords[e];if(t)return this._addToken(t),!0}if(i||r)return this._addToken(Ws.tokens.ident),!0;for(;;){let t=this._findType(e);const i=this._peekAhead();if("-"==e&&this._tokens.length>0){if("="==i)return this._current++,e+=i,this._addToken(Ws.tokens.minus_equal),!0;if("-"==i)return this._current++,e+=i,this._addToken(Ws.tokens.minus_minus),!0;const n=this._tokens.length-1;if((-1!=Ws.literal_or_ident.indexOf(this._tokens[n].type)||this._tokens[n].type==Ws.tokens.paren_right)&&">"!=i)return this._addToken(t),!0}if(">"==e&&(">"==i||"="==i)){let e=!1,n=this._tokens.length-1;for(let t=0;t<5&&n>=0&&-1===Ws.assignment_operators.indexOf(this._tokens[n].type);++t,--n)if(this._tokens[n].type===Ws.tokens.less_than){n>0&&this._tokens[n-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(t),!0}if(t===Ws.none){let i=e,r=0;const s=2;for(let e=0;e<s;++e)if(i+=this._peekAhead(e),t=this._findType(i),t!==Ws.none){r=e;break}if(t===Ws.none)return n!==Ws.none&&(this._current--,this._addToken(n),!0);e=i,this._current+=r+1}if(n=t,this._isAtEnd())break;e+=this._advance()}return n!==Ws.none&&(this._addToken(n),!0)}_findType(e){for(const t in Ws.regexTokens){const n=Ws.regexTokens[t];if(this._match(e,n.rule))return n}return Ws.literalTokens[e]||Ws.none}_match(e,t){const n=t.exec(e);return n&&0==n.index&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&"_"!==e&&"."!==e&&"("!==e&&")"!==e&&"["!==e&&"]"!==e&&"{"!==e&&"}"!==e&&","!==e&&";"!==e&&":"!==e&&"="!==e&&"!"!==e&&"<"!==e&&">"!==e&&"+"!==e&&"-"!==e&&"*"!==e&&"/"!==e&&"%"!==e&&"&"!==e&&"|"!==e&&"^"!==e&&"~"!==e&&"@"!==e&&"#"!==e&&"?"!==e&&"'"!==e&&"`"!==e&&'"'!==e&&"\\"!==e&&"\n"!==e&&"\r"!==e&&"\t"!==e&&"\0"!==e}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||"_"===e}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new js(e,t,this._line,this._start,this._current))}}function Xs(e){return Array.isArray(e)||(null==e?void 0:e.buffer)instanceof ArrayBuffer}const Qs=new Float32Array(1),$s=new Uint32Array(Qs.buffer),Ys=new Uint32Array(Qs.buffer),Ks=new Int32Array(1),Zs=new Float32Array(Ks.buffer),qs=new Uint32Array(Ks.buffer),Js=new Uint32Array(1),eo=new Float32Array(Js.buffer),to=new Int32Array(Js.buffer);function no(e,t,n){if(t===n)return e;if("f32"===t){if("i32"===n||"x32"===n)return Qs[0]=e,$s[0];if("u32"===n)return Qs[0]=e,Ys[0]}else if("i32"===t||"x32"===t){if("f32"===n)return Ks[0]=e,Zs[0];if("u32"===n)return Ks[0]=e,qs[0]}else if("u32"===t){if("f32"===n)return Js[0]=e,eo[0];if("i32"===n||"x32"===n)return Js[0]=e,to[0]}return e}class io{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class ro{constructor(e,t){this.align=e,this.size=t}}class so{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new gr,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}updateAST(e){for(const t of e)t instanceof Lr&&this._functions.set(t.name,new io(t));for(const t of e)if(t instanceof As){const e=this.getTypeInfo(t,null);e instanceof ir&&this.structs.push(e)}for(const t of e)if(t instanceof ns)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof Ur){const e=t,n=this._getAttributeNum(e.attributes,"id",0),i=null!=e.type?this.getTypeInfo(e.type,e.attributes):null;this.overrides.push(new dr(e.name,i,e.attributes,n));continue}if(this._isUniformVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),s=new lr(e.name,r,n,i,e.attributes,ar.Uniform,e.access);s.access||(s.access="read"),this.uniforms.push(s);continue}if(this._isStorageVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),s=this._isStorageTexture(r),o=new lr(e.name,r,n,i,e.attributes,s?ar.StorageTexture:ar.Storage,e.access);o.access||(o.access="read"),this.storage.push(o);continue}if(this._isTextureVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),s=this._isStorageTexture(r),o=new lr(e.name,r,n,i,e.attributes,s?ar.StorageTexture:ar.Texture,e.access);o.access||(o.access="read"),s?this.storage.push(o):this.textures.push(o);continue}if(this._isSamplerVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),s=new lr(e.name,r,n,i,e.attributes,ar.Sampler,e.access);this.samplers.push(s);continue}}for(const t of e)if(t instanceof Lr){const e=this._getAttribute(t,"vertex"),n=this._getAttribute(t,"fragment"),i=this._getAttribute(t,"compute"),r=e||n||i,s=new pr(t.name,null==r?void 0:r.name,t.attributes);s.attributes=t.attributes,s.startLine=t.startLine,s.endLine=t.endLine,this.functions.push(s),this._functions.get(t.name).info=s,r&&(this._functions.get(t.name).inUse=!0,s.inUse=!0,s.resources=this._findResources(t,!!r),s.inputs=this._getInputs(t.args),s.outputs=this._getOutputs(t.returnType),this.entry[r.name].push(s)),s.arguments=t.args.map(e=>new fr(e.name,this.getTypeInfo(e.type,e.attributes),e.attributes)),s.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(e=>{var n,i,r;if(e instanceof ks){if(e.value)if(Xs(e.value))for(const s of e.value)for(const e of this.overrides)s===e.name&&(null===(n=t.info)||void 0===n||n.overrides.push(e));else for(const s of this.overrides)e.value===s.name&&(null===(i=t.info)||void 0===i||i.overrides.push(s))}else if(e instanceof ms)for(const s of this.overrides)e.name===s.name&&(null===(r=t.info)||void 0===r||r.overrides.push(s))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const i of e.calls){const e=null===(n=this._functions.get(i.name))||void 0===n?void 0:n.info;e&&t.add(e)}}findResource(e,t,n){if(n){for(const i of this.entry.compute)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n;for(const i of this.entry.vertex)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n;for(const i of this.entry.fragment)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n}for(const i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(const i of this.storage)if(i.group==e&&i.binding==t)return i;for(const i of this.textures)if(i.group==e&&i.binding==t)return i;for(const i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],i=this,r=[];return e.search(s=>{if(s instanceof Rr)r.push({});else if(s instanceof Ir)r.pop();else if(s instanceof Fr){const e=s;t&&null!==e.type&&this._markStructsFromAST(e.type),r.length>0&&(r[r.length-1][e.name]=e)}else if(s instanceof ps){const e=s;t&&null!==e.type&&this._markStructsFromAST(e.type)}else if(s instanceof Gr){const e=s;t&&null!==e.type&&this._markStructsFromAST(e.type),r.length>0&&(r[r.length-1][e.name]=e)}else if(s instanceof ms){const e=s;if(r.length>0&&r[r.length-1][e.name])return;const t=i._findResource(e.name);t&&n.push(t)}else if(s instanceof gs){const r=s,o=i._functions.get(r.name);o&&(t&&(o.inUse=!0),e.calls.add(o.node),null===o.resources&&(o.resources=i._findResources(o.node,t)),n.push(...o.resources))}else if(s instanceof $r){const r=s,o=i._functions.get(r.name);o&&(t&&(o.inUse=!0),e.calls.add(o.node),null===o.resources&&(o.resources=i._findResources(o.node,t)),n.push(...o.resources))}}),[...new Map(n.map(e=>[e.name,e])).values()]}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(void 0===t&&(t=[]),e instanceof As)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof As)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const i=this.getTypeInfo(n.type,n.type.attributes),r=this._parseInt(e.value),s=new hr(n.name,i,e.name,r);t.push(s)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new hr("",n,t.name,i)}return null}_getInputs(e,t=void 0){void 0===t&&(t=[]);for(const n of e)if(n.type instanceof As)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof As)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),r=this._parseInt(t.value),s=new ur(e.name,i,t.name,r);return null!==n&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new cr(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof cs){const n=e.type?this.getTypeInfo(e.type,e.attributes):null,i=new sr(e.name,n,t);return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof us){const n=e,i=n.format?this.getTypeInfo(n.format,n.attributes):null,r=new rr(n.name,t);return r.format=i,r.count=n.count,this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof As){const n=e,i=new ir(n.name,t);i.startLine=n.startLine,i.endLine=n.endLine;for(const e of n.members){const t=this.getTypeInfo(e.type,e.attributes);i.members.push(new nr(e.name,t,e.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof hs){const n=e,i=n.format instanceof os,r=n.format?i?this.getTypeInfo(n.format,null):new tr(n.format,null):null,s=new or(n.name,r,t,n.access);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof ls){const n=e,i=n.format?this.getTypeInfo(n.format,null):null,r=new or(n.name,i,t,n.access);return this._types.set(e,r),this._updateTypeInfo(r),r}const n=new tr(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,i;const r=this._getTypeSize(e);if(e.size=null!==(t=null==r?void 0:r.size)&&void 0!==t?t:0,e instanceof rr&&e.format){const t=this._getTypeSize(e.format);e.stride=Math.max(null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,null!==(i=null==t?void 0:t.align)&&void 0!==i?i:0),this._updateTypeInfo(e.format)}e instanceof sr&&this._updateTypeInfo(e.format),e instanceof ir&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,r=0,s=0;for(let o=0,a=e.members.length;o<a;++o){const a=e.members[o],A=this._getTypeSize(a);if(!A)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const l=A.align,c=A.size;n=this._roundUp(l,n+i),i=c,r=n,s=Math.max(s,l),a.offset=n,a.size=c,this._updateTypeInfo(a.type)}e.size=this._roundUp(s,r+i),e.align=s}_getTypeSize(e){var t,n;if(null==e)return null;const i=this._getAttributeNum(e.attributes,"size",0),r=this._getAttributeNum(e.attributes,"align",0);if(e instanceof nr&&(e=e.type),e instanceof tr){const t=this._getAlias(e.name);null!==t&&(e=t)}{const n=so._typeInfo[e.name];if(void 0!==n){const s="f16"===(null===(t=e.format)||void 0===t?void 0:t.name)?2:1;return new ro(Math.max(r,n.align/s),Math.max(i,n.size/s))}}{const t=so._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const n="h"===e.name[e.name.length-1]?2:1;return new ro(Math.max(r,t.align/n),Math.max(i,t.size/n))}}if(e instanceof rr){let t=e,s=8,o=8;const a=this._getTypeSize(t.format);return null!==a&&(o=a.size,s=a.align),o=t.count*this._getAttributeNum(null!==(n=null==e?void 0:e.attributes)&&void 0!==n?n:null,"stride",this._roundUp(s,o)),i&&(o=i),new ro(Math.max(r,s),Math.max(i,o))}if(e instanceof ir){let t=0,n=0,s=0,o=0,a=0;for(const i of e.members){const e=this._getTypeSize(i.type);null!==e&&(t=Math.max(e.align,t),s=this._roundUp(e.align,s+o),o=e.size,a=s)}return n=this._roundUp(t,a+o),new ro(Math.max(r,t),Math.max(i,n))}return null}_isUniformVar(e){return e instanceof Fr&&"uniform"==e.storage}_isStorageVar(e){return e instanceof Fr&&"storage"==e.storage}_isTextureVar(e){return e instanceof Fr&&null!==e.type&&-1!=so._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof Fr&&null!==e.type&&-1!=so._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let r of i)if(r.name==t)return r;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let i of e)if(i.name==t){let e=null!==i&&null!==i.value?i.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}so._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},so._textureTypes=Ws.any_texture_type.map(e=>e.name),so._samplerTypes=Ws.sampler_type.map(e=>e.name);let oo=0;class ao{constructor(e,t,n){this.id=oo++,this.name=e,this.value=t,this.node=n}clone(){return new ao(this.name,this.value,this.node)}}class Ao{constructor(e){this.id=oo++,this.name=e.name,this.node=e}clone(){return new Ao(this.node)}}class lo{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=oo++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?null!==(t=this.variables.get(e))&&void 0!==t?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?null!==(t=this.functions.get(e))&&void 0!==t?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new ao(e,t,null!=n?n:null))}setVariable(e,t,n){const i=this.getVariable(e);null!==i?i.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return null!==(t=null==n?void 0:n.value)&&void 0!==t?t:null}clone(){return new lo(this)}}class co{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class uo{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let i=!0;if(n instanceof Fs)return n.data.forEach(e=>{e||(i=!1)}),new Os(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs){const e=n.data.some(e=>e);return new Os(e?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof Os))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof Es&&(n=n.right);const i=this.exec.evalExpression(n,t);if(i instanceof Gs&&0===i.typeInfo.size){const e=i.typeInfo,t=i.buffer.byteLength/e.stride;return new Os(t,this.getTypeInfo("u32"))}return new Os(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.abs(e)),n.typeInfo);const i=n;return new Os(Math.abs(i.value),i.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.acos(e)),n.typeInfo);const i=n;return new Os(Math.acos(i.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.acosh(e)),n.typeInfo);const i=n;return new Os(Math.acosh(i.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.asin(e)),n.typeInfo);const i=n;return new Os(Math.asin(i.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.asinh(e)),n.typeInfo);const i=n;return new Os(Math.asinh(i.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.atan(e)),n.typeInfo);const i=n;return new Os(Math.atan(i.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.atanh(e)),n.typeInfo);const i=n;return new Os(Math.atanh(i.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Fs&&i instanceof Fs)return new Fs(n.data.map((e,t)=>Math.atan2(e,i.data[t])),n.typeInfo);const r=n,s=i;return new Os(Math.atan2(r.value,s.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.ceil(e)),n.typeInfo);const i=n;return new Os(Math.ceil(i.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Fs&&i instanceof Fs&&r instanceof Fs)return new Fs(n.data.map((e,t)=>this._clamp(e,i.data[t],r.data[t])),n.typeInfo);const s=n,o=i,a=r;return new Os(this._clamp(s.value,o.value,a.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.cos(e)),n.typeInfo);const i=n;return new Os(Math.cos(i.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.cosh(e)),n.typeInfo);const i=n;return new Os(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.clz32(e)),n.typeInfo);const i=n;return new Os(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let t=0;for(;0!==e;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>this._countOneBits(e)),n.typeInfo);const i=n;return new Os(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(0===e)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>this._countTrailingZeros(e)),n.typeInfo);const i=n;return new Os(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Fs&&i instanceof Fs){if(3!==n.data.length||3!==i.data.length)return null;const e=n.data,t=i.data;return new Fs([e[1]*t[2]-t[1]*e[2],e[2]*t[0]-t[2]*e[0],e[0]*t[1]-t[0]*e[1]],n.typeInfo)}return null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return n instanceof Fs?new Fs(n.data.map(e=>e*i),n.typeInfo):new Os(n.value*i,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Us){const e=n.data,t=n.typeInfo.getTypeName(),i=t.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t)return new Os(e[0]*e[3]-e[1]*e[2],i);if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t)return new Os(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i);if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t);else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t);else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t)return new Os(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i)}return null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Fs&&i instanceof Fs){let e=0;for(let t=0;t<n.data.length;++t)e+=(n.data[t]-i.data[t])*(n.data[t]-i.data[t]);return new Os(Math.sqrt(e),this.getTypeInfo("f32"))}const r=n,s=i;return new Os(Math.abs(r.value-s.value),n.typeInfo)}_dot(e,t){let n=0;for(let i=0;i<e.length;++i)n+=t[i]*e[i];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return n instanceof Fs&&i instanceof Fs?new Os(this._dot(n.data,i.data),this.getTypeInfo("f32")):null}Dot4U8Packed(e,t){return null}Dot4I8Packed(e,t){return null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.exp(e)),n.typeInfo);const i=n;return new Os(Math.exp(i.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.pow(2,e)),n.typeInfo);const i=n;return new Os(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if("u32"!==i.typeInfo.name&&"x32"!==i.typeInfo.name)return null;if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return null;const s=i.value,o=r.value;if(n instanceof Fs)return new Fs(n.data.map(e=>e>>s&(1<<o)-1),n.typeInfo);if("i32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return null;const a=n.value;return new Os(a>>s&(1<<o)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Fs&&i instanceof Fs&&r instanceof Fs){const e=this._dot(i.data,r.data);return new Fs(e<0?Array.from(n.data):n.data.map(e=>-e),n.typeInfo)}return null}_firstLeadingBit(e){return 0===e?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>this._firstLeadingBit(e)),n.typeInfo);const i=n;return new Os(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return 0===e?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>this._firstTrailingBit(e)),n.typeInfo);const i=n;return new Os(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.floor(e)),n.typeInfo);const i=n;return new Os(Math.floor(i.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Fs&&i instanceof Fs&&r instanceof Fs)return n.data.length!==i.data.length||n.data.length!==r.data.length?null:new Fs(n.data.map((e,t)=>e*i.data[t]+r.data[t]),n.typeInfo);const s=n,o=i,a=r;return new Os(s.value*o.value+a.value,s.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>e-Math.floor(e)),n.typeInfo);const i=n;return new Os(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,t){return null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t),s=this.exec.evalExpression(e.args[3],t);if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return null;const o=r.value,a=(1<<s.value)-1<<o,A=~a;if(n instanceof Fs&&i instanceof Fs)return new Fs(n.data.map((e,t)=>e&A|i.data[t]<<o&a),n.typeInfo);const l=n.value,c=i.value;return new Os(l&A|c<<o&a,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>1/Math.sqrt(e)),n.typeInfo);const i=n;return new Os(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,t){return null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs){let e=0;return n.data.forEach(t=>{e+=t*t}),new Os(Math.sqrt(e),this.getTypeInfo("f32"))}const i=n;return new Os(Math.abs(i.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.log(e)),n.typeInfo);const i=n;return new Os(Math.log(i.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.log2(e)),n.typeInfo);const i=n;return new Os(Math.log2(i.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Fs&&i instanceof Fs)return new Fs(n.data.map((e,t)=>Math.max(e,i.data[t])),n.typeInfo);const r=n,s=i;return new Os(Math.max(r.value,s.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Fs&&i instanceof Fs)return new Fs(n.data.map((e,t)=>Math.min(e,i.data[t])),n.typeInfo);const r=n,s=i;return new Os(Math.min(r.value,s.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Fs&&i instanceof Fs&&r instanceof Fs)return new Fs(n.data.map((e,t)=>n.data[t]*(1-r.data[t])+i.data[t]*r.data[t]),n.typeInfo);const s=i,o=r;return new Os(n.value*(1-o.value)+s.value*o.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Fs&&i instanceof Fs)return new Fs(n.data.map((e,t)=>e%i.data[t]),n.typeInfo);const r=i;return new Os(n.value%r.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs){const i=this.Length(e,t).value;return new Fs(n.data.map(e=>e/i),n.typeInfo)}return null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Fs&&i instanceof Fs)return new Fs(n.data.map((e,t)=>Math.pow(e,i.data[t])),n.typeInfo);const r=n,s=i;return new Os(Math.pow(r.value,s.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Fs?new Fs(n.data.map(e=>e),n.typeInfo):new Os(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Fs?new Fs(n.data.map(e=>e*Math.PI/180),n.typeInfo):new Os(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Fs&&i instanceof Fs){const e=this._dot(n.data,i.data);return new Fs(n.data.map((t,n)=>t-2*e*i.data[n]),n.typeInfo)}return null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Fs&&i instanceof Fs&&r instanceof Os){const e=this._dot(i.data,n.data);return new Fs(n.data.map((t,n)=>{const s=1-r.value*r.value*(1-e*e);if(s<0)return 0;const o=Math.sqrt(s);return r.value*t-(r.value*e+o)*i.data[n]}),n.typeInfo)}return null}ReverseBits(e,t){return null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.round(e)),n.typeInfo);const i=n;return new Os(Math.round(i.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.min(Math.max(e,0),1)),n.typeInfo);const i=n;return new Os(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.sign(e)),n.typeInfo);const i=n;return new Os(Math.sign(i.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.sin(e)),n.typeInfo);const i=n;return new Os(Math.sin(i.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.sinh(e)),n.typeInfo);const i=n;return new Os(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,t,n){const i=Math.min(Math.max((n-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(r instanceof Fs&&n instanceof Fs&&i instanceof Fs)return new Fs(r.data.map((e,t)=>this._smoothstep(n.data[t],i.data[t],e)),r.typeInfo);const s=n,o=i,a=r;return new Os(this._smoothstep(s.value,o.value,a.value),r.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.sqrt(e)),n.typeInfo);const i=n;return new Os(Math.sqrt(i.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof Fs&&n instanceof Fs)return new Fs(i.data.map((e,t)=>e<n.data[t]?0:1),i.typeInfo);const r=n;return new Os(i.value<r.value?0:1,r.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.tan(e)),n.typeInfo);const i=n;return new Os(Math.tan(i.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.tanh(e)),n.typeInfo);const i=n;return new Os(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return"mat2x2f"===t||"mat2x2h"===t?e:"mat2x3f"===t?this.getTypeInfo("mat3x2f"):"mat2x3h"===t?this.getTypeInfo("mat3x2h"):"mat2x4f"===t?this.getTypeInfo("mat4x2f"):"mat2x4h"===t?this.getTypeInfo("mat4x2h"):"mat3x2f"===t?this.getTypeInfo("mat2x3f"):"mat3x2h"===t?this.getTypeInfo("mat2x3h"):"mat3x3f"===t||"mat3x3h"===t?e:"mat3x4f"===t?this.getTypeInfo("mat4x3f"):"mat3x4h"===t?this.getTypeInfo("mat4x3h"):"mat4x2f"===t?this.getTypeInfo("mat2x4f"):"mat4x2h"===t?this.getTypeInfo("mat2x4h"):"mat4x3f"===t?this.getTypeInfo("mat3x4f"):"mat4x3h"===t?this.getTypeInfo("mat3x4h"):e}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof Us))return null;const i=this._getTransposeType(n.typeInfo);if("mat2x2"===n.typeInfo.name||"mat2x2f"===n.typeInfo.name||"mat2x2h"===n.typeInfo.name){const e=n.data;return new Us([e[0],e[2],e[1],e[3]],i)}if("mat2x3"===n.typeInfo.name||"mat2x3f"===n.typeInfo.name||"mat2x3h"===n.typeInfo.name){const e=n.data;return new Us([e[0],e[3],e[6],e[1],e[4],e[7]],i)}if("mat2x4"===n.typeInfo.name||"mat2x4f"===n.typeInfo.name||"mat2x4h"===n.typeInfo.name){const e=n.data;return new Us([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13]],i)}if("mat3x2"===n.typeInfo.name||"mat3x2f"===n.typeInfo.name||"mat3x2h"===n.typeInfo.name){const e=n.data;return new Us([e[0],e[3],e[1],e[4],e[2],e[5]],i)}if("mat3x3"===n.typeInfo.name||"mat3x3f"===n.typeInfo.name||"mat3x3h"===n.typeInfo.name){const e=n.data;return new Us([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]],i)}if("mat3x4"===n.typeInfo.name||"mat3x4f"===n.typeInfo.name||"mat3x4h"===n.typeInfo.name){const e=n.data;return new Us([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14]],i)}if("mat4x2"===n.typeInfo.name||"mat4x2f"===n.typeInfo.name||"mat4x2h"===n.typeInfo.name){const e=n.data;return new Us([e[0],e[4],e[1],e[5],e[2],e[6]],i)}if("mat4x3"===n.typeInfo.name||"mat4x3f"===n.typeInfo.name||"mat4x3h"===n.typeInfo.name){const e=n.data;return new Us([e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]],i)}if("mat4x4"===n.typeInfo.name||"mat4x4f"===n.typeInfo.name||"mat4x4h"===n.typeInfo.name){const e=n.data;return new Us([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],i)}return null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Fs)return new Fs(n.data.map(e=>Math.trunc(e)),n.typeInfo);const i=n;return new Os(Math.trunc(i.value),n.typeInfo)}Dpdx(e,t){return null}DpdxCoarse(e,t){return null}DpdxFine(e,t){return null}Dpdy(e,t){return null}DpdyCoarse(e,t){return null}DpdyFine(e,t){return null}Fwidth(e,t){return null}FwidthCoarse(e,t){return null}FwidthFine(e,t){return null}TextureDimensions(e,t){const n=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof ms){const e=n.name,r=t.getVariableValue(e);if(r instanceof zs){if(i<0||i>=r.mipLevelCount)return null;const e=r.getMipLevelSize(i),t=r.dimension;return"1d"===t?new Os(e[0],this.getTypeInfo("u32")):"3d"===t?new Fs(e,this.getTypeInfo("vec3u")):"2d"===t?new Fs(e.slice(0,2),this.getTypeInfo("vec2u")):null}return null}return null}TextureGather(e,t){return null}TextureGatherCompare(e,t){return null}TextureLoad(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),r=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof Fs)||2!==i.data.length)return null;if(n instanceof ms){const e=n.name,s=t.getVariableValue(e);if(s instanceof zs){const e=Math.floor(i.data[0]),t=Math.floor(i.data[1]);if(e<0||e>=s.width||t<0||t>=s.height)return null;const n=s.getPixel(e,t,0,r);return null===n?null:new Fs(n,this.getTypeInfo("vec4f"))}return null}return null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof ms){const e=n.name,i=t.getVariableValue(e);return i instanceof zs?new Os(i.depthOrArrayLayers,this.getTypeInfo("u32")):null}return null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof ms){const e=n.name,i=t.getVariableValue(e);return i instanceof zs?new Os(i.mipLevelCount,this.getTypeInfo("u32")):null}return null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof ms){const e=n.name,i=t.getVariableValue(e);return i instanceof zs?new Os(i.sampleCount,this.getTypeInfo("u32")):null}return null}TextureSample(e,t){return null}TextureSampleBias(e,t){return null}TextureSampleCompare(e,t){return null}TextureSampleCompareLevel(e,t){return null}TextureSampleGrad(e,t){return null}TextureSampleLevel(e,t){return null}TextureSampleBaseClampToEdge(e,t){return null}TextureStore(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),r=4===e.args.length?this.exec.evalExpression(e.args[2],t).value:0,s=4===e.args.length?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(4!==s.length)return null;if(!(i instanceof Fs)||2!==i.data.length)return null;if(n instanceof ms){const e=n.name,o=t.getVariableValue(e);if(o instanceof zs){const e=o.getMipLevelSize(0),t=Math.floor(i.data[0]),n=Math.floor(i.data[1]);return t<0||t>=e[0]||n<0||n>=e[1]||o.setPixel(t,n,0,r,Array.from(s)),null}return null}return null}AtomicLoad(e,t){let n=e.args[0];n instanceof Es&&(n=n.right);const i=this.exec.getVariableName(n,t);return t.getVariable(i).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof Es&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t);return a instanceof Os&&o instanceof Os&&(a.value=o.value),r.value instanceof Gs&&r.value.setDataValue(this.exec,a,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof Es&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),A=new Os(a.value,a.typeInfo);return a instanceof Os&&o instanceof Os&&(a.value+=o.value),r.value instanceof Gs&&r.value.setDataValue(this.exec,a,n.postfix,t),A}AtomicSub(e,t){let n=e.args[0];n instanceof Es&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),A=new Os(a.value,a.typeInfo);return a instanceof Os&&o instanceof Os&&(a.value-=o.value),r.value instanceof Gs&&r.value.setDataValue(this.exec,a,n.postfix,t),A}AtomicMax(e,t){let n=e.args[0];n instanceof Es&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),A=new Os(a.value,a.typeInfo);return a instanceof Os&&o instanceof Os&&(a.value=Math.max(a.value,o.value)),r.value instanceof Gs&&r.value.setDataValue(this.exec,a,n.postfix,t),A}AtomicMin(e,t){let n=e.args[0];n instanceof Es&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),A=new Os(a.value,a.typeInfo);return a instanceof Os&&o instanceof Os&&(a.value=Math.min(a.value,o.value)),r.value instanceof Gs&&r.value.setDataValue(this.exec,a,n.postfix,t),A}AtomicAnd(e,t){let n=e.args[0];n instanceof Es&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),A=new Os(a.value,a.typeInfo);return a instanceof Os&&o instanceof Os&&(a.value=a.value&o.value),r.value instanceof Gs&&r.value.setDataValue(this.exec,a,n.postfix,t),A}AtomicOr(e,t){let n=e.args[0];n instanceof Es&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),A=new Os(a.value,a.typeInfo);return a instanceof Os&&o instanceof Os&&(a.value=a.value|o.value),r.value instanceof Gs&&r.value.setDataValue(this.exec,a,n.postfix,t),A}AtomicXor(e,t){let n=e.args[0];n instanceof Es&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),A=new Os(a.value,a.typeInfo);return a instanceof Os&&o instanceof Os&&(a.value=a.value^o.value),r.value instanceof Gs&&r.value.setDataValue(this.exec,a,n.postfix,t),A}AtomicExchange(e,t){let n=e.args[0];n instanceof Es&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let s=e.args[1];const o=this.exec.evalExpression(s,t),a=r.value.getSubData(this.exec,n.postfix,t),A=new Os(a.value,a.typeInfo);return a instanceof Os&&o instanceof Os&&(a.value=o.value),r.value instanceof Gs&&r.value.setDataValue(this.exec,a,n.postfix,t),A}AtomicCompareExchangeWeak(e,t){return null}Pack4x8snorm(e,t){return null}Pack4x8unorm(e,t){return null}Pack4xI8(e,t){return null}Pack4xU8(e,t){return null}Pack4x8Clamp(e,t){return null}Pack4xU8Clamp(e,t){return null}Pack2x16snorm(e,t){return null}Pack2x16unorm(e,t){return null}Pack2x16float(e,t){return null}Unpack4x8snorm(e,t){return null}Unpack4x8unorm(e,t){return null}Unpack4xI8(e,t){return null}Unpack4xU8(e,t){return null}Unpack2x16snorm(e,t){return null}Unpack2x16unorm(e,t){return null}Unpack2x16float(e,t){return null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return null}SubgroupExclusiveAdd(e,t){return null}SubgroupInclusiveAdd(e,t){return null}SubgroupAll(e,t){return null}SubgroupAnd(e,t){return null}SubgroupAny(e,t){return null}SubgroupBallot(e,t){return null}SubgroupBroadcast(e,t){return null}SubgroupBroadcastFirst(e,t){return null}SubgroupElect(e,t){return null}SubgroupMax(e,t){return null}SubgroupMin(e,t){return null}SubgroupMul(e,t){return null}SubgroupExclusiveMul(e,t){return null}SubgroupInclusiveMul(e,t){return null}SubgroupOr(e,t){return null}SubgroupShuffle(e,t){return null}SubgroupShuffleDown(e,t){return null}SubgroupShuffleUp(e,t){return null}SubgroupShuffleXor(e,t){return null}SubgroupXor(e,t){return null}QuadBroadcast(e,t){return null}QuadSwapDiagonal(e,t){return null}QuadSwapX(e,t){return null}QuadSwapY(e,t){return null}}const ho={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},fo={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class po extends co{constructor(e,t){var n;super(),this.ast=null!=e?e:[],this.reflection=new so,this.reflection.updateAST(this.ast),this.context=null!==(n=null==t?void 0:t.clone())&&void 0!==n?n:new lo,this.builtins=new uo(this),this.typeInfo={bool:this.getTypeInfo(os.bool),i32:this.getTypeInfo(os.i32),u32:this.getTypeInfo(os.u32),f32:this.getTypeInfo(os.f32),f16:this.getTypeInfo(os.f16),vec2f:this.getTypeInfo(ls.vec2f),vec2u:this.getTypeInfo(ls.vec2u),vec2i:this.getTypeInfo(ls.vec2i),vec2h:this.getTypeInfo(ls.vec2h),vec3f:this.getTypeInfo(ls.vec3f),vec3u:this.getTypeInfo(ls.vec3u),vec3i:this.getTypeInfo(ls.vec3i),vec3h:this.getTypeInfo(ls.vec3h),vec4f:this.getTypeInfo(ls.vec4f),vec4u:this.getTypeInfo(ls.vec4u),vec4i:this.getTypeInfo(ls.vec4i),vec4h:this.getTypeInfo(ls.vec4h),mat2x2f:this.getTypeInfo(ls.mat2x2f),mat2x3f:this.getTypeInfo(ls.mat2x3f),mat2x4f:this.getTypeInfo(ls.mat2x4f),mat3x2f:this.getTypeInfo(ls.mat3x2f),mat3x3f:this.getTypeInfo(ls.mat3x3f),mat3x4f:this.getTypeInfo(ls.mat3x4f),mat4x2f:this.getTypeInfo(ls.mat4x2f),mat4x3f:this.getTypeInfo(ls.mat4x3f),mat4x4f:this.getTypeInfo(ls.mat4x4f)}}getVariableValue(e){var t,n;const i=null!==(n=null===(t=this.context.getVariable(e))||void 0===t?void 0:t.value)&&void 0!==n?n:null;if(null===i)return null;if(i instanceof Os)return i.value;if(i instanceof Fs)return Array.from(i.data);if(i instanceof Us)return Array.from(i.data);if(i instanceof Gs&&i.typeInfo instanceof rr){if("u32"===i.typeInfo.format.name)return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if("i32"===i.typeInfo.format.name)return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if("f32"===i.typeInfo.format.name)return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return null}execute(e){(e=null!=e?e:{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,i){const r=this.context.clone();(i=null!=i?i:{}).constants&&this._setOverrides(i.constants,r),this._execStatements(this.ast,r);const s=r.getFunction(e);if(!s)return;if("number"==typeof t)t=[t,1,1];else{if(0===t.length)return;1===t.length?t=[t[0],1,1]:2===t.length?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const o=t[0],a=t[1],A=t[2],l=this.getTypeInfo("vec3u");r.setVariable("@num_workgroups",new Fs(t,l));const c=this.reflection.getFunctionInfo(e);for(const u in n)for(const e in n[u]){const t=n[u][e];r.variables.forEach(n=>{var i;const r=n.node;if(null==r?void 0:r.attributes){let s=null,o=null;for(const e of r.attributes)"binding"===e.name?s=e.value:"group"===e.name&&(o=e.value);if(e==s&&u==o){let s=!1;for(const t of c.resources)if(t.name===n.name&&t.group===parseInt(u)&&t.binding===parseInt(e)){s=!0;break}if(s)if(void 0!==t.texture&&void 0!==t.descriptor){const e=new zs(t.texture,this.getTypeInfo(r.type),t.descriptor,null!==(i=t.texture.view)&&void 0!==i?i:null);n.value=e}else void 0!==t.uniform?n.value=new Gs(t.uniform,this.getTypeInfo(r.type)):n.value=new Gs(t,this.getTypeInfo(r.type))}}})}for(let u=0;u<A;++u)for(let e=0;e<a;++e)for(let t=0;t<o;++t)r.setVariable("@workgroup_id",new Fs([t,e,u],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(s,[t,e,u],r)}execStatement(e,t){if(e instanceof qr)return this.evalExpression(e.value,t);if(e instanceof rs){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof Os))throw new Error("Invalid break-if condition");if(!n.value)return null}return po._breakObj}if(e instanceof ss)return po._continueObj;if(e instanceof Gr)this._let(e,t);else if(e instanceof Fr)this._var(e,t);else if(e instanceof zr)this._const(e,t);else if(e instanceof Lr)this._function(e,t);else{if(e instanceof Zr)return this._if(e,t);if(e instanceof Kr)return this._switch(e,t);if(e instanceof Nr)return this._for(e,t);if(e instanceof Dr)return this._while(e,t);if(e instanceof Yr)return this._loop(e,t);if(e instanceof Or){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof Qr)this._assign(e,t);else if(e instanceof Xr)this._increment(e,t);else{if(e instanceof As)return null;if(e instanceof Ur){const n=e.name;null===t.getVariable(n)&&t.setVariable(n,new Os(0,this.getTypeInfo("u32")))}else if(e instanceof $r)this._call(e,t);else{if(e instanceof ts)return null;if(e instanceof ns)return null}}}return null}evalExpression(e,t){return e instanceof xs?this._evalBinaryOp(e,t):e instanceof vs?this._evalLiteral(e,t):e instanceof ms?this._evalVariable(e,t):e instanceof gs?this._evalCall(e,t):e instanceof ps?this._evalCreate(e,t):e instanceof _s?this._evalConst(e,t):e instanceof ys?this._evalBitcast(e,t):e instanceof Es?this._evalUnaryOp(e,t):null}getTypeInfo(e){var t;if(e instanceof os){const t=this.reflection.getTypeInfo(e);if(null!==t)return t}let n=null!==(t=this.typeInfo[e])&&void 0!==t?t:null;return null!==n||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const i=e[n],r=this.reflection.getOverrideInfo(n);null!==r&&(null===r.type&&(r.type=this.getTypeInfo("u32")),"u32"===r.type.name||"i32"===r.type.name||"f32"===r.type.name||"f16"===r.type.name?t.setVariable(n,new Os(i,r.type)):"bool"===r.type.name?t.setVariable(n,new Os(i?1:0,r.type)):("vec2"===r.type.name||"vec3"===r.type.name||"vec4"===r.type.name||"vec2f"===r.type.name||"vec3f"===r.type.name||"vec4f"===r.type.name||"vec2i"===r.type.name||"vec3i"===r.type.name||"vec4i"===r.type.name||"vec2u"===r.type.name||"vec3u"===r.type.name||"vec4u"===r.type.name||"vec2h"===r.type.name||"vec3h"===r.type.name||"vec4h"===r.type.name)&&t.setVariable(n,new Fs(i,r.type)))}}_dispatchWorkgroup(e,t,n){const i=[1,1,1];for(const l of e.node.attributes)if("workgroup_size"===l.name){if(l.value.length>0){const e=n.getVariableValue(l.value[0]);i[0]=e instanceof Os?e.value:parseInt(l.value[0])}if(l.value.length>1){const e=n.getVariableValue(l.value[1]);i[1]=e instanceof Os?e.value:parseInt(l.value[1])}if(l.value.length>2){const e=n.getVariableValue(l.value[2]);i[2]=e instanceof Os?e.value:parseInt(l.value[2])}}const r=this.getTypeInfo("vec3u"),s=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Fs(i,r));const o=i[0],a=i[1],A=i[2];for(let l=0,c=0;l<A;++l)for(let A=0;A<a;++A)for(let a=0;a<o;++a,++c){const o=[a,A,l],u=[a+t[0]*i[0],A+t[1]*i[1],l+t[2]*i[2]];n.setVariable("@local_invocation_id",new Fs(o,r)),n.setVariable("@global_invocation_id",new Fs(u,r)),n.setVariable("@local_invocation_index",new Os(c,s)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const e of n.attributes)if("builtin"===e.name){const i=`@${e.value}`,r=t.getVariable(i);void 0!==r&&t.variables.set(n.name,r)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Es;)e=e.right;return e instanceof ms?e.name:null}_execStatements(e,t){for(const n of e){if(n instanceof Array){const e=t.clone(),i=this._execStatements(n,e);if(i)return i;continue}const e=this.execStatement(n,t);if(e)return e}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let t=0;t<i.node.args.length;++t){const r=i.node.args[t],s=this.evalExpression(e.args[t],n);n.setVariable(r.name,s,r)}this._execStatements(i.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),i=t.getVariable(n);i&&("++"===e.operator?i.value instanceof Os&&i.value.value++:"--"===e.operator&&i.value instanceof Os&&i.value.value--)}_getVariableData(e,t){if(e instanceof ms){const n=this.getVariableName(e,t),i=t.getVariable(n);return null===i?null:i.value.getSubData(this,e.postfix,t)}if(e instanceof Es){if("*"===e.operator){const n=this._getVariableData(e.right,t);return n instanceof Ds?n.reference.getSubData(this,e.postfix,t):null}if("&"===e.operator){const n=this._getVariableData(e.right,t);return new Ds(n)}}return null}_assign(e,t){let n=null,i="<var>",r=null;if(e.variable instanceof Es){const n=this._getVariableData(e.variable,t),i=this.evalExpression(e.value,t),r=e.operator;if("="===r){if(n instanceof Os||n instanceof Fs||n instanceof Us){if(i instanceof Os||i instanceof Fs||i instanceof Us&&n.data.length===i.data.length)return void n.data.set(i.data)}else if(n instanceof Gs&&i instanceof Gs&&n.buffer.byteLength-n.offset>=i.buffer.byteLength-i.offset)return void(n.buffer.byteLength%4==0?new Uint32Array(n.buffer,n.offset,n.typeInfo.size/4).set(new Uint32Array(i.buffer,i.offset,i.typeInfo.size/4)):new Uint8Array(n.buffer,n.offset,n.typeInfo.size).set(new Uint8Array(i.buffer,i.offset,i.typeInfo.size)));return null}if("+="===r)return(n instanceof Os||n instanceof Fs||n instanceof Us)&&(i instanceof Os||i instanceof Fs||i instanceof Us)?void n.data.set(i.data.map((e,t)=>n.data[t]+e)):void 0;if("-="===r)return(n instanceof Os||n instanceof Fs||n instanceof Us)&&(i instanceof Os||i instanceof Fs||i instanceof Us)?void n.data.set(i.data.map((e,t)=>n.data[t]-e)):void 0}if(e.variable instanceof Es){if("*"===e.variable.operator){i=this.getVariableName(e.variable.right,t);const r=t.getVariable(i);if(!(r&&r.value instanceof Ds))return;n=r.value.reference;let s=e.variable.postfix;if(!s){let t=e.variable.right;for(;t instanceof Es;){if(t.postfix){s=t.postfix;break}t=t.right}}s&&(n=n.getSubData(this,s,t))}}else{r=e.variable.postfix,i=this.getVariableName(e.variable,t);const s=t.getVariable(i);if(null===s)return;n=s.value}if(n instanceof Ds&&(n=n.reference),null===n)return;const s=this.evalExpression(e.value,t),o=e.operator;if("="!==o){const e=n.getSubData(this,r,t);if(e instanceof Fs&&s instanceof Os){const t=e.data,n=s.value;if("+="===o)for(let e=0;e<t.length;++e)t[e]+=n;else if("-="===o)for(let e=0;e<t.length;++e)t[e]-=n;else if("*="===o)for(let e=0;e<t.length;++e)t[e]*=n;else if("/="===o)for(let e=0;e<t.length;++e)t[e]/=n;else if("%="===o)for(let e=0;e<t.length;++e)t[e]%=n;else if("&="===o)for(let e=0;e<t.length;++e)t[e]&=n;else if("|="===o)for(let e=0;e<t.length;++e)t[e]|=n;else if("^="===o)for(let e=0;e<t.length;++e)t[e]^=n;else if("<<="===o)for(let e=0;e<t.length;++e)t[e]<<=n;else if(">>="===o)for(let e=0;e<t.length;++e)t[e]>>=n}else if(e instanceof Fs&&s instanceof Fs){const t=e.data,n=s.data;if(t.length!==n.length)return;if("+="===o)for(let e=0;e<t.length;++e)t[e]+=n[e];else if("-="===o)for(let e=0;e<t.length;++e)t[e]-=n[e];else if("*="===o)for(let e=0;e<t.length;++e)t[e]*=n[e];else if("/="===o)for(let e=0;e<t.length;++e)t[e]/=n[e];else if("%="===o)for(let e=0;e<t.length;++e)t[e]%=n[e];else if("&="===o)for(let e=0;e<t.length;++e)t[e]&=n[e];else if("|="===o)for(let e=0;e<t.length;++e)t[e]|=n[e];else if("^="===o)for(let e=0;e<t.length;++e)t[e]^=n[e];else if("<<="===o)for(let e=0;e<t.length;++e)t[e]<<=n[e];else if(">>="===o)for(let e=0;e<t.length;++e)t[e]>>=n[e]}else{if(!(e instanceof Os&&s instanceof Os))return;"+="===o?e.value+=s.value:"-="===o?e.value-=s.value:"*="===o?e.value*=s.value:"/="===o?e.value/=s.value:"%="===o?e.value%=s.value:"&="===o?e.value&=s.value:"|="===o?e.value|=s.value:"^="===o?e.value^=s.value:"<<="===o?e.value<<=s.value:">>="===o&&(e.value>>=s.value)}return void(n instanceof Gs&&n.setDataValue(this,e,r,t))}if(n instanceof Gs)n.setDataValue(this,s,r,t);else if(r){if(!(n instanceof Fs||n instanceof Us))return;if(r instanceof bs){const e=this.evalExpression(r.index,t).value;if(n instanceof Fs){if(!(s instanceof Os))return;n.data[e]=s.value}else{if(!(n instanceof Us))return;{const e=this.evalExpression(r.index,t).value;if(e<0)return;if(!(s instanceof Fs))return;{const t=n.typeInfo.getTypeName();if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t){if(!(e<2&&2===s.data.length))return;n.data[2*e]=s.data[0],n.data[2*e+1]=s.data[1]}else if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t){if(!(e<2&&3===s.data.length))return;n.data[3*e]=s.data[0],n.data[3*e+1]=s.data[1],n.data[3*e+2]=s.data[2]}else if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t){if(!(e<2&&4===s.data.length))return;n.data[4*e]=s.data[0],n.data[4*e+1]=s.data[1],n.data[4*e+2]=s.data[2],n.data[4*e+3]=s.data[3]}else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t){if(!(e<3&&2===s.data.length))return;n.data[2*e]=s.data[0],n.data[2*e+1]=s.data[1]}else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t){if(!(e<3&&3===s.data.length))return;n.data[3*e]=s.data[0],n.data[3*e+1]=s.data[1],n.data[3*e+2]=s.data[2]}else if("mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t){if(!(e<3&&4===s.data.length))return;n.data[4*e]=s.data[0],n.data[4*e+1]=s.data[1],n.data[4*e+2]=s.data[2],n.data[4*e+3]=s.data[3]}else if("mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t){if(!(e<4&&2===s.data.length))return;n.data[2*e]=s.data[0],n.data[2*e+1]=s.data[1]}else if("mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t){if(!(e<4&&3===s.data.length))return;n.data[3*e]=s.data[0],n.data[3*e+1]=s.data[1],n.data[3*e+2]=s.data[2]}else{if("mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t)return;if(!(e<4&&4===s.data.length))return;n.data[4*e]=s.data[0],n.data[4*e+1]=s.data[1],n.data[4*e+2]=s.data[2],n.data[4*e+3]=s.data[3]}}}}}else if(r instanceof fs){const e=r.value;if(!(n instanceof Fs))return;if(s instanceof Os){if(e.length>1)return;if("x"===e)n.data[0]=s.value;else if("y"===e){if(n.data.length<2)return;n.data[1]=s.value}else if("z"===e){if(n.data.length<3)return;n.data[2]=s.value}else if("w"===e){if(n.data.length<4)return;n.data[3]=s.value}}else{if(!(s instanceof Fs))return;if(e.length!==s.data.length)return;for(let t=0;t<e.length;++t){const i=e[t];if("x"===i||"r"===i)n.data[0]=s.data[t];else if("y"===i||"g"===i){if(s.data.length<2)return;n.data[1]=s.data[t]}else if("z"===i||"b"===i){if(s.data.length<3)return;n.data[2]=s.data[t]}else{if("w"!==i&&"a"!==i)return;if(s.data.length<4)return;n.data[3]=s.data[t]}}}}}else n instanceof Os&&s instanceof Os?n.value=s.value:(n instanceof Fs&&s instanceof Fs||n instanceof Us&&s instanceof Us)&&n.data.set(s.data)}_function(e,t){const n=new Ao(e);t.functions.set(e.name,n)}_const(e,t){let n=null;null!==e.value&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return;e.value instanceof Es||(n=n.clone())}else{const i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||"array"===i){const i=new ps(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return;e.value instanceof Es||(n=n.clone())}else{if(null===e.type)return;const i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||e.type instanceof us||e.type instanceof As||e.type instanceof ls){const i=new ps(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Os))return null;let i=null;for(const r of e.cases)if(r instanceof Cs)for(const e of r.selectors){if(e instanceof Ss){i=r;continue}const s=this.evalExpression(e,t);if(!(s instanceof Os))return null;if(s.value===n.value)return this._execStatements(r.body,t)}else r instanceof Ps&&(i=r);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Os))return null;if(n.value)return this._execStatements(e.body,t);for(const i of e.elseif){const e=this.evalExpression(i.condition,t);if(!(e instanceof Os))return null;if(e.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof Os?e.value:0}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===po._breakObj)break;if(null!==n&&n!==po._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===po._breakObj)break;if(n===po._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===po._breakObj)break}else if(null!==n)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===po._breakObj)break;if(n!==po._continueObj&&null!==n)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),i=e.type;if(n instanceof Os){const e=no(n.value,n.typeInfo.name,i.name);return new Os(e,this.getTypeInfo(i))}if(n instanceof Fs){const e=n.typeInfo.getTypeName();let t="";if(e.endsWith("f"))t="f32";else if(e.endsWith("i"))t="i32";else if(e.endsWith("u"))t="u32";else if(e.endsWith("b"))t="bool";else{if(!e.endsWith("h"))return null;t="f16"}const r=i.getTypeName();let s="";if(r.endsWith("f"))s="f32";else if(r.endsWith("i"))s="i32";else if(r.endsWith("u"))s="u32";else if(r.endsWith("b"))s="bool";else{if(!r.endsWith("h"))return null;s="f16"}const o=function(e,t,n){if(t===n)return e;const i=new Array(e.length);for(let r=0;r<e.length;r++)i[r]=no(e[r],t,n);return i}(Array.from(n.data),t,s);return new Fs(o,this.getTypeInfo(i))}return null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof ps){if(null===e.type)return Bs.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}e instanceof ps?e.type.name:e.name;const i=e instanceof ps?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(null===i)return null;if(0===i.size)return null;const r=new Gs(new ArrayBuffer(i.size),i,0);if(i instanceof ir){if(e.args)for(let s=0;s<e.args.length;++s){const n=i.members[s],o=e.args[s],a=this.evalExpression(o,t);r.setData(this,a,n.type,n.offset,t)}}else if(i instanceof rr){let s=0;if(e.args)for(let o=0;o<e.args.length;++o){const a=e.args[o],A=this.evalExpression(a,t);null===i.format&&("x32"===(null===(n=A.typeInfo)||void 0===n?void 0:n.name)?i.format=this.getTypeInfo("i32"):i.format=A.typeInfo),r.setData(this,A,i.format,s,t),s+=i.stride}}return e instanceof ps?r.getSubData(this,e.postfix,t):r}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),i=n.name;return"x32"===i||"u32"===i||"f32"===i||"f16"===i||"i32"===i||"bool"===i?new Os(e.scalarValue,n):"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i?this._callConstructorVec(e,t):"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return null===n?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const i=po._priority.get(t.name);po._priority.get(e[n].name)<i&&(t=e[n])}return"x32"===t.name?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if("&"===e.operator)return new Ds(n);if("*"===e.operator)return n instanceof Ds?n.reference.getSubData(this,e.postfix,t):null;const i=n instanceof Os?n.value:n instanceof Fs?Array.from(n.data):null;switch(e.operator){case"+":{if(Xs(i)){const e=i.map((e,t)=>+e);return new Fs(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Os(+e,t)}case"-":{if(Xs(i)){const e=i.map((e,t)=>-e);return new Fs(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Os(-e,t)}case"!":{if(Xs(i)){const e=i.map((e,t)=>e?0:1);return new Fs(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Os(e?0:1,t)}case"~":{if(Xs(i)){const e=i.map((e,t)=>~e);return new Fs(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Os(~e,t)}}return null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),r=n instanceof Os?n.value:n instanceof Fs||n instanceof Us?Array.from(n.data):null,s=i instanceof Os?i.value:i instanceof Fs||i instanceof Us?Array.from(i.data):null;switch(e.operator){case"+":{if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e+t[n]);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t+e);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e+t);return new Fs(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Os(e+t,o)}case"-":{if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e-t[n]);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t-e);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e-t);return new Fs(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Os(e-t,o)}case"*":{if(Xs(r)&&Xs(s)){const e=r,t=s;if(n instanceof Us&&i instanceof Us){const r=function(e,t,n,i){if(void 0===fo[t.name]||void 0===fo[i.name])return null;const r=fo[t.name][0],s=fo[t.name][1],o=fo[i.name][0];if(r!==fo[i.name][1])return null;const a=new Array(o*s);for(let A=0;A<s;A++)for(let t=0;t<o;t++){let i=0;for(let o=0;o<r;o++)i+=e[o*s+A]*n[t*r+o];a[A*o+t]=i}return a}(e,n.typeInfo,t,i.typeInfo);if(null===r)return null;const s=fo[i.typeInfo.name][0],o=fo[n.typeInfo.name][1],a=this.getTypeInfo(`mat${s}x${o}f`);return new Us(r,a)}if(n instanceof Us&&i instanceof Fs){const r=function(e,t,n,i){if(void 0===fo[t.name]||void 0===ho[i.name])return null;const r=fo[t.name][0],s=fo[t.name][1];if(r!==n.length)return null;const o=new Array(s);for(let a=0;a<s;a++){let t=0;for(let i=0;i<r;i++)t+=e[i*s+a]*n[i];o[a]=t}return o}(e,n.typeInfo,t,i.typeInfo);return null===r?null:new Fs(r,i.typeInfo)}if(n instanceof Fs&&i instanceof Us){const r=function(e,t,n,i){if(void 0===ho[t.name]||void 0===fo[i.name])return null;const r=fo[i.name][0],s=fo[i.name][1];if(s!==e.length)return null;const o=[];for(let a=0;a<r;a++){let t=0;for(let i=0;i<s;i++)t+=e[i]*n[i*r+a];o[a]=t}return o}(e,n.typeInfo,t,i.typeInfo);return null===r?null:new Fs(r,n.typeInfo)}{if(e.length!==t.length)return null;const i=e.map((e,n)=>e*t[n]);return new Fs(i,n.typeInfo)}}if(Xs(r)){const e=s,t=r.map((t,n)=>t*e);return n instanceof Us?new Us(t,n.typeInfo):new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e*t);return i instanceof Us?new Us(t,i.typeInfo):new Fs(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Os(e*t,o)}case"%":{if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e%t[n]);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t%e);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e%t);return new Fs(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Os(e%t,o)}case"/":{if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e/t[n]);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t/e);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e/t);return new Fs(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Os(e/t,o)}case"&":{if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e&t[n]);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t&e);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e&t);return new Fs(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Os(e&t,o)}case"|":{if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e|t[n]);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t|e);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e|t);return new Fs(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Os(e|t,o)}case"^":{if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e^t[n]);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t^e);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e^t);return new Fs(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Os(e^t,o)}case"<<":{if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e<<t[n]);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t<<e);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e<<t);return new Fs(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Os(e<<t,o)}case">>":{if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e>>t[n]);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t>>e);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e>>t);return new Fs(t,i.typeInfo)}const e=r,t=s,o=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Os(e>>t,o)}case">":if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e>t[n]?1:0);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t>e?1:0);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e>t?1:0);return new Fs(t,i.typeInfo)}return new Os(r>s?1:0,this.getTypeInfo("bool"));case"<":if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e<t[n]?1:0);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t<e?1:0);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e<t?1:0);return new Fs(t,i.typeInfo)}return new Os(r<s?1:0,this.getTypeInfo("bool"));case"==":if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e===t[n]?1:0);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t==e?1:0);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e==t?1:0);return new Fs(t,i.typeInfo)}return new Os(r===s?1:0,this.getTypeInfo("bool"));case"!=":if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e!==t[n]?1:0);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t!==e?1:0);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e!==t?1:0);return new Fs(t,i.typeInfo)}return new Os(r!==s?1:0,this.getTypeInfo("bool"));case">=":if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e>=t[n]?1:0);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t>=e?1:0);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e>=t?1:0);return new Fs(t,i.typeInfo)}return new Os(r>=s?1:0,this.getTypeInfo("bool"));case"<=":if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e<=t[n]?1:0);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t<=e?1:0);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e<=t?1:0);return new Fs(t,i.typeInfo)}return new Os(r<=s?1:0,this.getTypeInfo("bool"));case"&&":if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e&&t[n]?1:0);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t&&e?1:0);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e&&t?1:0);return new Fs(t,i.typeInfo)}return new Os(r&&s?1:0,this.getTypeInfo("bool"));case"||":if(Xs(r)&&Xs(s)){const e=r,t=s;if(e.length!==t.length)return null;const i=e.map((e,n)=>e||t[n]?1:0);return new Fs(i,n.typeInfo)}if(Xs(r)){const e=s,t=r.map((t,n)=>t||e?1:0);return new Fs(t,n.typeInfo)}if(Xs(s)){const e=r,t=s.map((t,n)=>e||t?1:0);return new Fs(t,i.typeInfo)}return new Os(r||s?1:0,this.getTypeInfo("bool"))}return null}_evalCall(e,t){if(null!==e.cachedReturnValue)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):null;for(let r=0;r<i.node.args.length;++r){const t=i.node.args[r],s=this.evalExpression(e.args[r],n);n.createVariable(t.name,s,t)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const i=t.clone();for(let t=0;t<n.node.args.length;++t){const r=n.node.args[t],s=this.evalExpression(e.args[t],i);i.setVariable(r.name,s,r)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||0===e.args.length)return new Os(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),r=ho[i];if(void 0===r)return null;const s=[];if(e instanceof vs)if(e.isVector){const t=e.vectorValue;for(const e of t)s.push(e)}else s.push(e.scalarValue);else if(e.args)for(const o of e.args){const e=this.evalExpression(o,t);if(e instanceof Fs){const t=e.data;for(let e=0;e<t.length;++e){let n=t[e];s.push(n)}}else if(e instanceof Os){let t=e.value;s.push(t)}}if(e.type instanceof ls&&null===e.type.format&&(e.type.format=ls.f32),0===s.length){const i=new Array(r).fill(0);return new Fs(i,n).getSubData(this,e.postfix,t)}if(1===s.length)for(;s.length<r;)s.push(s[0]);return s.length<r?null:new Fs(s.length>r?s.slice(0,r):s,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),r=fo[i];if(void 0===r)return null;const s=[];if(e instanceof vs)if(e.isVector){const t=e.vectorValue;for(const e of t)s.push(e)}else s.push(e.scalarValue);else if(e.args)for(const o of e.args){const e=this.evalExpression(o,t);e instanceof Fs?s.push(...e.data):e instanceof Os?s.push(e.value):e instanceof Us&&s.push(...e.data)}if(n instanceof or&&null===n.format&&(n.format=this.getTypeInfo("f32")),0===s.length){const i=new Array(r[2]).fill(0);return new Us(i,n).getSubData(this,e.postfix,t)}return s.length!==r[2]?null:new Us(s,n).getSubData(this,e.postfix,t)}}po._breakObj=new Ls(new tr("BREAK",null),null),po._continueObj=new Ls(new tr("CONTINUE",null),null),po._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class go{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class mo{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new go,this._exec=new po,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}if(this._deferArrayCountEval.length>0){for(const e of this._deferArrayCountEval){const t=e.arrayType,i=e.countNode;if(i instanceof ms){const e=i.name,r=this._context.constants.get(e);if(r)try{const e=r.constEvaluate(this._exec);t.count=e}catch(n){}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of t)i.search(e=>{e instanceof Ms||e instanceof cs?e.type=this._forwardType(e.type):e instanceof us?e.format=this._forwardType(e.format):e instanceof Fr||e instanceof Gr||e instanceof zr?e.type=this._forwardType(e.type):e instanceof Lr?e.returnType=this._forwardType(e.returnType):e instanceof Rs&&(e.type=this._forwardType(e.type))});return t}_forwardType(e){if(e instanceof as){const t=this._getType(e.name);if(t)return t}else e instanceof cs?e.type=this._forwardType(e.type):e instanceof us&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if("string"==typeof e){const t=new Hs(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=null!=t?t:this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Ws.eof}_match(e){if(e instanceof Vs)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let i=!1;for(const t of e){if(n===t)return!0;t===Ws.tokens.name&&(i=!0)}if(i){const e=Ws.tokens.name.rule.exec(t.lexeme);if(e&&0==e.index&&e[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===Ws.tokens.name){const e=Ws.tokens.name.rule.exec(t.lexeme);return e&&0==e.index&&e[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=null!==(t=null===(e=this._peek())||void 0===e?void 0:e.line)&&void 0!==t?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Ws.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Ws.keywords.alias)){const e=this._type_alias();return this._consume(Ws.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Ws.keywords.diagnostic)){const e=this._diagnostic();return this._consume(Ws.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Ws.keywords.requires)){const e=this._requires_directive();return this._consume(Ws.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Ws.keywords.enable)){const e=this._enable_directive();return this._consume(Ws.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const e=this._attribute();if(this._check(Ws.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(Ws.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ws.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(Ws.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ws.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(Ws.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ws.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(Ws.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ws.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(Ws.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(Ws.keywords.fn))return null;const e=this._currentLine,t=this._consume(Ws.tokens.ident,"Expected function name.").toString();this._consume(Ws.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Ws.tokens.paren_right))do{if(this._check(Ws.tokens.paren_right))break;const e=this._attribute(),t=this._consume(Ws.tokens.name,"Expected argument name.").toString();this._consume(Ws.tokens.colon,"Expected ':' for argument type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i,n.push(this._updateNode(new Rs(t,r,e))))}while(this._match(Ws.tokens.comma));this._consume(Ws.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(Ws.tokens.arrow)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}const r=this._compound_statement(),s=this._currentLine;return this._updateNode(new Lr(t,n,i,r,e,s),e)}_compound_statement(){const e=[];for(this._consume(Ws.tokens.brace_left,"Expected '{' for block.");!this._check(Ws.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(Ws.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Ws.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Ws.tokens.attr)&&this._attribute(),this._check(Ws.keywords.if))return this._if_statement();if(this._check(Ws.keywords.switch))return this._switch_statement();if(this._check(Ws.keywords.loop))return this._loop_statement();if(this._check(Ws.keywords.for))return this._for_statement();if(this._check(Ws.keywords.while))return this._while_statement();if(this._check(Ws.keywords.continuing))return this._continuing_statement();if(this._check(Ws.keywords.static_assert))return this._static_assert_statement();if(this._check(Ws.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Ws.keywords.return))e=this._return_statement();else if(this._check([Ws.keywords.var,Ws.keywords.let,Ws.keywords.const]))e=this._variable_statement();else if(this._match(Ws.keywords.discard))e=this._updateNode(new is);else if(this._match(Ws.keywords.break)){const t=this._updateNode(new rs);if(this._currentLoop.length>0){const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t,this._check(Ws.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(Ws.keywords.continue)){const t=this._updateNode(new ss);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=e&&this._consume(Ws.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Ws.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new Br(t),e)}_while_statement(){if(!this._match(Ws.keywords.while))return null;const e=this._updateNode(new Dr(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Ws.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Ws.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new Or(n,e),t)}_for_statement(){if(!this._match(Ws.keywords.for))return null;this._consume(Ws.tokens.paren_left,"Expected '('.");const e=this._updateNode(new Nr(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Ws.tokens.semicolon)?null:this._for_init(),this._consume(Ws.tokens.semicolon,"Expected ';'."),e.condition=this._check(Ws.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Ws.tokens.semicolon,"Expected ';'."),e.increment=this._check(Ws.tokens.paren_right)?null:this._for_increment(),this._consume(Ws.tokens.paren_right,"Expected ')'."),this._check(Ws.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Ws.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Ws.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Fr(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(Ws.keywords.let)){const e=this._currentLine,t=this._consume(Ws.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(Ws.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(Ws.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new Gr(t,n,null,null,i),e)}if(this._match(Ws.keywords.const)){const e=this._currentLine,t=this._consume(Ws.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(Ws.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(Ws.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return null===n&&i instanceof vs&&(n=i.type),this._updateNode(new zr(t,n,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(Ws.increment_operators))return this._current=e,null;const n=this._consume(Ws.increment_operators,"Expected increment operator");return this._updateNode(new Xr(n.type===Ws.tokens.plus_plus?Vr.increment:Vr.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(Ws.tokens.brace_right))return null;let n=this._match(Ws.tokens.underscore);if(n||(e=this._unary_expression()),!n&&null==e)return null;const i=this._consume(Ws.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return this._updateNode(new Qr(Wr.parse(i.lexeme),e,r),t)}_func_call_statement(){if(!this._check(Ws.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(Ws.tokens.ident,"Expected function name."),i=this._argument_expression_list();return null===i?(this._current=t,null):this._updateNode(new $r(n.lexeme,i),e)}_loop_statement(){if(!this._match(Ws.keywords.loop))return null;this._check(Ws.tokens.attr)&&this._attribute(),this._consume(Ws.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new Yr([],null));this._currentLoop.push(e);let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof Or){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(Ws.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Ws.keywords.switch))return null;const e=this._updateNode(new Kr(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Ws.tokens.attr)&&this._attribute(),this._consume(Ws.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),null==e.cases||0==e.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Ws.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([Ws.keywords.default,Ws.keywords.case]);){if(this._match(Ws.keywords.case)){const n=this._case_selectors();for(const e of n)if(e instanceof Ss){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(Ws.tokens.colon),this._check(Ws.tokens.attr)&&this._attribute(),this._consume(Ws.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(Ws.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Cs(n,i)))}if(this._match(Ws.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Ws.tokens.colon),this._check(Ws.tokens.attr)&&this._attribute(),this._consume(Ws.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(Ws.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Ps(n)))}}return e}_case_selectors(){const e=[];for(this._match(Ws.keywords.default)?e.push(this._updateNode(new Ss)):e.push(this._shift_expression());this._match(Ws.tokens.comma);)this._match(Ws.keywords.default)?e.push(this._updateNode(new Ss)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Ws.keywords.fallthrough))return this._consume(Ws.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(Ws.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(Ws.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(Ws.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let r=null;return this._match(Ws.keywords.else)&&(this._check(Ws.tokens.attr)&&this._attribute(),r=this._compound_statement()),this._updateNode(new Zr(t,n,i,r),e)}_match_elseif(){return this._tokens[this._current].type===Ws.keywords.else&&this._tokens[this._current+1].type===Ws.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new Is(t,n))),this._match_elseif()&&(this._check(Ws.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Ws.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new qr(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Ws.tokens.or_or);)e=this._updateNode(new xs(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Ws.tokens.and_and);)e=this._updateNode(new xs(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Ws.tokens.or);)e=this._updateNode(new xs(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Ws.tokens.xor);)e=this._updateNode(new xs(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Ws.tokens.and);)e=this._updateNode(new xs(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([Ws.tokens.equal_equal,Ws.tokens.not_equal])?this._updateNode(new xs(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Ws.tokens.less_than,Ws.tokens.greater_than,Ws.tokens.less_than_equal,Ws.tokens.greater_than_equal]);)e=this._updateNode(new xs(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Ws.tokens.shift_left,Ws.tokens.shift_right]);)e=this._updateNode(new xs(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Ws.tokens.plus,Ws.tokens.minus]);)e=this._updateNode(new xs(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Ws.tokens.star,Ws.tokens.forward_slash,Ws.tokens.modulo]);)e=this._updateNode(new xs(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Ws.tokens.minus,Ws.tokens.bang,Ws.tokens.tilde,Ws.tokens.star,Ws.tokens.and])?this._updateNode(new Es(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Ws.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Ws.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new bs(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(Ws.tokens.period)){const e=this._consume(Ws.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new fs(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(null!==t)return t;switch(e){case"void":return os.void;case"bool":return os.bool;case"i32":return os.i32;case"u32":return os.u32;case"f32":return os.f32;case"f16":return os.f16;case"vec2f":return ls.vec2f;case"vec3f":return ls.vec3f;case"vec4f":return ls.vec4f;case"vec2i":return ls.vec2i;case"vec3i":return ls.vec3i;case"vec4i":return ls.vec4i;case"vec2u":return ls.vec2u;case"vec3u":return ls.vec3u;case"vec4u":return ls.vec4u;case"vec2h":return ls.vec2h;case"vec3h":return ls.vec3h;case"vec4h":return ls.vec4h;case"mat2x2f":return ls.mat2x2f;case"mat2x3f":return ls.mat2x3f;case"mat2x4f":return ls.mat2x4f;case"mat3x2f":return ls.mat3x2f;case"mat3x3f":return ls.mat3x3f;case"mat3x4f":return ls.mat3x4f;case"mat4x2f":return ls.mat4x2f;case"mat4x3f":return ls.mat4x3f;case"mat4x4f":return ls.mat4x4f;case"mat2x2h":return ls.mat2x2h;case"mat2x3h":return ls.mat2x3h;case"mat2x4h":return ls.mat2x4h;case"mat3x2h":return ls.mat3x2h;case"mat3x3h":return ls.mat3x3h;case"mat3x4h":return ls.mat3x4h;case"mat4x2h":return ls.mat4x2h;case"mat4x3h":return ls.mat4x3h;case"mat4x4h":return ls.mat4x4h;case"mat2x2i":return ls.mat2x2i;case"mat2x3i":return ls.mat2x3i;case"mat2x4i":return ls.mat2x4i;case"mat3x2i":return ls.mat3x2i;case"mat3x3i":return ls.mat3x3i;case"mat3x4i":return ls.mat3x4i;case"mat4x2i":return ls.mat4x2i;case"mat4x3i":return ls.mat4x3i;case"mat4x4i":return ls.mat4x4i;case"mat2x2u":return ls.mat2x2u;case"mat2x3u":return ls.mat2x3u;case"mat2x4u":return ls.mat2x4u;case"mat3x2u":return ls.mat3x2u;case"mat3x3u":return ls.mat3x3u;case"mat3x4u":return ls.mat3x4u;case"mat4x2u":return ls.mat4x2u;case"mat4x3u":return ls.mat4x3u;case"mat4x4u":return ls.mat4x4u}return null}_validateTypeRange(e,t){if("i32"===t.name){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if("u32"===t.name&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Ws.tokens.ident)){const e=this._previous().toString();if(this._check(Ws.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getType(e);return null!==n?this._updateNode(new ps(n,t)):this._updateNode(new gs(e,t))}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return this._updateNode(new _s(e,t.value))}return this._updateNode(new ms(e))}if(this._match(Ws.tokens.int_literal)){const e=this._previous().toString();let t=e.endsWith("i")||e.endsWith("i")?os.i32:e.endsWith("u")||e.endsWith("U")?os.u32:os.x32;const n=parseInt(e);return this._validateTypeRange(n,t),this._updateNode(new vs(new Os(n,this._exec.getTypeInfo(t)),t))}if(this._match(Ws.tokens.uint_literal)){const e=parseInt(this._previous().toString());return this._validateTypeRange(e,os.u32),this._updateNode(new vs(new Os(e,this._exec.getTypeInfo(os.u32)),os.u32))}if(this._match([Ws.tokens.decimal_float_literal,Ws.tokens.hex_float_literal])){let e=this._previous().toString(),t=e.endsWith("h");t&&(e=e.substring(0,e.length-1));const n=parseFloat(e);this._validateTypeRange(n,t?os.f16:os.f32);const i=t?os.f16:os.f32;return this._updateNode(new vs(new Os(n,this._exec.getTypeInfo(i)),i))}if(this._match([Ws.keywords.true,Ws.keywords.false])){let e=this._previous().toString()===Ws.keywords.true.rule;return this._updateNode(new vs(new Os(e?1:0,this._exec.getTypeInfo(os.bool)),os.bool))}if(this._check(Ws.tokens.paren_left))return this._paren_expression();if(this._match(Ws.keywords.bitcast)){this._consume(Ws.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(Ws.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return this._updateNode(new ys(e,t))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new ps(e,t))}_argument_expression_list(){if(!this._match(Ws.tokens.paren_left))return null;const e=[];do{if(this._check(Ws.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Ws.tokens.comma));return this._consume(Ws.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Ws.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Ws.tokens.paren_right),e}_paren_expression(){this._consume(Ws.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Ws.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Ws.keywords.struct))return null;const e=this._currentLine,t=this._consume(Ws.tokens.ident,"Expected name for struct.").toString();this._consume(Ws.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Ws.tokens.brace_right);){const e=this._attribute(),t=this._consume(Ws.tokens.name,"Expected variable name.").toString();this._consume(Ws.tokens.colon,"Expected ':' for struct member type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i),this._check(Ws.tokens.brace_right)?this._match(Ws.tokens.comma):this._consume(Ws.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new Ms(t,r,e)))}this._consume(Ws.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,r=this._updateNode(new As(t,n,e,i),e);return this._context.structs.set(t,r),r}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(Ws.tokens.equal)){const t=this._const_expression();e.value=t}if(null!==e.type&&e.value instanceof vs){if("x32"!==e.value.type.name&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else null===e.type&&e.value instanceof vs&&(e.type="x32"===e.value.type.name?os.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Ws.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Ws.keywords.const))return null;const t=this._consume(Ws.tokens.name,"Expected variable name"),n=this._currentLine;let i=null;if(this._match(Ws.tokens.colon)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}let r=null;this._consume(Ws.tokens.equal,"const declarations require an assignment");const s=this._short_circuit_or_expression();try{let e=[os.f32],n=s.constEvaluate(this._exec,e);n instanceof Os&&this._validateTypeRange(n.value,e[0]),e[0]instanceof ls&&null===e[0].format&&n.typeInfo instanceof or&&null!==n.typeInfo.format&&("f16"===n.typeInfo.format.name?e[0].format=os.f16:"f32"===n.typeInfo.format.name?e[0].format=os.f32:"i32"===n.typeInfo.format.name?e[0].format=os.i32:"u32"===n.typeInfo.format.name?e[0].format=os.u32:"bool"===n.typeInfo.format.name&&(e[0].format=os.bool)),r=this._updateNode(new vs(n,e[0])),this._exec.context.setVariable(t.toString(),n)}catch(a){r=s}if(null!==i&&r instanceof vs){if("x32"!==r.type.name&&i.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${i.name}. Line:${this._currentLine}`);r.type=i,r.isScalar&&this._validateTypeRange(r.scalarValue,r.type)}else null===i&&r instanceof vs&&(i=null!==(e=null==r?void 0:r.type)&&void 0!==e?e:os.f32,i===os.x32&&(i=os.i32));const o=this._updateNode(new zr(t.toString(),i,"","",r),n);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(Ws.keywords.let))return null;const e=this._currentLine,t=this._consume(Ws.tokens.name,"Expected variable name");let n=null;if(this._match(Ws.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}let i=null;if(this._match(Ws.tokens.equal)&&(i=this._const_expression()),null!==n&&i instanceof vs){if("x32"!==i.type.name&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n}else null===n&&i instanceof vs&&(n="x32"===i.type.name?os.i32:i.type);return i instanceof vs&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new Gr(t.toString(),n,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Ws.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(Ws.tokens.less_than)&&(t=this._consume(Ws.storage_class,"Expected storage_class.").toString(),this._match(Ws.tokens.comma)&&(n=this._consume(Ws.access_mode,"Expected access_mode.").toString()),this._consume(Ws.tokens.greater_than,"Expected '>'."));const i=this._consume(Ws.tokens.name,"Expected variable name");let r=null;if(this._match(Ws.tokens.colon)){const e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}return this._updateNode(new Fr(i.toString(),r,t,n,null),e)}_override_decl(){if(!this._match(Ws.keywords.override))return null;const e=this._consume(Ws.tokens.name,"Expected variable name");let t=null;if(this._match(Ws.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return this._updateNode(new Ur(e.toString(),t,null))}_diagnostic(){this._consume(Ws.tokens.paren_left,"Expected '('");const e=this._consume(Ws.tokens.ident,"Expected severity control name.");this._consume(Ws.tokens.comma,"Expected ','");let t=this._consume(Ws.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Ws.tokens.period)&&(t+=`.${this._consume(Ws.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Ws.tokens.paren_right,"Expected ')'"),this._updateNode(new ts(e.toString(),t))}_enable_directive(){const e=this._consume(Ws.tokens.ident,"identity expected.");return this._updateNode(new Jr(e.toString()))}_requires_directive(){const e=[this._consume(Ws.tokens.ident,"identity expected.").toString()];for(;this._match(Ws.tokens.comma);){const t=this._consume(Ws.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new es(e))}_type_alias(){const e=this._consume(Ws.tokens.ident,"identity expected.");this._consume(Ws.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new ns(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Ws.tokens.ident,...Ws.texel_format,Ws.keywords.bool,Ws.keywords.f32,Ws.keywords.i32,Ws.keywords.u32])){const e=this._advance().toString();if(this._context.structs.has(e))return this._context.structs.get(e);if(this._context.aliases.has(e))return this._context.aliases.get(e).type;if(!this._getType(e)){const t=this._updateNode(new as(e));return this._forwardTypeCount++,t}return this._updateNode(new os(e))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Ws.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(Ws.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(Ws.tokens.comma)&&(n=this._consume(Ws.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ws.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new ls(e,t,n))}if(this._match(Ws.keywords.ptr)){let e=this._previous().toString();this._consume(Ws.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(Ws.storage_class,"Expected storage_class for pointer");this._consume(Ws.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let i=null;return this._match(Ws.tokens.comma)&&(i=this._consume(Ws.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ws.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new cs(e,t.toString(),n,i))}const t=this._attribute();if(this._match(Ws.keywords.array)){let e=null,i=-1;const r=this._previous();let s=null;if(this._match(Ws.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";if(this._match(Ws.tokens.comma)){s=this._shift_expression();try{t=s.constEvaluate(this._exec).toString(),s=null}catch(n){t="1"}}this._consume(Ws.tokens.greater_than,"Expected '>' for array."),i=t?parseInt(t):0}const o=this._updateNode(new us(r.toString(),t,e,i));return s&&this._deferArrayCountEval.push({arrayType:o,countNode:s}),o}return null}_texture_sampler_types(){if(this._match(Ws.sampler_type))return this._updateNode(new hs(this._previous().toString(),null,null));if(this._match(Ws.depth_texture_type))return this._updateNode(new hs(this._previous().toString(),null,null));if(this._match(Ws.sampled_texture_type)||this._match(Ws.multisampled_texture_type)){const e=this._previous();this._consume(Ws.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Ws.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new hs(e.toString(),t,null))}if(this._match(Ws.storage_texture_type)){const e=this._previous();this._consume(Ws.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Ws.texel_format,"Invalid texel format.").toString();this._consume(Ws.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Ws.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Ws.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new hs(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(Ws.tokens.attr);){const t=this._consume(Ws.attribute_name,"Expected attribute name"),n=this._updateNode(new ks(t.toString(),null));if(this._match(Ws.tokens.paren_left)){if(n.value=this._consume(Ws.literal_or_ident,"Expected attribute value").toString(),this._check(Ws.tokens.comma)){this._advance();do{const e=this._consume(Ws.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(Ws.tokens.comma))}this._consume(Ws.tokens.paren_right,"Expected ')'")}e.push(n)}return 0==e.length?null:e}}class _o extends so{constructor(e){super(),e&&this.update(e)}update(e){const t=(new mo).parse(e);this.updateAST(t)}}function vo(e){var t;const n={attributes:[],bindings:[]};let i;try{i=function(e){try{return new _o(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"==typeof t&&(null==t?void 0:t.message)&&(e+=`: ${t.message} `),"object"==typeof t&&(null==t?void 0:t.token)&&(e+=t.token.line||""),new Error(e,{cause:t})}}(e)}catch(o){return bn.error(o.message)(),n}for(const a of i.uniforms){const e=[];for(const n of(null==(t=a.type)?void 0:t.members)||[])e.push({name:n.name,type:yo(n.type)});n.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:e})}for(const a of i.textures)n.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(const a of i.samplers)n.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});const r=i.entry.vertex[0],s=(null==r?void 0:r.inputs.length)||0;for(let a=0;a<s;a++){const e=r.inputs[a];if("location"===e.locationType){const t=yo(e.type);n.attributes.push({name:e.name,location:Number(e.location),type:t})}}return n}function yo(e){return(null==e?void 0:e.format)?`${e.name}<${e.format.name}>`:e.name}globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};const bo=globalThis.mathgl.config;function wo(e,{precision:t=bo.precision}={}){return e=function(e){return Math.round(e/bo.EPSILON)*bo.EPSILON}(e),`${parseFloat(e.toPrecision(t))}`}function Eo(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function xo(e,t,n){return function(e,t,n){if(Eo(e)){const i=e;n=n||function(e){return e.clone?e.clone():new Array(e.length)}(i);for(let r=0;r<n.length&&r<i.length;++r){const i="number"==typeof e?e:e[r];n[r]=t(i,r,n)}return n}return t(e)}(e,e=>Math.max(t,Math.min(n,e)))}function To(e,t,n){return Eo(e)?e.map((e,i)=>To(e,t[i],n)):n*t+(1-n)*e}function So(e,t,n){const i=bo.EPSILON;try{if(e===t)return!0;if(Eo(e)&&Eo(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!So(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"==typeof e&&"number"==typeof t&&Math.abs(e-t)<=bo.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{bo.EPSILON=i}}class Co extends Array{clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Eo(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(bo)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+wo(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!So(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(void 0===n)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const r=e[i],s="number"==typeof t?t:t[i];this[i]=r+n*(s-r)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(bo.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function Po(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function Ro(e,t,n=""){if(bo.debug&&!function(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}(e,t))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return e}function Io(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class Mo extends Co{get x(){return this[0]}set x(e){this[0]=Po(e)}get y(){return this[1]}set y(e){this[1]=Po(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return Po(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Po(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Io(e>=0&&e<this.ELEMENTS,"index is out of range"),Po(this[e])}setComponent(e,t){return Io(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const ko=1e-6;let Lo="undefined"!=typeof Float32Array?Float32Array:Array;function Bo(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function Do(e,t,n,i){const r=t[0],s=t[1];return e[0]=r+i*(n[0]-r),e[1]=s+i*(n[1]-s),e}const Oo=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e};function No(e,t,n){const i=t[0],r=t[1],s=t[2],o=n[3]*i+n[7]*r+n[11]*s||1;return e[0]=(n[0]*i+n[4]*r+n[8]*s)/o,e[1]=(n[1]*i+n[5]*r+n[9]*s)/o,e[2]=(n[2]*i+n[6]*r+n[10]*s)/o,e}function Fo(e,t,n){const i=t[0],r=t[1],s=t[2];let o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,e[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,e[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,e[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,e}!function(){const e=function(){const e=new Lo(2);return Lo!=Float32Array&&(e[0]=0,e[1]=0),e}()}();const Uo=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e};!function(){const e=function(){const e=new Lo(3);return Lo!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}()}();const Go=[0,0,0];let zo;class Vo extends Mo{static get ZERO(){return zo||(zo=new Vo(0,0,0),Object.freeze(zo)),zo}constructor(e=0,t=0,n=0){super(-0,-0,-0),1===arguments.length&&Eo(e)?this.copy(e):(bo.debug&&(Po(e),Po(t),Po(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return bo.debug&&(Po(e.x),Po(e.y),Po(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Po(e)}angle(e){return function(e,t){const n=e[0],i=e[1],r=e[2],s=t[0],o=t[1],a=t[2],A=Math.sqrt((n*n+i*i+r*r)*(s*s+o*o+a*a)),l=A&&function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}(e,t)/A;return Math.acos(Math.min(Math.max(l,-1),1))}(this,e)}cross(e){return function(e,t,n){const i=t[0],r=t[1],s=t[2],o=n[0],a=n[1],A=n[2];e[0]=r*A-s*a,e[1]=s*o-i*A,e[2]=i*a-r*o}(this,this,e),this.check()}rotateX({radians:e,origin:t=Go}){return function(e,t,n,i){const r=[],s=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Go}){return function(e,t,n,i){const r=[],s=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Go}){return function(e,t,n,i){const r=[],s=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Fo(this,this,e),this.check()}transformAsVector(e){return No(this,this,e),this.check()}transformByMatrix3(e){return function(e,t,n){const i=t[0],r=t[1],s=t[2];e[0]=i*n[0]+r*n[3]+s*n[6],e[1]=i*n[1]+r*n[4]+s*n[7],e[2]=i*n[2]+r*n[5]+s*n[8]}(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const i=t[0],r=t[1];e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e[2]=t[2]}(this,this,e),this.check()}transformByQuaternion(e){return function(e,t,n){const i=n[0],r=n[1],s=n[2],o=n[3],a=t[0],A=t[1],l=t[2];let c=r*l-s*A,u=s*a-i*l,h=i*A-r*a,d=r*h-s*u,f=s*c-i*h,p=i*u-r*c;const g=2*o;c*=g,u*=g,h*=g,d*=2,f*=2,p*=2,e[0]=a+c+d,e[1]=A+u+f,e[2]=l+h+p}(this,this,e),this.check()}}class Wo extends Co{toString(){let e="[";if(bo.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=Po(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}}function jo(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],A=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],f=t[12],p=t[13],g=t[14],m=t[15],_=n*a-i*o,v=n*A-r*o,y=n*l-s*o,b=i*A-r*a,w=i*l-s*a,E=r*l-s*A,x=c*p-u*f,T=c*g-h*f,S=c*m-d*f,C=u*g-h*p,P=u*m-d*p,R=h*m-d*g;let I=_*R-v*P+y*C+b*S-w*T+E*x;return I?(I=1/I,e[0]=(a*R-A*P+l*C)*I,e[1]=(r*P-i*R-s*C)*I,e[2]=(p*E-g*w+m*b)*I,e[3]=(h*w-u*E-d*b)*I,e[4]=(A*S-o*R-l*T)*I,e[5]=(n*R-r*S+s*T)*I,e[6]=(g*y-f*E-m*v)*I,e[7]=(c*E-h*y+d*v)*I,e[8]=(o*P-a*S+l*x)*I,e[9]=(i*S-n*P-s*x)*I,e[10]=(f*w-p*y+m*_)*I,e[11]=(u*y-c*w-d*_)*I,e[12]=(a*T-o*C-A*x)*I,e[13]=(n*C-i*T+r*x)*I,e[14]=(p*v-f*b-g*_)*I,e[15]=(c*b-u*v+h*_)*I,e):null}function Ho(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],A=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],g=t[13],m=t[14],_=t[15];let v=n[0],y=n[1],b=n[2],w=n[3];return e[0]=v*i+y*a+b*u+w*p,e[1]=v*r+y*A+b*h+w*g,e[2]=v*s+y*l+b*d+w*m,e[3]=v*o+y*c+b*f+w*_,v=n[4],y=n[5],b=n[6],w=n[7],e[4]=v*i+y*a+b*u+w*p,e[5]=v*r+y*A+b*h+w*g,e[6]=v*s+y*l+b*d+w*m,e[7]=v*o+y*c+b*f+w*_,v=n[8],y=n[9],b=n[10],w=n[11],e[8]=v*i+y*a+b*u+w*p,e[9]=v*r+y*A+b*h+w*g,e[10]=v*s+y*l+b*d+w*m,e[11]=v*o+y*c+b*f+w*_,v=n[12],y=n[13],b=n[14],w=n[15],e[12]=v*i+y*a+b*u+w*p,e[13]=v*r+y*A+b*h+w*g,e[14]=v*s+y*l+b*d+w*m,e[15]=v*o+y*c+b*f+w*_,e}function Xo(e,t,n){const i=n[0],r=n[1],s=n[2];let o,a,A,l,c,u,h,d,f,p,g,m;return t===e?(e[12]=t[0]*i+t[4]*r+t[8]*s+t[12],e[13]=t[1]*i+t[5]*r+t[9]*s+t[13],e[14]=t[2]*i+t[6]*r+t[10]*s+t[14],e[15]=t[3]*i+t[7]*r+t[11]*s+t[15]):(o=t[0],a=t[1],A=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7],f=t[8],p=t[9],g=t[10],m=t[11],e[0]=o,e[1]=a,e[2]=A,e[3]=l,e[4]=c,e[5]=u,e[6]=h,e[7]=d,e[8]=f,e[9]=p,e[10]=g,e[11]=m,e[12]=o*i+c*r+f*s+t[12],e[13]=a*i+u*r+p*s+t[13],e[14]=A*i+h*r+g*s+t[14],e[15]=l*i+d*r+m*s+t[15]),e}function Qo(e,t,n){const i=n[0],r=n[1],s=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function $o(e,t,n){const i=Math.sin(n),r=Math.cos(n),s=t[4],o=t[5],a=t[6],A=t[7],l=t[8],c=t[9],u=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+l*i,e[5]=o*r+c*i,e[6]=a*r+u*i,e[7]=A*r+h*i,e[8]=l*r-s*i,e[9]=c*r-o*i,e[10]=u*r-a*i,e[11]=h*r-A*i,e}function Yo(e,t,n){const i=Math.sin(n),r=Math.cos(n),s=t[0],o=t[1],a=t[2],A=t[3],l=t[4],c=t[5],u=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+l*i,e[1]=o*r+c*i,e[2]=a*r+u*i,e[3]=A*r+h*i,e[4]=l*r-s*i,e[5]=c*r-o*i,e[6]=u*r-a*i,e[7]=h*r-A*i,e}const Ko=function(e,t,n,i,r){const s=1/Math.tan(t/2);if(e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0){const t=1/(i-r);e[10]=(r+i)*t,e[14]=2*r*i*t}else e[10]=-1,e[14]=-2*i;return e};const Zo=function(e,t,n,i,r,s,o){const a=1/(t-n),A=1/(i-r),l=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*A,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*A,e[14]=(o+s)*l,e[15]=1,e};function qo(e,t,n){const i=t[0],r=t[1],s=t[2],o=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,e[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,e[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,e[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,e}var Jo,ea;!function(){const e=function(){const e=new Lo(4);return Lo!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}(),(ea=Jo||(Jo={}))[ea.COL0ROW0=0]="COL0ROW0",ea[ea.COL0ROW1=1]="COL0ROW1",ea[ea.COL0ROW2=2]="COL0ROW2",ea[ea.COL0ROW3=3]="COL0ROW3",ea[ea.COL1ROW0=4]="COL1ROW0",ea[ea.COL1ROW1=5]="COL1ROW1",ea[ea.COL1ROW2=6]="COL1ROW2",ea[ea.COL1ROW3=7]="COL1ROW3",ea[ea.COL2ROW0=8]="COL2ROW0",ea[ea.COL2ROW1=9]="COL2ROW1",ea[ea.COL2ROW2=10]="COL2ROW2",ea[ea.COL2ROW3=11]="COL2ROW3",ea[ea.COL3ROW0=12]="COL3ROW0",ea[ea.COL3ROW1=13]="COL3ROW1",ea[ea.COL3ROW2=14]="COL3ROW2",ea[ea.COL3ROW3=15]="COL3ROW3";const ta=45*Math.PI/180,na=1,ia=.1,ra=500,sa=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class oa extends Wo{static get IDENTITY(){return function(){Aa||(Aa=new oa,Object.freeze(Aa));return Aa}()}static get ZERO(){return function(){aa||(aa=new oa([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(aa));return aa}()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Jo}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,r,s,o,a,A,l,c,u,h,d,f,p){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=r,this[5]=s,this[6]=o,this[7]=a,this[8]=A,this[9]=l,this[10]=c,this[11]=u,this[12]=h,this[13]=d,this[14]=f,this[15]=p,this.check()}setRowMajor(e,t,n,i,r,s,o,a,A,l,c,u,h,d,f,p){return this[0]=e,this[1]=r,this[2]=A,this[3]=h,this[4]=t,this[5]=s,this[6]=l,this[7]=d,this[8]=n,this[9]=o,this[10]=c,this[11]=f,this[12]=i,this[13]=a,this[14]=u,this[15]=p,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(sa)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){const n=t[0],i=t[1],r=t[2],s=t[3],o=n+n,a=i+i,A=r+r,l=n*o,c=i*o,u=i*a,h=r*o,d=r*a,f=r*A,p=s*o,g=s*a,m=s*A;e[0]=1-u-f,e[1]=c+m,e[2]=h-g,e[3]=0,e[4]=c-m,e[5]=1-l-f,e[6]=d+p,e[7]=0,e[8]=h+g,e[9]=d-p,e[10]=1-l-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:r,near:s=ia,far:o=ra}=e;return o===1/0?function(e,t,n,i,r,s){const o=2*s/(n-t),a=2*s/(r-i),A=(n+t)/(n-t),l=(r+i)/(r-i),c=-1,u=-1,h=-2*s;e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=A,e[9]=l,e[10]=c,e[11]=u,e[12]=0,e[13]=0,e[14]=h,e[15]=0}(this,t,n,i,r,s):function(e,t,n,i,r,s,o){const a=1/(n-t),A=1/(r-i),l=1/(s-o);e[0]=2*s*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*A,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+i)*A,e[10]=(o+s)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*l,e[15]=0}(this,t,n,i,r,s,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return function(e,t,n,i){let r,s,o,a,A,l,c,u,h,d;const f=t[0],p=t[1],g=t[2],m=i[0],_=i[1],v=i[2],y=n[0],b=n[1],w=n[2];Math.abs(f-y)<ko&&Math.abs(p-b)<ko&&Math.abs(g-w)<ko?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(e):(u=f-y,h=p-b,d=g-w,r=1/Math.sqrt(u*u+h*h+d*d),u*=r,h*=r,d*=r,s=_*d-v*h,o=v*u-m*d,a=m*h-_*u,r=Math.sqrt(s*s+o*o+a*a),r?(r=1/r,s*=r,o*=r,a*=r):(s=0,o=0,a=0),A=h*a-d*o,l=d*s-u*a,c=u*o-h*s,r=Math.sqrt(A*A+l*l+c*c),r?(r=1/r,A*=r,l*=r,c*=r):(A=0,l=0,c=0),e[0]=s,e[1]=A,e[2]=u,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=a,e[9]=c,e[10]=d,e[11]=0,e[12]=-(s*f+o*p+a*g),e[13]=-(A*f+l*p+c*g),e[14]=-(u*f+h*p+d*g),e[15]=1)}(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:r,near:s=ia,far:o=ra}=e;return Zo(this,t,n,i,r,s,o),this.check()}orthographic(e){const{fovy:t=ta,aspect:n=na,focalDistance:i=1,near:r=ia,far:s=ra}=e;la(t);const o=t/2,a=i*Math.tan(o),A=a*n;return this.ortho({left:-A,right:A,bottom:-a,top:a,near:r,far:s})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:r=500}=e;return la(t),Ko(this,t,n,i,r),this.check()}determinant(){return function(e){const t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],a=e[6],A=e[7],l=e[8],c=e[9],u=e[10],h=e[11],d=e[12],f=e[13],p=e[14],g=t*o-n*s,m=t*a-i*s,_=n*a-i*o,v=l*f-c*d,y=l*p-u*d,b=c*p-u*f;return A*(t*b-n*y+i*v)-r*(s*b-o*y+a*v)+e[15]*(l*_-c*m+u*g)-h*(d*_-f*m+p*g)}(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],r=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*r,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*r,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],r=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*s,e[3]=this[4]*i,e[4]=this[5]*r,e[5]=this[6]*s,e[6]=this[8]*i,e[7]=this[9]*r,e[8]=this[10]*s,e}transpose(){return function(e,t){if(e===t){const n=t[1],i=t[2],r=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=r,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this,this),this.check()}invert(){return jo(this,this),this.check()}multiplyLeft(e){return Ho(this,e,this),this.check()}multiplyRight(e){return Ho(this,this,e),this.check()}rotateX(e){return $o(this,this,e),this.check()}rotateY(e){return function(e,t,n){const i=Math.sin(n),r=Math.cos(n),s=t[0],o=t[1],a=t[2],A=t[3],l=t[8],c=t[9],u=t[10],h=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r-l*i,e[1]=o*r-c*i,e[2]=a*r-u*i,e[3]=A*r-h*i,e[8]=s*i+l*r,e[9]=o*i+c*r,e[10]=a*i+u*r,e[11]=A*i+h*r}(this,this,e),this.check()}rotateZ(e){return Yo(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return function(e,t,n,i){let r,s,o,a,A,l,c,u,h,d,f,p,g,m,_,v,y,b,w,E,x,T,S,C,P=i[0],R=i[1],I=i[2],M=Math.sqrt(P*P+R*R+I*I);M<ko||(M=1/M,P*=M,R*=M,I*=M,s=Math.sin(n),r=Math.cos(n),o=1-r,a=t[0],A=t[1],l=t[2],c=t[3],u=t[4],h=t[5],d=t[6],f=t[7],p=t[8],g=t[9],m=t[10],_=t[11],v=P*P*o+r,y=R*P*o+I*s,b=I*P*o-R*s,w=P*R*o-I*s,E=R*R*o+r,x=I*R*o+P*s,T=P*I*o+R*s,S=R*I*o-P*s,C=I*I*o+r,e[0]=a*v+u*y+p*b,e[1]=A*v+h*y+g*b,e[2]=l*v+d*y+m*b,e[3]=c*v+f*y+_*b,e[4]=a*w+u*E+p*x,e[5]=A*w+h*E+g*x,e[6]=l*w+d*E+m*x,e[7]=c*w+f*E+_*x,e[8]=a*T+u*S+p*C,e[9]=A*T+h*S+g*C,e[10]=l*T+d*S+m*C,e[11]=c*T+f*S+_*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,this,e,t),this.check()}scale(e){return Qo(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Xo(this,this,e),this.check()}transform(e,t){return 4===e.length?(Ro(t=qo(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=function(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}(t||[-0,-0],e,this);break;case 3:i=Fo(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ro(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=function(e,t,n){const i=t[0],r=t[1],s=n[3]*i+n[7]*r||1;return e[0]=(n[0]*i+n[4]*r)/s,e[1]=(n[1]*i+n[5]*r)/s,e}(t||[-0,-0],e,this);break;case 3:n=No(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ro(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let aa,Aa;function la(e){if(e>2*Math.PI)throw Error("expected radians")}function ca(e,t=[],n=0){const i=Math.fround(e),r=e-i;return t[n]=i,t[n+1]=r,t}const ua={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n\n// All these functions are for substituting tan() function from Intel GPU only\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n\n    // 2pi range reduction\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n"},ha={name:"fp64arithmetic",vs:"\nuniform fp64arithmeticUniforms {\n  uniform float ONE;\n} fp64;\n\n/*\nAbout LUMA_FP64_CODE_ELIMINATION_WORKAROUND\n\nThe purpose of this workaround is to prevent shader compilers from\noptimizing away necessary arithmetic operations by swapping their sequences\nor transform the equation to some 'equivalent' form.\n\nThe method is to multiply an artifical variable, ONE, which will be known to\nthe compiler to be 1 only at runtime. The whole expression is then represented\nas a polynomial with respective to ONE. In the coefficients of all terms, only one a\nand one b should appear\n\nerr = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE\n*/\n\n// Divide float number to high and low floats to extend fraction bits\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * fp64.ONE - (t - a);\n  float a_lo = a * fp64.ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\n\n// Divide float number again when high float uses too many fraction bits\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\n\n// Special sum operation when a > b\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * fp64.ONE;\n  float err = b - (sum - a) * fp64.ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\n\n// General sum operation\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *\n    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:ca,fp64LowPart:function(e){return e-Math.fround(e)},fp64ifyMatrix4:function(e){const t=new Float32Array(32);for(let n=0;n<4;++n)for(let i=0;i<4;++i){const r=4*n+i;ca(e[4*i+n],t,2*r)}return t}},da={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!bool(picking.isAttribute)) {\n      // Stores the picking color so that the fragment shader can render it during picking\n      picking_vRGBcolor_Avalid.rgb = pickingColor;\n    }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n",getUniforms:function(e={},t){const n={};if(void 0===e.highlightedObjectColor);else if(null===e.highlightedObjectColor)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const t=e.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=t}if(e.highlightColor){const t=Array.from(e.highlightColor,e=>e/255);Number.isFinite(t[3])||(t[3]=1),n.highlightColor=t}void 0!==e.isActive&&(n.isActive=Boolean(e.isActive),n.isAttribute=Boolean(e.isAttribute));void 0!==e.useFloatColors&&(n.useFloatColors=Boolean(e.useFloatColors));return n}};const fa="precision highp int;\n\n// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  vec3 color;\n};\n\nstruct PointLight {\n  vec3 color;\n  vec3 position;\n  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform lightingUniforms {\n  int enabled;\n  int lightType;\n\n  int directionalLightCount;\n  int pointLightCount;\n\n  vec3 ambientColor;\n\n  vec3 lightColor0;\n  vec3 lightPosition0;\n  vec3 lightDirection0;\n  vec3 lightAttenuation0;\n\n  vec3 lightColor1;\n  vec3 lightPosition1;\n  vec3 lightDirection1;\n  vec3 lightAttenuation1;\n\n  vec3 lightColor2;\n  vec3 lightPosition2;\n  vec3 lightDirection2;\n  vec3 lightAttenuation2;\n} lighting;\n\nPointLight lighting_getPointLight(int index) {\n  switch (index) {\n    case 0:\n      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);\n    case 1:\n      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);\n    case 2:\n    default:  \n      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);\n  }\n}\n\nDirectionalLight lighting_getDirectionalLight(int index) {\n  switch (index) {\n    case 0:\n      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);\n    case 1:\n      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);\n    case 2:\n    default:   \n      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);\n  }\n} \n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n// #endif\n";var pa,ga;(ga=pa||(pa={}))[ga.POINT=0]="POINT",ga[ga.DIRECTIONAL=1]="DIRECTIONAL";const ma={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:pa.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:"// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  color: vec3<f32>,\n};\n\nstruct PointLight {\n  color: vec3<f32>,\n  position: vec3<f32>,\n  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  color: vec3<f32>,\n  direction: vec3<f32>,\n};\n\nstruct lightingUniforms {\n  enabled: i32,\n  pointLightCount: i32,\n  directionalLightCount: i32,\n\n  ambientColor: vec3<f32>,\n\n  // TODO - support multiple lights by uncommenting arrays below\n  lightType: i32,\n  lightColor: vec3<f32>,\n  lightDirection: vec3<f32>,\n  lightPosition: vec3<f32>,\n  lightAttenuation: vec3<f32>,\n\n  // AmbientLight ambientLight;\n  // PointLight pointLight[MAX_LIGHTS];\n  // DirectionalLight directionalLight[MAX_LIGHTS];\n};\n\n// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)\n@binding(1) @group(0) var<uniform> lighting : lightingUniforms;\n\nfn lighting_getPointLight(index: i32) -> PointLight {\n  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);\n}\n\nfn lighting_getDirectionalLight(index: i32) -> DirectionalLight {\n  return DirectionalLight(lighting.lightColor, lighting.lightDirection);\n} \n\nfn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n",vs:fa,fs:fa,getUniforms:function(e,t={}){if(!(e=e?{...e}:e))return{...ma.defaultUniforms};e.lights&&(e={...e,...va(e.lights),lights:void 0});const{ambientLight:n,pointLights:i,directionalLights:r}=e||{};if(!(n||i&&i.length>0||r&&r.length>0))return{...ma.defaultUniforms,enabled:0};const s={...ma.defaultUniforms,...t,..._a({ambientLight:n,pointLights:i,directionalLights:r})};void 0!==e.enabled&&(s.enabled=e.enabled?1:0);return s}};function _a({ambientLight:e,pointLights:t=[],directionalLights:n=[]}){const i={};i.ambientColor=ya(e);let r=0;for(const s of t){i.lightType=pa.POINT;const e=r;i[`lightColor${e}`]=ya(s),i[`lightPosition${e}`]=s.position,i[`lightAttenuation${e}`]=s.attenuation||[1,0,0],r++}for(const s of n){i.lightType=pa.DIRECTIONAL;const e=r;i[`lightColor${e}`]=ya(s),i[`lightDirection${e}`]=s.direction,r++}return r>5&&bn.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=n.length,i.pointLightCount=t.length,i}function va(e){var t,n;const i={pointLights:[],directionalLights:[]};for(const r of e||[])switch(r.type){case"ambient":i.ambientLight=r;break;case"directional":null==(t=i.directionalLights)||t.push(r);break;case"point":null==(n=i.pointLights)||n.push(r)}return i}function ya(e={}){const{color:t=[0,0,0],intensity:n=1}=e;return t.map(e=>e*n/255)}const ba="uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n",wa="#define MAX_LIGHTS 3\n\nuniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n  vec3 halfway_direction = normalize(light_direction + view_direction);\n  float lambertian = dot(light_direction, normal_worldspace);\n  float specular = 0.0;\n  if (lambertian > 0.0) {\n    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  vec3 view_direction = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  for (int i = 0; i < lighting.pointLightCount; i++) {\n    PointLight pointLight = lighting_getPointLight(i);\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);\n  }\n\n  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);\n  for (int i = lighting.pointLightCount; i < totalLights; i++) {\n    DirectionalLight directionalLight = lighting_getDirectionalLight(i);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  return lightColor;\n}\n",Ea="struct phongMaterialUniforms {\n  ambient: f32,\n  diffuse: f32,\n  shininess: f32,\n  specularColor: vec3<f32>,\n};\n\n@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;\n\nfn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {\n  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);\n  var lambertian: f32 = dot(light_direction, normal_worldspace);\n  var specular: f32 = 0.0;\n  if (lambertian > 0.0) {\n    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, phongMaterial.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;\n}\n\nfn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {\n  var lightColor: vec3<f32> = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);\n  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    let pointLight: PointLight  = lighting_getPointLight(0);\n    let light_position_worldspace: vec3<f32> = pointLight.position;\n    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  return lightColor;\n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n}\n\nfn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{\n  var lightColor = vec3<f32>(0, 0, 0);\n  let surfaceColor = vec3<f32>(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    let view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0, default: {\n        let pointLight: PointLight = lighting_getPointLight(0);\n        let light_position_worldspace: vec3<f32> = pointLight.position;\n        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n      }\n      case 1: {\n        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n      }\n    }\n  }\n  return lightColor;\n}\n",xa={props:{},name:"gouraudMaterial",vs:wa.replace("phongMaterial","gouraudMaterial"),fs:ba.replace("phongMaterial","gouraudMaterial"),source:Ea.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[ma],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...xa.defaultUniforms,...t}}},Ta={name:"phongMaterial",dependencies:[ma],source:Ea,vs:ba,fs:wa,defines:{LIGHTING_FRAGMENT:!0},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...Ta.defaultUniforms,...t}}},Sa="uniform layerUniforms {\n  uniform float opacity;\n} layer;\n",Ca={name:"layer",vs:Sa,fs:Sa,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},Pa={name:"color",dependencies:[],source:"\n\nstruct ColorUniforms {\n  opacity: f32,\n};\n\nvar<private> color: ColorUniforms = ColorUniforms(1.0);\n// TODO (kaapp) avoiding binding index collisions to handle layer opacity \n// requires some thought.\n// @group(0) @binding(0) var<uniform> color: ColorUniforms;\n\n@must_use\nfn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {\n    return vec4(fragColor.rgb * fragColor.a, fragColor.a); \n};\n",getUniforms:e=>({}),uniformTypes:{opacity:"f32"}},Ra="#define SMOOTH_EDGE_RADIUS 0.5",Ia={name:"geometry",source:"const SMOOTH_EDGE_RADIUS: f32 = 0.5;\n\nstruct VertexGeometry {\n  position: vec4<f32>,\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  normal: vec3<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\nvar<private> geometry_: VertexGeometry = VertexGeometry(\n  vec4<f32>(0.0, 0.0, 1.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec2<f32>(0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0)\n);\n\nstruct FragmentGeometry {\n  uv: vec2<f32>,\n};\n\nvar<private> fragmentGeometry: FragmentGeometry;\n\nfn smoothedge(edge: f32, x: f32) -> f32 {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n",vs:`${Ra}\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n`,fs:`${Ra}\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n`};var Ma,ka,La,Ba,Da,Oa;(ka=Ma||(Ma={}))[ka.Start=1]="Start",ka[ka.Move=2]="Move",ka[ka.End=4]="End",ka[ka.Cancel=8]="Cancel",(Ba=La||(La={}))[Ba.None=0]="None",Ba[Ba.Left=1]="Left",Ba[Ba.Right=2]="Right",Ba[Ba.Up=4]="Up",Ba[Ba.Down=8]="Down",Ba[Ba.Horizontal=3]="Horizontal",Ba[Ba.Vertical=12]="Vertical",Ba[Ba.All=15]="All",(Oa=Da||(Da={}))[Oa.Possible=1]="Possible",Oa[Oa.Began=2]="Began",Oa[Oa.Changed=4]="Changed",Oa[Oa.Ended=8]="Ended",Oa[Oa.Recognized=8]="Recognized",Oa[Oa.Cancelled=16]="Cancelled",Oa[Oa.Failed=32]="Failed";const Na="manipulation",Fa="none",Ua="pan-x",Ga="pan-y";class za{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){"compute"===e&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return function(e){if(e.includes(Fa))return Fa;const t=e.includes(Ua),n=e.includes(Ga);return t&&n?Fa:t||n?t?Ua:Ga:e.includes(Na)?Na:"auto"}(e.join(" "))}}function Va(e){return e.trim().split(/\s+/g)}function Wa(e,t,n){if(e)for(const i of Va(t))e.addEventListener(i,n,!1)}function ja(e,t,n){if(e)for(const i of Va(t))e.removeEventListener(i,n,!1)}function Ha(e){return(e.ownerDocument||e).defaultView}function Xa(e){const t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let n=0,i=0,r=0;for(;r<t;)n+=e[r].clientX,i+=e[r].clientY,r++;return{x:Math.round(n/t),y:Math.round(i/t)}}function Qa(e){const t=[];let n=0;for(;n<e.pointers.length;)t[n]={clientX:Math.round(e.pointers[n].clientX),clientY:Math.round(e.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:t,center:Xa(t),deltaX:e.deltaX,deltaY:e.deltaY}}function $a(e,t){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}function Ya(e,t){const n=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(n*n+i*i)}function Ka(e,t){const n=t.clientX-e.clientX,i=t.clientY-e.clientY;return 180*Math.atan2(i,n)/Math.PI}function Za(e,t){return e===t?La.None:Math.abs(e)>=Math.abs(t)?e<0?La.Left:La.Right:t<0?La.Up:La.Down}function qa(e,t,n){return{x:t/e||0,y:n/e||0}}function Ja(e,t){const{session:n}=e,{pointers:i}=t,{length:r}=i;n.firstInput||(n.firstInput=Qa(t)),r>1&&!n.firstMultiple?n.firstMultiple=Qa(t):1===r&&(n.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=n,a=o?o.center:s.center,A=t.center=Xa(i);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-s.timeStamp,t.angle=function(e,t){const n=t.x-e.x,i=t.y-e.y;return 180*Math.atan2(i,n)/Math.PI}(a,A),t.distance=$a(a,A);const{deltaX:l,deltaY:c}=function(e,t){const n=t.center;let i=e.offsetDelta,r=e.prevDelta;const s=e.prevInput;return t.eventType!==Ma.Start&&(null==s?void 0:s.eventType)!==Ma.End||(r=e.prevDelta={x:(null==s?void 0:s.deltaX)||0,y:(null==s?void 0:s.deltaY)||0},i=e.offsetDelta={x:n.x,y:n.y}),{deltaX:r.x+(n.x-i.x),deltaY:r.y+(n.y-i.y)}}(n,t);t.deltaX=l,t.deltaY=c,t.offsetDirection=Za(t.deltaX,t.deltaY);const u=qa(t.deltaTime,t.deltaX,t.deltaY);var h,d;t.overallVelocityX=u.x,t.overallVelocityY=u.y,t.overallVelocity=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,t.scale=o?(h=o.pointers,Ya((d=i)[0],d[1])/Ya(h[0],h[1])):1,t.rotation=o?function(e,t){return Ka(t[1],t[0])-Ka(e[1],e[0])}(o.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length;let f=e.element;return function(e,t){let n=e;for(;n;){if(n===t)return!0;n=n.parentNode}return!1}(t.srcEvent.target,f)&&(f=t.srcEvent.target),t.target=f,function(e,t){const n=e.lastInterval||t,i=t.timeStamp-n.timeStamp;let r,s,o,a;if(t.eventType!==Ma.Cancel&&(i>25||void 0===n.velocity)){const A=t.deltaX-n.deltaX,l=t.deltaY-n.deltaY,c=qa(i,A,l);s=c.x,o=c.y,r=Math.abs(c.x)>Math.abs(c.y)?c.x:c.y,a=Za(A,l),e.lastInterval=t}else r=n.velocity,s=n.velocityX,o=n.velocityY,a=n.direction;t.velocity=r,t.velocityX=s,t.velocityY=o,t.direction=a}(n,t),t}let eA=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){!function(e,t,n){const i=n.pointers.length,r=n.changedPointers.length,s=t&Ma.Start&&i-r===0,o=t&(Ma.End|Ma.Cancel)&&i-r===0;n.isFirst=Boolean(s),n.isFinal=Boolean(o),s&&(e.session={}),n.eventType=t;const a=Ja(e,n);e.emit("hammer.input",a),e.recognize(a),e.session.prevInput=a}(this.manager,e,t)}init(){Wa(this.element,this.evEl,this.domHandler),Wa(this.target,this.evTarget,this.domHandler),Wa(Ha(this.element),this.evWin,this.domHandler)}destroy(){ja(this.element,this.evEl,this.domHandler),ja(this.target,this.evTarget,this.domHandler),ja(Ha(this.element),this.evWin,this.domHandler)}};const tA={pointerdown:Ma.Start,pointermove:Ma.Move,pointerup:Ma.End,pointercancel:Ma.Cancel,pointerout:Ma.Cancel};class nA extends eA{constructor(e){super(e),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const i=tA[e.type],r=e.pointerType,s="touch"===r;let o=t.findIndex(t=>t.pointerId===e.pointerId);i&Ma.Start&&(e.buttons||s)?o<0&&(t.push(e),o=t.length-1):i&(Ma.End|Ma.Cancel)&&(n=!0),o<0||(t[o]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:r,srcEvent:e}),n&&t.splice(o,1))}}const iA=["","webkit","Moz","MS","ms","o"];function rA(e,t){const n=t[0].toUpperCase()+t.slice(1);for(const i of iA){const r=i?i+n:t;if(r in e)return r}}const sA={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class oA{constructor(e,t){this.options={...sA,...t,cssProps:{...sA.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new nA(this),this.touchAction=new za(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?2:1}recognize(e){const{session:t}=this;if(t.stopped)return;let n;this.session.prevented&&e.srcEvent.preventDefault();const{recognizers:i}=this;let{curRecognizer:r}=t;(!r||r&&r.state&Da.Recognized)&&(r=t.curRecognizer=null);let s=0;for(;s<i.length;)n=i[s],2===t.stopped||r&&n!==r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&n.state&(Da.Began|Da.Changed|Da.Ended)&&(r=t.curRecognizer=n),s++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const t of e)this.add(t);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const t of e)this.remove(t);return this}const t="string"==typeof e?this.get(e):e;if(t){const{recognizers:e}=this,n=e.indexOf(t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const i of Va(e))n[i]=n[i]||[],n[i].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const i of Va(e))t?n[i]&&n[i].splice(n[i].indexOf(t),1):delete n[i]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let r=0;for(;r<n.length;)n[r](i),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,i]of Object.entries(this.options.cssProps)){const r=rA(t.style,n);e?(this.oldCssProps[r]=t.style[r],t.style[r]=i):t.style[r]=this.oldCssProps[r]||""}e||(this.oldCssProps={})}}}let aA=1;function AA(e){return e&Da.Cancelled?"cancel":e&Da.Ended?"end":e&Da.Changed?"move":e&Da.Began?"start":""}class lA{constructor(e){this.options=e,this.id=aA++,this.state=Da.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const t of e)this.recognizeWith(t);return this}let t;if("string"==typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const t of e)this.dropRecognizeWith(t);return this}let t;return t="string"==typeof e?this.manager.get(e):e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const t of e)this.requireFailure(t);return this}let t;if("string"==typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return-1===n.indexOf(t)&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const t of e)this.dropRequireFailure(t);return this}let t;if(t="string"==typeof e?this.manager.get(e):e,t){const e=this.requireFail.indexOf(t);e>-1&&this.requireFail.splice(e,1)}return this}hasRequireFailures(){return Boolean(this.requireFail.find(e=>e.options.enable))}canRecognizeWith(e){return Boolean(this.simultaneous[e.id])}emit(e){if(!e)return;const{state:t}=this;t<Da.Ended&&this.manager.emit(this.options.event+AA(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Da.Ended&&this.manager.emit(this.options.event+AA(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Da.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Da.Failed|Da.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable)return this.reset(),void(this.state=Da.Failed);this.state&(Da.Recognized|Da.Cancelled|Da.Failed)&&(this.state=Da.Possible),this.state=this.process(t),this.state&(Da.Began|Da.Changed|Da.Ended|Da.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class cA extends lA{attrTest(e){const t=this.options.pointers;return 0===t||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,i=t&(Da.Began|Da.Changed),r=this.attrTest(e);return i&&(n&Ma.Cancel||!r)?t|Da.Cancelled:i||r?n&Ma.End?t|Da.Ended:t&Da.Began?t|Da.Changed:Da.Began:Da.Failed}}class uA extends lA{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Na]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&Ma.Start&&0===this.count)return this.failTimeout();if(i&&r&&n){if(e.eventType!==Ma.End)return this.failTimeout();const n=!this.pTime||e.timeStamp-this.pTime<t.interval,i=!this.pCenter||$a(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,i&&n?this.count+=1:this.count=1,this._input=e;if(0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Da.Recognized,this.tryEmit(this._input)},t.interval),Da.Began):Da.Recognized}return Da.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Da.Failed},this.options.interval),Da.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Da.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const hA=["","start","move","end","cancel","up","down","left","right"];class dA extends cA{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:La.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&La.Horizontal&&t.push(Ga),e&La.Vertical&&t.push(Ua),t}getEventNames(){return hA.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let n=!0,{distance:i}=e,{direction:r}=e;const s=e.deltaX,o=e.deltaY;return r&t.direction||(t.direction&La.Horizontal?(r=0===s?La.None:s<0?La.Left:La.Right,n=s!==this.pX,i=Math.abs(e.deltaX)):(r=0===o?La.None:o<0?La.Up:La.Down,n=o!==this.pY,i=Math.abs(e.deltaY))),e.direction=r,n&&i>t.threshold&&Boolean(r&t.direction)}attrTest(e){return super.attrTest(e)&&(Boolean(this.state&Da.Began)||!(this.state&Da.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=La[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const fA=["","start","move","end","cancel","in","out"];class pA{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const gA=-1!==("undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"").indexOf("firefox"),mA=4.000244140625;class _A extends pA{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;globalThis.WheelEvent&&(gA&&e.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(t/=globalThis.devicePixelRatio),e.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%mA===0&&(t=Math.floor(t/mA)),e.shiftKey&&t&&(t*=.25),this.callback({type:"wheel",center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}const vA=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class yA extends pA{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,vA.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){vA.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t}}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const bA=["keydown","keyup"];class wA extends pA{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=e=>{const t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",bA.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){bA.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}class EA extends pA{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){"contextmenu"===e&&(this.options.enable=t)}}const xA={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function TA(e){const t=xA[e.srcEvent.type];if(!t)return null;const{buttons:n,button:i}=e.srcEvent;let r=!1,s=!1,o=!1;return 2===t?(r=Boolean(1&n),s=Boolean(4&n),o=Boolean(2&n)):(r=0===i,s=1===i,o=2===i),{leftButton:r,middleButton:s,rightButton:o}}function SA(e,t){const n=e.center;if(!n)return null;const i=t.getBoundingClientRect(),r=i.width/t.offsetWidth||1,s=i.height/t.offsetHeight||1;return{center:n,offsetCenter:{x:(n.x-i.left-t.clientLeft)/r,y:(n.y-i.top-t.clientTop)/s}}}const CA={srcElement:"root",priority:0};class PA{constructor(e,t){this.handleEvent=e=>{if(this.isEmpty())return;const t=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,i=!1,r=!1){const{handlers:s,handlersByElement:o}=this,a={...CA,...n};let A=o.get(a.srcElement);A||(A=[],o.set(a.srcElement,A));const l={type:e,handler:t,srcElement:a.srcElement,priority:a.priority};i&&(l.once=!0),r&&(l.passive=!0),s.push(l),this._active=this._active||!l.passive;let c=A.length-1;for(;c>=0&&!(A[c].priority>=l.priority);)c--;A.splice(c+1,0,l)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let r=n.length-1;r>=0;r--){const s=n[r];if(s.type===e&&s.handler===t){n.splice(r,1);const e=i.get(s.srcElement);e.splice(e.indexOf(s),1),0===e.length&&i.delete(s.srcElement)}}this._active=n.some(e=>!e.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let t=!1;const i=()=>{e.handled=!0},r=()=>{e.handled=!0,t=!0},s=[];for(let o=0;o<n.length;o++){const{type:a,handler:A,once:l}=n[o];if(A({...e,type:a,stopPropagation:i,stopImmediatePropagation:r}),l&&s.push(n[o]),t)break}for(let e=0;e<s.length;e++){const{type:t,handler:n}=s[e];this.remove(t,n)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...TA(e),...SA(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function RA(e){if("recognizer"in e)return e;let t;const n=Array.isArray(e)?[...e]:[e];if("function"==typeof n[0]){t=new(n.shift())(n.shift()||{})}else t=n.shift();return{recognizer:t,recognizeWith:"string"==typeof n[0]?[n[0]]:n[0],requireFailure:"string"==typeof n[1]?[n[1]]:n[1]}}class IA{constructor(e=null,t={}){if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,e){this.manager=new oA(e,this.options);for(const e of this.options.recognizers){const{recognizer:t,recognizeWith:n,requireFailure:i}=RA(e);this.manager.add(t),n&&t.recognizeWith(n),i&&t.requireFailure(i)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new _A(e,this._onOtherEvent,{enable:!1}),this.moveInput=new yA(e,this._onOtherEvent,{enable:!1}),this.keyInput=new wA(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new EA(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var n,i,r,s;const{manager:o}=this;if(!o)return;const a=o.get(e);a&&(a.set({enable:t}),o.touchAction.update()),null==(n=this.wheelInput)||n.enableEventType(e,t),null==(i=this.moveInput)||i.enableEventType(e,t),null==(r=this.keyInput)||r.enableEventType(e,t),null==(s=this.contextmenuInput)||s.enableEventType(e,t)}_addEventHandler(e,t,n,i,r){if("string"!=typeof e){n=t;for(const[t,s]of Object.entries(e))this._addEventHandler(t,s,n,i,r);return}const{manager:s,events:o}=this;if(!s)return;let a=o.get(e);if(!a){const t=this._getRecognizerName(e)||e;a=new PA(this,t),o.set(e,a),s&&s.on(e,a.handleEvent)}a.add(e,t,n,i,r),a.isEmpty()||this._toggleRecognizer(a.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(const[t,n]of Object.entries(e))this._removeEventHandler(t,n);return}const{events:n}=this,i=n.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:e}=i;let t=!1;for(const i of n.values())if(i.recognizerName===e&&!i.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_getRecognizerName(e){var t;return null==(t=this.manager.recognizers.find(t=>t.getEventNames().includes(e)))?void 0:t.options.event}}const MA={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(MA,"IDENTITY",{get:()=>(Mt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const kA={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},LA={common:0,meters:1,pixels:2},BA={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},DA={multipan:[dA,{threshold:10,direction:La.Vertical,pointers:2}],pinch:[class extends cA{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Fa]}getEventNames(){return fA.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||Boolean(this.state&Da.Began))}emit(e){if(1!==e.scale){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}},{},null,["multipan"]],pan:[dA,{threshold:1},["pinch"],["multipan"]],dblclick:[uA,{event:"dblclick",taps:2}],click:[uA,{event:"click"},null,["dblclick"]]};function OA(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}return!1}function NA(e){let t,n={};return i=>{for(const r in i)if(!OA(i[r],n[r])){t=e(i),n=i;break}return t}}const FA=[0,0,0,0],UA=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],GA=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],zA=[0,0,0],VA=[0,0,0],WA=NA(function({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:A,geospatialOrigin:l}=function(e,t,n){const{viewMatrixUncentered:i,projectionMatrix:r}=e;let{viewMatrix:s,viewProjectionMatrix:o}=e,a=FA,A=FA,l=e.cameraPosition;const{geospatialOrigin:c,shaderCoordinateOrigin:u,offsetMode:h}=jA(e,t,n);h&&(A=e.projectPosition(c||u),l=[l[0]-A[0],l[1]-A[1],l[2]-A[2]],A[3]=1,a=qo([],A,o),s=i||s,o=Ho([],r,s),o=Ho([],o,UA));return{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:A,cameraPosCommon:l,shaderCoordinateOrigin:u,geospatialOrigin:c}}(e,n,i),c=e.getDistanceScales(),u=[e.width*t,e.height*t],h=qo([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,d={coordinateSystem:n,projectionMode:e.projectionMode,coordinateOrigin:A,commonOrigin:o.slice(0,3),center:r,pseudoMeters:Boolean(e._pseudoMeters),viewportSize:u,devicePixelRatio:t,focalDistance:h,commonUnitsPerMeter:c.unitsPerMeter,commonUnitsPerWorldUnit:c.unitsPerMeter,commonUnitsPerWorldUnit2:zA,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:GA,cameraPosition:a};if(l){const t=e.getDistanceScales(l);switch(n){case MA.METER_OFFSETS:d.commonUnitsPerWorldUnit=t.unitsPerMeter,d.commonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case MA.LNGLAT:case MA.LNGLAT_OFFSETS:e._pseudoMeters||(d.commonUnitsPerMeter=t.unitsPerMeter),d.commonUnitsPerWorldUnit=t.unitsPerDegree,d.commonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case MA.CARTESIAN:d.commonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],d.commonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return d});function jA(e,t,n=VA){n.length<3&&(n=[n[0],n[1],0]);let i,r=n,s=!0;switch(i=t===MA.LNGLAT_OFFSETS||t===MA.METER_OFFSETS?n:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case kA.WEB_MERCATOR:t!==MA.LNGLAT&&t!==MA.CARTESIAN||(i=[0,0,0],s=!1);break;case kA.WEB_MERCATOR_AUTO_OFFSET:t===MA.LNGLAT?r=i:t===MA.CARTESIAN&&(r=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case kA.IDENTITY:r=e.position.map(Math.fround),r[2]=r[2]||0;break;case kA.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}const HA=`${`${Object.keys(MA).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${MA[e]};`).join("")}\n${Object.keys(kA).map(e=>`const PROJECTION_MODE_${e}: i32 = ${kA[e]};`).join("")}\n${Object.keys(LA).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${LA[e]};`).join("")}\n\nconst TILE_SIZE: f32 = 512.0;\nconst PI: f32 = 3.1415926536;\nconst WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);\nconst ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);\nconst EARTH_RADIUS: f32 = 6370972.0; // meters\nconst GLOBE_RADIUS: f32 = 256.0;\n\n// -----------------------------------------------------------------------------\n// Uniform block (converted from GLSL uniform block)\n// -----------------------------------------------------------------------------\nstruct ProjectUniforms {\n  wrapLongitude: i32,\n  coordinateSystem: i32,\n  commonUnitsPerMeter: vec3<f32>,\n  projectionMode: i32,\n  scale: f32,\n  commonUnitsPerWorldUnit: vec3<f32>,\n  commonUnitsPerWorldUnit2: vec3<f32>,\n  center: vec4<f32>,\n  modelMatrix: mat4x4<f32>,\n  viewProjectionMatrix: mat4x4<f32>,\n  viewportSize: vec2<f32>,\n  devicePixelRatio: f32,\n  focalDistance: f32,\n  cameraPosition: vec3<f32>,\n  coordinateOrigin: vec3<f32>,\n  commonOrigin: vec3<f32>,\n  pseudoMeters: i32,\n};\n\n@group(0) @binding(0)\nvar<uniform> project: ProjectUniforms;\n\n// -----------------------------------------------------------------------------\n// Geometry data\n// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,\n// you might supply this via vertex attributes or a uniform. Here we define a\n// uniform struct for demonstration.)\n// -----------------------------------------------------------------------------\n\n// Structure to carry additional geometry data used by deck.gl filters.\nstruct Geometry {\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  position: vec4<f32>,\n  normal: vec3<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\n// @group(0) @binding(1)\nvar<private> geometry: Geometry;\n`}\n\n// -----------------------------------------------------------------------------\n// Functions\n// -----------------------------------------------------------------------------\n\n// Returns an adjustment factor for commonUnitsPerMeter\nfn _project_size_at_latitude(lat: f32) -> f32 {\n  let y = clamp(lat, -89.9, 89.9);\n  return 1.0 / cos(radians(y));\n}\n\n// Overloaded version: scales a value in meters at a given latitude.\nfn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);\n}\n\n// Computes a non-linear scale factor based on geometry.\n// (Note: This function relies on "geometry" being provided.)\nfn project_size() -> f32 {\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n      project.pseudoMeters == 0) {\n    if (geometry.position.w == 0.0) {\n      return _project_size_at_latitude(geometry.worldPosition.y);\n    }\n    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    let y2 = y * y;\n    let y4 = y2 * y2;\n    let y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\n\n// Overloads to scale offsets (meters to world units)\nfn project_size_float(meters: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * project_size();\n}\n\nfn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {\n  return meters * project.commonUnitsPerMeter.xy * project_size();\n}\n\nfn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {\n  return meters * project.commonUnitsPerMeter * project_size();\n}\n\nfn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {\n  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\n\n// Returns a rotation matrix aligning the z‑axis with the given up vector.\nfn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {\n  let uz = normalize(up);\n  let ux = select(\n    vec3<f32>(1.0, 0.0, 0.0),\n    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),\n    abs(uz.z) == 1.0\n  );\n  let uy = cross(uz, ux);\n  return mat3x3<f32>(ux, uy, uz);\n}\n\n// Since WGSL does not support "out" parameters, we return a struct.\nstruct RotationResult {\n  needsRotation: bool,\n  transform: mat3x3<f32>,\n};\n\nfn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    return RotationResult(true, project_get_orientation_matrix(commonPosition));\n  } else {\n    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed\n  };\n}\n\n// Projects a normal vector from the current coordinate system to world space.\nfn project_normal(vector: vec3<f32>) -> vec3<f32> {\n  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);\n  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\n  let rotResult = project_needs_rotation(geometry.position.xyz);\n  if (rotResult.needsRotation) {\n    n = rotResult.transform * n;\n  }\n  return n;\n}\n\n// Applies a scale offset based on y-offset (dy)\nfn project_offset_(offset: vec4<f32>) -> vec4<f32> {\n  let dy: f32 = offset.y;\n  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\n  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\n\n// Projects lng/lat coordinates to a unit tile [0,1]\nfn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {\n  var x = lnglat.x;\n  if (project.wrapLongitude != 0) {\n    x = ((x + 180.0) % 360.0) - 180.0;\n  }\n  let y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2<f32>(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// Projects lng/lat/z coordinates for a globe projection.\nfn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {\n  let lambda = radians(lnglatz.x);\n  let phi = radians(lnglatz.y);\n  let cosPhi = cos(phi);\n  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n  return vec3<f32>(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\n\n// Projects positions (with an optional 64-bit low part) from the input\n// coordinate system to the common space.\nfn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {\n  var position_world = project.modelMatrix * position;\n\n  // Work around for a Mac+NVIDIA bug:\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_mercator_(position_world.xy),\n        _project_size_at_latitude_m(position_world.z, position_world.y),\n        position_world.w\n      );\n    }\n    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\n        return vec4<f32>(\n          project_mercator_(position_world.xy) - project.commonOrigin.xy,\n          project_size_float(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);\n  }\n\n  return project_offset_(position_world) +\n         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));\n}\n\n// Overloaded versions for different input types.\nfn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {\n  return project_position_vec4_f64(position, ZERO_64_LOW);\n}\n\nfn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nfn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nfn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\n// Transforms a common space position to clip space.\nfn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {\n  return viewProjectionMatrix * position + center;\n}\n\n// Uses the project viewProjectionMatrix and center.\nfn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {\n  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);\n}\n\n// Returns a clip space offset corresponding to a given number of screen pixels.\nfn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {\n  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\n  return offset * project.focalDistance;\n}\n\nfn project_meter_size_to_pixel(meters: f32) -> f32 {\n  return project_size_float(meters) * project.scale;\n}\n\nfn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {\n  if (unit == UNIT_METERS) {\n    return project_meter_size_to_pixel(size);\n  } else if (unit == UNIT_COMMON) {\n    return size * project.scale;\n  }\n  // UNIT_PIXELS: no scaling applied.\n  return size;\n}\n\nfn project_pixel_size_float(pixels: f32) -> f32 {\n  return pixels / project.scale;\n}\n\nfn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {\n  return pixels / project.scale;\n}\n`,XA=Object.keys(MA).map(e=>`const int COORDINATE_SYSTEM_${e} = ${MA[e]};`).join(""),QA=Object.keys(kA).map(e=>`const int PROJECTION_MODE_${e} = ${kA[e]};`).join(""),$A=Object.keys(LA).map(e=>`const int UNIT_${e.toUpperCase()} = ${LA[e]};`).join(""),YA={};const KA={name:"project",dependencies:[ua,Ia],source:HA,vs:`${XA}\n${QA}\n${$A}\nuniform projectUniforms {\nbool wrapLongitude;\nint coordinateSystem;\nvec3 commonUnitsPerMeter;\nint projectionMode;\nfloat scale;\nvec3 commonUnitsPerWorldUnit;\nvec3 commonUnitsPerWorldUnit2;\nvec4 center;\nmat4 modelMatrix;\nmat4 viewProjectionMatrix;\nvec2 viewportSize;\nfloat devicePixelRatio;\nfloat focalDistance;\nvec3 cameraPosition;\nvec3 coordinateOrigin;\nvec3 commonOrigin;\nbool pseudoMeters;\n} project;\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\nfloat y = clamp(lat, -89.9, 89.9);\nreturn 1.0 / cos(radians(y));\n}\nfloat project_size() {\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\nproject.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\nproject.pseudoMeters == false) {\nif (geometry.position.w == 0.0) {\nreturn project_size_at_latitude(geometry.worldPosition.y);\n}\nfloat y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\nfloat y2 = y * y;\nfloat y4 = y2 * y2;\nfloat y6 = y4 * y2;\nreturn 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n}\nreturn 1.0;\n}\nfloat project_size_at_latitude(float meters, float lat) {\nreturn meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\nreturn meters * project.commonUnitsPerMeter.z * project_size();\n}\nvec2 project_size(vec2 meters) {\nreturn meters * project.commonUnitsPerMeter.xy * project_size();\n}\nvec3 project_size(vec3 meters) {\nreturn meters * project.commonUnitsPerMeter * project_size();\n}\nvec4 project_size(vec4 meters) {\nreturn vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\nvec3 uz = normalize(up);\nvec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\nvec3 uy = cross(uz, ux);\nreturn mat3(ux, uy, uz);\n}\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\ntransform = project_get_orientation_matrix(commonPosition);\nreturn true;\n}\nreturn false;\n}\nvec3 project_normal(vec3 vector) {\nvec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);\nvec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\nmat3 rotation;\nif (project_needs_rotation(geometry.position.xyz, rotation)) {\nn = rotation * n;\n}\nreturn n;\n}\nvec4 project_offset_(vec4 offset) {\nfloat dy = offset.y;\nvec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\nreturn vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\nfloat x = lnglat.x;\nif (project.wrapLongitude) {\nx = mod(x + 180., 360.0) - 180.;\n}\nfloat y = clamp(lnglat.y, -89.9, 89.9);\nreturn vec2(\nradians(x) + PI,\nPI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n) * WORLD_SCALE;\n}\nvec3 project_globe_(vec3 lnglatz) {\nfloat lambda = radians(lnglatz.x);\nfloat phi = radians(lnglatz.y);\nfloat cosPhi = cos(phi);\nfloat D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\nreturn vec3(\nsin(lambda) * cosPhi,\n-cos(lambda) * cosPhi,\nsin(phi)\n) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\nvec4 position_world = project.modelMatrix * position;\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_mercator_(position_world.xy),\nproject_size_at_latitude(position_world.z, position_world.y),\nposition_world.w\n);\n}\nif (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\nposition_world.xyz += project.coordinateOrigin;\n}\n}\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_globe_(position_world.xyz),\nposition_world.w\n);\n}\n}\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nif (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\nreturn vec4(\nproject_mercator_(position_world.xy) - project.commonOrigin.xy,\nproject_size(position_world.z),\nposition_world.w\n);\n}\n}\n}\nif (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\nposition_world.xyz -= project.coordinateOrigin;\n}\nreturn project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));\n}\nvec4 project_position(vec4 position) {\nreturn project_position(position, ZERO_64_LOW);\n}\nvec3 project_position(vec3 position, vec3 position64Low) {\nvec4 projected_position = project_position(vec4(position, 1.0), position64Low);\nreturn projected_position.xyz;\n}\nvec3 project_position(vec3 position) {\nvec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\nreturn projected_position.xyz;\n}\nvec2 project_position(vec2 position) {\nvec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\nreturn projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\nreturn offset * project.focalDistance;\n}\nfloat project_size_to_pixel(float meters) {\nreturn project_size(meters) * project.scale;\n}\nfloat project_size_to_pixel(float size, int unit) {\nif (unit == UNIT_METERS) return project_size_to_pixel(size);\nif (unit == UNIT_COMMON) return size * project.scale;\nreturn size;\n}\nfloat project_pixel_size(float pixels) {\nreturn pixels / project.scale;\n}\nvec2 project_pixel_size(vec2 pixels) {\nreturn pixels / project.scale;\n}\n`,getUniforms:function(e=YA){return"viewport"in e?function({viewport:e,devicePixelRatio:t=1,modelMatrix:n=null,coordinateSystem:i=MA.DEFAULT,coordinateOrigin:r=VA,autoWrapLongitude:s=!1}){i===MA.DEFAULT&&(i=e.isGeospatial?MA.LNGLAT:MA.CARTESIAN);const o=WA({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:r});return o.wrapLongitude=s,o.modelMatrix=n||GA,o}(e):{}},uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},ZA={name:"project32",dependencies:[KA],source:"// Define a structure to hold both the clip-space position and the common position.\nstruct ProjectResult {\n  clipPosition: vec4<f32>,\n  commonPosition: vec4<f32>,\n};\n\n// This function mimics the GLSL version with the 'out' parameter by returning both values.\nfn project_position_to_clipspace_and_commonspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> ProjectResult {\n  // Compute the projected position.\n  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);\n\n  // Start with the provided offset.\n  var finalOffset: vec3<f32> = offset;\n\n  // Get whether a rotation is needed and the rotation matrix.\n  let rotationResult = project_needs_rotation(projectedPosition);\n\n  // If rotation is needed, update the offset.\n  if (rotationResult.needsRotation) {\n    finalOffset = rotationResult.transform * offset;\n  }\n\n  // Compute the common position.\n  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);\n\n  // Convert to clip-space.\n  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);\n\n  return ProjectResult(clipPosition, commonPosition);\n}\n\n// A convenience overload that returns only the clip-space position.\nfn project_position_to_clipspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> vec4<f32> {\n  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;\n}\n",vs:"vec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"};function qA(e,t){const n=qo([],t,e);var i,r,s;return i=n,r=n,s=1/n[3],i[0]=r[0]*s,i[1]=r[1]*s,i[2]=r[2]*s,i[3]=r[3]*s,n}function JA(e,t){const n=e%t;return n<0?t+n:n}function el(e,t,n){return n*t+(1-n)*e}function tl(e,t,n){return e<t?t:e>n?n:e}const nl=Math.log2||function(e){return Math.log(e)*Math.LOG2E};function il(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const rl=Math.PI,sl=rl/4,ol=rl/180,al=180/rl,Al=512,ll=4003e4,cl=85.051129,ul=1.5;function hl(e){return Math.pow(2,e)}function dl(e){return nl(e)}function fl(e){const[t,n]=e;il(Number.isFinite(t)),il(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=n*ol;return[Al*(t*ol+rl)/(2*rl),Al*(rl+Math.log(Math.tan(sl+.5*i)))/(2*rl)]}function pl(e){const[t,n]=e,i=t/Al*(2*rl)-rl,r=2*(Math.atan(Math.exp(n/Al*(2*rl)-rl))-sl);return[i*al,r*al]}function gl(e){return 12790407194604047e-21/Math.cos(e*ol)}function ml(e){const{latitude:t,longitude:n,highPrecision:i=!1}=e;il(Number.isFinite(t)&&Number.isFinite(n));const r=Al,s=Math.cos(t*ol),o=r/360,a=o/s,A=12790407194604047e-21/s,l={unitsPerMeter:[A,A,A],metersPerUnit:[1/A,1/A,1/A],unitsPerDegree:[o,a,A],degreesPerUnit:[.703125,1/a,1/A]};if(i){const e=ol*Math.tan(t*ol)/s,n=o*e/2,i=12790407194604047e-21*e,r=i/a*A;l.unitsPerDegree2=[0,n,i],l.unitsPerMeter2=[r,0,r]}return l}function _l(e,t){const[n,i,r]=e,[s,o,a]=t,{unitsPerMeter:A,unitsPerMeter2:l}=ml({longitude:n,latitude:i,highPrecision:!0}),c=fl(e);c[0]+=s*(A[0]+l[0]*o),c[1]+=o*(A[1]+l[1]*o);const u=pl(c),h=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[u[0],u[1],h]:u}function vl(e){return 2*Math.atan(.5/e)*al}function yl(e){return.5/Math.tan(.5*e*ol)}function bl(e,t){const[n,i,r=0]=e;return il(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),qA(t,[n,i,r,1])}function wl(e,t,n=0){const[i,r,s]=e;if(il(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s)){return qA(t,[i,r,s,1])}const o=qA(t,[i,r,0,1]),a=qA(t,[i,r,1,1]),A=o[2],l=a[2];return Do([],o,a,A===l?0:((n||0)-A)/(l-A))}function El(e){const{width:t,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=e,[[a,A],[l,c]]=i,u=function(e=0){if("number"==typeof e)return{top:e,bottom:e,left:e,right:e};return il(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e}(e.padding),h=fl([a,tl(c,-85.051129,cl)]),d=fl([l,tl(A,-85.051129,cl)]),f=[Math.max(Math.abs(d[0]-h[0]),r),Math.max(Math.abs(d[1]-h[1]),r)],p=[t-u.left-u.right-2*Math.abs(o[0]),n-u.top-u.bottom-2*Math.abs(o[1])];il(p[0]>0&&p[1]>0);const g=p[0]/f[0],m=p[1]/f[1],_=(u.right-u.left)/2/g,v=(u.top-u.bottom)/2/m,y=pl([(d[0]+h[0])/2+_,(d[1]+h[1])/2+v]),b=Math.min(s,nl(Math.abs(Math.min(g,m))));return il(Number.isFinite(b)),{longitude:y[0],latitude:y[1],zoom:b}}const xl=Math.PI/180;function Tl(e,t,n){const{pixelUnprojectionMatrix:i}=e,r=qA(i,[t,0,1,1]),s=qA(i,[t,e.height,1,1]),o=pl(Do([],r,s,(n*e.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2])));return o.push(n),o}const Sl=["longitude","latitude","zoom"],Cl={curve:1.414,speed:1.2};function Pl(e,t,n){const i=(n=Object.assign({},Cl,n)).curve,r=e.zoom,s=[e.longitude,e.latitude],o=hl(r),a=t.zoom,A=[t.longitude,t.latitude],l=hl(a-r),c=fl(s),u=fl(A),h=Oo([],u,c),d=Math.max(e.width,e.height),f=d/l,p=function(e){const t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}(h)*o,g=Math.max(p,.01),m=i*i,_=(f*f-d*d+m*m*g*g)/(2*d*m*g),v=(f*f-d*d-m*m*g*g)/(2*f*m*g),y=Math.log(Math.sqrt(_*_+1)-_),b=Math.log(Math.sqrt(v*v+1)-v);return{startZoom:r,startCenterXY:c,uDelta:h,w0:d,u1:p,S:(b-y)/i,rho:i,rho2:m,r0:y,r1:b}}const Rl="\nuniform shadowUniforms {\n  bool drawShadowMap;\n  bool useShadowMap;\n  vec4 color;\n  highp int lightId;\n  float lightCount;\n  mat4 viewProjectionMatrix0;\n  mat4 viewProjectionMatrix1;\n  vec4 projectCenter0;\n  vec4 projectCenter1;\n} shadow;\n",Il=`\n${Rl}\n\nconst int max_lights = 2;\n\nout vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  mat4 viewProjectionMatrices[max_lights];\n  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;\n  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;\n  vec4 projectCenters[max_lights];\n  projectCenters[0] = shadow.projectCenter0;\n  projectCenters[1] = shadow.projectCenter1;\n\n  if (shadow.drawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);\n  }\n  if (shadow.useShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow.lightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n\n`,Ml=`\n${Rl}\n\nconst int max_lights = 2;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\n\nin vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow.drawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow.useShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow.lightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow.color.a / shadow.lightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n\n`,kl=NA(function({viewport:e,center:t}){return new oa(e.viewProjectionMatrix).invert().transform(t)}),Ll=NA(function({viewport:e,shadowMatrices:t}){const n=[],i=e.pixelUnprojectionMatrix,r=e.isGeospatial?void 0:1,s=[[0,0,r],[e.width,0,r],[0,e.height,r],[e.width,e.height,r],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(e=>function(e,t){const[n,i,r]=e,s=wl([n,i,r],t);if(Number.isFinite(r))return s;return[s[0],s[1],0]}(e,i));for(const o of t){const t=o.clone().translate(new Vo(e.center).negate()),i=s.map(e=>t.transform(e)),r=(new oa).ortho({left:Math.min(...i.map(e=>e[0])),right:Math.max(...i.map(e=>e[0])),bottom:Math.min(...i.map(e=>e[1])),top:Math.max(...i.map(e=>e[1])),near:Math.min(...i.map(e=>-e[2])),far:Math.max(...i.map(e=>-e[2]))});n.push(r.multiplyRight(o))}return n}),Bl=[0,0,0,1],Dl=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];const Ol={name:"shadow",dependencies:[KA],vs:Il,fs:Ml,inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:function(e){const{shadowEnabled:t=!0,project:n}=e;if(!(t&&n&&e.shadowMatrices&&e.shadowMatrices.length))return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const i=KA.getUniforms(n),r=kl({viewport:n.viewport,center:i.center}),s=[],o=Ll({shadowMatrices:e.shadowMatrices,viewport:n.viewport}).slice();for(let A=0;A<e.shadowMatrices.length;A++){const e=o[A],t=e.clone().translate(new Vo(n.viewport.center).negate());i.coordinateSystem===MA.LNGLAT&&i.projectionMode===kA.WEB_MERCATOR?(o[A]=t,s[A]=r):(o[A]=e.clone().multiplyRight(Dl),s[A]=t.transform(r))}const a={drawShadowMap:Boolean(e.drawToShadowMap),useShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,color:e.shadowColor||Bl,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let A=0;A<o.length;A++)a[`viewProjectionMatrix${A}`]=o[A],a[`projectCenter${A}`]=s[A];for(let A=0;A<2;A++)a[`shadow_uShadowMap${A}`]=e.shadowMaps&&e.shadowMaps[A]||e.dummyShadowMap;return a},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Nl={...da,defaultUniforms:{...da.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}}},Fl=[Ia],Ul=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],Gl=[];function zl(e){const t=_n.getDefaultShaderAssembler();for(const i of Fl)t.addDefaultModule(i);t._hookFunctions.length=0;const n="glsl"===e?Ul:Gl;for(const i of n)t.addShaderHook(i);return t}const Vl=[255,255,255],Wl=1;let jl=0;class Hl{constructor(e={}){this.type="ambient";const{color:t=Vl}=e,{intensity:n=Wl}=e;this.id=e.id||"ambient-"+jl++,this.color=t,this.intensity=n}}const Xl=[255,255,255],Ql=1,$l=[0,0,-1];let Yl=0;class Kl{constructor(e={}){this.type="directional";const{color:t=Xl}=e,{intensity:n=Ql}=e,{direction:i=$l}=e,{_shadow:r=!1}=e;this.id=e.id||"directional-"+Yl++,this.color=t,this.intensity=n,this.type="directional",this.direction=new Vo(i).normalize().toArray(),this.shadow=r}getProjectedLight(e){return this}}class Zl{constructor(e,t={id:"pass"}){const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class ql extends Zl{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,r=e.clearColor??(!!i&&[0,0,0,0]),s=!!i&&1,o=!!i&&0,a=e.colorMask??15,A={viewport:[0,0,t,n]};e.colorMask&&(A.colorMask=a),e.scissorRect&&(A.scissorRect=e.scissorRect);const l=this.device.beginRenderPass({framebuffer:e.target,parameters:A,clearColor:r,clearDepth:s,clearStencil:o});try{return this._drawLayers(l,e)}finally{l.end(),this.device.submit()}}_drawLayers(e,t){const{target:n,shaderModuleProps:i,viewports:r,views:s,onViewportActive:o,clearStack:a=!0}=t;t.pass=t.pass||"unknown",a&&(this._lastRenderIndex=-1);const A=[];for(const l of r){const r=s&&s[l.id];null==o||o(l);const a=this._getDrawLayerParams(l,t),c=l.subViewports||[l];for(const s of c){const o=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:s,view:r,pass:t.pass,layers:t.layers},a);A.push(o)}}return A}_getDrawLayerParams(e,{layers:t,pass:n,isPicking:i=!1,layerFilter:r,cullRect:s,effects:o,shaderModuleProps:a},A=!1){var l;const c=[],u=Jl(this._lastRenderIndex+1),h={layer:t[0],viewport:e,isPicking:i,renderPass:n,cullRect:s},d={};for(let f=0;f<t.length;f++){const i=t[f],s=this._shouldDrawLayer(i,h,r,d),p={shouldDrawLayer:s};s&&!A&&(p.shouldDrawLayer=!0,p.layerRenderIndex=u(i,s),p.shaderModuleProps=this._getShaderModuleProps(i,o,n,a),p.layerParameters={...null==(l=i.context.deck)?void 0:l.props.parameters,...this.getLayerParameters(i,f,e)}),c[f]=p}return c}_drawLayersInViewport(e,{layers:t,shaderModuleProps:n,pass:i,target:r,viewport:s,view:o},a){const A=function(e,{shaderModuleProps:t,target:n,viewport:i}){var r;const s=(null==(r=null==t?void 0:t.project)?void 0:r.devicePixelRatio)??e.canvasContext.cssToDeviceRatio(),[,o]=e.canvasContext.getDrawingBufferSize(),a=n?n.height:o,A=i;return[A.x*s,a-(A.y+A.height)*s,A.width*s,A.height*s]}(this.device,{shaderModuleProps:n,target:r,viewport:s});if(o){const{clear:e,clearColor:t,clearDepth:n,clearStencil:i}=o.props;if(e){let e=[0,0,0,0],s=1,o=0;Array.isArray(t)?e=[...t.slice(0,3),t[3]||255].map(e=>e/255):!1===t&&(e=!1),void 0!==n&&(s=n),void 0!==i&&(o=i);this.device.beginRenderPass({framebuffer:r,parameters:{viewport:A,scissorRect:A},clearColor:e,clearDepth:s,clearStencil:o}).end()}}const l={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:A});for(let u=0;u<t.length;u++){const n=t[u],r=a[u],{shouldDrawLayer:o}=r;if(o&&n.props.pickable&&l.pickableCount++,n.isComposite&&l.compositeCount++,n.isDrawable&&r.shouldDrawLayer){const{layerRenderIndex:t,shaderModuleProps:o,layerParameters:a}=r;l.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,t),o.project&&(o.project.viewport=s),n.context.renderPass=e;try{n._drawLayer({renderPass:e,shaderModuleProps:o,uniforms:{layerIndex:t},parameters:a})}catch(c){n.raiseError(c,`drawing ${n} to ${i}`)}}}return l}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let r=e.parent;for(;r;){if(!r.props.visible||!r.filterSubLayer(t))return!1;t.layer=r,r=r.parent}if(n){const e=t.layer.id;if(e in i||(i[e]=n(t)),!i[e])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,i){var r,s;const o=this.device.canvasContext.cssToDeviceRatio(),a=(null==(r=e.internalState)?void 0:r.propsInTransition)||e.props,A={layer:a,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:a.modelMatrix,coordinateSystem:a.coordinateSystem,coordinateOrigin:a.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const l of t)ec(A,null==(s=l.getShaderModuleProps)?void 0:s.call(l,e,A));return ec(A,this.getShaderModuleProps(e,t,A),i)}}function Jl(e=0,t={}){const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,A=r.parent&&r.parent.id;let l;if(A&&!(A in t)&&i(r.parent,!1),A in n){const e=n[A]=n[A]||Jl(t[A],t);l=e(r,s),n[a]=e}else Number.isFinite(o)?(l=o+(t[A]||0),n[a]=null):l=e;return s&&l>=e&&(e=l+1),t[a]=l,l};return i}function ec(e,...t){for(const n of t)if(n)for(const t in n)e[t]?Object.assign(e[t],n[t]):e[t]=n[t];return e}class tc extends ql{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),i=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],r=i.width*n,s=i.height*n;r===t.width&&s===t.height||t.resize({width:r,height:s}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const nc={color:[255,255,255],intensity:1},ic=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],rc=[0,0,0,200/255];class sc{constructor(e={}){this.id="lighting-effect",this.shadowColor=rc,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(Ol),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++){this.shadowPasses[s].render({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:r,shaderModuleProps:{shadow:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(e=>e.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(t=>t.getProjectedLight({layer:e})),pointLights:this.pointLights.map(t=>t.getProjectedLight({layer:e}))},r=e.props.material;return{shadow:n,lighting:i,phongMaterial:r,gouraudMaterial:r}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Ol))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=(new oa).lookAt({eye:new Vo(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new tc(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;e||0!==t.length||0!==n.length||(this.ambientLight=new Hl(nc),this.directionalLights.push(new Kl(ic[0]),new Kl(ic[1])))}}const oc=new class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:n=1,type:i,padding:r=0,copy:s=!1,initialize:o=!1,maxCount:a}){const A=i||e&&e.constructor||Float32Array,l=t*n+r;if(ArrayBuffer.isView(e)){if(l<=e.length)return e;if(l*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new A(e.buffer,0,l)}let c=1/0;a&&(c=a*n+r);const u=this._allocate(A,l,o,c);return e&&s?u.set(e):o||u.fill(0,0,4),this._release(e),u}release(e){this._release(e)}_allocate(e,t,n,i){let r=Math.max(Math.ceil(t*this.opts.overAlloc),1);r>i&&(r=i);const s=this._pool,o=e.BYTES_PER_ELEMENT*r,a=s.findIndex(e=>e.byteLength>=o);if(a>=0){const t=new e(s.splice(a,1)[0],0,r);return n&&t.fill(0),t}return new e(r)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,r=t.findIndex(e=>e.byteLength>=i);r<0?t.push(n):(r>0||t.length<this.opts.poolSize)&&t.splice(r,0,n),t.length>this.opts.poolSize&&t.shift()}};const ac=new Vo;function Ac(e,t,n,i){ac.set(e,t,n);const r=ac.len();return{distance:i/r,normal:new Vo(-e/r,-t/r,-n/r)}}function lc(e){return e-Math.fround(e)}let cc;function uc(e,t){const{size:n=1,startIndex:i=0}=t,r=void 0!==t.endIndex?t.endIndex:e.length,s=(r-i)/n;cc=oc.allocate(cc,s,{type:Float32Array,size:2*n});let o=i,a=0;for(;o<r;){for(let t=0;t<n;t++){const i=e[o++];cc[a+t]=i,cc[a+t+n]=lc(i)}a+=2*n}return cc.subarray(0,s*n*2)}function hc(e){let t=null,n=!1;for(const i of e)i&&(t?(n||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],n=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}const dc=Math.PI/180,fc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],pc=[0,0,0],gc={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class mc{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||gc,this.focalDistance=e.focalDistance||1,this.position=e.position||pc,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?kA.WEB_MERCATOR:kA.WEB_MERCATOR_AUTO_OFFSET:kA.IDENTITY}equals(e){return e instanceof mc&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&So(e.projectionMatrix,this.projectionMatrix)&&So(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){const n=bl(this.projectPosition(e),this.pixelProjectionMatrix),[i,r]=n,s=t?r:this.height-r;return 2===e.length?[i,s]:[i,s,n[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,r,s]=e,o=t?r:this.height-r,a=n&&n*this.distanceScales.unitsPerMeter[2],A=wl([i,o,s],this.pixelUnprojectionMatrix,a),[l,c,u]=this.unprojectPosition(A);return Number.isFinite(s)?[l,c,u]:Number.isFinite(n)?[l,c,n]:[l,c]}projectPosition(e){const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){const t=fl(e);return t[1]=xo(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?pl(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),i=this.unproject([this.width,0],t),r=this.unproject([0,this.height],t),s=this.unproject([this.width,this.height],t);return[Math.min(n[0],i[0],r[0],s[0]),Math.min(n[1],i[1],r[1],s[1]),Math.max(n[0],i[0],r[0],s[0]),Math.max(n[1],i[1],r[1],s[1])]}getDistanceScales(e){return e&&this.isGeospatial?ml({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,{left:Ac((e=this.viewProjectionMatrix)[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:Ac(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:Ac(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:Ac(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:Ac(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:Ac(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}),this._frustumPlanes;var e}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=function(e){const{latitude:t}=e;il(Number.isFinite(t));const n=Math.cos(t*ol);return dl(ll*n)-9}({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||ml({latitude:n,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:r,modelMatrix:s}=e;let o=pc;if(r&&(o=s?new oa(s).transformAsVector(r,[]):r),this.isGeospatial){const e=this.projectPosition([t,n,0]);this.center=new Vo(o).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(o)}_initMatrices(e){const{viewMatrix:t=fc,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:r,fovy:s=75,near:o=.1,far:a=1e3,padding:A=null,focalDistance:l=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=(new oa).multiplyRight(t).translate(new Vo(this.center).negate()),this.projectionMatrix=n||function({width:e,height:t,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:o,far:a}){const A=e/t,l=n?(new oa).orthographic({fovy:i,aspect:A,focalDistance:r,near:o,far:a}):(new oa).perspective({fovy:i,aspect:A,near:o,far:a});if(s){const{left:n=0,right:i=0,top:r=0,bottom:o=0}=s,a=xo((n+e-i)/2,0,e)-e/2,A=xo((r+t-o)/2,0,t)-t/2;l[8]-=2*a/e,l[9]+=2*A/t}return l}({width:this.width,height:this.height,orthographic:i,fovyRadians:r||s*dc,focalDistance:l,padding:A,near:o,far:a});const c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var u;Ho(c,c,this.projectionMatrix),Ho(c,c,this.viewMatrix),this.viewProjectionMatrix=c,this.viewMatrixInverse=jo([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(u=this.viewMatrixInverse)[12],u[13],u[14]];const h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Qo(h,h,[this.width/2,-this.height/2,1]),Xo(h,h,[1,-1,0]),Ho(d,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=jo([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Mt.warn("Pixel project matrix not invertible")()}}mc.displayName="Viewport";class _c extends mc{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=0,pitch:r=0,bearing:s=0,nearZMultiplier:o=.1,farZMultiplier:a=1.01,nearZ:A,farZ:l,orthographic:c=!1,projectionMatrix:u,repeat:h=!1,worldOffset:d=0,position:f,padding:p,legacyMeterSizes:g=!1}=e;let{width:m,height:_,altitude:v=1.5}=e;const y=Math.pow(2,i);let b;m=m||1,_=_||1;let w=null;if(u)v=u[5]/2,b=vl(v);else{let n;if(e.fovy?(b=e.fovy,v=yl(b)):b=vl(v),p){const{top:e=0,bottom:t=0}=p;n=[0,xo((e+_-t)/2,0,_)-_/2]}w=function(e){const{width:t,height:n,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:A=1,farZMultiplier:l=1}=e;let{fovy:c=vl(ul)}=e;void 0!==i&&(c=vl(i));const u=c*ol,h=r*ol,d=yl(c);let f=d;o&&(f+=o[2]*a/Math.cos(h)/n);const p=u*(.5+(s?s[1]:0)/n),g=Math.sin(p)*f/Math.sin(tl(Math.PI/2-h-p,.01,Math.PI-.01)),m=Math.sin(h)*g+f,_=10*f;return{fov:u,aspect:t/n,focalDistance:d,near:A,far:Math.min(m*l,_)}}({width:m,height:_,scale:y,center:f&&[0,0,f[2]*gl(t)],offset:n,pitch:r,fovy:b,nearZMultiplier:o,farZMultiplier:a}),Number.isFinite(A)&&(w.near=A),Number.isFinite(l)&&(w.far=l)}let E=function(e){const{height:t,pitch:n,bearing:i,altitude:r,scale:s,center:o}=e,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Xo(a,a,[0,0,-r]),$o(a,a,-n*ol),Yo(a,a,i*ol);const A=s/t;var l,c;return Qo(a,a,[A,A,A]),o&&Xo(a,a,((l=[])[0]=-(c=o)[0],l[1]=-c[1],l[2]=-c[2],l)),a}({height:_,pitch:r,bearing:s,scale:y,altitude:v});if(d){E=(new oa).translate([512*d,0,0]).multiplyLeft(E)}super({...e,width:m,height:_,viewMatrix:E,longitude:n,latitude:t,zoom:i,...w,fovy:b,focalDistance:v}),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=r,this.bearing=s,this.altitude=v,this.fovy=b,this.orthographic=c,this._subViewports=h?[]:null,this._pseudoMeters=g,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=t;i<=n;i++){const e=i?new _c({...this,worldOffset:i}):this;this._subViewports.push(e)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*gl(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)/gl(n)]}addMetersToLngLat(e,t){return _l(e,t)}panByPosition(e,t){const n=wl(t,this.pixelUnprojectionMatrix),i=Bo([],this.projectFlat(e),((r=[])[0]=-(s=n)[0],r[1]=-s[1],r));var r,s;const o=Bo([],this.center,i),[a,A]=this.unprojectFlat(o);return{longitude:a,latitude:A}}getBounds(e={}){const t=function(e,t=0){const{width:n,height:i,unproject:r}=e,s={targetZ:t},o=r([0,i],s),a=r([n,i],s);let A,l;return(e.fovy?.5*e.fovy*xl:Math.atan(.5/e.altitude))>(90-e.pitch)*xl-.01?(A=Tl(e,0,t),l=Tl(e,n,t)):(A=r([0,0],s),l=r([n,0],s)),[o,a,l,A]}(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:r,latitude:s,zoom:o}=El({width:n,height:i,bounds:e,...t});return new _c({width:n,height:i,longitude:r,latitude:s,zoom:o})}}_c.displayName="WebMercatorViewport";const vc=[0,0,0];function yc(e,t,n=!1){const i=t.projectPosition(e);if(n&&t instanceof _c){const[n,r,s=0]=e,o=t.getDistanceScales([n,r]);i[2]=s*o.unitsPerMeter[2]}return i}function bc(e,{viewport:t,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,A=0]=e;switch(n&&([o,a,A]=qo([],[o,a,A,1],n)),i){case MA.LNGLAT:return yc([o,a,A],t,s);case MA.LNGLAT_OFFSETS:return yc([o+r[0],a+r[1],A+(r[2]||0)],t,s);case MA.METER_OFFSETS:return yc(_l(r,[o,a,A]),t,s);default:return t.isGeospatial?[o+r[0],a+r[1],A+r[2]]:t.projectPosition([o,a,A])}}function wc(e,t){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=function(e){const{viewport:t,modelMatrix:n,coordinateOrigin:i}=e;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=e;return r===MA.DEFAULT&&(r=t.isGeospatial?MA.LNGLAT:MA.CARTESIAN),void 0===s&&(s=r),void 0===o&&(o=i),{viewport:t,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}(t),{autoOffset:A=!0}=t,{geospatialOrigin:l=vc,shaderCoordinateOrigin:c=vc,offsetMode:u=!1}=A?jA(n,i,r):{},h=bc(e,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:u});if(u){const e=n.projectPosition(l||c);Uo(h,h,e)}return h}let Ec=1,xc=1;class Tc{constructor(){i(this,"time",0),i(this,"channels",new Map),i(this,"animations",new Map),i(this,"playing",!1),i(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:r=1}=e,s=Ec++,o={time:0,delay:t,duration:n,rate:i,repeat:r};return this._setChannelTime(o,this.time),this.channels.set(s,o),s}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:e,channel:t}=i;e.setTime(this.getTime(t))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=xc++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}let Sc=0;const Cc=class e{constructor(t){if(i(this,"device",null),i(this,"canvas",null),i(this,"props"),i(this,"animationProps",null),i(this,"timeline",null),i(this,"stats"),i(this,"cpuTime"),i(this,"gpuTime"),i(this,"frameRate"),i(this,"display"),i(this,"needsRedraw","initialized"),i(this,"_initialized",!1),i(this,"_running",!1),i(this,"_animationFrameId",null),i(this,"_nextFramePromise",null),i(this,"_resolveNextFrame",null),i(this,"_cpuStartTime",0),i(this,"_error",null),this.props={...e.defaultAnimationLoopProps,...t},!(t=this.props).device)throw new Error("No device provided");this.stats=t.stats||new he({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(null==(e=this.device)?void 0:e.isLost)||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),null==(t=this.device)||t.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){var e;const t=null==(e=this.device)?void 0:e.getDefaultCanvasContext();if(!this.device||!t)throw new Error("loop");const n=null==t?void 0:t.canvas,i=t.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:t,canvas:n,useDevicePixels:i,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var e,t;if(!this.device)return{width:1,height:1,aspect:1};const[n,i]=(null==(e=this.device)?void 0:e.getDefaultCanvasContext().getDevicePixelSize())||[1,1];let r=1;const s=null==(t=this.device)?void 0:t.getDefaultCanvasContext().canvas;return s&&s.clientHeight?r=s.clientWidth/s.clientHeight:n>0&&i>0&&(r=n/i),{width:n,height:i,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}};i(Cc,"defaultAnimationLoopProps",{device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>{},stats:ri.stats.get("animation-loop-"+Sc++),autoResizeViewport:!1});let Pc=Cc;const Rc={};function Ic(e="id"){Rc[e]=Rc[e]||1;return`${e}-${Rc[e]++}`}class Mc{constructor(e){if(i(this,"id"),i(this,"userData",{}),i(this,"topology"),i(this,"bufferLayout",[]),i(this,"vertexCount"),i(this,"indices"),i(this,"attributes"),this.id=e.id||Ic("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Sn.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;null==(e=this.indices)||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function kc(e,t){if(t instanceof Mc)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:Sn.INDEX,data:n})}(e,t),{attributes:i,bufferLayout:r}=function(e,t){const n=[],i={};for(const[s,o]of Object.entries(t.attributes)){let t=s;switch(s){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(o){i[t]=e.createBuffer({data:o.value,id:`${s}-buffer`});const{value:r,size:a,normalized:A}=o;n.push({name:t,format:Ln(r,a,A)})}}const r=t._calculateVertexCount(t.attributes,t.indices);return{attributes:i,bufferLayout:n,vertexCount:r}}(e,t);return new Mc({topology:t.topology||"triangle-list",bufferLayout:r,vertexCount:t.vertexCount,indices:n,attributes:i})}const Lc=class e{constructor(e){i(this,"device"),i(this,"cachingEnabled"),i(this,"destroyPolicy"),i(this,"debug"),i(this,"_hashCounter",0),i(this,"_hashes",{}),i(this,"_renderPipelineCache",{}),i(this,"_computePipelineCache",{}),this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new e(t),t._lumaData.defaultPipelineFactory}get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}createRenderPipeline(e){var t;if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const n={...Pi.defaultProps,...e},i=this._renderPipelineCache,r=this._hashRenderPipeline(n);let s=null==(t=i[r])?void 0:t.pipeline;return s?(i[r].useCount++,this.debug&&bn.log(3,`${this}: ${i[r].pipeline} reused, count=${i[r].useCount}, (id=${e.id})`)()):(s=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:Ic("unnamed-cached")}),s.hash=r,i[r]={pipeline:s,useCount:1},this.debug&&bn.log(3,`${this}: ${s} created, count=${i[r].useCount}`)()),s}createComputePipeline(e){var t;if(!this.cachingEnabled)return this.device.createComputePipeline(e);const n={...ki.defaultProps,...e},i=this._computePipelineCache,r=this._hashComputePipeline(n);let s=null==(t=i[r])?void 0:t.pipeline;return s?(i[r].useCount++,this.debug&&bn.log(3,`${this}: ${i[r].pipeline} reused, count=${i[r].useCount}, (id=${e.id})`)()):(s=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0}),s.hash=r,i[r]={pipeline:s,useCount:1},this.debug&&bn.log(3,`${this}: ${s} created, count=${i[r].useCount}`)()),s}release(e){if(!this.cachingEnabled)return void e.destroy();const t=this._getCache(e),n=e.hash;t[n].useCount--,0===t[n].useCount?(this._destroyPipeline(e),this.debug&&bn.log(3,`${this}: ${e} released and destroyed`)()):t[n].useCount<0?(bn.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[n].useCount=0):this.debug&&bn.log(3,`${this}: ${e} released, count=${t[n].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof ki&&(t=this._computePipelineCache),e instanceof Pi&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device;return`${t}/C/${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i=this._getHash(JSON.stringify(e.bufferLayout)),{type:r}=this.device;if("webgl"===r)return`${r}/R/${t}/${n}V-BL${i}`;{const s=this._getHash(JSON.stringify(e.parameters));return`${r}/R/${t}/${n}V-T${e.topology}P${s}BL${i}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};i(Lc,"defaultProps",{...Pi.defaultProps});let Bc=Lc;const Dc=class e{constructor(e){i(this,"device"),i(this,"cachingEnabled"),i(this,"destroyPolicy"),i(this,"debug"),i(this,"_cache",{}),this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}static getDefaultShaderFactory(t){var n;return(n=t._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new e(t)),t._lumaData.defaultShaderFactory}get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let n=this._cache[t];if(n)n.useCount++,this.debug&&bn.log(3,`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:i,useCount:1},this.debug&&bn.log(3,`${this}: Created new shader ${i.id}`)()}return n.shader}release(e){if(!this.cachingEnabled)return void e.destroy();const t=this._hashShader(e),n=this._cache[t];if(n)if(n.useCount--,0===n.useCount)"unused"===this.destroyPolicy&&(delete this._cache[t],n.shader.destroy(),this.debug&&bn.log(3,`${this}: Releasing shader ${e.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&bn.log(3,`${this}: Releasing shader ${e.id} count=${n.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}};i(Dc,"defaultProps",{...Ei.defaultProps});let Oc=Dc;let Nc=null,Fc=null;function Uc(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Uc(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const s of i){if(!t.hasOwnProperty(s))return!1;if(!Uc(e[s],t[s],n-1))return!1}return!0}return!1}class Gc{constructor(e){i(this,"bufferLayouts"),this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?null==(t=e.attributes)?void 0:t.map(e=>e.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const i of t){const e=n.findIndex(e=>e.name===i.name);e<0?n.push(i):n[e]=i}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex(t=>t.name===e);return-1===t&&bn.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function zc(e){return function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)||function(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}(e)}function Vc(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(n=>{const i=e[n];var r;zc(r=i)||"number"==typeof r||"boolean"==typeof r?t.uniforms[n]=i:t.bindings[n]=i}),t}class Wc{constructor(e,t){i(this,"options",{disableWarnings:!1}),i(this,"modules"),i(this,"moduleUniforms"),i(this,"moduleBindings"),Object.assign(this.options,t);const n=qt(Object.values(e).filter(e=>e.dependencies));for(const i of n)e[i.name]=i;bn.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,r]of Object.entries(e))this._addModule(r),r.name&&i!==r.name&&!this.options.disableWarnings&&bn.warn(`Module name: ${i} vs ${r.name}`)()}destroy(){}setProps(e){var t;for(const n of Object.keys(e)){const i=n,r=e[i]||{},s=this.modules[i];if(!s){this.options.disableWarnings||bn.warn(`Module ${n} not found`)();continue}const o=this.moduleUniforms[i],a=this.moduleBindings[i],A=(null==(t=s.getUniforms)?void 0:t.call(s,r,o))||r,{uniforms:l,bindings:c}=Vc(A);this.moduleUniforms[i]={...o,...l},this.moduleBindings[i]={...a,...c}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var e;const t={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[r,s]of Object.entries(i))t[`${n}.${r}`]={type:null==(e=this.modules[n].uniformTypes)?void 0:e[r],value:String(s)};return t}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}const jc=["+X","-X","+Y","-Y","+Z","-Z"],Hc=["+X","-X","+Y","-Y","+Z","-Z"],Xc=class e{constructor(t,n){i(this,"device"),i(this,"id"),i(this,"props"),i(this,"texture"),i(this,"sampler"),i(this,"view"),i(this,"ready"),i(this,"isReady",!1),i(this,"destroyed",!1),i(this,"resolveReady",()=>{}),i(this,"rejectReady",()=>{}),this.device=t;const r=Ic("async-texture");this.props={...e.defaultProps,id:r,...n},this.id=this.props.id,"string"==typeof(null==(n={...n})?void 0:n.data)&&"2d"===n.dimension&&(n.data=async function(e,t){const n=new Image;return n.crossOrigin="anonymous",n.src=e.startsWith("http")?e:""+e,await n.decode(),t?await createImageBitmap(n,t):await createImageBitmap(n)}(n.data)),n.mipmaps&&(n.mipLevels="auto"),this.ready=new Promise((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data,n=await $c(t).then(void 0,this.rejectReady);if(this.destroyed)return;const i=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!i)throw new Error("Texture size could not be determined");const r={...i,...e,data:void 0,mipLevels:1},s=this.device.getMipLevelCount(r.width,r.height);if(r.mipLevels="auto"===this.props.mipLevels?s:Math.min(s,this.props.mipLevels),this.texture=this.device.createTexture(r),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n)}this.props.mipmaps&&this.generateMipmaps(),bn.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof fi?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=null==e?void 0:e.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e)return null;if(ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&"object"==typeof e&&e.constructor===Object){const t=Object.values(e)[0];return{width:t.width,height:t.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(e);n.length>1&&!1!==this.props.mipmaps&&bn.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<n.length;i++){const e=n[i];this.device.isExternalImage(e)?this.texture.copyExternalImage({image:e,depth:t,mipLevel:i,flipY:!0}):this.texture.copyImageData({data:e.data,mipLevel:i})}}_setTexture3DData(e,t){var n;if("3d"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeData(e,t){var n;if("cube"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(const[i,r]of Object.entries(t)){const e=Hc.indexOf(i);this._setTexture2DData(r,e)}}_setTextureArrayData(e,t){var n;if("2d-array"!==(null==(n=this.texture)?void 0:n.props.dimension))throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,n,i=0){Array.isArray(t)&&t.length>1&&!1!==this.props.mipmaps&&bn.warn(`${this.id} has mipmap and multiple LODs.`)();const r=jc.indexOf(n);this._setTexture2DData(t,r)}_normalizeTextureData(e){const t=this.texture;let n;return n=ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e],n}};i(Xc,"defaultProps",{...mi.defaultProps,data:null,mipmaps:!1});let Qc=Xc;async function $c(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map($c));if(e&&"object"==typeof e&&e.constructor===Object){const t=e,n=await Promise.all(Object.values(t)),i=Object.keys(t),r={};for(let e=0;e<i.length;e++)r[i[e]]=n[e];return r}return e}const Yc=class e{constructor(t,n){var r,s,o,a;i(this,"device"),i(this,"id"),i(this,"source"),i(this,"vs"),i(this,"fs"),i(this,"pipelineFactory"),i(this,"shaderFactory"),i(this,"userData",{}),i(this,"parameters"),i(this,"topology"),i(this,"bufferLayout"),i(this,"isInstanced"),i(this,"instanceCount",0),i(this,"vertexCount"),i(this,"indexBuffer",null),i(this,"bufferAttributes",{}),i(this,"constantAttributes",{}),i(this,"bindings",{}),i(this,"vertexArray"),i(this,"transformFeedback",null),i(this,"pipeline"),i(this,"shaderInputs"),i(this,"_uniformStore"),i(this,"_attributeInfos",{}),i(this,"_gpuGeometry",null),i(this,"props"),i(this,"_pipelineNeedsUpdate","newly created"),i(this,"_needsRedraw","initializing"),i(this,"_destroyed",!1),i(this,"_lastDrawTimestamp",-1),i(this,"_lastLogTime",0),i(this,"_logOpen",!1),i(this,"_drawCount",0),this.props={...e.defaultProps,...n},n=this.props,this.id=n.id||Ic("model"),this.device=t,Object.assign(this.userData,n.userData);const A=Object.fromEntries((null==(r=this.props.modules)?void 0:r.map(e=>[e.name,e]))||[]),l=n.shaderInputs||new Wc(A,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(l);const c=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(t),u=((null==(s=this.props.modules)?void 0:s.length)>0?this.props.modules:null==(o=this.shaderInputs)?void 0:o.getModules())||[];if("webgpu"===this.device.type&&this.props.source){const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:c,...this.props,modules:u});this.source=e,this._getModuleUniforms=t,(a=this.props).shaderLayout||(a.shaderLayout=vo(this.source))}else{const{vs:e,fs:t,getUniforms:n}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:c,...this.props,modules:u});this.vs=e,this.fs=t,this._getModuleUniforms=n}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||Bc.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||Oc.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),null==(e=this._gpuGeometry)||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return bn.info(2,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const t=this._getBindings();this.pipeline.setBindings(t,{disableWarnings:this.props.disableWarnings});const{indexBuffer:i}=this.vertexArray,r=i?i.byteLength/("uint32"===i.indexType?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:r,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var t;null==(t=this._gpuGeometry)||t.destroy();const n=e&&kc(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const e=new Gc(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Gc(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Uc(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new er(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(Zc(n)){const e=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=e}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=(null==t?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&bn.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=function(e,t){const n=Object.fromEntries(e.attributes.map(e=>[e.name,e.location])),i=t.slice();return i.sort((e,t)=>{const i=e.attributes?e.attributes.map(e=>e.attribute):[e.name],r=t.attributes?t.attributes.map(e=>e.attribute):[t.name];return Math.min(...i.map(e=>n[e]))-Math.min(...r.map(e=>n[e]))}),i}(this.pipeline.shaderLayout,this.bufferLayout);const i=new Gc(this.bufferLayout);for(const[r,s]of Object.entries(e)){const e=i.getBufferLayout(r);if(!e){n||bn.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const t=i.getAttributeNamesForBuffer(e);let o=!1;for(const n of t){const e=this._attributeInfos[n];if(e){const t="webgpu"===this.device.type?i.getBufferIndex(e.bufferName):e.location;this.vertexArray.setBuffer(t,s),o=!0}}o||n||bn.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,i]of Object.entries(e)){const e=this._attributeInfos[n];e?this.vertexArray.setConstantWebGL(e.location,i):((null==t?void 0:t.disableWarnings)??this.props.disableWarnings)||bn.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Qc&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof Qc?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof vi?e=Math.max(e,t.texture.updateTimestamp):t instanceof Sn||t instanceof mi?e=Math.max(e,t.updateTimestamp):t instanceof Qc?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof fi||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))this.pipeline.shaderLayout.attributes.find(e=>e.name===n)||"positions"===n||delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(bn.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=zi(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=bn.level>3?0:1e4;bn.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,bn.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:bn.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e){var t;const n={},i="Values";if(0===e.attributes.length&&!(null==(t=e.varyings)?void 0:t.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const r of e.attributes)r&&(n[`in ${r.location} ${r.name}: ${r.type}`]={[i]:r.stepMode||"vertex"});for(const r of e.varyings||[])n[`out ${r.location} ${r.name}`]={[i]:JSON.stringify(r)};return n}(this.pipeline.shaderLayout,this.id);bn.table(2,e)();const t=this.shaderInputs.getDebugTable();bn.table(2,t)();const n=this._getAttributeDebugTable();bn.table(2,this._attributeInfos)(),bn.table(2,n)(),bn.groupEnd(2)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&function(e,{id:t,minimap:n,opaque:i,top:r="0",left:s="0",rgbaScale:o=1}){Nc||(Nc=document.createElement("canvas"),Nc.id=t,Nc.title=t,Nc.style.zIndex="100",Nc.style.position="absolute",Nc.style.top=r,Nc.style.left=s,Nc.style.border="blue 5px solid",Nc.style.transform="scaleY(-1)",document.body.appendChild(Nc),Fc=Nc.getContext("2d")),Nc.width===e.width&&Nc.height===e.height||(Nc.width=e.width/2,Nc.height=e.height/2,Nc.style.width="400px",Nc.style.height="400px");const a=e.device.readPixelsToArrayWebGL(e),A=null==Fc?void 0:Fc.createImageData(e.width,e.height);if(A){const e=0;for(let t=0;t<a.length;t+=4)A.data[e+t+0]=a[t+0]*o,A.data[e+t+1]=a[t+1]*o,A.data[e+t+2]=a[t+2]*o,A.data[e+t+3]=i?255:a[t+3]*o;null==Fc||Fc.putImageData(A,0,0)}}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=In(t);return(e instanceof Sn?new n(e.debugData):e).toString()}};i(Yc,"defaultProps",{...Pi.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:_n.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Kc=Yc;function Zc(e){return Boolean(e.uniformTypes&&!function(e){for(const t in e)return!1;return!0}(e.uniformTypes))}const qc=class e{constructor(t,n=e.defaultProps){if(i(this,"device"),i(this,"model"),i(this,"transformFeedback"),!e.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new Kc(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||vn(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return"webgl"===(null==(t=null==e?void 0:e.info)?void 0:t.type)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){(null==e?void 0:e.inputBuffers)&&this.model.setAttributes(e.inputBuffers),(null==e?void 0:e.outputBuffers)&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Sn)return t.readAsync();const{buffer:n,byteOffset:i=0,byteLength:r=n.byteLength}=t;return n.readAsync(i,r)}};i(qc,"defaultProps",{...Kc.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Jc=qc;class eu{constructor(e,t){i(this,"device"),i(this,"model"),i(this,"sampler"),i(this,"currentIndex",0),i(this,"samplerTextureMap",null),i(this,"bindings",[]),i(this,"resources",{}),this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Kc(this.device,{id:t.id||Ic("texture-transform-model"),fs:t.fs||vn({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:"transform_output"}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){var e;this.model.destroy();for(const t of this.bindings)null==(e=t.framebuffer)||e.destroy()}delete(){this.destroy()}run(e){const{framebuffer:t}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(n),n.end(),this.device.submit()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:n,targetTexture:i}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,t),i){e.targetTexture=i;const{width:t,height:n}=i;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:t,height:n,colorAttachments:[i]}),e.framebuffer.resize({width:t,height:n})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const n in t)t[n].sampler=this.sampler}}class tu{constructor(e){i(this,"id"),i(this,"topology"),i(this,"vertexCount"),i(this,"indices"),i(this,"attributes"),i(this,"userData",{});const{attributes:t={},indices:n=null,vertexCount:r=null}=e;this.id=e.id||Ic("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[i,s]of Object.entries(t)){const e=ArrayBuffer.isView(s)?{value:s}:s;if(!ArrayBuffer.isView(e.value))throw new Error(`${this._print(i)}: must be typed array or object with value as typed array`);if("POSITION"!==i&&"positions"!==i||e.size||(e.size=3),"indices"===i){if(this.indices)throw new Error("Multiple indices detected");this.indices=e}else this.attributes[i]=e}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const i of Object.values(e)){const{value:e,size:t,constant:r}=i;!r&&e&&void 0!==t&&t>=1&&(n=Math.min(n,e.length/t))}return n}}const nu={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class iu extends ql{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:r,pickingFBO:s,deviceRect:{x:o,y:a,width:A,height:l},cullRect:c,effects:u,pass:h="picking",pickZ:d,shaderModuleProps:f}){this.pickZ=d;const p=this._resetColorEncoder(d),g=[o,a,A,l],m=super.render({target:s,layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:r,cullRect:c,effects:null==u?void 0:u.filter(e=>e.useInPicking),pass:h,isPicking:!0,shaderModuleProps:f,clearColor:[0,0,0,0],colorMask:15,scissorRect:g});this._colorEncoderState=null;return{decodePickingColor:p&&ru.bind(null,p),stats:m}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const i={...e.props.parameters},{pickable:r,operation:s}=e.props;return!this._colorEncoderState||s.includes("terrain")?i.blend=!1:r&&s.includes("draw")&&(Object.assign(i,nu),i.blend=!0,i.blendColor=function(e,t,n){const{byLayer:i,byAlpha:r}=e;let s,o=i.get(t);o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:t,viewports:[n]},i.set(t,o),r[s]=o):(Mt.warn("Too many pickable layers, only picking the first 255")(),s=0));return[0,0,0,s/255]}(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function ru(e,t){const n=e.byAlpha[t[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(t)}}const su="Awaiting state",ou="Matched. State transferred from previous layer",au="Initialized",Au="Discarded. Awaiting garbage collection",lu="No longer matched. Awaiting garbage collection",cu="Finalized! Awaiting garbage collection",uu=Symbol.for("component"),hu=Symbol.for("propTypes"),du=Symbol.for("deprecatedProps"),fu=Symbol.for("asyncPropDefaults"),pu=Symbol.for("asyncPropOriginal"),gu=Symbol.for("asyncPropResolved");function mu(e,t=()=>!0){return Array.isArray(e)?_u(e,t,[]):t(e)?[e]:[]}function _u(e,t,n){let i=-1;for(;++i<e.length;){const r=e[i];Array.isArray(r)?_u(r,t,n):t(r)&&n.push(r)}return n}function vu({target:e,source:t,start:n=0,count:i=1}){const r=t.length,s=i*r;let o=0;for(let a=n;o<r;o++)e[a++]=t[o];for(;o<s;)o<s-o?(e.copyWithin(n+o,n,n+o),o*=2):(e.copyWithin(n+o,n,n+s-o),o=s);return e}class yu{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;"string"==typeof e&&(i=ct(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=e)}).catch(e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=e||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const r of this._subscribers)r.onChange(this.getData())}}class bu{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:null==(t=e.device)?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:i=!0}){let r=this._resources[e];r?r.setData(t,n):(r=new yu(e,t,this._context),this._resources[e]=r),r.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const e in t){const n=t[e],i=this._resources[n.resourceId];i&&i.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:i="default"}){const{_resources:r,protocol:s}=this;e.startsWith(s)&&(r[e=e.replace(s,"")]||this.add({resourceId:e,data:null,persistent:!1}));const o=r[e];if(this._track(n,i,o,t),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const r=this._consumers,s=r[e]=r[e]||{};let o=s[t];const a=o&&o.resourceId&&this._resources[o.resourceId];a&&(a.unsubscribe(o),this.prune()),n&&(o?(o.onChange=i,o.resourceId=n.id):o={onChange:i,resourceId:n.id},s[t]=o,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}class wu{constructor(e,t){var n;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{Bt("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};const{deck:i,stats:r,viewport:s,timeline:o}=t||{};this.layers=[],this.resourceManager=new bu({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:null==e?void 0:e.gl,deck:i,shaderAssembler:zl((null==(n=null==e?void 0:e.info)?void 0:n.shadingLanguage)||"glsl"),defaultShaderModules:[Ca],renderPass:void 0,stats:r||new he({id:"deck.gl"}),viewport:s||new mc({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Tc,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(e=>0===t.id.indexOf(e))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Bt("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;const n=mu(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(t=>t.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(t=>t.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const s of e)n[s.id]?Mt.warn(`Multiple old layers with same id ${s.id}`)():n[s.id]=s;if(this._defaultShaderModulesChanged){for(const t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let r=!1;for(const s of i)if(s.hasUniformTransition()){r=`Uniform transition in ${s}`;break}this._needsUpdate=r,this.layers=i}_updateSublayersRecursively(e,t,n){for(const r of e){r.context=this.context;const e=t[r.id];null===e&&Mt.warn(`Multiple new layers with same id ${r.id}`)(),t[r.id]=null;let s=null;try{this._debug&&e!==r&&r.validateProps(),e?(this._transferLayerState(e,r),this._updateLayer(r)):this._initializeLayer(r),n.push(r),s=r.isComposite?r.getSubLayers():null}catch(i){this._handleError("matching",i,r)}s&&this._updateSublayersRecursively(s,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=au}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=ou,t!==e&&(e.lifecycle=Au)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=lu;try{e._finalize(),e.lifecycle=cu}catch(t){this._handleError("finalization",t,e)}}}function Eu(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Eu(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const s of i){if(!t.hasOwnProperty(s))return!1;if(!Eu(e[s],t[s],n-1))return!1}return!0}return!1}class xu{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t="string"==typeof e?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let r=n.length-1;r>=0;--r){const s=n[r];if(s.containsPixel(i)){const n=e.slice();return n[0]-=s.x,n[1]-=s.y,s.unproject(n,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=mu(e,Boolean);this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){if(e){!Eu(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e}else Mt.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const n=new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>{var n;return null==(n=this.getView(e.id))?void 0:n.makeViewport({viewState:t,width:this.width,height:this.height})}});return n}_updateController(e,t,n,i){const r=e.controller;if(r&&n){const s={...t,...r,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return i&&i.constructor===r.type||(i=this._createController(e,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const r=e[i],s=this.getViewState(r),o=r.makeViewport({viewState:s,width:this.width,height:this.height});let a=t[r.id];const A=Boolean(r.controller);A&&!a&&(n=!0),!n&&A||!a||(a.finalize(),a=null),this.controllers[r.id]=this._updateController(r,s,o,a),o&&this._viewports.unshift(o)}for(const i in t){const e=t[i];e&&!this.controllers[i]&&e.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length||e.some((n,i)=>!e[i].equals(t[i]))}}const Tu=/([0-9]+\.?[0-9]*)(%|px)/;function Su(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=Tu.exec(e);if(t&&t.length>=3){const e="%"===t[2],n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error(`Could not parse position string ${e}`)}}function Cu(e,t){return e.relative?Math.round(e.position*t):e.position}class Pu{constructor(e){const{id:t,x:n=0,y:i=0,width:r="100%",height:s="100%",padding:o=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Su(n),this._y=Su(i),this._width=Su(r),this._height=Su(s),this._padding=o&&{left:Su(o.left||0),right:Su(o.right||0),top:Su(o.top||0),bottom:Su(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.constructor===e.constructor&&Eu(this.props,e.props,2)}clone(e){return new(0,this.constructor)({...this.props,...e})}makeViewport({width:e,height:t,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:t});if(!i.height||!i.width)return null;return new(this.getViewportType(n))({...n,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return"string"==typeof e?e:(null==e?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){const n={x:Cu(this._x,e),y:Cu(this._y,t),width:Cu(this._width,e),height:Cu(this._height,t)};return this._padding&&(n.padding={left:Cu(this._padding.left,e),top:Cu(this._padding.top,t),right:Cu(this._padding.right,e),bottom:Cu(this._padding.bottom,t)}),n}get controller(){const e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}}class Ru{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,n;this.cancel(),this.settings=e,this._inProgress=!0,null==(n=(t=this.settings).onStart)||n.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,null==(t=(e=this.settings).onEnd)||t.call(e,this))}cancel(){var e,t;this._inProgress&&(null==(t=(e=this.settings).onInterrupt)||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),null==(t=(e=this.settings).onUpdate)||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Iu=()=>{},Mu=2,ku=3,Lu=e=>e,Bu=1;class Du{constructor(e){this._onTransitionUpdate=e=>{const{time:t,settings:{interpolator:n,startProps:i,endProps:r,duration:s,easing:o}}=e,a=o(t/s),A=n.interpolateProps(i,r,a);this.propsInTransition=this.getControllerState({...this.props,...A}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Ru(e.timeline),this.onViewStateChange=e.onViewStateChange||Iu,this.onStateChange=e.onStateChange||Iu}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:e,endProps:t}=this.transition.settings;i={...n,...e===Mu?t:this.propsInTransition||n}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||"auto"===t)&&Boolean(n)}_isUpdateDueToCurrentTransition(e){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){if(this.transition.inProgress){return this.transition.settings.interruption===ku||this._isUpdateDueToCurrentTransition(t)}return!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){const n=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(n),r=t.transitionInterpolator,s=r.getDuration?r.getDuration(e,t):t.transitionDuration;if(0===s)return;const o=r.initializeProps(e,i);this.propsInTransition={};const a={duration:s,easing:t.transitionEasing||Lu,interpolator:r,interruption:t.transitionInterruption||Bu,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),null==e||e(t)}}}function Ou(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class Nu{constructor(e){const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!So(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},i={};for(const r of this._propsToExtract)(r in e||r in t)&&(n[r]=e[r],i[r]=t[r]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];Ou(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}}const Fu=["longitude","latitude","zoom","bearing","pitch"],Uu=["longitude","latitude","zoom"];class Gu extends Nu{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Fu,required:Uu},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:r}=this.opts;if(i&&r){const s=i(e),o=i(t),a=s.unproject(r);n.start.around=r,Object.assign(n.end,{around:o.project(a),aroundPosition:a,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const r of this._propsToExtract)i[r]=To(e[r]||0,t[r]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...t,...i});Object.assign(i,r.panByPosition(t.aroundPosition,To(e.around,t.around,n)))}return i}}const zu={transitionDuration:0},Vu=e=>1-(1-e)*(1-e),Wu=["wheel"],ju=["panstart","panmove","panend"],Hu=["pinchstart","pinchmove","pinchend"],Xu=["multipanstart","multipanmove","multipanend"],Qu=["dblclick"],$u=["keydown"],Yu={};class Ku{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Du({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&(null==(e=this.eventManager)||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return!t&&this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.props;if(t&&t.handled)return!1;const r=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return r&&t&&t.stopPropagation(),r}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:!0===t?300:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:r=!0,doubleClickZoom:s=!0,touchZoom:o=!0,touchRotate:a=!1,keyboard:A=!0}=e,l=Boolean(this.onViewStateChange);this.toggleEvents(Wu,l&&n),this.toggleEvents(ju,l),this.toggleEvents(Hu,l&&(o||a)),this.toggleEvents(Xu,l&&a),this.toggleEvents(Qu,l&&s),this.toggleEvents($u,l&&A),this.scrollZoom=n,this.dragPan=i,this.dragRotate=r,this.doubleClickZoom=s,this.touchZoom=o,this.touchRotate=a,this.keyboard=A}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))})}updateViewport(e,t=null,n={}){const i={...e.getViewportProps(),...t},r=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),r){const e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,zu,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,zu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Vu},{isDragging:!1,isPanning:!0})}else{const e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,zu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Vu},{isDragging:!1,isRotating:!0})}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:r}=e;let s=2/(1+Math.exp(-Math.abs(r*n)));r<0&&0!==s&&(s=1/s);const o=i?{...this._getTransitionProps({around:t}),transitionDuration:250}:zu,a=this.controllerState.zoom({pos:t,scale:s});return this.updateViewport(a,o,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,zu,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,zu,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],r=this.controllerState.rotate({pos:i});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Vu},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Yu._startPinchRotation=e.rotation,Yu._lastPinchEvent=e,this.updateViewport(n,zu,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:Yu._startPinchRotation-n})}return this.updateViewport(t,zu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Yu._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=Yu;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let r=this.controllerState.rotateEnd();const s=Math.log2(e.scale),o=(s-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),a=Math.pow(2,s+o*t/2);r=r.zoom({pos:i,scale:a}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:Vu},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Yu._startPinchRotation=null,Yu._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:r,rotateSpeedY:s}=!0===this.keyboard?{}:this.keyboard,{controllerState:o}=this;let a;const A={};switch(e.srcEvent.code){case"Minus":a=t?o.zoomOut(n).zoomOut(n):o.zoomOut(n),A.isZooming=!0;break;case"Equal":a=t?o.zoomIn(n).zoomIn(n):o.zoomIn(n),A.isZooming=!0;break;case"ArrowLeft":t?(a=o.rotateLeft(r),A.isRotating=!0):(a=o.moveLeft(i),A.isPanning=!0);break;case"ArrowRight":t?(a=o.rotateRight(r),A.isRotating=!0):(a=o.moveRight(i),A.isPanning=!0);break;case"ArrowUp":t?(a=o.rotateUp(s),A.isRotating=!0):(a=o.moveUp(i),A.isPanning=!0);break;case"ArrowDown":t?(a=o.rotateDown(s),A.isRotating=!0):(a=o.moveDown(i),A.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),A),!0}_getTransitionProps(e){const{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new Gu({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:zu}}class Zu{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}class qu extends Zu{constructor(e){const{width:t,height:n,latitude:i,longitude:r,zoom:s,bearing:o=0,pitch:a=0,altitude:A=1.5,position:l=[0,0,0],maxZoom:c=20,minZoom:u=0,maxPitch:h=60,minPitch:d=0,startPanLngLat:f,startZoomLngLat:p,startRotatePos:g,startBearing:m,startPitch:_,startZoom:v,normalize:y=!0}=e;Ou(Number.isFinite(r)),Ou(Number.isFinite(i)),Ou(Number.isFinite(s)),super({width:t,height:n,latitude:i,longitude:r,zoom:s,bearing:o,pitch:a,altitude:A,maxZoom:c,minZoom:u,maxPitch:h,minPitch:d,normalize:y,position:l},{startPanLngLat:f,startZoomLngLat:p,startRotatePos:g,startBearing:m,startPitch:_,startZoom:v}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this.getState().startPanLngLat||this._unproject(t);if(!n)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:r,startPitch:s}=this.getState();if(!i||void 0===r||void 0===s)return this;let o;return o=e?this._getNewRotation(e,i,s,r):{bearing:r+t,pitch:s+n},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:i,startZoomLngLat:r}=this.getState();if(r||(i=this.getViewportProps().zoom,r=this._unproject(t)||this._unproject(e)),!r)return this;const{maxZoom:s,minZoom:o}=this.getViewportProps();let a=i+Math.log2(n);a=xo(a,o,s);const A=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...A.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:r}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-t.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=xo(i,n,t);const{maxPitch:r,minPitch:s,pitch:o}=e;e.pitch=xo(o,s,r);const{normalize:a=!0}=e;return a&&Object.assign(e,function(e){const{width:t,height:n,pitch:i=0}=e;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=e;(r<-180||r>180)&&(r=JA(r+180,360)-180),(a<-180||a>180)&&(a=JA(a+180,360)-180);const A=nl(n/512);if(o<=A)o=A,s=0;else{const e=n/2/Math.pow(2,o),t=pl([0,e])[1];if(s<t)s=t;else{const t=pl([0,512-e])[1];s>t&&(s=t)}}return{width:t,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,i){const r=e[0]-t[0],s=e[1]-t[1],o=e[1],a=t[1],{width:A,height:l}=this.getViewportProps(),c=r/A;let u=0;s>0?Math.abs(l-a)>5&&(u=s/(a-l)*1.2):s<0&&a>5&&(u=1-o/a),u=xo(u,-1,1);const{minPitch:h,maxPitch:d}=this.getViewportProps();let f=n;return u>0?f=n+u*(d-n):u<0&&(f=n-u*(h-n)),{pitch:f,bearing:i+180*c}}}class Ju extends Ku{constructor(){super(...arguments),this.ControllerState=qu,this.transition={transitionDuration:300,transitionInterpolator:new Gu({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e);(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class eh extends Pu{constructor(e={}){super(e)}getViewportType(){return _c}get ControllerType(){return Ju}}eh.displayName="MapView";const th=new sc;class nh{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(t=>t.id===e.id)){const n=t.findIndex(t=>function(e,t){return(e.order??1/0)-(t.order??1/0)}(t,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Eu(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const n=[];for(const i of e){const e=t[i.id];let r=i;e&&e!==i?e.setProps?(e.setProps(i.props),r=e):e.cleanup(this._context):e||i.setup(this._context),n.push(r),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(e=>e instanceof sc)||this._resolvedEffects.push(th),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class ih extends ql{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}class rh{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new ih(e),this.pickLayersPass=new iu(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const r=t.render({...n,target:i});n.effects&&(this.lastPostProcessEffect&&(n.clearCanvas=void 0===e.clearCanvas||e.clearCanvas),this._postRender(n.effects,n)),this.renderCount++,Bt("deckRenderer.renderLayers",this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[n,i]=t;0===e.length&&[0,1].map(t=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:n,height:i});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${t}`,colorAttachments:[r]}))});for(const r of e)r.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,i={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const r of e)if(r.postRender){i.target=r.id===this.lastPostProcessEffect?t.target:void 0;const e=r.postRender(i);i.inputBuffer=e,i.swapBuffer=e===n[0]?n[1]:n[0]}}}const sh={pickedColor:null,pickedObjectIndex:-1};function oh({pickedColors:e,decodePickingColor:t,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:o,y:a,width:A,height:l}=s;let c=r*r,u=-1,h=0;for(let d=0;d<l;d++){const t=d+a-i,r=t*t;if(r>c)h+=4*A;else for(let i=0;i<A;i++){if(e[h+3]-1>=0){const e=i+o-n,t=e*e+r;t<=c&&(c=t,u=h)}h+=4}}if(u>=0){const n=e.slice(u,u+4),i=t(n);if(i){const e=Math.floor(u/4/A),t=u/4-e*A;return{...i,pickedColor:n,pickedX:o+t,pickedY:a+e}}Mt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return sh}function ah({pickedColors:e,decodePickingColor:t}){const n=new Map;if(e)for(let i=0;i<e.length;i+=4){if(e[i+3]-1>=0){const r=e.slice(i,i+4),s=r.join(",");if(!n.has(s)){const e=t(r);e?n.set(s,{...e,color:r}):Mt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function Ah({pickInfo:e,viewports:t,pixelRatio:n,x:i,y:r,z:s}){let o,a=t[0];if(t.length>1&&(a=function(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.containsPixel(t))return i}return e[0]}((null==e?void 0:e.pickedViewports)||t,{x:i,y:r})),a){const e=[i-a.x,r-a.y];void 0!==s&&(e[2]=s),o=a.unproject(e)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:o,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:n}}function lh(e){const{pickInfo:t,lastPickedInfo:n,mode:i,layers:r}=e,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=t,A=o?[o]:[];if("hover"===i){const e=n.index,t=n.layerId,i=o?o.props.id:null;if(i!==t||a!==e){if(i!==t){const e=r.find(e=>e.props.id===t);e&&A.unshift(e)}n.layerId=i,n.index=a,n.info=null}}const l=Ah(e),c=new Map;return c.set(null,l),A.forEach(e=>{let t={...l};e===o&&(t.color=s,t.index=a,t.picked=!0),t=ch({layer:e,info:t,mode:i});const r=t.layer;e===o&&"hover"===i&&(n.info=t),c.set(r.id,t),"hover"===i&&r.updateAutoHighlight(t)}),c}function ch({layer:e,info:t,mode:n}){for(;e&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=e,t=e.getPickingInfo({info:t,mode:n,sourceLayer:i}),e=e.parent}return t}class uh{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new iu(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:i},r=this.lastPickedInfo.info){const s=r&&r.layer&&r.layer.id,o=r&&r.viewport&&r.viewport.id,a=s?n.find(e=>e.id===s):null,A=o&&i.find(e=>e.id===o)||i[0],l=A&&A.unproject([e-A.x,t-A.y]),c={x:e,y:t,viewport:A,coordinate:l,layer:a};return{...r,...c}}_resizeBuffer(){var e,t;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const{canvas:n}=this.device.getDefaultCanvasContext();null==(e=this.pickingFBO)||e.resize({width:n.width,height:n.height}),null==(t=this.depthFBO)||t.resize({width:n.width,height:n.height})}_getPickable(e){if(!1===this._pickable)return null;const t=e.filter(e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:n,x:i,y:r,radius:s=0,depth:o=1,mode:a="query",unproject3D:A,onViewportActive:l,effects:c}){const u=this.device.canvasContext.cssToDeviceRatio(),h=this._getPickable(e);if(!h||0===n.length)return{result:[],emptyInfo:Ah({viewports:n,x:i,y:r,pixelRatio:u})};this._resizeBuffer();const d=this.device.canvasContext.cssToDevicePixels([i,r],!0),f=[d.x+Math.floor(d.width/2),d.y+Math.floor(d.height/2)],p=Math.round(s*u),{width:g,height:m}=this.pickingFBO,_=this._getPickingRect({deviceX:f[0],deviceY:f[1],deviceRadius:p,deviceWidth:g,deviceHeight:m}),v={x:i-s,y:r-s,width:2*s+1,height:2*s+1};let y;const b=[],w=new Set;for(let E=0;E<o;E++){let e,s;if(_){e=oh({...this._drawAndSample({layers:h,views:t,viewports:n,onViewportActive:l,deviceRect:_,cullRect:v,effects:c,pass:`picking:${a}`}),deviceX:f[0],deviceY:f[1],deviceRadius:p,deviceRect:_})}else e={pickedColor:null,pickedObjectIndex:-1};if(e.pickedLayer&&A&&this.depthFBO){const{pickedColors:i}=this._drawAndSample({layers:[e.pickedLayer],views:t,viewports:n,onViewportActive:l,deviceRect:{x:e.pickedX,y:e.pickedY,width:1,height:1},cullRect:v,effects:c,pass:`picking:${a}:z`},!0);i[3]&&(s=i[0])}e.pickedLayer&&E+1<o&&(w.add(e.pickedLayer),e.pickedLayer.disablePickingIndex(e.pickedObjectIndex)),y=lh({pickInfo:e,lastPickedInfo:this.lastPickedInfo,mode:a,layers:h,viewports:n,x:i,y:r,z:s,pixelRatio:u});for(const t of y.values())t.layer&&b.push(t);if(!e.pickedColor)break}for(const E of w)E.restorePickingColors();return{result:b,emptyInfo:y.get(null)}}_pickClosestObject({layers:e,views:t,viewports:n,x:i,y:r,radius:s=0,depth:o=1,mode:a="query",unproject3D:A,onViewportActive:l,effects:c}){const u=this.device.canvasContext.cssToDeviceRatio(),h=this._getPickable(e);if(!h||0===n.length)return{result:[],emptyInfo:Ah({viewports:n,x:i,y:r,pixelRatio:u})};this._resizeBuffer();const d=this.device.canvasContext.cssToDevicePixels([i,r],!0),f=[d.x+Math.floor(d.width/2),d.y+Math.floor(d.height/2)],p=Math.round(s*u),{width:g,height:m}=this.pickingFBO,_=this._getPickingRect({deviceX:f[0],deviceY:f[1],deviceRadius:p,deviceWidth:g,deviceHeight:m}),v={x:i-s,y:r-s,width:2*s+1,height:2*s+1};let y;const b=[],w=new Set;for(let E=0;E<o;E++){let e,s;if(_){e=oh({...this._drawAndSample({layers:h,views:t,viewports:n,onViewportActive:l,deviceRect:_,cullRect:v,effects:c,pass:`picking:${a}`}),deviceX:f[0],deviceY:f[1],deviceRadius:p,deviceRect:_})}else e={pickedColor:null,pickedObjectIndex:-1};if(e.pickedLayer&&A&&this.depthFBO){const{pickedColors:i}=this._drawAndSample({layers:[e.pickedLayer],views:t,viewports:n,onViewportActive:l,deviceRect:{x:e.pickedX,y:e.pickedY,width:1,height:1},cullRect:v,effects:c,pass:`picking:${a}:z`},!0);i[3]&&(s=i[0])}e.pickedLayer&&E+1<o&&(w.add(e.pickedLayer),e.pickedLayer.disablePickingIndex(e.pickedObjectIndex)),y=lh({pickInfo:e,lastPickedInfo:this.lastPickedInfo,mode:a,layers:h,viewports:n,x:i,y:r,z:s,pixelRatio:u});for(const t of y.values())t.layer&&b.push(t);if(!e.pickedColor)break}for(const E of w)E.restorePickingColors();return{result:b,emptyInfo:y.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:n,x:i,y:r,width:s=1,height:o=1,mode:a="query",maxObjects:A=null,onViewportActive:l,effects:c}){const u=this._getPickable(e);if(!u||0===n.length)return[];this._resizeBuffer();const h=this.device.canvasContext.cssToDeviceRatio(),d=this.device.canvasContext.cssToDevicePixels([i,r],!0),f=d.x,p=d.y+d.height,g=this.device.canvasContext.cssToDevicePixels([i+s,r+o],!0),m=g.x+g.width,_=g.y,v={x:f,y:_,width:m-f,height:p-_},y=ah(this._drawAndSample({layers:u,views:t,viewports:n,onViewportActive:l,deviceRect:v,cullRect:{x:i,y:r,width:s,height:o},effects:c,pass:`picking:${a}`})),b=new Map,w=[],E=Number.isFinite(A);for(let x=0;x<y.length&&!(E&&w.length>=A);x++){const e=y[x];let t={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:i,y:r,pixelRatio:h};t=ch({layer:e.pickedLayer,info:t,mode:a});const n=t.layer.id;b.has(n)||b.set(n,new Set);const s=b.get(n),o=t.object??t.index;s.has(o)||(s.add(o),w.push(t))}return w}_pickVisibleObjects({layers:e,views:t,viewports:n,x:i,y:r,width:s=1,height:o=1,mode:a="query",maxObjects:A=null,onViewportActive:l,effects:c}){const u=this._getPickable(e);if(!u||0===n.length)return[];this._resizeBuffer();const h=this.device.canvasContext.cssToDeviceRatio(),d=this.device.canvasContext.cssToDevicePixels([i,r],!0),f=d.x,p=d.y+d.height,g=this.device.canvasContext.cssToDevicePixels([i+s,r+o],!0),m=g.x+g.width,_=g.y,v={x:f,y:_,width:m-f,height:p-_},y=ah(this._drawAndSample({layers:u,views:t,viewports:n,onViewportActive:l,deviceRect:v,cullRect:{x:i,y:r,width:s,height:o},effects:c,pass:`picking:${a}`})),b=new Map,w=[],E=Number.isFinite(A);for(let x=0;x<y.length&&!(E&&w.length>=A);x++){const e=y[x];let t={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:i,y:r,pixelRatio:h};t=ch({layer:e.pickedLayer,info:t,mode:a});const n=t.layer.id;b.has(n)||b.set(n,new Set);const s=b.get(n),o=t.object??t.index;s.has(o)||(s.add(o),w.push(t))}return w}async _drawAndSampleAsync({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:r,cullRect:s,effects:o,pass:a},A=!1){const l=A?this.depthFBO:this.pickingFBO,c={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:l,deviceRect:r,cullRect:s,effects:o,pass:a,pickZ:A,preRenderStats:{},isPicking:!0};for(const m of o)m.useInPicking&&(c.preRenderStats[m.id]=m.preRender(c));const{decodePickingColor:u}=this.pickLayersPass.render(c),{x:h,y:d,width:f,height:p}=r,g=new(A?Float32Array:Uint8Array)(f*p*4);return this.device.readPixelsToArrayWebGL(l,{sourceX:h,sourceY:d,sourceWidth:f,sourceHeight:p,target:g}),{pickedColors:g,decodePickingColor:u}}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:r,cullRect:s,effects:o,pass:a},A=!1){const l=A?this.depthFBO:this.pickingFBO,c={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:l,deviceRect:r,cullRect:s,effects:o,pass:a,pickZ:A,preRenderStats:{},isPicking:!0};for(const m of o)m.useInPicking&&(c.preRenderStats[m.id]=m.preRender(c));const{decodePickingColor:u}=this.pickLayersPass.render(c),{x:h,y:d,width:f,height:p}=r,g=new(A?Float32Array:Uint8Array)(f*p*4);return this.device.readPixelsToArrayWebGL(l,{sourceX:h,sourceY:d,sourceWidth:f,sourceHeight:p,target:g}),{pickedColors:g,decodePickingColor:u}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:i,deviceHeight:r}){const s=Math.max(0,e-n),o=Math.max(0,t-n),a=Math.min(i,e+n+1)-s,A=Math.min(r,t+n+1)-o;return a<=0||A<=0?null:{x:s,y:o,width:a,height:A}}}const hh={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},dh="top-left",fh="__root";class ph{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,null==t||t.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!Eu(e.widgets,this.widgets,1)){const t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){var n,i;const r=e.reduce((e,t)=>(e[t.id]=t,e),{});for(const s of this.getWidgets()){const{viewId:o}=s;if(o){const e=r[o];e&&(s.onViewportChange&&s.onViewportChange(e),null==(n=s.onRedraw)||n.call(s,{viewports:[e],layers:t}))}else{if(s.onViewportChange)for(const t of e)s.onViewportChange(t);null==(i=s.onRedraw)||i.call(s,{viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){var n,i;for(const r of this.getWidgets()){const{viewId:s}=r;s&&s!==(null==(n=e.viewport)?void 0:n.id)||null==(i=r.onHover)||i.call(r,e,t)}}onEvent(e,t){var n,i;const r=BA[t.type];if(r)for(const s of this.getWidgets()){const{viewId:o}=s;o&&o!==(null==(n=e.viewport)?void 0:n.id)||null==(i=s[r])||i.call(s,e,t)}}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const e=t[n.id];e?e.viewId!==n.viewId||e.placement!==n.placement?(this._removeWidget(e),this._addWidget(n)):n!==e&&(e.setProps(n.props),n=e):this._addWidget(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const e=t[n];e&&this._removeWidget(e)}this.widgets=e}_addWidget(e){const{viewId:t=null,placement:n=dh}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(t,n).append(e.rootElement),e.updateHTML()}_removeWidget(e){var t;null==(t=e.onRemove)||t.call(e),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){var n;const i=e||fh;let r=this.containers[i];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",null==(n=this.parentElement)||n.append(r),this.containers[i]=r);let s=r.querySelector(`.${t}`);return s||(s=globalThis.document.createElement("div"),s.className=t,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,hh[t]),r.append(s)),s}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,r=n===fh||i,s=this.containers[n];r?(s.style.display="block",s.style.left=`${i?i.x:0}px`,s.style.top=`${i?i.y:0}px`,s.style.width=`${i?i.width:e}px`,s.style.height=`${i?i.height:t}px`):s.style.display="none"}}}function gh(e,t){t&&Object.entries(t).map(([t,n])=>{t.startsWith("--")?e.style.setProperty(t,n):e.style[t]=n})}class mh{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const t=this.props,n=this.rootElement;var i,r;n&&t.className!==e.className&&(t.className&&n.classList.remove(t.className),e.className&&n.classList.add(e.className)),n&&!Eu(t.style,e.style,1)&&(i=n,(r=t.style)&&Object.keys(r).map(e=>{e.startsWith("--")?i.style.removeProperty(e):i.style[e]=""}),gh(n,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(e=>"string"==typeof e&&e.length>0).forEach(e=>t.classList.add(e)),gh(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}mh.defaultProps={id:"widget",style:{},className:""};const _h={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class vh extends mh{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,_h),e}onRenderHTML(e){}onViewportChange(e){var t;this.isVisible&&e.id===(null==(t=this.lastViewport)?void 0:t.id)&&!e.equals(this.lastViewport)&&this.setTooltip(null),this.lastViewport=e}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const i=n(e);this.setTooltip(i,e.x,e.y)}setTooltip(e,t,n){const i=this.rootElement;if(i){if("string"==typeof e)i.innerText=e;else{if(!e)return this.isVisible=!1,void(i.style.display="none");e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className)}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${n}px)`,e&&"object"==typeof e&&"style"in e&&Object.assign(i.style,e.style)}}}var yh,bh;vh.defaultProps={...mh.defaultProps},(bh=yh||(yh={}))[bh.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",bh[bh.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",bh[bh.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",bh[bh.POINTS=0]="POINTS",bh[bh.LINES=1]="LINES",bh[bh.LINE_LOOP=2]="LINE_LOOP",bh[bh.LINE_STRIP=3]="LINE_STRIP",bh[bh.TRIANGLES=4]="TRIANGLES",bh[bh.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",bh[bh.TRIANGLE_FAN=6]="TRIANGLE_FAN",bh[bh.ZERO=0]="ZERO",bh[bh.ONE=1]="ONE",bh[bh.SRC_COLOR=768]="SRC_COLOR",bh[bh.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",bh[bh.SRC_ALPHA=770]="SRC_ALPHA",bh[bh.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",bh[bh.DST_ALPHA=772]="DST_ALPHA",bh[bh.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",bh[bh.DST_COLOR=774]="DST_COLOR",bh[bh.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",bh[bh.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",bh[bh.CONSTANT_COLOR=32769]="CONSTANT_COLOR",bh[bh.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",bh[bh.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",bh[bh.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",bh[bh.FUNC_ADD=32774]="FUNC_ADD",bh[bh.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",bh[bh.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",bh[bh.BLEND_EQUATION=32777]="BLEND_EQUATION",bh[bh.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",bh[bh.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",bh[bh.BLEND_DST_RGB=32968]="BLEND_DST_RGB",bh[bh.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",bh[bh.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",bh[bh.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",bh[bh.BLEND_COLOR=32773]="BLEND_COLOR",bh[bh.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",bh[bh.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",bh[bh.LINE_WIDTH=2849]="LINE_WIDTH",bh[bh.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",bh[bh.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",bh[bh.CULL_FACE_MODE=2885]="CULL_FACE_MODE",bh[bh.FRONT_FACE=2886]="FRONT_FACE",bh[bh.DEPTH_RANGE=2928]="DEPTH_RANGE",bh[bh.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",bh[bh.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",bh[bh.DEPTH_FUNC=2932]="DEPTH_FUNC",bh[bh.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",bh[bh.STENCIL_FUNC=2962]="STENCIL_FUNC",bh[bh.STENCIL_FAIL=2964]="STENCIL_FAIL",bh[bh.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",bh[bh.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",bh[bh.STENCIL_REF=2967]="STENCIL_REF",bh[bh.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",bh[bh.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",bh[bh.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",bh[bh.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",bh[bh.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",bh[bh.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",bh[bh.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",bh[bh.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",bh[bh.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",bh[bh.VIEWPORT=2978]="VIEWPORT",bh[bh.SCISSOR_BOX=3088]="SCISSOR_BOX",bh[bh.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",bh[bh.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",bh[bh.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",bh[bh.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",bh[bh.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",bh[bh.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",bh[bh.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",bh[bh.RED_BITS=3410]="RED_BITS",bh[bh.GREEN_BITS=3411]="GREEN_BITS",bh[bh.BLUE_BITS=3412]="BLUE_BITS",bh[bh.ALPHA_BITS=3413]="ALPHA_BITS",bh[bh.DEPTH_BITS=3414]="DEPTH_BITS",bh[bh.STENCIL_BITS=3415]="STENCIL_BITS",bh[bh.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",bh[bh.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",bh[bh.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",bh[bh.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",bh[bh.SAMPLES=32937]="SAMPLES",bh[bh.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",bh[bh.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",bh[bh.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",bh[bh.VENDOR=7936]="VENDOR",bh[bh.RENDERER=7937]="RENDERER",bh[bh.VERSION=7938]="VERSION",bh[bh.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",bh[bh.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",bh[bh.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",bh[bh.STATIC_DRAW=35044]="STATIC_DRAW",bh[bh.STREAM_DRAW=35040]="STREAM_DRAW",bh[bh.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",bh[bh.ARRAY_BUFFER=34962]="ARRAY_BUFFER",bh[bh.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",bh[bh.BUFFER_SIZE=34660]="BUFFER_SIZE",bh[bh.BUFFER_USAGE=34661]="BUFFER_USAGE",bh[bh.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",bh[bh.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",bh[bh.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",bh[bh.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",bh[bh.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",bh[bh.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",bh[bh.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",bh[bh.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",bh[bh.CULL_FACE=2884]="CULL_FACE",bh[bh.FRONT=1028]="FRONT",bh[bh.BACK=1029]="BACK",bh[bh.FRONT_AND_BACK=1032]="FRONT_AND_BACK",bh[bh.BLEND=3042]="BLEND",bh[bh.DEPTH_TEST=2929]="DEPTH_TEST",bh[bh.DITHER=3024]="DITHER",bh[bh.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",bh[bh.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",bh[bh.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",bh[bh.SCISSOR_TEST=3089]="SCISSOR_TEST",bh[bh.STENCIL_TEST=2960]="STENCIL_TEST",bh[bh.NO_ERROR=0]="NO_ERROR",bh[bh.INVALID_ENUM=1280]="INVALID_ENUM",bh[bh.INVALID_VALUE=1281]="INVALID_VALUE",bh[bh.INVALID_OPERATION=1282]="INVALID_OPERATION",bh[bh.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",bh[bh.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",bh[bh.CW=2304]="CW",bh[bh.CCW=2305]="CCW",bh[bh.DONT_CARE=4352]="DONT_CARE",bh[bh.FASTEST=4353]="FASTEST",bh[bh.NICEST=4354]="NICEST",bh[bh.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",bh[bh.BYTE=5120]="BYTE",bh[bh.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",bh[bh.SHORT=5122]="SHORT",bh[bh.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",bh[bh.INT=5124]="INT",bh[bh.UNSIGNED_INT=5125]="UNSIGNED_INT",bh[bh.FLOAT=5126]="FLOAT",bh[bh.DOUBLE=5130]="DOUBLE",bh[bh.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",bh[bh.ALPHA=6406]="ALPHA",bh[bh.RGB=6407]="RGB",bh[bh.RGBA=6408]="RGBA",bh[bh.LUMINANCE=6409]="LUMINANCE",bh[bh.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",bh[bh.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",bh[bh.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",bh[bh.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",bh[bh.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",bh[bh.VERTEX_SHADER=35633]="VERTEX_SHADER",bh[bh.COMPILE_STATUS=35713]="COMPILE_STATUS",bh[bh.DELETE_STATUS=35712]="DELETE_STATUS",bh[bh.LINK_STATUS=35714]="LINK_STATUS",bh[bh.VALIDATE_STATUS=35715]="VALIDATE_STATUS",bh[bh.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",bh[bh.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",bh[bh.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",bh[bh.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",bh[bh.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",bh[bh.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",bh[bh.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",bh[bh.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",bh[bh.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",bh[bh.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",bh[bh.SHADER_TYPE=35663]="SHADER_TYPE",bh[bh.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",bh[bh.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",bh[bh.NEVER=512]="NEVER",bh[bh.LESS=513]="LESS",bh[bh.EQUAL=514]="EQUAL",bh[bh.LEQUAL=515]="LEQUAL",bh[bh.GREATER=516]="GREATER",bh[bh.NOTEQUAL=517]="NOTEQUAL",bh[bh.GEQUAL=518]="GEQUAL",bh[bh.ALWAYS=519]="ALWAYS",bh[bh.KEEP=7680]="KEEP",bh[bh.REPLACE=7681]="REPLACE",bh[bh.INCR=7682]="INCR",bh[bh.DECR=7683]="DECR",bh[bh.INVERT=5386]="INVERT",bh[bh.INCR_WRAP=34055]="INCR_WRAP",bh[bh.DECR_WRAP=34056]="DECR_WRAP",bh[bh.NEAREST=9728]="NEAREST",bh[bh.LINEAR=9729]="LINEAR",bh[bh.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",bh[bh.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",bh[bh.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",bh[bh.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",bh[bh.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",bh[bh.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",bh[bh.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",bh[bh.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",bh[bh.TEXTURE_2D=3553]="TEXTURE_2D",bh[bh.TEXTURE=5890]="TEXTURE",bh[bh.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",bh[bh.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",bh[bh.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",bh[bh.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",bh[bh.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",bh[bh.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",bh[bh.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",bh[bh.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",bh[bh.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",bh[bh.TEXTURE0=33984]="TEXTURE0",bh[bh.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",bh[bh.REPEAT=10497]="REPEAT",bh[bh.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",bh[bh.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",bh[bh.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",bh[bh.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",bh[bh.FLOAT_VEC2=35664]="FLOAT_VEC2",bh[bh.FLOAT_VEC3=35665]="FLOAT_VEC3",bh[bh.FLOAT_VEC4=35666]="FLOAT_VEC4",bh[bh.INT_VEC2=35667]="INT_VEC2",bh[bh.INT_VEC3=35668]="INT_VEC3",bh[bh.INT_VEC4=35669]="INT_VEC4",bh[bh.BOOL=35670]="BOOL",bh[bh.BOOL_VEC2=35671]="BOOL_VEC2",bh[bh.BOOL_VEC3=35672]="BOOL_VEC3",bh[bh.BOOL_VEC4=35673]="BOOL_VEC4",bh[bh.FLOAT_MAT2=35674]="FLOAT_MAT2",bh[bh.FLOAT_MAT3=35675]="FLOAT_MAT3",bh[bh.FLOAT_MAT4=35676]="FLOAT_MAT4",bh[bh.SAMPLER_2D=35678]="SAMPLER_2D",bh[bh.SAMPLER_CUBE=35680]="SAMPLER_CUBE",bh[bh.LOW_FLOAT=36336]="LOW_FLOAT",bh[bh.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",bh[bh.HIGH_FLOAT=36338]="HIGH_FLOAT",bh[bh.LOW_INT=36339]="LOW_INT",bh[bh.MEDIUM_INT=36340]="MEDIUM_INT",bh[bh.HIGH_INT=36341]="HIGH_INT",bh[bh.FRAMEBUFFER=36160]="FRAMEBUFFER",bh[bh.RENDERBUFFER=36161]="RENDERBUFFER",bh[bh.RGBA4=32854]="RGBA4",bh[bh.RGB5_A1=32855]="RGB5_A1",bh[bh.RGB565=36194]="RGB565",bh[bh.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",bh[bh.STENCIL_INDEX=6401]="STENCIL_INDEX",bh[bh.STENCIL_INDEX8=36168]="STENCIL_INDEX8",bh[bh.DEPTH_STENCIL=34041]="DEPTH_STENCIL",bh[bh.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",bh[bh.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",bh[bh.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",bh[bh.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",bh[bh.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",bh[bh.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",bh[bh.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",bh[bh.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",bh[bh.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",bh[bh.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",bh[bh.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",bh[bh.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",bh[bh.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",bh[bh.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",bh[bh.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",bh[bh.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",bh[bh.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",bh[bh.NONE=0]="NONE",bh[bh.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",bh[bh.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",bh[bh.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",bh[bh.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",bh[bh.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",bh[bh.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",bh[bh.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",bh[bh.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",bh[bh.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",bh[bh.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",bh[bh.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",bh[bh.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",bh[bh.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",bh[bh.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",bh[bh.READ_BUFFER=3074]="READ_BUFFER",bh[bh.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",bh[bh.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",bh[bh.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",bh[bh.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",bh[bh.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",bh[bh.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",bh[bh.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",bh[bh.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",bh[bh.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",bh[bh.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",bh[bh.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",bh[bh.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",bh[bh.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",bh[bh.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",bh[bh.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",bh[bh.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",bh[bh.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",bh[bh.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",bh[bh.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",bh[bh.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",bh[bh.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",bh[bh.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",bh[bh.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",bh[bh.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",bh[bh.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",bh[bh.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",bh[bh.RED=6403]="RED",bh[bh.RGB8=32849]="RGB8",bh[bh.RGBA8=32856]="RGBA8",bh[bh.RGB10_A2=32857]="RGB10_A2",bh[bh.TEXTURE_3D=32879]="TEXTURE_3D",bh[bh.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",bh[bh.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",bh[bh.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",bh[bh.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",bh[bh.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",bh[bh.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",bh[bh.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",bh[bh.SRGB=35904]="SRGB",bh[bh.SRGB8=35905]="SRGB8",bh[bh.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",bh[bh.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",bh[bh.RGBA32F=34836]="RGBA32F",bh[bh.RGB32F=34837]="RGB32F",bh[bh.RGBA16F=34842]="RGBA16F",bh[bh.RGB16F=34843]="RGB16F",bh[bh.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",bh[bh.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",bh[bh.R11F_G11F_B10F=35898]="R11F_G11F_B10F",bh[bh.RGB9_E5=35901]="RGB9_E5",bh[bh.RGBA32UI=36208]="RGBA32UI",bh[bh.RGB32UI=36209]="RGB32UI",bh[bh.RGBA16UI=36214]="RGBA16UI",bh[bh.RGB16UI=36215]="RGB16UI",bh[bh.RGBA8UI=36220]="RGBA8UI",bh[bh.RGB8UI=36221]="RGB8UI",bh[bh.RGBA32I=36226]="RGBA32I",bh[bh.RGB32I=36227]="RGB32I",bh[bh.RGBA16I=36232]="RGBA16I",bh[bh.RGB16I=36233]="RGB16I",bh[bh.RGBA8I=36238]="RGBA8I",bh[bh.RGB8I=36239]="RGB8I",bh[bh.RED_INTEGER=36244]="RED_INTEGER",bh[bh.RGB_INTEGER=36248]="RGB_INTEGER",bh[bh.RGBA_INTEGER=36249]="RGBA_INTEGER",bh[bh.R8=33321]="R8",bh[bh.RG8=33323]="RG8",bh[bh.R16F=33325]="R16F",bh[bh.R32F=33326]="R32F",bh[bh.RG16F=33327]="RG16F",bh[bh.RG32F=33328]="RG32F",bh[bh.R8I=33329]="R8I",bh[bh.R8UI=33330]="R8UI",bh[bh.R16I=33331]="R16I",bh[bh.R16UI=33332]="R16UI",bh[bh.R32I=33333]="R32I",bh[bh.R32UI=33334]="R32UI",bh[bh.RG8I=33335]="RG8I",bh[bh.RG8UI=33336]="RG8UI",bh[bh.RG16I=33337]="RG16I",bh[bh.RG16UI=33338]="RG16UI",bh[bh.RG32I=33339]="RG32I",bh[bh.RG32UI=33340]="RG32UI",bh[bh.R8_SNORM=36756]="R8_SNORM",bh[bh.RG8_SNORM=36757]="RG8_SNORM",bh[bh.RGB8_SNORM=36758]="RGB8_SNORM",bh[bh.RGBA8_SNORM=36759]="RGBA8_SNORM",bh[bh.RGB10_A2UI=36975]="RGB10_A2UI",bh[bh.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",bh[bh.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",bh[bh.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",bh[bh.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",bh[bh.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",bh[bh.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",bh[bh.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",bh[bh.HALF_FLOAT=5131]="HALF_FLOAT",bh[bh.RG=33319]="RG",bh[bh.RG_INTEGER=33320]="RG_INTEGER",bh[bh.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",bh[bh.CURRENT_QUERY=34917]="CURRENT_QUERY",bh[bh.QUERY_RESULT=34918]="QUERY_RESULT",bh[bh.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",bh[bh.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",bh[bh.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",bh[bh.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",bh[bh.DRAW_BUFFER0=34853]="DRAW_BUFFER0",bh[bh.DRAW_BUFFER1=34854]="DRAW_BUFFER1",bh[bh.DRAW_BUFFER2=34855]="DRAW_BUFFER2",bh[bh.DRAW_BUFFER3=34856]="DRAW_BUFFER3",bh[bh.DRAW_BUFFER4=34857]="DRAW_BUFFER4",bh[bh.DRAW_BUFFER5=34858]="DRAW_BUFFER5",bh[bh.DRAW_BUFFER6=34859]="DRAW_BUFFER6",bh[bh.DRAW_BUFFER7=34860]="DRAW_BUFFER7",bh[bh.DRAW_BUFFER8=34861]="DRAW_BUFFER8",bh[bh.DRAW_BUFFER9=34862]="DRAW_BUFFER9",bh[bh.DRAW_BUFFER10=34863]="DRAW_BUFFER10",bh[bh.DRAW_BUFFER11=34864]="DRAW_BUFFER11",bh[bh.DRAW_BUFFER12=34865]="DRAW_BUFFER12",bh[bh.DRAW_BUFFER13=34866]="DRAW_BUFFER13",bh[bh.DRAW_BUFFER14=34867]="DRAW_BUFFER14",bh[bh.DRAW_BUFFER15=34868]="DRAW_BUFFER15",bh[bh.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",bh[bh.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",bh[bh.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",bh[bh.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",bh[bh.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",bh[bh.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",bh[bh.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",bh[bh.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",bh[bh.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",bh[bh.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",bh[bh.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",bh[bh.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",bh[bh.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",bh[bh.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",bh[bh.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",bh[bh.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",bh[bh.SAMPLER_3D=35679]="SAMPLER_3D",bh[bh.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",bh[bh.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",bh[bh.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",bh[bh.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",bh[bh.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",bh[bh.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",bh[bh.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",bh[bh.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",bh[bh.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",bh[bh.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",bh[bh.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",bh[bh.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",bh[bh.MAX_SAMPLES=36183]="MAX_SAMPLES",bh[bh.SAMPLER_BINDING=35097]="SAMPLER_BINDING",bh[bh.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",bh[bh.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",bh[bh.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",bh[bh.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",bh[bh.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",bh[bh.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",bh[bh.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",bh[bh.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",bh[bh.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",bh[bh.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",bh[bh.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",bh[bh.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",bh[bh.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",bh[bh.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",bh[bh.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",bh[bh.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",bh[bh.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",bh[bh.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",bh[bh.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",bh[bh.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",bh[bh.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",bh[bh.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",bh[bh.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",bh[bh.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",bh[bh.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",bh[bh.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",bh[bh.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",bh[bh.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",bh[bh.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",bh[bh.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",bh[bh.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",bh[bh.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",bh[bh.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",bh[bh.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",bh[bh.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",bh[bh.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",bh[bh.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",bh[bh.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",bh[bh.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",bh[bh.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",bh[bh.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",bh[bh.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",bh[bh.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",bh[bh.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",bh[bh.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",bh[bh.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",bh[bh.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",bh[bh.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",bh[bh.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",bh[bh.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",bh[bh.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",bh[bh.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",bh[bh.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",bh[bh.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",bh[bh.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",bh[bh.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",bh[bh.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",bh[bh.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",bh[bh.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",bh[bh.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",bh[bh.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",bh[bh.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",bh[bh.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",bh[bh.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",bh[bh.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",bh[bh.UNIFORM_TYPE=35383]="UNIFORM_TYPE",bh[bh.UNIFORM_SIZE=35384]="UNIFORM_SIZE",bh[bh.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",bh[bh.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",bh[bh.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",bh[bh.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",bh[bh.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",bh[bh.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",bh[bh.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",bh[bh.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",bh[bh.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",bh[bh.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",bh[bh.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",bh[bh.OBJECT_TYPE=37138]="OBJECT_TYPE",bh[bh.SYNC_CONDITION=37139]="SYNC_CONDITION",bh[bh.SYNC_STATUS=37140]="SYNC_STATUS",bh[bh.SYNC_FLAGS=37141]="SYNC_FLAGS",bh[bh.SYNC_FENCE=37142]="SYNC_FENCE",bh[bh.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",bh[bh.UNSIGNALED=37144]="UNSIGNALED",bh[bh.SIGNALED=37145]="SIGNALED",bh[bh.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",bh[bh.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",bh[bh.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",bh[bh.WAIT_FAILED=37149]="WAIT_FAILED",bh[bh.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",bh[bh.COLOR=6144]="COLOR",bh[bh.DEPTH=6145]="DEPTH",bh[bh.STENCIL=6146]="STENCIL",bh[bh.MIN=32775]="MIN",bh[bh.MAX=32776]="MAX",bh[bh.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",bh[bh.STREAM_READ=35041]="STREAM_READ",bh[bh.STREAM_COPY=35042]="STREAM_COPY",bh[bh.STATIC_READ=35045]="STATIC_READ",bh[bh.STATIC_COPY=35046]="STATIC_COPY",bh[bh.DYNAMIC_READ=35049]="DYNAMIC_READ",bh[bh.DYNAMIC_COPY=35050]="DYNAMIC_COPY",bh[bh.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",bh[bh.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",bh[bh.INVALID_INDEX=4294967295]="INVALID_INDEX",bh[bh.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",bh[bh.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",bh[bh.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",bh[bh.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",bh[bh.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",bh[bh.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",bh[bh.R16_EXT=33322]="R16_EXT",bh[bh.RG16_EXT=33324]="RG16_EXT",bh[bh.RGB16_EXT=32852]="RGB16_EXT",bh[bh.RGBA16_EXT=32859]="RGBA16_EXT",bh[bh.R16_SNORM_EXT=36760]="R16_SNORM_EXT",bh[bh.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",bh[bh.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",bh[bh.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",bh[bh.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",bh[bh.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",bh[bh.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",bh[bh.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",bh[bh.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",bh[bh.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",bh[bh.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",bh[bh.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",bh[bh.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",bh[bh.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",bh[bh.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",bh[bh.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",bh[bh.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",bh[bh.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",bh[bh.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",bh[bh.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",bh[bh.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",bh[bh.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",bh[bh.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",bh[bh.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",bh[bh.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",bh[bh.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",bh[bh.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",bh[bh.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",bh[bh.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",bh[bh.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",bh[bh.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",bh[bh.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",bh[bh.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",bh[bh.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",bh[bh.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",bh[bh.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",bh[bh.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",bh[bh.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",bh[bh.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",bh[bh.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",bh[bh.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",bh[bh.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",bh[bh.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",bh[bh.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",bh[bh.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",bh[bh.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",bh[bh.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",bh[bh.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",bh[bh.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",bh[bh.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",bh[bh.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",bh[bh.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",bh[bh.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",bh[bh.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",bh[bh.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",bh[bh.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",bh[bh.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",bh[bh.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",bh[bh.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",bh[bh.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",bh[bh.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",bh[bh.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",bh[bh.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",bh[bh.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",bh[bh.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",bh[bh.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",bh[bh.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",bh[bh.LINE_WEBGL=6913]="LINE_WEBGL",bh[bh.FILL_WEBGL=6914]="FILL_WEBGL",bh[bh.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",bh[bh.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",bh[bh.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",bh[bh.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",bh[bh.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",bh[bh.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",bh[bh.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",bh[bh.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",bh[bh.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",bh[bh.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",bh[bh.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",bh[bh.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",bh[bh.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",bh[bh.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",bh[bh.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",bh[bh.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",bh[bh.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",bh[bh.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",bh[bh.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",bh[bh.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",bh[bh.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",bh[bh.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",bh[bh.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",bh[bh.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT";const wh={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},Eh=e=>({drawBuffersWEBGL:t=>e.drawBuffers(t),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),xh=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>e.createVertexArray(),deleteVertexArrayOES:t=>e.deleteVertexArray(t),isVertexArrayOES:t=>e.isVertexArray(t),bindVertexArrayOES:t=>e.bindVertexArray(t)}),Th=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE:(...t)=>e.drawArraysInstanced(...t),drawElementsInstancedANGLE:(...t)=>e.drawElementsInstanced(...t),vertexAttribDivisorANGLE:(...t)=>e.vertexAttribDivisor(...t)});function Sh(e=!0){const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext)return t.getContext=t.originalGetContext,void(t.originalGetContext=void 0);t.originalGetContext=t.getContext,t.getContext=function(e,t){if("webgl"===e||"experimental-webgl"===e){const e=this.originalGetContext("webgl2",t);return e instanceof HTMLElement&&function(e){e.getExtension("EXT_color_buffer_float");const t={...wh,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:Eh(e),OES_vertex_array_object:xh(e),ANGLE_instanced_arrays:Th(e)},n=e.getExtension;e.getExtension=function(i){const r=n.call(e,i);return r||(i in t?t[i]:null)};const i=e.getSupportedExtensions;e.getSupportedExtensions=function(){const n=i.apply(e)||[];return null==n?void 0:n.concat(Object.keys(t))}}(e),e}return this.originalGetContext(e,t)}}async function Ch(e,t){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",e),new Promise((t,r)=>{i.onload=t,i.onerror=t=>r(new Error(`Unable to load script '${e}': ${t}`)),n.appendChild(i)})}let Ph=null,Rh=!1;const Ih={debugSpectorJS:bn.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};function Mh(e){return e.luma=e.luma||{},e.luma}function kh(e,t={}){return t.debugWebGL||t.traceWebGL?function(e,t){if(!globalThis.WebGLDebugUtils)return bn.warn("webgl-debug not loaded")(),e;const n=Mh(e);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...yh,...e});const i=globalThis.WebGLDebugUtils.makeDebugContext(e,Bh.bind(null,t),Dh.bind(null,t));for(const o in yh)o in i||"number"!=typeof yh[o]||(i[o]=yh[o]);class r{}Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.setPrototypeOf(r,i);const s=Object.create(r);return n.realContext=e,n.debugContext=s,s.debug=!0,s}(e,t):function(e){const t=Mh(e);return t.realContext?t.realContext:e}(e)}function Lh(e,t){t=Array.from(t).map(e=>void 0===e?"undefined":e);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${e}(${n})`}function Bh(e,t,n,i){i=Array.from(i).map(e=>void 0===e?"undefined":e);const r=`${globalThis.WebGLDebugUtils.glEnumToString(t)} in gl.${n}(${globalThis.WebGLDebugUtils.glFunctionArgsToString(n,i)})`;bn.error(r)()}function Dh(e,t,n){let i="";bn.level>=1&&(i=Lh(t,n),e.traceWebGL&&bn.log(1,i)());for(const r of n)void 0===r&&(i=i||Lh(t,n))}const Oh=new class extends si{constructor(){super(),i(this,"type","webgl"),ti.defaultProps={...ti.defaultProps,...Ih}}enforceWebGL2(e){Sh(e)}isSupported(){return"undefined"!=typeof WebGL2RenderingContext}isDeviceHandle(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||("undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext&&bn.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:n}=await A(async()=>{const{WebGLDevice:e}=await Promise.resolve().then(()=>_f);return{WebGLDevice:e}},void 0);if(e instanceof n)return e;if((null==e?void 0:e.device)instanceof n)return e.device;if(!function(e){if("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)return!0;return Boolean(e&&Number.isFinite(e._version))}(e))throw new Error("Invalid WebGL2RenderingContext");const i=!0===t.createCanvasContext?{}:t.createCanvasContext;return new n({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...i}})}async create(e={}){const{WebGLDevice:t}=await A(async()=>{const{WebGLDevice:e}=await Promise.resolve().then(()=>_f);return{WebGLDevice:e}},void 0);bn.groupCollapsed(1,"WebGLDevice created")();try{const n=[];(e.debugWebGL||e.debug)&&n.push(async function(){b()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Ch("https://unpkg.com/webgl-debug@2.0.1/index.js"))}()),e.debugSpectorJS&&n.push(async function(e){if(!globalThis.SPECTOR)try{await Ch(e.debugSpectorJSUrl||Ih.debugSpectorJSUrl)}catch(t){bn.warn(String(t))}}(e));const i=await Promise.allSettled(n);for(const e of i)"rejected"===e.status&&bn.error(`Failed to initialize debug libraries ${e.reason}`)();const r=new t(e),s=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.props.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return bn.probe(1,s)(),bn.table(1,r.info)(),r}finally{bn.groupEnd(1)()}}},Nh={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Fh=(e,t,n)=>t?e.enable(n):e.disable(n),Uh=(e,t,n)=>e.hint(n,t),Gh=(e,t,n)=>e.pixelStorei(n,t),zh=(e,t,n)=>{const i=36006===n?36009:36008;return e.bindFramebuffer(i,t)},Vh=(e,t,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];e.bindBuffer(i,t)};function Wh(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const jh={3042:Fh,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:Fh,2885:(e,t)=>e.cullFace(t),2929:Fh,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:Fh,35723:Uh,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>{var n;return null==(n=e.bindTransformFeedback)?void 0:n.call(e,36386,t)},34229:(e,t)=>e.bindVertexArray(t),36006:zh,36010:zh,34964:Vh,36662:Vh,36663:Vh,35053:Vh,35055:Vh,2886:(e,t)=>e.frontFace(t),33170:Uh,2849:(e,t)=>e.lineWidth(t),32823:Fh,32824:"polygonOffset",10752:"polygonOffset",35977:Fh,32926:Fh,32928:Fh,32938:"sampleCoverage",32939:"sampleCoverage",3089:Fh,3088:(e,t)=>e.scissor(...t),2960:Fh,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:Fh,10754:Fh,12288:Fh,12289:Fh,12290:Fh,12291:Fh,12292:Fh,12293:Fh,12294:Fh,12295:Fh,3333:Gh,3317:Gh,37440:Gh,37441:Gh,37443:Gh,3330:Gh,3332:Gh,3331:Gh,3314:Gh,32878:Gh,3316:Gh,3315:Gh,32877:Gh,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,n)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const n="number"==typeof t?[t,t]:t;e.blendEquationSeparate(...n)},blendFunc:(e,t)=>{const n=2===(null==t?void 0:t.length)?[...t,...t]:t;e.blendFuncSeparate(...n)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=Wh(t)?t:[t,t];const[n,i]=t;e.stencilMaskSeparate(1028,n),e.stencilMaskSeparate(1029,i)},stencilFunc:(e,t)=>{t=Wh(t)&&3===t.length?[...t,...t]:t;const[n,i,r,s,o,a]=t;e.stencilFuncSeparate(1028,n,i,r),e.stencilFuncSeparate(1029,s,o,a)},stencilOp:(e,t)=>{t=Wh(t)&&3===t.length?[...t,...t]:t;const[n,i,r,s,o,a]=t;e.stencilOpSeparate(1028,n,i,r),e.stencilOpSeparate(1029,s,o,a)},viewport:(e,t)=>e.viewport(...t)};function Hh(e,t,n){return void 0!==t[e]?t[e]:n[e]}const Xh={blendEquation:(e,t,n)=>e.blendEquationSeparate(Hh(32777,t,n),Hh(34877,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(Hh(32969,t,n),Hh(32968,t,n),Hh(32971,t,n),Hh(32970,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(Hh(32824,t,n),Hh(10752,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(Hh(32938,t,n),Hh(32939,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(1028,Hh(2962,t,n),Hh(2967,t,n),Hh(2963,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(1029,Hh(34816,t,n),Hh(36003,t,n),Hh(36004,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(1028,Hh(2964,t,n),Hh(2965,t,n),Hh(2966,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(1029,Hh(34817,t,n),Hh(34818,t,n),Hh(34819,t,n))},Qh={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,n)=>e({36007:n}),bindTransformFeedback:(e,t,n)=>e({36389:n}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,n)=>{switch(t){case 36160:return e({36006:n,36010:n});case 36009:return e({36006:n});case 36008:return e({36010:n});default:return null}},bindBuffer:(e,t,n)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return i?e({[i]:n}):{valueChanged:!0}},blendColor:(e,t,n,i,r)=>e({32773:new Float32Array([t,n,i,r])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,n)=>e({32777:t,34877:n}),blendFunc:(e,t,n)=>e({32969:t,32968:n,32971:t,32970:n}),blendFuncSeparate:(e,t,n,i,r)=>e({32969:t,32968:n,32971:i,32970:r}),clearColor:(e,t,n,i,r)=>e({3106:new Float32Array([t,n,i,r])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,n,i,r)=>e({3107:[t,n,i,r]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,n)=>e({2928:new Float32Array([t,n])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,n)=>e({32824:t,10752:n}),sampleCoverage:(e,t,n)=>e({32938:t,32939:n}),scissor:(e,t,n,i,r)=>e({3088:new Int32Array([t,n,i,r])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,n)=>e({[1028===t?2968:36005]:n}),stencilFunc:(e,t,n,i)=>e({2962:t,2967:n,2963:i,34816:t,36003:n,36004:i}),stencilFuncSeparate:(e,t,n,i,r)=>e({[1028===t?2962:34816]:n,[1028===t?2967:36003]:i,[1028===t?2963:36004]:r}),stencilOp:(e,t,n,i)=>e({2964:t,2965:n,2966:i,34817:t,34818:n,34819:i}),stencilOpSeparate:(e,t,n,i,r)=>e({[1028===t?2964:34817]:n,[1028===t?2965:34818]:i,[1028===t?2966:34819]:r}),viewport:(e,t,n,i,r)=>e({2978:[t,n,i,r]})},$h=(e,t)=>e.isEnabled(t),Yh={3042:$h,2884:$h,2929:$h,3024:$h,32823:$h,32926:$h,32928:$h,3089:$h,2960:$h,35977:$h},Kh=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Zh(e,t){if(function(e){for(const t in e)return!1;return!0}(t))return;const n={};for(const r in t){const i=Number(r),s=jh[r];s&&("string"==typeof s?n[s]=!0:s(e,t[r],i))}const i=e.state&&e.state.cache;if(i)for(const r in n){(0,Xh[r])(e,t,i)}}function qh(e,t=Nh){if("number"==typeof t){const n=t,i=Yh[n];return i?i(e,n):e.getParameter(n)}const n=Array.isArray(t)?t:Object.keys(t),i={};for(const r of n){const t=Yh[r];i[r]=t?t(e,Number(r)):e.getParameter(Number(r))}return i}function Jh(e,t){if(e===t)return!0;if(ed(e)&&ed(t)&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}function ed(e){return Array.isArray(e)||ArrayBuffer.isView(e)}class td{constructor(e,t){i(this,"gl"),i(this,"program",null),i(this,"stateStack",[]),i(this,"enable",!0),i(this,"cache",null),i(this,"log"),i(this,"initialized",!1),this.gl=e,this.log=(null==t?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Zh(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=(null==t?void 0:t.copyState)?qh(e):Object.assign({},Nh),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){const i=td.get(e);i.program!==n&&(t(n),i.program=n)}}(e);for(const n in Qh){id(e,n,Qh[n])}nd(e,"getParameter"),nd(e,"isEnabled")}_updateCache(e){let t,n=!1;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in e){const s=e[r],o=this.cache[r];Jh(s,o)||(n=!0,t=o,i&&!(r in i)&&(i[r]=o),this.cache[r]=s)}return{valueChanged:n,oldValue:t}}}function nd(e,t){const n=e[t].bind(e);e[t]=function(t){if(void 0===t||Kh.has(t))return n(t);const i=td.get(e);return t in i.cache||(i.cache[t]=n(t)),i.enable?i.cache[t]:n(t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function id(e,t,n){if(!e[t])return;const i=e[t].bind(e);e[t]=function(...t){const r=td.get(e),{valueChanged:s,oldValue:o}=n(r._updateCache,...t);return s&&i(...t),o},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function rd(e,t,n){return void 0===n[t]&&(n[t]=e.getExtension(t)||null),n[t]}function sd(e,t){const n=e.getParameter(7936),i=e.getParameter(7937);rd(e,"WEBGL_debug_renderer_info",t);const r=t.WEBGL_debug_renderer_info,s=e.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936)||n,o=e.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937)||i,a=e.getParameter(7938),A=od(s,o),l=function(e,t){if(/Metal/i.exec(e)||/Metal/i.exec(t))return"metal";if(/ANGLE/i.exec(e)||/ANGLE/i.exec(t))return"opengl";return"unknown"}(s,o),c=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(od(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(s,o);return{type:"webgl",gpu:A,gpuType:c,gpuBackend:l,vendor:s,renderer:o,version:a,shadingLanguage:"glsl",shadingLanguageVersion:300}}function od(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function ad(e){switch(e){case"uint8":case"unorm8":return 5121;case"sint8":case"snorm8":return 5120;case"uint16":case"unorm16":return 5123;case"sint16":case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const Ad="WEBGL_compressed_texture_s3tc",ld="WEBGL_compressed_texture_s3tc_srgb",cd="EXT_texture_compression_rgtc",ud="EXT_texture_compression_bptc",hd="EXT_texture_norm16",dd="EXT_render_snorm",fd={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[dd],"norm16-renderable-webgl":[hd],"snorm16-renderable-webgl":[hd,dd],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Ad,ld,cd,ud],"texture-compression-bc5-webgl":[cd],"texture-compression-bc7-webgl":[ud],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]};const pd={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:"EXT_color_buffer_float",dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Ad},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:ld},"bc1-rgba-unorm":{gl:33777,x:Ad},"bc1-rgba-unorm-srgb":{gl:35916,x:ld},"bc2-rgba-unorm":{gl:33778,x:Ad},"bc2-rgba-unorm-srgb":{gl:35918,x:ld},"bc3-rgba-unorm":{gl:33779,x:Ad},"bc3-rgba-unorm-srgb":{gl:35919,x:ld},"bc4-r-unorm":{gl:36283,x:cd},"bc4-r-snorm":{gl:36284,x:cd},"bc5-rg-unorm":{gl:36285,x:cd},"bc5-rg-snorm":{gl:36286,x:cd},"bc6h-rgb-ufloat":{gl:36495,x:ud},"bc6h-rgb-float":{gl:36494,x:ud},"bc7-rgba-unorm":{gl:36492,x:ud},"bc7-rgba-unorm-srgb":{gl:36493,x:ud},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function gd(e){var t;const n=pd[e],i=function(e){const t=pd[e],n=null==t?void 0:t.gl;if(void 0===n)throw new Error(`Unsupported texture format ${e}`);return n}(e),r=Kn.getInfo(e);return r.compressed&&(n.dataFormat=i),{internalFormat:i,format:(null==n?void 0:n.dataFormat)||md(r.channels,r.integer,r.normalized,i),type:r.dataType?ad(r.dataType):(null==(t=null==n?void 0:n.types)?void 0:t[0])||5121,compressed:r.compressed||!1}}function md(e,t,n,i){if(6408===i||6407===i)return i;switch(e){case"r":return t&&!n?36244:6403;case"rg":return t&&!n?33320:33319;case"rgb":return t&&!n?36248:6407;case"rgba":return t&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}const _d={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class vd extends Jn{constructor(e,t,n){super([],n),i(this,"gl"),i(this,"extensions"),i(this,"testedFeatures",new Set),this.gl=e,this.extensions=t,rd(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){var t;return!(null==(t=this.disabledFeatures)?void 0:t[e])&&(this.testedFeatures.has(e)||(this.testedFeatures.add(e),function(e){return e in fd}(e)&&function(e,t,n){return(fd[t]||[]).every(t=>rd(e,t,n))}(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(e=>"polygon-mode-webgl"!==e);for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(_d),...Object.keys(fd)]}getWebGLFeature(e){const t=_d[e];return"string"==typeof t?Boolean(rd(this.gl,t,this.extensions)):Boolean(t)}}class yd extends qn{constructor(e){super(),i(this,"gl"),i(this,"limits",{}),this.gl=e}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(e){return void 0===this.limits[e]&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class bd extends Si{constructor(e,t){super(e,t),i(this,"device"),i(this,"gl"),i(this,"handle"),i(this,"colorAttachments",[]),i(this,"depthStencilAttachment",null);const n=null===t.handle;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const e=this.colorAttachments[t];if(e){const n=36064+t;this._attachTextureView(n,e)}}if(this.depthStencilAttachment){const e=function(e){switch(Kn.getInfo(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${e}`)}}(this.depthStencilAttachment.props.format);this._attachTextureView(e,this.depthStencilAttachment)}if(this.device.props.debug){const e=this.gl.checkFramebufferStatus(36160);if(36053!==e)throw new Error(`Framebuffer ${function(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}(e)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:n}=this.device,{texture:i}=t,r=t.props.baseMipLevel,s=t.props.baseArrayLayer;switch(n.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,i.handle,r,s);break;case 34067:const t=function(e){return e<34069?e+34069:e}(s);n.framebufferTexture2D(36160,e,t,i.handle,r);break;case 3553:n.framebufferTexture2D(36160,e,3553,i.handle,r);break;default:throw new Error("Illegal texture type")}n.bindTexture(i.glTarget,null)}}class wd extends ci{constructor(e,t){super(t),i(this,"device"),i(this,"handle",null),i(this,"_framebuffer",null),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new bd(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const Ed={};function xd(e="id"){Ed[e]=Ed[e]||1;return`${e}-${Ed[e]++}`}class Td extends Sn{constructor(e,t={}){super(e,t),i(this,"device"),i(this,"gl"),i(this,"handle"),i(this,"glTarget"),i(this,"glUsage"),i(this,"glIndexType",5123),i(this,"byteLength",0),i(this,"bytesUsed",0),this.device=e,this.gl=this.device.gl;const n="object"==typeof t?t.handle:void 0;this.handle=n||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=function(e){if(e&Sn.INDEX)return 34963;if(e&Sn.VERTEX)return 34962;if(e&Sn.UNIFORM)return 35345;return 34962}(this.props.usage),this.glUsage=function(e){if(e&Sn.INDEX)return 35044;if(e&Sn.VERTEX)return 35044;if(e&Sn.UNIFORM)return 35048;return 35044}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,t=0,n=e.byteLength+t){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let t=e;0===e&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,t=0){const n=ArrayBuffer.isView(e)?e:new Uint8Array(e),i=36663;this.gl.bindBuffer(i,this.handle),this.gl.bufferSubData(i,t,n),this.gl.bindBuffer(i,null),this._setDebugData(e,t,e.byteLength)}async mapAndWriteAsync(e,t=0,n=this.byteLength-t){const i=new ArrayBuffer(n);await e(i,"copied"),this.write(i,t)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}async mapAndReadAsync(e,t=0,n){const i=await this.readAsync(t,n);return await e(i.buffer,"copied")}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const n=new Uint8Array(t);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,0,t),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,t),n}}function Sd(e){const t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}class Cd extends Ei{constructor(e,t){switch(super(e,t),i(this,"device"),i(this,"handle"),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?function(e){const t=e.split(/\r?\n/),n=[];for(const i of t){if(i.length<=1)continue;const e=i.split(":");if(2===e.length){const[t,i]=e;n.push({message:i.trim(),type:Sd(t),lineNum:0,linePos:0});continue}const[t,r,s,...o]=e;let a=parseInt(s,10);isNaN(a)&&(a=0);let A=parseInt(r,10);isNaN(A)&&(A=0),n.push({message:o.join(":").trim(),type:Sd(t),lineNum:a,linePos:A})}return n}(e):[]}getTranslatedSource(){const e=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(null==e?void 0:e.getTranslatedShaderSource(this.handle))||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es\n${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),this.device.props.debug){if(this.device.features.has("compilation-status-async-webgl"))bn.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),bn.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader();else if(this._getCompilationStatus(),this.debugShader(),"error"===this.compilationStatus)throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`)}else this.compilationStatus="pending"}async _waitForCompilationComplete(){const e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl"))return void(await e(10));const{gl:t}=this.device;for(;;){if(t.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Pd(e,t,n,i){if(function(e){let t=!0;for(const n in e){t=!1;break}return t}(t))return i(e);const r=e;r.pushState();try{return function(e,t){const n=e,{gl:i}=n;if(t.cullMode)switch(t.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029)}t.frontFace&&i.frontFace(Ld("frontFace",t.frontFace,{ccw:2305,cw:2304}));t.unclippedDepth&&e.features.has("depth-clip-control")&&i.enable(34383);void 0!==t.depthBias&&(i.enable(32823),i.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0));if(t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const e=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,i=Ld("provokingVertex",t.provokingVertex,{first:36429,last:36430});null==e||e.provokingVertexWEBGL(i)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const e=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,i=Ld("polygonMode",t.polygonMode,{fill:6914,line:6913});null==e||e.polygonModeWEBGL(1028,i),null==e||e.polygonModeWEBGL(1029,i)}t.polygonOffsetLine&&i.enable(10754)}e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&i.enable(12288),t.clipDistance1&&i.enable(12289),t.clipDistance2&&i.enable(12290),t.clipDistance3&&i.enable(12291),t.clipDistance4&&i.enable(12292),t.clipDistance5&&i.enable(12293),t.clipDistance6&&i.enable(12294),t.clipDistance7&&i.enable(12295));void 0!==t.depthWriteEnabled&&i.depthMask(t.depthWriteEnabled);t.depthCompare&&("always"!==t.depthCompare?i.enable(2929):i.disable(2929),i.depthFunc(Rd("depthCompare",t.depthCompare)));if(t.stencilWriteMask){const e=t.stencilWriteMask;i.stencilMaskSeparate(1028,e),i.stencilMaskSeparate(1029,e)}t.stencilReadMask&&bn.warn("stencilReadMask not supported under WebGL");if(t.stencilCompare){const e=t.stencilReadMask||4294967295,n=Rd("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,n,0,e),i.stencilFuncSeparate(1029,n,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const e=Id("stencilPassOperation",t.stencilPassOperation),n=Id("stencilFailOperation",t.stencilFailOperation),r=Id("stencilDepthFailOperation",t.stencilDepthFailOperation);i.stencilOpSeparate(1028,n,r,e),i.stencilOpSeparate(1029,n,r,e)}switch(t.blend){case!0:i.enable(3042);break;case!1:i.disable(3042)}if(t.blendColorOperation||t.blendAlphaOperation){const e=Md("blendColorOperation",t.blendColorOperation||"add"),n=Md("blendAlphaOperation",t.blendAlphaOperation||"add");i.blendEquationSeparate(e,n);const r=kd("blendColorSrcFactor",t.blendColorSrcFactor||"one"),s=kd("blendColorDstFactor",t.blendColorDstFactor||"zero"),o=kd("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=kd("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");i.blendFuncSeparate(r,s,o,a)}}(e,t),Zh(r.gl,n),i(e)}finally{r.popState()}}function Rd(e,t){return Ld(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Id(e,t){return Ld(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Md(e,t){return Ld(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function kd(e,t,n="color"){return Ld(e,t,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:"color"===n?32769:32771,"one-minus-constant":"color"===n?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function Ld(e,t,n){if(!(t in n))throw new Error(function(e,t){return`Illegal parameter ${t} for ${e}`}(e,t));return n[t]}function Bd(e){const t={};return e.addressModeU&&(t[10242]=Dd(e.addressModeU)),e.addressModeV&&(t[10243]=Dd(e.addressModeV)),e.addressModeW&&(t[32882]=Dd(e.addressModeW)),e.magFilter&&(t[10240]=Od(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=function(e,t="none"){if(!t)return Od(e);switch(t){case"none":return Od(e);case"nearest":switch(e){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(e){case"nearest":return 9986;case"linear":return 9987}}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[33082]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[33083]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[34892]=34894),e.compare&&(t[34893]=Rd("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function Dd(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Od(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}class Nd extends fi{constructor(e,t){super(e,t),i(this,"device"),i(this,"handle"),i(this,"parameters"),this.device=e,this.parameters=Bd(t),this.handle=t.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const e=Number(t);switch(e){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,e,n);break;default:this.device.gl.samplerParameteri(this.handle,e,n)}}}}function Fd(e,t,n){if(function(e){for(const t in e)return!1;return!0}(t))return n(e);const{nocatch:i=!0}=t,r=td.get(e);let s;if(r.push(),Zh(e,t),i)s=n(e),r.pop();else try{s=n(e)}finally{r.pop()}return s}class Ud extends vi{constructor(e,t){super(e,{...mi.defaultProps,...t}),i(this,"device"),i(this,"gl"),i(this,"handle"),i(this,"texture"),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}class Gd extends mi{constructor(e,t){super(e,t),i(this,"device"),i(this,"gl"),i(this,"handle"),i(this,"sampler"),i(this,"view"),i(this,"glTarget"),i(this,"glFormat"),i(this,"glType"),i(this,"glInternalFormat"),i(this,"compressed"),i(this,"_textureUnit",0),this.device=e,this.gl=this.device.gl;const n=gd(this.props.format);this.glTarget=function(e){switch(e){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(e)}(this.props.dimension),this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:r,width:s,height:o,depth:a,mipLevels:A,glTarget:l,glInternalFormat:c}=this;switch(r){case"2d":case"cube":this.gl.texStorage2D(l,A,c,s,o);break;case"2d-array":case"3d":this.gl.texStorage3D(l,A,c,s,o,a);break;default:throw new Error(r)}this.gl.bindTexture(this.glTarget,null),this._initializeData(t.data),this.setSampler(this.props.sampler),this.view=new Ud(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new Ud(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const t=Bd(this.sampler.props);this._setSamplerParameters(t)}copyImageData(e){const t=this._normalizeCopyImageDataOptions(e),n=t.data,{width:i,height:r,depth:s}=this,{mipLevel:o=0,byteOffset:a=0,x:A=0,y:l=0,z:c=0}=t,{glFormat:u,glType:h,compressed:d}=this,f=zd(this.glTarget,this.dimension,c);let p;if(!this.compressed){const{bytesPerPixel:e}=this.device.getTextureFormatInfo(this.format);if(e){if(t.bytesPerRow%e!==0)throw new Error(`bytesPerRow (${t.bytesPerRow}) must be a multiple of bytesPerPixel (${e}) for ${this.format}`);p=t.bytesPerRow/e}}const g=this.compressed?{}:{...void 0!==p?{3314:p}:{},32878:t.rowsPerImage};this.gl.bindTexture(f,this.handle),Fd(this.gl,g,()=>{switch(this.dimension){case"2d":case"cube":d?this.gl.compressedTexSubImage2D(f,o,A,l,i,r,u,n,a):this.gl.texSubImage2D(f,o,A,l,i,r,u,h,n,a);break;case"2d-array":case"3d":d?this.gl.compressedTexSubImage3D(f,o,A,l,c,i,r,s,u,n,a):this.gl.texSubImage3D(f,o,A,l,c,i,r,s,u,h,n,a)}}),this.gl.bindTexture(f,null)}copyExternalImage(e){const t=this._normalizeCopyExternalImageOptions(e);if(t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:n,glType:i}=this,{image:r,depth:s,mipLevel:o,x:a,y:A,z:l,width:c,height:u}=t,h=zd(this.glTarget,this.dimension,s),d=t.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),Fd(this.gl,d,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(h,o,a,A,c,u,n,i,r);break;case"2d-array":case"3d":this.gl.texSubImage3D(h,o,a,A,l,c,u,s,n,i,r)}}),this.gl.bindTexture(this.glTarget,null),{width:t.width,height:t.height}}generateMipmapsWebGL(e){if(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format)||(bn.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),null==e?void 0:e.force))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(t){bn.warn(`Error generating mipmap for ${this}: ${t.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){bn.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,n]of Object.entries(e)){const e=Number(t),i=n;switch(e){case 33082:case 33083:this.gl.texParameterf(this.glTarget,e,i);break;case 10240:case 10241:case 10242:case 10243:case 32882:case 34892:case 34893:this.gl.texParameteri(this.glTarget,e,i);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,e,i)}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:t}=this;return void 0!==e&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:t}=this;return void 0!==e&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}function zd(e,t,n){return"cube"===t?34069+n:e}function Vd(e){return Hd[e]}function Wd(e){return Boolean(Xd[e])}function jd(e){return Xd[e]}const Hd={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},Xd={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},Qd={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function $d(e,t){const n={attributes:[],bindings:[]};n.attributes=function(e,t){const n=[],i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r);if(!i)throw new Error("activeInfo");const{name:s,type:o}=i,a=e.getAttribLocation(t,s);if(a>=0){const e=Vd(o),t=/instance/i.test(s)?"instance":"vertex";n.push({name:s,location:a,stepMode:t,type:e})}}return n.sort((e,t)=>e.location-t.location),n}(e,t);const i=function(e,t){const n=(n,i)=>e.getActiveUniformBlockParameter(t,n,i),i=[],r=e.getProgramParameter(t,35382);for(let s=0;s<r;s++){const r={name:e.getActiveUniformBlockName(t,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},o=n(s,35395)||[],a=e.getActiveUniforms(t,o,35383),A=e.getActiveUniforms(t,o,35384),l=e.getActiveUniforms(t,o,35387),c=e.getActiveUniforms(t,o,35388);for(let n=0;n<r.uniformCount;++n){const i=e.getActiveUniform(t,o[n]);if(!i)throw new Error("activeInfo");const s=Vd(a[n]);r.uniforms.push({name:i.name,format:s,type:a[n],arrayLength:A[n],byteOffset:l[n],byteStride:c[n]})}i.push(r)}return i.sort((e,t)=>e.location-t.location),i}(e,t);for(const a of i){const e=a.uniforms.map(e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength}));n.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:e})}const r=function(e,t){const n=[],i=e.getProgramParameter(t,35718);for(let r=0;r<i;r++){const i=e.getActiveUniform(t,r);if(!i)throw new Error("activeInfo");const{name:s,size:o,type:a}=i,{name:A,isArray:l}=Yd(s);let c=e.getUniformLocation(t,A);const u={location:c,name:A,size:o,type:a,isArray:l};if(n.push(u),u.size>1)for(let r=0;r<u.size;r++){const i=`${A}[${r}]`;c=e.getUniformLocation(t,i);const s={...u,name:i,location:c};n.push(s)}}return n}(e,t);let s=0;for(const a of r)if(Wd(a.type)){const{viewDimension:e,sampleType:t}=jd(a.type);n.bindings.push({type:"texture",name:a.name,group:0,location:s,viewDimension:e,sampleType:t}),a.textureUnit=s,s+=1}r.length&&(n.uniforms=r);const o=function(e,t){const n=[],i=e.getProgramParameter(t,35971);for(let r=0;r<i;r++){const i=e.getTransformFeedbackVarying(t,r);if(!i)throw new Error("activeInfo");const{name:s,type:o,size:a}=i,A=Vd(o),{type:l,components:c}=Ni(A);n.push({location:r,name:s,type:l,size:a*c})}return n.sort((e,t)=>e.location-t.location),n}(e,t);return(null==o?void 0:o.length)&&(n.varyings=o),n}function Yd(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function Kd(e,t,n,i){const r=e;let s=i;!0===s&&(s=1),!1===s&&(s=0);const o="number"==typeof s?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if("number"!=typeof i)throw new Error("samplers must be set to integers");return e.uniform1i(t,i);case 5126:return e.uniform1fv(t,o);case 35664:return e.uniform2fv(t,o);case 35665:return e.uniform3fv(t,o);case 35666:return e.uniform4fv(t,o);case 5124:case 35670:return e.uniform1iv(t,o);case 35667:case 35671:return e.uniform2iv(t,o);case 35668:case 35672:return e.uniform3iv(t,o);case 35669:case 35673:return e.uniform4iv(t,o);case 5125:return r.uniform1uiv(t,o,1);case 36294:return r.uniform2uiv(t,o,2);case 36295:return r.uniform3uiv(t,o,3);case 36296:return r.uniform4uiv(t,o,4);case 35674:return e.uniformMatrix2fv(t,!1,o);case 35675:return e.uniformMatrix3fv(t,!1,o);case 35676:return e.uniformMatrix4fv(t,!1,o);case 35685:return r.uniformMatrix2x3fv(t,!1,o);case 35686:return r.uniformMatrix2x4fv(t,!1,o);case 35687:return r.uniformMatrix3x2fv(t,!1,o);case 35688:return r.uniformMatrix3x4fv(t,!1,o);case 35689:return r.uniformMatrix4x2fv(t,!1,o);case 35690:return r.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}class Zd extends Pi{constructor(e,t){super(e,t),i(this,"device"),i(this,"handle"),i(this,"vs"),i(this,"fs"),i(this,"introspectedLayout"),i(this,"uniforms",{}),i(this,"bindings",{}),i(this,"varyings",null),i(this,"_uniformCount",0),i(this,"_uniformSetters",{}),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:r=35981}=t;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,r)),this._linkShaders(),bn.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=$d(this.device.gl,this.handle),bn.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=t.shaderLayout?function(e,t){const n={...e,attributes:e.attributes.map(e=>({...e}))};for(const i of(null==t?void 0:t.attributes)||[]){const e=n.attributes.find(e=>e.name===i.name);e?(e.type=i.type||e.type,e.stepMode=i.stepMode||e.stepMode):bn.warn(`shader layout attribute ${i.name} not present in shader`)}return n}(this.introspectedLayout,t.shaderLayout):this.introspectedLayout}get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,t){for(const[n,i]of Object.entries(e)){const e=this.shaderLayout.bindings.find(e=>e.name===n)||this.shaderLayout.bindings.find(e=>e.name===`${n}Uniforms`);if(!e){const e=this.shaderLayout.bindings.map(e=>`"${e.name}"`).join(", ");(null==t?void 0:t.disableWarnings)||bn.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${e}`,i)();continue}switch(i||bn.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),e.type){case"uniform":if(!(i instanceof Td||i.buffer instanceof Td))throw new Error("buffer value");break;case"texture":if(!(i instanceof Ud||i instanceof Gd||i instanceof bd))throw new Error(`${this} Bad texture binding for ${n}`);break;case"sampler":bn.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(e.type)}this.bindings[n]=i}}draw(e){var t;const{renderPass:n,parameters:i=this.props.parameters,topology:r=this.props.topology,vertexArray:s,vertexCount:o,instanceCount:a,isInstanced:A=!1,firstVertex:l=0,transformFeedback:c}=e,u=function(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}(r),h=Boolean(s.indexBuffer),d=null==(t=s.indexBuffer)?void 0:t.glIndexType;if("success"!==this.linkStatus)return bn.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return bn.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),s.bindBeforeRender(n),c&&c.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const f=n;return Pd(this.device,i,f.glParameters,()=>{h&&A?this.device.gl.drawElementsInstanced(u,o||0,d,l,a||0):h?this.device.gl.drawElements(u,o||0,d,l):A?this.device.gl.drawArraysInstanced(u,l,o||0,a||0):this.device.gl.drawArrays(u,l,o||0),c&&c.end()}),s.unbindAfterRender(n),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),bn.time(4,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),bn.timeEnd(4,`linkProgram for ${this.id}`)(),bn.level,!this.device.features.has("compilation-status-async-webgl")){const e=this._getLinkStatus();return void this._reportLinkStatus(e)}bn.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),bn.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){var t;if("success"!==e){const n="link-error"===e?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${n} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader()}switch(null==(t=this.fs)?void 0:t.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${n} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader()}const i=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${n} during ${e}: ${i}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;if(!e.getProgramParameter(this.handle,35714))return this.linkStatus="error","link-error";e.validateProgram(this.handle);return e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")}async _waitForLinkComplete(){const e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl"))return void(await e(10));const{gl:t}=this.device;for(;;){if(t.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)this.bindings[t.name]||this.bindings[t.name.replace(/Uniforms$/,"")]||(bn.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if("success"!==this.linkStatus)return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,n=0;for(const i of this.shaderLayout.bindings){const r=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!r)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:s}=i,o=e.getUniformBlockIndex(this.handle,s);if(4294967295===o)throw new Error(`Invalid uniform block name ${s}`);e.uniformBlockBinding(this.handle,n,o),r instanceof Td?e.bindBufferBase(35345,n,r.handle):e.bindBufferRange(35345,n,r.buffer.handle,r.offset||0,r.size||r.buffer.byteLength-r.offset),n+=1;break;case"texture":if(!(r instanceof Ud||r instanceof Gd||r instanceof bd))throw new Error("texture");let a;if(r instanceof Ud)a=r.texture;else if(r instanceof Gd)a=r;else{if(!(r instanceof bd&&r.colorAttachments[0]instanceof Ud))throw new Error("No texture");bn.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),a=r.colorAttachments[0].texture}e.activeTexture(33984+t),e.bindTexture(a.glTarget,a.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:n,type:i,textureUnit:r}=e,s=this.uniforms[t]??r;void 0!==s&&Kd(this.device.gl,n,i,s)}}}class qd extends Oi{constructor(e){super(e,{}),i(this,"device"),i(this,"handle",null),i(this,"commands",[]),this.device=e}_executeCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":Jd(this.device,t.options);break;case"copy-buffer-to-texture":ef(this.device,t.options);break;case"copy-texture-to-buffer":tf(this.device,t.options);break;case"copy-texture-to-texture":nf(this.device,t.options);break;default:throw new Error(t.name)}}}function Jd(e,t){const n=t.sourceBuffer,i=t.destinationBuffer;e.gl.bindBuffer(36662,n.handle),e.gl.bindBuffer(36663,i.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function ef(e,t){throw new Error("Not implemented")}function tf(e,t){const{sourceTexture:n,mipLevel:i=0,aspect:r="all",width:s=t.sourceTexture.width,height:o=t.sourceTexture.height,depthOrArrayLayers:a=0,origin:A=[0,0],destinationBuffer:l,byteOffset:c=0,bytesPerRow:u,rowsPerImage:h}=t;if("all"!==r)throw new Error("aspect not supported in WebGL");if(0!==i||0!==a||u||h)throw new Error("not implemented");const{framebuffer:d,destroyFramebuffer:f}=rf(n);let p;try{const t=l,n=s||d.width,i=o||d.height,r=gd(d.colorAttachments[0].texture.props.format),a=r.format,u=r.type;e.gl.bindBuffer(35051,t.handle),p=e.gl.bindFramebuffer(36160,d.handle),e.gl.readPixels(A[0],A[1],n,i,a,u,c)}finally{e.gl.bindBuffer(35051,null),void 0!==p&&e.gl.bindFramebuffer(36160,p),f&&d.destroy()}}function nf(e,t){const{sourceTexture:n,destinationMipLevel:i=0,origin:r=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=t;let{width:a=t.destinationTexture.width,height:A=t.destinationTexture.height}=t;const{framebuffer:l,destroyFramebuffer:c}=rf(n),[u,h]=r,[d,f,p]=s,g=e.gl.bindFramebuffer(36160,l.handle);let m,_;if(!(o instanceof Gd))throw new Error("invalid destination");switch(m=o,a=Number.isFinite(a)?a:m.width,A=Number.isFinite(A)?A:m.height,m._bind(0),_=m.glTarget,_){case 3553:case 34067:e.gl.copyTexSubImage2D(_,i,d,f,u,h,a,A);break;case 35866:case 32879:e.gl.copyTexSubImage3D(_,i,d,f,p,u,h,a,A)}m&&m._unbind(),e.gl.bindFramebuffer(36160,g),c&&l.destroy()}function rf(e){if(e instanceof mi){const{width:t,height:n,id:i}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${i}`,width:t,height:n,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}const sf=[1,2,4,8];class of extends Ii{constructor(e,t){var n;let r;if(super(e,t),i(this,"device"),i(this,"handle",null),i(this,"glParameters",{}),this.device=e,!(null==(n=null==t?void 0:t.parameters)?void 0:n.viewport))if(null==t?void 0:t.framebuffer){const{width:e,height:n}=t.framebuffer;r=[0,0,e,n]}else{const[t,n]=e.getDefaultCanvasContext().getDrawingBufferSize();r=[0,0,t,n]}this.device.pushState(),this.setParameters({viewport:r,...this.props.parameters});const s=this.props.framebuffer;if(this.props.framebuffer&&(null==s?void 0:s.handle)){const e=this.props.framebuffer.colorAttachments.map((e,t)=>36064+t);this.device.gl.drawBuffers(e)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(t[2967]=e.stencilReference),"colorMask"in e&&(t.colorMask=sf.map(t=>Boolean(t&e.colorMask))),this.glParameters=t,Zh(this.device.gl,t)}beginOcclusionQuery(e){const t=this.props.occlusionQuerySet;null==t||t.beginOcclusionQuery()}endOcclusionQuery(){const e=this.props.occlusionQuerySet;null==e||e.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((e,t)=>{e&&this.clearColorBuffer(t,e)}),!1!==this.props.clearColor&&void 0===this.props.clearColors&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&Fd(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){Fd(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class af extends Bi{constructor(e,t){super(e,t),i(this,"device"),i(this,"handle",null),i(this,"commandBuffer"),this.device=e,this.commandBuffer=new qd(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new of(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,n){}}class Af extends ji{constructor(e,t){super(e,t),i(this,"device"),i(this,"handle"),i(this,"buffer",null),i(this,"bufferValue",null),this.device=e,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(e){return"Chrome"==(b()?y()?"Electron":(v.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node")}destroy(){var e;super.destroy(),this.buffer&&(null==(e=this.buffer)||e.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&34963!==t.glTarget)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const n=t;if(34963===n.glTarget)throw new Error("Use .setIndexBuffer()");const{size:i,type:r,stride:s,offset:o,normalized:a,integer:A,divisor:l}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),A?this.device.gl.vertexAttribIPointer(e,i,r,s,o):this.device.gl.vertexAttribPointer(e,i,r,a,s,o),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,l||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const n=ad(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}}_enable(e,t=!0){const n=Af.isConstantAttributeZeroSupported(this.device);(t||(n||0!==e))&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const n=function(e){if(Array.isArray(e))return new Float32Array(e);return e}(t),i=n.byteLength*e,r=n.length*e;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),s||(s=!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,this.bufferValue)),s){const e=function(e,t){return new e(Ki(e.BYTES_PER_ELEMENT*t),0,t)}(t.constructor,r);!function(e){const{target:t,source:n,start:i=0,count:r=1}=e,s=n.length,o=r*s;let a=0;for(let A=i;a<s;a++)t[A++]=n[a];for(;a<o;)a<o-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+o-a),a=o);e.target}({target:e,source:n,start:0,count:r}),this.buffer.write(e),this.bufferValue=t}return this.buffer}}class lf extends Xi{constructor(e,t){super(e,t),i(this,"device"),i(this,"gl"),i(this,"handle"),i(this,"layout"),i(this,"buffers",{}),i(this,"unusedBuffers",{}),i(this,"bindOnUse",!0),i(this,"_bound",!1),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return 0;case"line-list":case"line-strip":return 1;case"triangle-list":case"triangle-strip":return 4;default:throw new Error(e)}}(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:i,byteLength:r,byteOffset:s}=this._getBufferRange(t);if(n<0)return this.unusedBuffers[e]=i,void bn.warn(`${this.id} unusedBuffers varying buffer ${e}`)();this.buffers[n]={buffer:i,byteLength:r,byteOffset:s},this.bindOnUse||this._bindBuffer(n,i,s,r)}getBuffer(e){if(cf(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if("function"!=typeof e)return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Td)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:i}}_getVaryingIndex(e){if(cf(e))return Number(e);for(const t of this.layout.varyings||[])if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,i,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,n=0,i){const r=t&&t.handle;r&&void 0!==i?this.gl.bindBufferRange(35982,e,r,n,i):this.gl.bindBufferBase(35982,e,r)}}function cf(e){return"number"==typeof e?Number.isInteger(e):/^\d+$/.test(e)}class uf extends Yi{constructor(e,t){if(super(e,t),i(this,"device"),i(this,"handle"),i(this,"target",null),i(this,"_queryPending",!1),i(this,"_pollingPromise",null),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");const n=this.device.gl.createQuery();if(!n)throw new Error("WebGL query not supported");this.handle=n,Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin((null==e?void 0:e.conservative)?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((n,i)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)}),this._pollingPromise}}function hf(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}const df={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function ff(e,t){var n;const{sourceX:i=0,sourceY:r=0,sourceAttachment:s=0}=t||{};let{target:o=null,sourceWidth:a,sourceHeight:A,sourceDepth:l,sourceFormat:c,sourceType:u}=t||{};const{framebuffer:h,deleteFramebuffer:d}=pf(e),{gl:f,handle:p}=h;a||(a=h.width),A||(A=h.height);const g=null==(n=h.colorAttachments[s])?void 0:n.texture;if(!g)throw new Error(`Invalid framebuffer attachment ${s}`);l=(null==g?void 0:g.depth)||1,c||(c=(null==g?void 0:g.glFormat)||6408),u||(u=(null==g?void 0:g.glType)||5121),o=function(e,t,n,i,r){if(e)return e;t||(t=5121);const s=In((a=t,df[a])),o=hf(n);var a;return new s(i*r*o)}(o,u,c,a,A);const m=Rn(o);u=u||Qd[m];const _=f.bindFramebuffer(36160,p);return f.readBuffer(36064+s),f.readPixels(i,r,a,A,c,u,o),f.readBuffer(36064),f.bindFramebuffer(36160,_||null),d&&h.destroy(),o}function pf(e){return e instanceof Si?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:gf(e),deleteFramebuffer:!0}}function gf(e,t){const{device:n,width:i,height:r,id:s}=e;return n.createFramebuffer({...t,id:`framebuffer-for-${s}`,width:i,height:r,colorAttachments:[e]})}class mf extends ti{constructor(e){var t,n;super({...e,id:e.id||xd("webgl-device")}),i(this,"type","webgl"),i(this,"handle"),i(this,"features"),i(this,"limits"),i(this,"info"),i(this,"canvasContext"),i(this,"preferredColorFormat","rgba8unorm"),i(this,"preferredDepthFormat","depth24plus"),i(this,"commandEncoder"),i(this,"lost"),i(this,"_resolveContextLost"),i(this,"gl"),i(this,"_constants"),i(this,"_extensions",{}),i(this,"_polyfilled",!1),i(this,"spectorJS");const r=ti._getCanvasContextProps(e);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=null==(n=null==(t=r.canvas)?void 0:t.gl)?void 0:n.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new wd(this,r),this.lost=new Promise(e=>{this._resolveContextLost=e});const o={...e.webgl};"premultiplied"===r.alphaMode&&(o.premultipliedAlpha=!0),void 0!==e.powerPreference&&(o.powerPreference=e.powerPreference);const a=this.props._handle||function(e,t,n){let i="";const r={preserveDrawingBuffer:!0,...n};let s=null;if(s||(s=e.getContext("webgl2",r)),r.failIfMajorPerformanceCaveat&&(i||(i="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),s||n.failIfMajorPerformanceCaveat||(r.failIfMajorPerformanceCaveat=!1,s=e.getContext("webgl2",r),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=e.getContext("webgl",{}),s&&(s=null,i||(i="Your browser only supports WebGL1"))),!s)throw i||(i="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:o,onContextRestored:a}=t;return e.addEventListener("webglcontextlost",e=>o(e),!1),e.addEventListener("webglcontextrestored",e=>a(e),!1),s.luma||(s.luma={}),s}(this.canvasContext.canvas,{onContextLost:e=>{var t;return null==(t=this._resolveContextLost)?void 0:t.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:e=>{}},o);if(!a)throw new Error("WebGL context creation failed");if(s=a.device,s){if(e._reuseDevices)return bn.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=a,this.gl=a,this.spectorJS=function(e){var t;if(!(e={...Ih,...e}).debugSpectorJS)return null;if(!Ph&&globalThis.SPECTOR&&!(null==(t=globalThis.luma)?void 0:t.spector)){bn.probe(1,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;Ph=new e,globalThis.luma&&(globalThis.luma.spector=Ph)}if(!Ph)return null;if(Rh||(Rh=!0,Ph.spyCanvases(),null==Ph||Ph.onCaptureStarted.add(e=>bn.info("Spector capture started:",e)()),null==Ph||Ph.onCapture.add(e=>{bn.info("Spector capture complete:",e)(),null==Ph||Ph.getResultUI(),null==Ph||Ph.resultView.display(),null==Ph||Ph.resultView.addCapture(e)})),e.gl){const t=e.gl,n=t.device;null==Ph||Ph.startCapture(e.gl,500),t.device=n,new Promise(e=>setTimeout(e,2e3)).then(e=>{bn.info("Spector capture stopped after 2 seconds")(),null==Ph||Ph.stopCapture()})}return Ph}({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=sd(this.gl,this._extensions),this.limits=new yd(this.gl),this.features=new vd(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures();new td(this.gl,{log:(...e)=>bn.log(1,...e)()}).trackState(this.gl,{copyState:!1});const A=e.debugWebGL||e.debug,l=e.debugWebGL;A&&(this.gl=kh(this.gl,{debugWebGL:A,traceWebGL:l}),bn.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(bn.level=Math.max(bn.level,1))),this.commandEncoder=new af(this,{id:`${this}-command-encoder`})}get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){return"unorm8x4-bgra"!==e}destroy(){this.props._reuseDevices||this._reused||delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new Td(this,t)}createTexture(e){return new Gd(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new Nd(this,e)}createShader(e){return new Cd(this,e)}createFramebuffer(e){return new bd(this,e)}createVertexArray(e){return new Af(this,e)}createTransformFeedback(e){return new lf(this,e)}createQuerySet(e){return new uf(this,e)}createRenderPipeline(e){return new Zd(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new af(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,t){return ff(e,t)}readPixelsToBufferWebGL(e,t){return function(e,t){const{target:n,sourceX:i=0,sourceY:r=0,sourceFormat:s=6408,targetByteOffset:o=0}=t||{};let{sourceWidth:a,sourceHeight:A,sourceType:l}=t||{};const{framebuffer:c,deleteFramebuffer:u}=pf(e);a=a||c.width,A=A||c.height;const h=c;l=l||5121;let d=n;if(!d){const e=o+a*A*hf(s)*function(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}(l);d=h.device.createBuffer({byteLength:e})}const f=e.device.createCommandEncoder();return f.copyTextureToBuffer({sourceTexture:e,width:a,height:A,origin:[i,r],destinationBuffer:d,byteOffset:o}),f.destroy(),u&&c.destroy(),d}(e,t)}setParametersWebGL(e){Zh(this.gl,e)}getParametersWebGL(e){return qh(this.gl,e)}withParametersWebGL(e,t){return Fd(this.gl,e,t)}resetWebGL(){bn.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),Zh(this.gl,Nh)}_getDeviceSpecificTextureFormatCapabilities(e){return function(e,t,n){let i=t.create;const r=pd[t.format];return void 0===(null==r?void 0:r.gl)&&(i=!1),(null==r?void 0:r.x)&&(i=i&&Boolean(rd(e,r.x,n))),{format:t.format,create:i&&t.create,render:i&&t.render,filter:i&&t.filter,blend:i&&t.blend,store:i&&t.store}}(this.gl,e,this._extensions)}loseDevice(){var e;let t=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),null==(e=this._resolveContextLost)||e.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){td.get(this.gl).push()}popState(){td.get(this.gl).pop()}getGLKey(e,t){const n=Number(e);for(const i in this.gl)if(this.gl[i]===n)return`GL.${i}`;return(null==t?void 0:t.emptyIfUnknown)?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((e,[n,i])=>(e[`${n}:${this.getGLKey(n,t)}`]=`${i}:${this.getGLKey(i,t)}`,e),{})}setConstantAttributeWebGL(e,t){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const i=this._constants[e];switch(i&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(i,t)&&bn.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,n){switch(n.length){case 1:e.gl.vertexAttrib1fv(t,n);break;case 2:e.gl.vertexAttrib2fv(t,n);break;case 3:e.gl.vertexAttrib3fv(t,n);break;case 4:e.gl.vertexAttrib4fv(t,n)}}(this,e,t);break;case Int32Array:!function(e,t,n){e.gl.vertexAttribI4iv(t,n)}(this,e,t);break;case Uint32Array:!function(e,t,n){e.gl.vertexAttribI4uiv(t,n)}(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return rd(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,t,n){e.luma=t;const i={props:n.spector,id:n.spector.id};e.__SPECTOR_Metadata=i}}const _f=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:mf},Symbol.toStringTag,{value:"Module"}));function vf(){}const yf={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:vf,onWebGLInitialized:vf,onResize:vf,onViewStateChange:vf,onInteractionStateChange:vf,onBeforeRender:vf,onAfterRender:vf,onLoad:vf,onError:e=>Mt.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class bf{constructor(e){var t;this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new he({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{const{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;{const n=e.offsetCenter;if(!n)return;t.x=n.x,t.y=n.y,t.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{const t=BA[e.type],n=e.offsetCenter;if(!t||!n||!this.layerManager)return;const i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:i,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:s}=r,o=s&&(s[t]||s.props[t]),a=this.props[t];let A=!1;o&&(A=o.call(s,r,e)),A||(null==a||a(r,e),this.widgetManager.onEvent(r,e))},this._onPointerDown=e=>{var t;if("webgpu"===(null==(t=this.device)?void 0:t.type))return;const n=e.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props={...yf,...e},(e=this.props).viewState&&e.initialViewState&&Mt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;if(!n&&e.gl){e.gl instanceof WebGLRenderingContext&&Mt.error("WebGL1 context not supported.")();const i=null==(t=this.props.deviceProps)?void 0:t.onResize;n=Oh.attach(e.gl,{...this.props.deviceProps,onResize:(e,t)=>{const{width:n,height:r}=e.canvas;e.drawingBufferWidth=n,e.drawingBufferHeight=r,this._needsRedraw="Canvas resized",null==i||i(e,t)}})}n||(n=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&oc.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,n,i,r,s,o,a,A,l;null==(e=this.animationLoop)||e.stop(),null==(t=this.animationLoop)||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,null==(n=this.layerManager)||n.finalize(),this.layerManager=null,null==(i=this.viewManager)||i.finalize(),this.viewManager=null,null==(r=this.effectManager)||r.finalize(),this.effectManager=null,null==(s=this.deckRenderer)||s.finalize(),this.deckRenderer=null,null==(o=this.deckPicker)||o.finalize(),this.deckPicker=null,null==(a=this.eventManager)||a.destroy(),this.eventManager=null,null==(A=this.widgetManager)||A.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas||(null==(l=this.canvas.parentElement)||l.removeChild(this.canvas),this.canvas=null)}setProps(e){var t,n,i,r,s,o,a;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Mt.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Mt.removed("onLayerClick","onClick")(),e.initialViewState&&!Eu(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const A=Object.create(this.props);Object.assign(A,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==(null==(t=this.device)?void 0:t.id)&&(null==(n=this.animationLoop)||n.stop(),this.canvas!==(null==(i=e.device.canvasContext)?void 0:i.canvas)&&(null==(r=this.canvas)||r.remove(),null==(s=this.eventManager)||s.destroy(),this.canvas=null),Mt.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),null==(o=this.animationLoop)||o.setProps(A),void 0!==e.useDevicePixels&&(null==(a=this.device)?void 0:a.canvasContext)&&this.device.canvasContext.setProps({useDevicePixels:e.useDevicePixels}),this.layerManager&&(this.viewManager.setProps(A),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(A),this.effectManager.setProps(A),this.deckRenderer.setProps(A),this.deckPicker.setProps(A),this.widgetManager.setProps(A)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),r=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return t=t||n||i||r||s,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return Ou(this.viewManager),this.viewManager.views}getViewports(e){return Ou(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;null==(t=this.layerManager)||t.removeDefaultShaderModule(e)}_pick(e,t,n){Ou(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const r=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(t).timeEnd(),r}_createCanvas(e){let t=e.canvas;if("string"==typeof t&&(t=document.getElementById(t),Ou(t)),!t){t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",e.width&&"number"==typeof e.width&&(t.width=e.width),e.height&&"number"==typeof e.height&&(t.height=e.height);(e.parent||document.body).appendChild(t)}return Object.assign(t.style,e.style),t}_setCanvasSize(e){var t;if(!this.canvas)return;const{width:n,height:i}=e;if(n||0===n){const e=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=e}if(i||0===i){const n=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=(null==(t=e.style)?void 0:t.position)||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){var e,t;const{canvas:n}=this;if(!n)return;const i=n.clientWidth??n.width,r=n.clientHeight??n.height;i===this.width&&r===this.height||(this.width=i,this.height=r,null==(e=this.viewManager)||e.setProps({width:i,height:r}),null==(t=this.layerManager)||t.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:r}))}_createAnimationLoop(e,t){const{gl:n,onError:i}=t;return new Pc({device:e,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:i})}_createDevice(e){var t,n,i;const r=null==(t=this.props.deviceProps)?void 0:t.createCanvasContext,s="object"==typeof r?r:void 0,o={adapters:[],_cacheShaders:!0,_cachePipelines:!0,...e.deviceProps};o.adapters.includes(Oh)||o.adapters.push(Oh);const a={alphaMode:"webgpu"===(null==(n=this.props.deviceProps)?void 0:n.type)?"premultiplied":void 0},A=null==(i=this.props.deviceProps)?void 0:i.onResize;return ri.createDevice({_reuseDevices:!0,type:"webgl",...o,createCanvasContext:{...a,...s,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0},onResize:(e,t)=>{this._needsRedraw="Canvas resized",null==A||A(e,t)}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new eh({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var e,t,n,i;if("webgpu"===(null==(e=this.device)?void 0:e.type))return;const{_pickRequest:r}=this;if(r.event){const{result:e,emptyInfo:s}=this._pick("pickObject","pickObject Time",r);this.cursorState.isHovering=e.length>0;let o=s,a=!1;for(const n of e)o=n,a=(null==(t=n.layer)?void 0:t.onHover(n,r.event))||a;a||(null==(i=(n=this.props).onHover)||i.call(n,o,r.event),this.widgetManager.onHover(o,r.event)),r.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var t,n;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=null==(t=this.device.canvasContext)?void 0:t.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),"webgl"===this.device.type&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),"webgl"===this.device.type&&this.props.onWebGLInitialized(this.device.gl);const i=new Tc;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new IA(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(DA).map(e=>{var t;const[n,i,r,s]=DA[e];return{recognizer:new n({...i,...null==(t=this.props.eventRecognizerOptions)?void 0:t[e],event:e}),recognizeWith:r,requestFailure:s}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in BA)this.eventManager.on(s,this._onEvent);this.viewManager=new xu({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new wu(this.device,{deck:this,stats:this.stats,viewport:r,timeline:i}),this.effectManager=new nh({deck:this,device:this.device}),this.deckRenderer=new rh(this.device),this.deckPicker=new uh(this.device),this.widgetManager=new ph({deck:this,parentElement:null==(n=this.canvas)?void 0:n.parentElement}),this.widgetManager.addDefault(new vh),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var n;const{device:i,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:r});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};null==(n=this.deckRenderer)||n.renderLayers(s),"screen"===s.pass&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:i,gl:r})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),Mt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),"webgpu"!==(null==(e=this.device)?void 0:e.type)&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=ri.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}bf.defaultProps=yf,bf.VERSION=Ot;const wf=Rn;function Ef(e,t,n){const i="webgpu"===n&&"uint8"===t.type?"unorm8":t.type;return{attribute:e,format:t.size>1?`${i}x${t.size}`:t.type,byteOffset:t.offset||0}}function xf(e){return e.stride||e.size*e.bytesPerElement}function Tf(e,t){t.offset&&Mt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=xf(e),i=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*n+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:i,stride:n}}class Sf{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,r="float64"===i;let s,{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0),s=r?"float32":!i&&t.isIndexed?"uint32":i||"float32";let a=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return In(e)}}(i||s);this.doublePrecision=r,r&&!1===t.fp64&&(a=Float32Array),this.value=null,this.settings={...t,defaultType:a,defaultValue:o,logicalType:i,type:s,normalized:s.includes("norm"),size:this.size,bytesPerElement:a.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*xf(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),oc.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const n={};if(this.state.constant){const i=this.value;if(t){const r=Tf(this.getAccessor(),t),s=r.offset/i.BYTES_PER_ELEMENT,o=r.size||this.size;n[e]=i.subarray(s,s+o)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,t=null){const n=this.getAccessor(),i=[],r={name:this.id,byteStride:xf(n),attributes:i};if(this.doublePrecision){const r=function(e,t){const n=Tf(e,t);return{high:n,low:{...n,offset:n.offset+4*e.size}}}(n,t||{});i.push(Ef(e,{...n,...r.high},this.device.type),Ef(`${e}64Low`,{...n,...r.low},this.device.type))}else if(t){const r=Tf(n,t);i.push(Ef(e,{...n,...r},this.device.type))}else i.push(Ef(e,n,this.device.type));return r}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:i}=this,r=n*i;if(t&&r&&t.length>=r){const n=new Array(i).fill(1/0),s=new Array(i).fill(-1/0);for(let e=0;e<r;)for(let r=0;r<i;r++){const i=t[e++];i<n[r]&&(n[r]=i),i>s[r]&&(s[r]=i)}e=[n,s]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;n=ArrayBuffer.isView(e)?{value:e}:e instanceof Sn?{buffer:e}:e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type){if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const e=wf(n.value);i.type=i.normalized?e.replace("int","norm"):e}}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=xf(i)}if(t.bounds=null,n.constant){let e=n.value;e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e));if(!(!t.constant||!this._areValuesEqual(e,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(n.buffer){const e=n.buffer;t.externalBuffer=e,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let e=n.value;t.externalBuffer=null,t.constant=!1,this.value=e;let{buffer:r}=this;const s=xf(i),o=(i.vertexOffset||0)*s;if(this.doublePrecision&&e instanceof Float64Array&&(e=uc(e,i)),this.settings.isIndexed){const t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}const a=e.byteLength+o+2*s;(!r||r.byteLength<a)&&(r=this._createBuffer(a)),r.write(e,o)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?uc(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:n}=this,i=n.allocatedValue,r=oc.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=r;const{byteOffset:s}=this;let{buffer:o}=this;return(!o||o.byteLength<r.byteLength+s)&&(o=this._createBuffer(r.byteLength+s),t&&i&&o.write(i instanceof Float64Array?uc(i,this):i,s)),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);t instanceof n||!this.settings.normalized||"normalized"in e||Mt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(e).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(e=>e/255);case"unorm16":return new Float32Array(e).map(e=>e/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let e=r;for(;--e>=0;)t[n+e]=i[e];return t}switch(r){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let s=r;for(;--s>=0;)t[n+s]=Number.isFinite(e[s])?e[s]:i[s]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){var t;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:i}=this.settings;return this._buffer=this.device.createBuffer({...null==(t=this._buffer)?void 0:t.props,id:this.id,usage:(n?Sn.INDEX:Sn.VERTEX)|Sn.COPY_DST,indexType:n?i:void 0,byteLength:e}),this._buffer}}const Cf=[],Pf=[];function Rf(e,t=0,n=1/0){let i=Cf;const r={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?i=e:e.length>0&&(Pf.length=e.length,i=Pf):i=Cf,(t>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,n),r.index=t-1),{iterable:i,objectInfo:r}}function If(e){return e&&e[Symbol.asyncIterator]}function Mf(e,t){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=t,a=e.BYTES_PER_ELEMENT,A=i?i/a:n,l=r?r/a:0,c=Math.floor((e.length-l)/A);return(t,{index:i,target:r})=>{if(!s){const t=i*A+l;for(let i=0;i<n;i++)r[i]=e[t+i];return r}const a=s[i],u=s[i+1]||c;let h;if(o){h=new Array(u-a);for(let t=a;t<u;t++){const i=t*A+l;r=new Array(n);for(let t=0;t<n;t++)r[t]=e[i+t];h[t-a]=r}}else if(A===n)h=e.subarray(a*n+l,u*n+l);else{h=new e.constructor((u-a)*n);let t=0;for(let i=a;i<u;i++){const r=i*A+l;for(let i=0;i<n;i++)h[t++]=e[r+i]}}return h}}const kf=[],Lf=[[0,1/0]];const Bf={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function Df(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const n=e.type||"interpolation";return{...Bf[n],...t,...e,type:n}}class Of extends Sf{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Lf}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,n,i;(t=this.state).layoutChanged||(t.layoutChanged=(n=e,i=this.getAccessor(),!(n.type===i.type&&n.size===i.size&&xf(n)===xf(i)&&(n.offset||0)===(i.offset||0)))),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition;return Df(Array.isArray(t)?e[t.find(t=>e[t])]:e[t],n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:e=0,endRow:n=1/0}=t;this.state.updateRanges=function(e,t){if(e===Lf)return e;if(t[0]<0&&(t[0]=0),t[0]>=t[1])return e;const n=[],i=e.length;let r=0;for(let s=0;s<i;s++){const i=e[s];i[1]<t[0]?(n.push(i),r=s+1):i[0]>t[1]?n.push(i):t=[Math.min(i[0],t[0]),Math.max(i[1],t[1])]}return n.splice(r,0,t),n}(this.state.updateRanges,[e,n])}else this.state.updateRanges=Lf}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=kf}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return!n.noAlloc&&(!!n.update&&(super.allocate(e,t.updateRanges!==Lf),!0))}updateBuffer({numInstances:e,data:t,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:s,noAlloc:o}}=this;let a=!0;if(s){for(const[o,a]of r)s.call(i,this,{data:t,startRow:o,endRow:a,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[t,n]of r){const i=Number.isFinite(t)?this.getVertexOffset(t):0,r=Number.isFinite(n)?this.getVertexOffset(n):o||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:i,endOffset:r})}else;this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(e,t){const n="webgpu"===this.device.type;if(n||void 0===t||"function"==typeof t){if(n&&"function"!=typeof t){const e=this._normalizeValue(t,[],0);this._areValuesEqual(e,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const i=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:i})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;n.binaryValue=e,this.setNeedsRedraw();if(i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const r=e;Ou(ArrayBuffer.isView(r.value),`invalid ${i.accessor}`);const s=Boolean(r.size)&&r.size!==this.size;return n.binaryAccessor=Mf(r.value,{size:r.size||this.size,stride:r.stride,offset:r.offset,startIndices:t,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(n.stepMode="dynamic"===i?e?e.isInstanced?"instance":"vertex":"instance":i??"vertex",!t)return n;for(const r in t){const e=super._getBufferLayout(r,t[r]);n.attributes.push(...e.attributes)}return n}_autoUpdater(e,{data:t,startRow:n,endRow:i,props:r,numInstances:s}){if(e.constant&&"webgpu"!==this.context.device.type)return;const{settings:o,state:a,value:A,size:l,startIndices:c}=e,{accessor:u,transform:h}=o;let d=a.binaryAccessor||("function"==typeof u?u:r[u]);"function"!=typeof d&&"string"==typeof u&&(d=()=>r[u]),Ou("function"==typeof d,`accessor "${u}" is not a function`);let f=e.getVertexOffset(n);const{iterable:p,objectInfo:g}=Rf(t,n,i);for(const m of p){g.index++;let t=d(m,g);if(h&&(t=h.call(this,t)),c){const n=(g.index<c.length-1?c[g.index+1]:s)-c[g.index];if(t&&Array.isArray(t[0])){let n=f;for(const i of t)e._normalizeValue(i,A,n),n+=l}else t&&t.length>l?A.set(t,f):(e._normalizeValue(t,g.target,0),vu({target:A,source:g.target,start:f,count:n}));f+=n*l}else e._normalizeValue(t,A,f),f+=l}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||"function"==typeof e.update))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Nf(e){const{source:t,target:n,start:i=0,size:r,getData:s}=e,o=e.end||n.length,a=t.length,A=o-i;if(a>A)return void n.set(t.subarray(0,A),i);if(n.set(t,i),!s)return;let l=a;for(;l<A;){const e=s(l,t);for(let t=0;t<r;t++)n[i+l]=e[t]||0,l++}}function Ff(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function Uf(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Gf(e){e.push(e.shift())}function zf({device:e,source:t,target:n}){return(!n||n.byteLength<t.byteLength)&&(null==n||n.destroy(),n=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),n}function Vf({device:e,buffer:t,attribute:n,fromLength:i,toLength:r,fromStartIndices:s,getData:o=e=>e}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,A=n.size*a,l=n.byteOffset,c=n.settings.bytesPerElement<4?l/n.settings.bytesPerElement*4:l,u=n.startIndices,h=s&&u,d=n.isConstant;if(!h&&t&&i>=r)return t;const f=n.value instanceof Float64Array?Float32Array:n.value.constructor,p=d?n.value:new f(n.getBuffer().readSyncWebGL(l,r*f.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!d){const e=o;o=(t,i)=>n.normalizeConstant(e(t,i))}const g=d?(e,t)=>o(p,t):(e,t)=>o(p.subarray(e+l,e+l+A),t),m=t?new Float32Array(t.readSyncWebGL(c,4*i).buffer):new Float32Array(0),_=new Float32Array(r);return function({source:e,target:t,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!r||!s)return Nf({source:e,target:t,size:n,getData:i}),t;let o=0,a=0;const A=i&&((e,t)=>i(e+a,t)),l=Math.min(r.length,s.length);for(let c=1;c<l;c++){const i=r[c]*n,l=s[c]*n;Nf({source:e.subarray(o,i),target:t,start:a,end:l,size:n,getData:A}),o=i,a=l}a<t.length&&Nf({source:[],target:t,start:a,size:n,getData:A})}({source:m,target:_,sourceStartIndices:s,targetStartIndices:u,size:A,getData:g}),(!t||t.byteLength<_.byteLength+c)&&(null==t||t.destroy(),t=e.createBuffer({byteLength:_.byteLength+c,usage:35050})),t.write(_,c),t}class Wf{constructor({device:e,attribute:t,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Ru(n),this.attribute=t,this.attributeInTransition=function(e){const{device:t,settings:n,value:i}=e,r=new Of(t,n);return r.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),r}(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){const{doublePrecision:n,settings:i,value:r,size:s}=e,o=n&&r instanceof Float64Array?2:1;let a=0;const{shaderAttributes:A}=e.settings;if(A)for(const l of Object.values(A))a=Math.max(a,l.vertexOffset??0);return(i.noAlloc?r.length:(t+a)*s)*o}(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}const jf={name:"interpolation",vs:"uniform interpolationUniforms {\n  float time;\n} interpolation;\n",uniformTypes:{time:"f32"}},Hf="#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, interpolation.time);\n  gl_Position = vec4(0.0);\n}\n",Xf="#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aFrom64Low;\nin ATTRIBUTE_TYPE aTo;\nin ATTRIBUTE_TYPE aTo64Low;\nout ATTRIBUTE_TYPE vCurrent;\nout ATTRIBUTE_TYPE vCurrent64Low;\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid main(void) {\n  for (int i=0; i<ATTRIBUTE_SIZE; i++) {\n    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);\n    vCurrent[i] = value.x;\n    vCurrent64Low[i] = value.y;\n  }\n  gl_Position = vec4(0.0);\n}\n";function Qf(e){return e.doublePrecision&&e.value instanceof Float64Array}const $f={name:"spring",vs:"uniform springUniforms {\n  float damping;\n  float stiffness;\n} spring;\n",uniformTypes:{damping:"f32",stiffness:"f32"}},Yf="#version 300 es\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nin ATTRIBUTE_TYPE aPrev;\nin ATTRIBUTE_TYPE aCur;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vNext;\nout float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE force = delta * spring.stiffness;\n  ATTRIBUTE_TYPE resistance = velocity * spring.damping;\n  return force - resistance + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",Kf="#version 300 es\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nin float vIsTransitioningFlag;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  fragColor = vec4(1.0);\n}";const Zf={interpolation:class extends Wf{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="interpolation",this.transform=function(e,t){const n=t.size,i=Ff(n),r=Uf(n),s=t.getBufferLayout();if(Qf(t))return new Jc(e,{vs:Xf,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*n}]}],modules:[ha,jf],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0});return new Jc(e,{vs:Hf,bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:s.attributes[0].format}],modules:[jf],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();const{buffers:r,attribute:s}=this;Gf(r),r[0]=Vf({device:this.device,buffer:r[0],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),r[1]=zf({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:o}=this,a=o.model;let A=Math.floor(this.currentLength/s.size);Qf(s)&&(A/=2),a.setVertexCount(A),s.isConstant?(a.setAttributes({aFrom:r[0]}),a.setConstantAttributes({aTo:s.value})):a.setAttributes({aFrom:r[0],aTo:s.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let i=n/e;t&&(i=t(i));const{model:r}=this.transform,s={time:i};r.shaderInputs.setProps({interpolation:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends Wf{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="spring",this.texture=function(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}(e),this.framebuffer=function(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}(e,this.texture),this.transform=function(e,t){const n=Ff(t.size),i=Uf(t.size);return new Jc(e,{vs:Yf,fs:Kf,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[$f],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:r,attribute:s}=this;for(let a=0;a<2;a++)r[a]=Vf({device:this.device,buffer:r[a],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});r[2]=zf({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?o.setConstantAttributes({aTo:s.value}):o.setAttributes({aTo:s.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this,r=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const s={stiffness:r.stiffness,damping:r.damping};t.model.shaderInputs.setProps({spring:s}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Gf(e),this.setBuffer(e[1]);this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class qf{constructor(e,{id:t,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const i in e){const n=e[i],r=n.getTransitionSetting(t);r&&this._updateAttribute(i,n,r)}for(const i in this.transitions){const n=e[i];n&&n.getTransitionSetting(t)||this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(const t in this.transitions){this.transitions[t].update()&&(this.needsRedraw=!0)}const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let r=!i||i.type!==n.type;if(r){i&&this._removeTransition(e);const s=Zf[n.type];s?this.transitions[e]=new s({attribute:t,timeline:this.timeline,device:this.device}):(Mt.error(`unsupported transition type '${n.type}'`)(),r=!1)}(r||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const Jf="attributeManager.invalidate";class ep{constructor(e,{id:t="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=NA(hc),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new qf(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);Bt(Jf,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Bt(Jf,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:i,props:r={},buffers:s={},context:o={}}){let a=!1;Bt("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const A in this.attributes){const i=this.attributes[A],l=i.settings.accessor;i.startIndices=n,i.numInstances=t,r[A]&&Mt.removed(`props.${A}`,`data.attributes.${A}`)(),i.setExternalBuffer(s[A])||i.setBinaryValue("string"==typeof l?s[l]:void 0,e.startIndices)||"string"==typeof l&&!s[l]&&i.setConstantValue(o,r[l])||i.needsUpdate()&&(a=!0,this._updateAttribute({attribute:i,numInstances:t,data:e,props:r,context:o})),this.needsRedraw=this.needsRedraw||i.needsRedraw()}a&&Bt("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(e=>{var t;return null==(t=this.attributes[e])?void 0:t.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const r in t){const s=t[r];s.needsRedraw(e)&&!n.hasAttribute(r)&&(i[r]=s)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const i=e[n],r={...i,id:n,size:(i.isIndexed?1:i.size)||1,...t};this.attributes[n]=new Of(this.device,r)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes){this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)})}this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,r=i[e];return r&&r.forEach(e=>{const i=n[e];i&&i.setNeedsUpdate(i.id,t)}),r}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(Bt("attribute.updateStart",t),t.constant)return void t.setConstantValue(e.context,t.value);t.allocate(n)&&Bt("attribute.allocate",t,n);t.updateBuffer(e)&&(this.needsRedraw=!0,Bt("attribute.updateEnd",t,n))}}const tp=1e-5;function np(e,t,n,i,r){const s=t-e;return(n-t)*r+-s*i+s+t}function ip(e,t){if(Array.isArray(e)){let n=0;for(let i=0;i<e.length;i++){const r=e[i]-t[i];n+=r*r}return Math.sqrt(n)}return Math.abs(e-t)}const rp={interpolation:class extends Ru{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:r}}=this,s=r(e/i);this._value=To(t,n,s)}},spring:class extends Ru{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:r=e,_currValue:s=e}=this;let o=function(e,t,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=np(e[o],t[o],n[o],i,r);return s}return np(e,t,n,i,r)}(r,s,t,n,i);const a=ip(o,t),A=ip(o,s);a<tp&&A<tp&&(o=t,this.end()),this._prevValue=s,this._currValue=o}}};class sp{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:r}=this;if(r.has(e)){const n=r.get(e),{value:i=n.settings.fromValue}=n;t=i,this.remove(e)}if(!(i=Df(i)))return;const s=rp[i.type];if(!s)return void Mt.error(`unsupported transition type '${i.type}'`)();const o=new s(this.timeline);o.start({...i,fromValue:t,toValue:n}),r.set(e,o)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function op(e,t){const n=Ap({newProps:e,oldProps:t,propTypes:e[hu],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(e,t){if(null===t)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=e;i?i(e.data,t.data)||(n="Data comparator detected a change"):e.data!==t.data&&(n="A new data container was supplied");n&&r&&(n=r(e.data,t.data)||n);return n}(e,t);let r=!1;return i||(r=function(e,t){if(null===t)return{all:!0};if("all"in e.updateTriggers){if(up(e,t,"all"))return{all:!0}}const n={};let i=!1;for(const r in e.updateTriggers)if("all"!==r){up(e,t,r)&&(n[r]=!0,i=!0)}return!!i&&n}(e,t)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:cp(e,t),transitionsChanged:ap(e,t)}}function ap(e,t){if(!e.transitions)return!1;const n={},i=e[hu];let r=!1;for(const s in e.transitions){const o=i[s],a=o&&o.type;("number"===a||"color"===a||"array"===a)&&lp(e[s],t[s],o)&&(n[s]=!0,r=!0)}return!!r&&n}function Ap({newProps:e,oldProps:t,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(t===e)return!1;if("object"!=typeof e||null===e)return`${r} changed shallowly`;if("object"!=typeof t||null===t)return`${r} changed shallowly`;for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${r}.${s} added`;const n=lp(e[s],t[s],i[s]);if(n)return`${r}.${s} ${n}`}for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${r}.${s} dropped`;if(!Object.hasOwnProperty.call(e,s)){const n=lp(e[s],t[s],i[s]);if(n)return`${r}.${s} ${n}`}}return!1}function lp(e,t,n){let i=n&&n.equal;return i&&!i(e,t,n)?"changed deeply":i||(i=e&&t&&e.equals,!i||i.call(e,t))?i||t===e?null:"changed shallowly":"changed deeply"}function cp(e,t){if(null===t)return!0;const n=t.extensions,{extensions:i}=e;if(i===n)return!1;if(!n||!i)return!0;if(i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function up(e,t,n){let i=e.updateTriggers[n];i=null==i?{}:i;let r=t.updateTriggers[n];r=null==r?{}:r;return Ap({oldProps:r,newProps:i,triggerName:n})}function hp(e){if(null===(t=e)||"object"!=typeof t)throw new Error("count(): argument not an object");var t;if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"==typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error("count(): argument not a container")}function dp(e,t){if(!t)return e;const n={...e,...t};if("defines"in t&&(n.defines={...e.defines,...t.defines}),"modules"in t&&(n.modules=(e.modules||[]).concat(t.modules),t.modules.some(e=>"project64"===e.name))){const e=n.modules.findIndex(e=>"project32"===e.name);e>=0&&n.modules.splice(e,1)}if("inject"in t)if(e.inject){const i={...e.inject};for(const e in t.inject)i[e]=(i[e]||"")+t.inject[e];n.inject=i}else n.inject=t.inject;return n}const fp={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},pp={};const gp={boolean:{validate:(e,t)=>!0,equal:(e,t,n)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||vp(e)&&(3===e.length||4===e.length),equal:(e,t,n)=>Eu(e,t,1)},accessor:{validate(e,t){const n=yp(e);return"function"===n||n===yp(t.value)},equal:(e,t,n)=>"function"==typeof t||Eu(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||vp(e),equal(e,t,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Eu(e,t,r):e===t}},object:{equal(e,t,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Eu(e,t,r):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,n)=>!n.compare&&!1!==n.ignore||e===t},data:{transform:(e,t,n)=>{if(!e)return e;const{dataTransform:i}=n.props;return i?i(e):"string"==typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,n)=>{const i=n.context;return i&&i.device?function(e,t,n,i){if(n instanceof mi)return n;n.constructor&&"Object"!==n.constructor.name&&(n={data:n});let r=null;n.compressed&&(r={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const{width:s,height:o}=n.data,a=t.createTexture({...n,sampler:{...fp,...r,...i},mipLevels:t.getMipLevelCount(s,o)});return a.generateMipmapsWebGL(),pp[a.id]=e,a}(n.id,i.device,e,{...t.parameters,...n.props.textureParameters}):null},release:(e,t,n)=>{var i,r;i=n.id,(r=e)&&r instanceof mi&&pp[r.id]===i&&(r.delete(),delete pp[r.id])}}};function mp(e,t){switch(yp(t)){case"object":return _p(e,t);case"array":return _p(e,{type:"array",value:t,compare:!1});case"boolean":return _p(e,{type:"boolean",value:t});case"number":return _p(e,{type:"number",value:t});case"function":return _p(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function _p(e,t){return"type"in t?{name:e,...gp[t.type],...t}:"value"in t?{name:e,type:yp(t.value),...t}:{name:e,type:"object",value:t}}function vp(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function yp(e){return vp(e)?"array":null===e?"null":typeof e}const bp="_mergedDefaultProps";function wp(e,t){if(!(e instanceof Cp.constructor))return{};let n=bp;if(t)for(const r of t){const e=r.constructor;e&&(n+=`:${e.extensionName||e.name}`)}const i=Tp(e,n);return i||(e[n]=function(e,t){const n=e.prototype;if(!n)return null;const i=Object.getPrototypeOf(e),r=wp(i),s=Tp(e,"defaultProps")||{},o=function(e){const t={},n={},i={};for(const[r,s]of Object.entries(e)){const e=null==s?void 0:s.deprecatedFor;if(e)i[r]=Array.isArray(e)?e:[e];else{const e=mp(r,s);t[r]=e,n[r]=e.value}}return{propTypes:t,defaultProps:n,deprecatedProps:i}}(s),a=Object.assign(Object.create(null),r,o.defaultProps),A=Object.assign(Object.create(null),null==r?void 0:r[hu],o.propTypes),l=Object.assign(Object.create(null),null==r?void 0:r[du],o.deprecatedProps);for(const c of t){const e=wp(c.constructor);e&&(Object.assign(a,e),Object.assign(A,e[hu]),Object.assign(l,e[du]))}(function(e,t){const n=function(e){const t=e.componentName;t||Mt.warn(`${e.name}.componentName not specified`)();return t||e.name}(t);Object.defineProperties(e,{id:{writable:!0,value:n}})})(a,e),function(e,t){const n={},i={};for(const r in t){const e=t[r],{name:s,value:o}=e;e.async&&(n[s]=o,i[s]=Ep(s))}e[fu]=n,e[pu]={},Object.defineProperties(e,i)}(a,A),function(e,t){for(const n in t)Object.defineProperty(e,n,{enumerable:!1,set(e){const i=`${this.id}: ${n}`;for(const r of t[n])xp(this,r)||(this[r]=e);Mt.deprecated(i,t[n].join("/"))()}})}(a,l),a[hu]=A,a[du]=l,0!==t.length||xp(e,"_propTypes")||(e._propTypes=A);return a}(e,t||[]))}function Ep(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||If(t)?this[pu][e]=t:this[gu][e]=t},get(){if(this[gu]){if(e in this[gu]){return this[gu][e]||this[fu][e]}if(e in this[pu]){const t=this[uu]&&this[uu].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[fu][e]}}return this[fu][e]}}}function xp(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Tp(e,t){return xp(e,t)&&e[t]}let Sp=0;class Cp{constructor(...e){this.props=function(e,t){let n;for(let s=t.length-1;s>=0;s--){const e=t[s];"extensions"in e&&(n=e.extensions)}const i=wp(e.constructor,n),r=Object.create(i);r[uu]=e,r[pu]={},r[gu]={};for(let s=0;s<t.length;++s){const e=t[s];for(const t in e)r[t]=e[t]}return Object.freeze(r),r}(this,e),this.id=this.props.id,this.count=Sp++}clone(e){const{props:t}=this,n={};for(const i in t[fu])i in t[gu]?n[i]=t[gu][i]:i in t[pu]&&(n[i]=t[pu][i]);return new this.constructor({...t,...n,...e})}}Cp.componentName="Component",Cp.defaultProps={};const Pp=Object.freeze({});class Rp{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Pp}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[uu]||this.component;const t=e[gu]||{},n=e[pu]||e,i=e[fu]||{};for(const r in t){const e=t[r];this._createAsyncPropData(r,i[r]),this._updateAsyncProp(r,e),t[r]=this.getAsyncProp(r)}for(const r in n){const e=n[r];this._createAsyncPropData(r,i[r]),this._updateAsyncProp(r,e)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){this._didAsyncInputValueChange(e,t)&&("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise?this._watchPromise(e,t):If(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t!==n.resolvedValue&&t!==n.lastValue&&(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;t.then(t=>{this.component&&(t=this._postProcessValue(n,t),this._setAsyncPropValue(e,t,i),this._onResolve(e,t))}).catch(t=>{this._onError(e,t)})}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let r=[],s=0;for await(const o of t){if(!this.component)return;const{dataTransform:t}=this.component.props;r=t?t(o,r):r.concat(o),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:s,endRow:r.length}]}),s=r.length,this._setAsyncPropValue(e,r,i)}this._onResolve(e,r)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[hu];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Ip extends Rp{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,i=null==n?void 0:n.props.fetch;return i?i(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const i=n.props.onDataLoad;"data"===e&&i&&i(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const Mp=2**24-1,kp=Object.freeze([]),Lp=NA(({oldViewport:e,viewport:t})=>e.equals(t));let Bp=new Uint8ClampedArray(0);const Dp={data:{type:"data",value:kp,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=n.context;r=r||n.getLoadOptions(),i=i||n.props.loaders,s&&(r={...r,fetch:{...null==r?void 0:r.fetch,signal:s}});let a=o.contains(e);return a||r||(o.add({resourceId:e,data:ct(e,i),persistent:!1}),a=!0),a?o.subscribe({resourceId:e,onChange:e=>{var i;return null==(i=n.internalState)?void 0:i.reloadAsyncProp(t,e)},consumerId:n.id,requestId:t}):ct(e,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:MA.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,100*-e]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Op extends Cp{constructor(){super(...arguments),this.internalState=null,this.lifecycle=su,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ou(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=bc(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,s]=bl(n,t.pixelProjectionMatrix);return 2===e.length?[i,r]:[i,r,s]}unproject(e){Ou(this.internalState);return(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Ou(this.internalState);return wc(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===MA.DEFAULT||e===MA.LNGLAT||e===MA.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Ou(e instanceof Uint8Array);const[t,n,i]=e;return t+256*n+65536*i-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:hp(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=dp(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=dp(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const i of n)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:n}=e,i=this.internalState.hasPickingBuffer,r=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(e=>e.getNeedsPickingBuffer.call(this,e));if(i!==r){this.internalState.hasPickingBuffer=r;const{pickingColors:e,instancePickingColors:n}=t.attributes,i=e||n;i&&(r&&i.constant&&(i.constant=!1,t.invalidate(i.id)),i.value||r||(i.constant=!0,i.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){var n,i,r,s;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(null==(i=(n=this.props).onError)?void 0:i.call(n,e))||null==(s=null==(r=this.context)?void 0:r.onError)||s.call(r,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){var e;return(null==(e=this.internalState)?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,t&&Lp({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const r=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const e in t)Object.defineProperty(n,e,{value:t[e]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(Bp.length/4);if(this.internalState.usesPickingColorCache=!0,n<t){t>Mp&&Mt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Bp=oc.allocate(Bp,t,{size:4,copy:!0,maxCount:Math.max(t,Mp)});const e=Math.floor(Bp.length/4),i=[0,0,0];for(let t=n;t<e;t++)this.encodePickingColor(t,i),Bp[4*t+0]=i[0],Bp[4*t+1]=i[1],Bp[4*t+2]=i[2],Bp[4*t+3]=0}e.value=Bp.subarray(0,4*t)}_setModelAttributes(e,t,n=!1){var i;if(!Object.keys(t).length)return;if(n){const n=this.getAttributeManager();e.setBufferLayout(n.getBufferLayouts(e)),t=n.getAttributes()}const r=(null==(i=e.userData)?void 0:i.excludeAttributes)||{},s={},o={};for(const a in t){if(r[a])continue;const n=t[a].getValue();for(const i in n){const r=n[i];r instanceof Sn?t[a].settings.isIndexed?e.setIndexBuffer(r):s[i]=r:r&&(o[i]=r)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i,s=r&&t.attributes&&t.attributes[r.id];if(s&&s.value){const n=s.value,i=this.encodePickingColor(e);for(let e=0;e<t.length;e++){const t=r.getVertexOffset(e);n[t]===i[0]&&n[t+1]===i[1]&&n[t+2]===i[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n;if(!i)return;const r=i.getVertexOffset(e),s=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(s-r),r)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Bp.buffer&&(n.value=Bp.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Ou(!this.internalState),Ou(Number.isFinite(this.props.coordinateSystem)),Bt("layer.initialize",this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Ip({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Mt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new sp(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Bt("layer.matched",this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Bt("layer.update",this,e),!e)return;const t=this.props,n=this.context,i=this.internalState,r=n.viewport,s=this._updateUniformTransition();i.propsInTransition=s,n.viewport=i.viewport||r,this.props=s;try{const e=this._getUpdateParams(),t=this.getModels();if(n.device)this.updateState(e);else try{this.updateState(e)}catch(o){}for(const n of this.props.extensions)n.updateState.call(this,e,n);this.setNeedsRedraw(),this._updateAttributes();const i=this.getModels()[0]!==t[0];this._postUpdate(e,i)}finally{n.viewport=r,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Bt("layer.finalize",this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,s=this.context;this.props=this.internalState.propsInTransition||r;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:r}=this.props,o=r&&r(n)||[0,0];s.device instanceof mf&&s.device.setParametersWebGL({polygonOffset:o});for(const e of this.getModels())"webgpu"===e.device.type?e.setParameters({...e.parameters,...i}):e.setParameters(i);if(s.device instanceof mf)s.device.withParametersWebGL(i,()=>{const r={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:i,context:s};for(const e of this.props.extensions)e.draw.call(this,r,e);this.draw(r)});else{const r={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:i,context:s};for(const e of this.props.extensions)e.draw.call(this,r,e);this.draw(r)}}finally{this.props=r}}getChangeFlags(){var e;return null==(e=this.internalState)?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let n=!1;if("dataChanged"===i){const r=e[i],s=t[i];r&&Array.isArray(s)&&(t.dataChanged=Array.isArray(r)?s.concat(r):r,n=!0)}t[i]||(t[i]=e[i],n=!0),n&&Bt("layer.changeFlag",this,i,e)}const n=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var n;const i=op(e,t);if(i.updateTriggersChanged)for(const r in i.updateTriggersChanged)i.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(i.transitionsChanged)for(const r in i.transitionsChanged)this.internalState.uniformTransitions.add(r,t[r],e[r],null==(n=e.transitions)?void 0:n[r]);return this.setChangeFlags(i)}validateProps(){!function(e){const t=e[hu];for(const n in t){const i=t[n],{validate:r}=i;if(r&&!r(e[n],i))throw new Error(`Invalid prop ${n}: ${e[n]}`)}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&"function"==typeof n&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new ep(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:i}=e,r=this.state.model;(null==r?void 0:r.isInstanced)&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:o,highlightColor:a}=n;if(t||i.autoHighlight!==s||i.highlightedObjectIndex!==o||i.highlightColor!==a){const e={};Array.isArray(a)&&(e.highlightColor=a),(t||i.autoHighlight!==s||o!==i.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=!!n&&n.getNeedsRedraw(e);if(t=t||i,t)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Op.defaultProps=Dp,Op.layerName="Layer";class Np extends Op{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id?(e.object=t.__source.object,e.index=t.__source.index,e):e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if("function"==typeof e){const t={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,i)}return e}getSubLayerProps(e={}){var t;const{opacity:n,pickable:i,visible:r,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:A,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:f,extensions:p,fetch:g,operation:m,_subLayerProps:_}=this.props,v={id:"",updateTriggers:{},opacity:n,pickable:i,visible:r,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:A,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:f,extensions:p,fetch:g,operation:m},y=_&&e.id&&_[e.id],b=y&&y.updateTriggers,w=e.id||"sublayer";if(y){const t=this.props[hu],n=e.type?e.type._propTypes:{};for(const e in y){const i=n[e]||t[e];i&&"accessor"===i.type&&(y[e]=this.getSubLayerAccessor(y[e]))}}Object.assign(v,e,y),v.id=`${this.props.id}-${w}`,v.updateTriggers={all:null==(t=this.props.updateTriggers)?void 0:t.all,...e.updateTriggers,...b};for(const E of p){const e=E.getSubLayerProps.call(this,E);e&&Object.assign(v,e,{updateTriggers:Object.assign(v.updateTriggers,e.updateTriggers)})}return v}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){n=mu(this.renderLayers(),Boolean),this.internalState.subLayers=n}Bt("compositeLayer.renderLayers",this,i,n);for(const r of n)r.parent=this}}Np.layerName="CompositeLayer";const Fp={bearing:0,pitch:0,position:[0,0,0]},Up={speed:1.2,curve:1.414};class Gp extends Nu{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...Up,...e}}interpolateProps(e,t,n){const i=function(e,t,n,i){const{startZoom:r,startCenterXY:s,uDelta:o,w0:a,u1:A,S:l,rho:c,rho2:u,r0:h}=Pl(e,t,i);if(A<.01){const i={};for(const r of Sl){const s=e[r],o=t[r];i[r]=el(s,o,n)}return i}const d=n*l,f=Math.cosh(h)/Math.cosh(h+c*d),p=a*((Math.cosh(h)*Math.tanh(h+c*d)-Math.sinh(h))/u)/A,g=r+dl(1/f),m=(y=p,(_=[])[0]=(v=o)[0]*y,_[1]=v[1]*y,_);var _,v,y;Bo(m,m,s);const b=pl(m);return{longitude:b[0],latitude:b[1],zoom:g}}(e,t,n,this.opts);for(const r in Fp)i[r]=To(e[r]||Fp[r],t[r]||Fp[r],n);return i}getDuration(e,t){let{transitionDuration:n}=t;return"auto"===n&&(n=function(e,t,n){const i={...Cl,...n},{screenSpeed:r,speed:s,maxDuration:o}=i,{S:a,rho:A}=Pl(e,t,i),l=1e3*a;let c;return c=Number.isFinite(r)?l/(r/A):l/s,Number.isFinite(o)&&c>o?0:c}(e,t,this.opts)),n}}class zp{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=oc,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:n={},getGeometry:i,geometryBuffer:r,positionFormat:s,dataChanged:o,normalize:a=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=r&&r.size||("XY"===s?2:3),this.buffers=n,this.normalize=a,r&&(Ou(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),a||(n.vertexPositions=r)),this.geometryBuffer=n.vertexPositions,Array.isArray(o))for(const A of o)this._rebuildGeometry(A);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?Mf(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:n,buffers:i,_attributeDefs:r,typedArrayManager:s}=this;for(const o in r)if(o in i)s.release(n[o]),n[o]=null;else{const i=r[o];i.copy=t,n[o]=s.allocate(n[o],e,i)}}_forEachGeometry(e,t,n){const{data:i,getGeometry:r}=this,{iterable:s,objectInfo:o}=Rf(i,t,n);for(const a of s){o.index++;e(r?r(a,o):null,o.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:n,instanceCount:i}=this;const{data:r,geometryBuffer:s}=this,{startRow:o=0,endRow:a=1/0}=e||{},A={};if(e||(t=[0],n=[0]),this.normalize||!s)this._forEachGeometry((e,t)=>{const i=e&&this.normalizeGeometry(e);A[t]=i,n[t+1]=n[t]+(i?this.getGeometrySize(i):0)},o,a),i=n[n.length-1];else if(n=r.startIndices,i=n[r.length]||0,ArrayBuffer.isView(s))i=i||s.length/this.positionSize;else if(s instanceof Sn){const e=4*this.positionSize;i=i||s.byteLength/e}else if(s.buffer){const e=s.stride||4*this.positionSize;i=i||s.buffer.byteLength/e}else if(s.value){const e=s.value,t=s.stride/e.BYTES_PER_ELEMENT||this.positionSize;i=i||e.length/t}this._allocate(i,Boolean(e)),this.indexStarts=t,this.vertexStarts=n,this.instanceCount=i;const l={};this._forEachGeometry((e,r)=>{const s=A[r]||e;l.vertexStart=n[r],l.indexStart=t[r];const o=r<n.length-1?n[r+1]:i;l.geometrySize=o-n[r],l.geometryIndex=r,this.updateGeometryAttributes(s,l)},o,a),this.vertexCount=t[t.length-1]}}const Vp="undefined"!=typeof window?s.useLayoutEffect:s.useEffect;function Wp(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}const jp={position:"absolute",zIndex:-1};function Hp(e,t){if("function"==typeof e)return e(t);if(Array.isArray(e))return e.map(e=>Hp(e,t));if(Xp(e)){if(function(e){var t;return null==(t=e.props)?void 0:t.mapStyle}(e))return t.style=jp,s.cloneElement(e,t);if(function(e){const t=e.type;return t&&t.deckGLViewProps}(e))return s.cloneElement(e,t)}return e}function Xp(e){return e&&"object"==typeof e&&"type"in e||!1}function Qp(e){if("function"==typeof e)return s.createElement(Pu,{},e);if(Array.isArray(e))return e.map(Qp);if(Xp(e)){if(e.type===s.Fragment)return Qp(e.props.children);if(Wp(e.type,Pu))return e}return e}const $p=s.createContext();const Yp={mixBlendMode:null};function Kp(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}const Zp=s.forwardRef(function(e,t){const[n,i]=s.useState(0),r=s.useRef({control:null,version:n,forceUpdate:()=>i(e=>e+1)}).current,o=s.useRef(null),a=s.useRef(null),A=s.useMemo(()=>function({children:e,layers:t=[],views:n=null}){const i=[],r=[],o={};return s.Children.forEach(Qp(e),e=>{if(Xp(e)){const t=e.type;if(Wp(t,Op)){const n=function(e,t){const n={},i=e.defaultProps||{};for(const r in t)i[r]!==t[r]&&(n[r]=t[r]);return new e(n)}(t,e.props);r.push(n)}else i.push(e);if(Wp(t,Pu)&&t!==Pu&&e.props.id){const n=new t(e.props);o[n.id]=n}}else e&&i.push(e)}),Object.keys(o).length>0&&(Array.isArray(n)?n.forEach(e=>{o[e.id]=e}):n&&(o[n.id]=n),n=Object.values(o)),{layers:t=r.length>0?[...r,...t]:t,children:i,views:n}}(e),[e.layers,e.views,e.children]);let l=!0;const c=t=>{var n;return l&&e.viewState?(r.viewStateUpdateRequested=t,null):(r.viewStateUpdateRequested=null,null==(n=e.onViewStateChange)?void 0:n.call(e,t))},u=t=>{var n;l?r.interactionStateUpdateRequested=t:(r.interactionStateUpdateRequested=null,null==(n=e.onInteractionStateChange)||n.call(e,t))},h=s.useMemo(()=>{const t={widgets:[],...e,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:A.layers,views:A.views,onViewStateChange:c,onInteractionStateChange:u};return delete t._customRender,r.deck&&r.deck.setProps(t),t},[e]);s.useEffect(()=>{const t=e.Deck||bf;return r.deck=function(e,t,n){var i,r,s;const o=new t({...n,_customRender:"webgpu"===(null==(s=null==(r=null==(i=n.deviceProps)?void 0:i.adapters)?void 0:r[0])?void 0:s.type)?void 0:t=>{e.redrawReason=t;const n=o.getViewports();e.lastRenderedViewports!==n?e.forceUpdate():Kp(e)}});return o}(r,t,{...h,parent:o.current,canvas:a.current}),()=>{var e;return null==(e=r.deck)?void 0:e.finalize()}},[]),Vp(()=>{var e;Kp(r);const{viewStateUpdateRequested:t,interactionStateUpdateRequested:n}=r;t&&c(t),n&&u(n),(null==(e=r.deck)?void 0:e.isInitialized)&&r.deck.redraw("Initial render")}),s.useImperativeHandle(t,()=>function(e){return{get deck(){return e.deck},pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)}}(r),[]);const d=r.deck&&r.deck.isInitialized?r.deck.getViewports():void 0,{ContextProvider:f,width:p="100%",height:g="100%",id:m,style:_}=e,{containerStyle:v,canvasStyle:y}=s.useMemo(()=>function({width:e,height:t,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},r={left:0,top:0};if(n)for(const s in n)s in Yp?r[s]=n[s]:i[s]=n[s];return{containerStyle:i,canvasStyle:r}}({width:p,height:g,style:_}),[p,g,_]);if(!r.viewStateUpdateRequested&&r.lastRenderedViewports===d||r.version!==n){r.lastRenderedViewports=d,r.version=n;const e=function({children:e,deck:t,ContextProvider:n=$p.Provider}){const{viewManager:i}=t||{};if(!i||!i.views.length)return[];const r={},o=i.views[0].id;for(const s of e){let e=o,t=s;Xp(s)&&Wp(s.type,Pu)&&(e=s.props.id||o,t=s.props.children);const n=i.getViewport(e),a=i.getViewState(e);if(n){a.padding=n.padding;const{x:i,y:s,width:o,height:A}=n;t=Hp(t,{x:i,y:s,width:o,height:A,viewport:n,viewState:a}),r[e]||(r[e]={viewport:n,children:[]}),r[e].children.push(t)}}return Object.keys(r).map(e=>{const{viewport:i,children:o}=r[e],{x:a,y:A,width:l,height:c}=i,u={position:"absolute",left:a,top:A,width:l,height:c},h=`view-${e}`,d=s.createElement("div",{key:h,id:h,style:u},...o),f={deck:t,viewport:i,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:n=>{n.viewId=e,t._onViewStateChange(n)},widgets:[]},p=`view-${e}-context`;return s.createElement(n,{key:p,value:f},d)})}({children:A.children,deck:r.deck,ContextProvider:f}),t=s.createElement("canvas",{key:"canvas",id:m||"deckgl-overlay",ref:a,style:y});r.control=s.createElement("div",{id:`${m||"deckgl"}-wrapper`,ref:o,style:v},[t,e])}return l=!1,r.control}),qp="uniform scatterplotUniforms {\n  float radiusScale;\n  float radiusMinPixels;\n  float radiusMaxPixels;\n  float lineWidthScale;\n  float lineWidthMinPixels;\n  float lineWidthMaxPixels;\n  float stroked;\n  float filled;\n  bool antialiasing;\n  bool billboard;\n  highp int radiusUnits;\n  highp int lineWidthUnits;\n} scatterplot;\n",Jp={name:"scatterplot",vs:qp,fs:qp,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},eg=[0,0,0,255],tg={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:eg},getLineColor:{type:"accessor",value:eg},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ng extends Op{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-vertex-shader\nin vec3 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceRadius;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout vec2 unitPosition;\nout float innerUnitRadius;\nout float outerRadiusPixels;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nouterRadiusPixels = clamp(\nproject_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),\nscatterplot.radiusMinPixels, scatterplot.radiusMaxPixels\n);\nfloat lineWidthPixels = clamp(\nproject_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),\nscatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels\n);\nouterRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;\nfloat edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\nunitPosition = edgePadding * positions.xy;\ngeometry.uv = unitPosition;\ngeometry.pickingColor = instancePickingColors;\ninnerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;\nif (scatterplot.billboard) {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = edgePadding * positions * outerRadiusPixels;\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-fragment-shader\nprecision highp float;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin vec2 unitPosition;\nin float innerUnitRadius;\nin float outerRadiusPixels;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = unitPosition;\nfloat distToCenter = length(unitPosition) * outerRadiusPixels;\nfloat inCircle = scatterplot.antialiasing ?\nsmoothedge(distToCenter, outerRadiusPixels) :\nstep(distToCenter, outerRadiusPixels);\nif (inCircle == 0.0) {\ndiscard;\n}\nif (scatterplot.stroked > 0.5) {\nfloat isLine = scatterplot.antialiasing ?\nsmoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\nstep(innerUnitRadius * outerRadiusPixels, distToCenter);\nif (scatterplot.filled > 0.5) {\nfragColor = mix(vFillColor, vLineColor, isLine);\n} else {\nif (isLine == 0.0) {\ndiscard;\n}\nfragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n}\n} else if (scatterplot.filled < 0.5) {\ndiscard;\n} else {\nfragColor = vFillColor;\n}\nfragColor.a *= inCircle;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",source:"// Main shaders\n\nstruct ScatterplotUniforms {\n  radiusScale: f32,\n  radiusMinPixels: f32,\n  radiusMaxPixels: f32,\n  lineWidthScale: f32,\n  lineWidthMinPixels: f32,\n  lineWidthMaxPixels: f32,\n  stroked: f32,\n  filled: i32,\n  antialiasing: i32,\n  billboard: i32,\n  radiusUnits: i32,\n  lineWidthUnits: i32,\n};\n\nstruct ConstantAttributeUniforms {\n instancePositions: vec3<f32>,\n instancePositions64Low: vec3<f32>,\n instanceRadius: f32,\n instanceLineWidths: f32,\n instanceFillColors: vec4<f32>,\n instanceLineColors: vec4<f32>,\n instancePickingColors: vec3<f32>,\n\n instancePositionsConstant: i32,\n instancePositions64LowConstant: i32,\n instanceRadiusConstant: i32,\n instanceLineWidthsConstant: i32,\n instanceFillColorsConstant: i32,\n instanceLineColorsConstant: i32,\n instancePickingColorsConstant: i32\n};\n\n@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;\n\nstruct ConstantAttributes {\n  instancePositions: vec3<f32>,\n  instancePositions64Low: vec3<f32>,\n  instanceRadius: f32,\n  instanceLineWidths: f32,\n  instanceFillColors: vec4<f32>,\n  instanceLineColors: vec4<f32>,\n  instancePickingColors: vec3<f32>\n};\n\nconst constants = ConstantAttributes(\n  vec3<f32>(0.0),\n  vec3<f32>(0.0),\n  0.0,\n  0.0,\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec3<f32>(0.0)\n);\n\nstruct Attributes {\n  @builtin(instance_index) instanceIndex : u32,\n  @builtin(vertex_index) vertexIndex : u32,\n  @location(0) positions: vec3<f32>,\n  @location(1) instancePositions: vec3<f32>,\n  @location(2) instancePositions64Low: vec3<f32>,\n  @location(3) instanceRadius: f32,\n  @location(4) instanceLineWidths: f32,\n  @location(5) instanceFillColors: vec4<f32>,\n  @location(6) instanceLineColors: vec4<f32>,\n  @location(7) instancePickingColors: vec3<f32>\n};\n\nstruct Varyings {\n  @builtin(position) position: vec4<f32>,\n  @location(0) vFillColor: vec4<f32>,\n  @location(1) vLineColor: vec4<f32>,\n  @location(2) unitPosition: vec2<f32>,\n  @location(3) innerUnitRadius: f32,\n  @location(4) outerRadiusPixels: f32,\n};\n\n@vertex\nfn vertexMain(attributes: Attributes) -> Varyings {\n  var varyings: Varyings;\n\n  // Draw an inline geometry constant array clip space triangle to verify that rendering works.\n  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));\n  // if (attributes.instanceIndex == 0) {\n  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);\n  //   return varyings;\n  // }\n\n  // var geometry: Geometry;\n  // geometry.worldPosition = instancePositions;\n\n  // Multiply out radius and clamp to limits\n  varyings.outerRadiusPixels = clamp(\n    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),\n    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels\n  );\n\n  // Multiply out line width and clamp to limits\n  let lineWidthPixels = clamp(\n    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),\n    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels\n  );\n\n  // outer radius needs to offset by half stroke width\n  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;\n  // Expand geometry to accommodate edge smoothing\n  let edgePadding = select(\n    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,\n    1.0,\n    scatterplot.antialiasing != 0\n  );\n\n  // position on the containing square in [-1, 1] space\n  varyings.unitPosition = edgePadding * attributes.positions.xy;\n  geometry.uv = varyings.unitPosition;\n  geometry.pickingColor = attributes.instancePickingColors;\n\n  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;\n\n  if (scatterplot.billboard != 0) {\n    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);\n    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);\n    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;\n    // DECKGL_FILTER_SIZE(offset, geometry);\n    let clipPixels = project_pixel_size_to_clipspace(offset.xy);\n    varyings.position.x = clipPixels.x;\n    varyings.position.y = clipPixels.y;\n  } else {\n    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);\n    // DECKGL_FILTER_SIZE(offset, geometry);\n    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);\n    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);\n  }\n\n  // Apply opacity to instance color, or return instance picking color\n  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);\n  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);\n  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);\n  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);\n\n  return varyings;\n}\n\n@fragment\nfn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {\n  // var geometry: Geometry;\n  // geometry.uv = unitPosition;\n\n  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;\n  let inCircle = select(\n    smoothedge(distToCenter, varyings.outerRadiusPixels),\n    step(distToCenter, varyings.outerRadiusPixels),\n    scatterplot.antialiasing != 0\n  );\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  var fragColor: vec4<f32>;\n\n  if (scatterplot.stroked != 0) {\n    let isLine = select(\n      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),\n      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),\n      scatterplot.antialiasing != 0\n    );\n\n    if (scatterplot.filled != 0) {\n      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);\n    }\n  } else if (scatterplot.filled == 0) {\n    discard;\n  } else {\n    fragColor = varyings.vFillColor;\n  }\n\n  fragColor.a *= inCircle;\n  // DECKGL_FILTER_COLOR(fragColor, geometry);\n\n  // Apply premultiplied alpha as required by transparent canvas\n  fragColor = deckgl_premultiplied_alpha(fragColor);\n\n  return fragColor;\n  // return vec4<f32>(0, 0, 1, 1);\n}\n",modules:[ZA,Pa,Nl,Jp]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&(null==(t=this.state.model)||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:r,stroked:s,filled:o,billboard:a,antialiasing:A,lineWidthUnits:l,lineWidthScale:c,lineWidthMinPixels:u,lineWidthMaxPixels:h}=this.props,d={stroked:s,filled:o,billboard:a,antialiasing:A,radiusUnits:LA[t],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:r,lineWidthUnits:LA[l],lineWidthScale:c,lineWidthMinPixels:u,lineWidthMaxPixels:h},f=this.state.model;f.shaderInputs.setProps({scatterplot:d}),"webgpu"===this.context.device.type&&(f.instanceCount=this.props.data.length),f.draw(this.context.renderPass)}_getModel(){const e="webgpu"===this.context.device.type?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0;return new Kc(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new tu({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0,parameters:e})}}ng.defaultProps=tg,ng.layerName="ScatterplotLayer";const ig=1,rg=-1;function sg(e,t,n={}){const i=function(e,t={}){return Math.sign(function(e,t={}){const{start:n=0,end:i=e.length,plane:r="xy"}=t,s=t.size||2;let o=0;const a=og[r[0]],A=og[r[1]];for(let l=n,c=i-s;l<i;l+=s)o+=(e[l+a]-e[c+a])*(e[l+A]+e[c+A]),c=l;return o/2}(e,t))}(e,n);return i!==t&&(function(e,t){const{start:n=0,end:i=e.length,size:r=2}=t,s=(i-n)/r,o=Math.floor(s/2);for(let a=0;a<o;++a){const t=n+a*r,i=n+(s-1-a)*r;for(let n=0;n<r;++n){const r=e[t+n];e[t+n]=e[i+n],e[i+n]=r}}}(e,n),!0)}const og={x:0,y:1,z:2};function ag(e,t){const n=t.length,i=e.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(e[i-n+s]!==t[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)e[i+r]=t[r];return!0}function Ag(e,t){const n=t.length;for(let i=0;i<n;i++)e[i]=t[i]}function lg(e,t,n,i,r=[]){const s=i+t*n;for(let o=0;o<n;o++)r[o]=e[s+o];return r}function cg(e,t,n,i,r=[]){let s,o;if(8&n)s=(i[3]-e[1])/(t[1]-e[1]),o=3;else if(4&n)s=(i[1]-e[1])/(t[1]-e[1]),o=1;else if(2&n)s=(i[2]-e[0])/(t[0]-e[0]),o=2;else{if(!(1&n))return null;s=(i[0]-e[0])/(t[0]-e[0]),o=0}for(let a=0;a<e.length;a++)r[a]=(1&o)===a?i[o]:s*(t[a]-e[a])+e[a];return r}function ug(e,t){let n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}function hg(e,t){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=e.length}=t||{},A=(a-o)/n;let l=[];const c=[l],u=lg(e,0,n,o);let h,d;const f=pg(u,r,s,[]),p=[];ag(l,u);for(let g=1;g<A;g++){for(h=lg(e,g,n,o,h),d=ug(h,f);d;){cg(u,h,d,f,p);const e=ug(p,f);e&&(cg(u,p,e,f,p),d=e),ag(l,p),Ag(u,p),gg(f,r,d),i&&l.length>n&&(l=[],c.push(l),ag(l,u)),d=ug(h,f)}ag(l,h),Ag(u,h)}return i?c:c[0]}function dg(e,t=null,n){if(!e.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],A=[{pos:e,types:o?new Array(e.length/i).fill(1):null,holes:t||[]}],l=[[],[]];let c=[];for(;A.length;){const{pos:e,types:t,holes:n}=A.shift();mg(e,i,n[0]||e.length,l),c=pg(l[0],r,s,c);const u=ug(l[1],c);if(u){let r=fg(e,t,i,0,n[0]||e.length,c,u);const s={pos:r[0].pos,types:r[0].types,holes:[]},a={pos:r[1].pos,types:r[1].types,holes:[]};A.push(s,a);for(let A=0;A<n.length;A++)r=fg(e,t,i,n[A],n[A+1]||e.length,c,u),r[0]&&(s.holes.push(s.pos.length),s.pos=_g(s.pos,r[0].pos),o&&(s.types=_g(s.types,r[0].types))),r[1]&&(a.holes.push(a.pos.length),a.pos=_g(a.pos,r[1].pos),o&&(a.types=_g(a.types,r[1].types)))}else{const i={positions:e};o&&(i.edgeTypes=t),n.length&&(i.holeIndices=n),a.push(i)}}return a}function fg(e,t,n,i,r,s,o){const a=(r-i)/n,A=[],l=[],c=[],u=[],h=[];let d,f,p;const g=lg(e,a-1,n,i);let m=Math.sign(8&o?g[1]-s[3]:g[0]-s[2]),_=t&&t[a-1],v=0,y=0;for(let b=0;b<a;b++)d=lg(e,b,n,i,d),f=Math.sign(8&o?d[1]-s[3]:d[0]-s[2]),p=t&&t[i/n+b],f&&m&&m!==f&&(cg(g,d,o,s,h),ag(A,h)&&c.push(_),ag(l,h)&&u.push(_)),f<=0?(ag(A,d)&&c.push(p),v-=f):c.length&&(c[c.length-1]=0),f>=0?(ag(l,d)&&u.push(p),y+=f):u.length&&(u[u.length-1]=0),Ag(g,d),m=f,_=p;return[v?{pos:A,types:t&&c}:null,y?{pos:l,types:t&&u}:null]}function pg(e,t,n,i){const r=Math.floor((e[0]-n[0])/t)*t+n[0],s=Math.floor((e[1]-n[1])/t)*t+n[1];return i[0]=r,i[1]=s,i[2]=r+t,i[3]=s+t,i}function gg(e,t,n){8&n?(e[1]+=t,e[3]+=t):4&n?(e[1]-=t,e[3]-=t):2&n?(e[0]+=t,e[2]+=t):1&n&&(e[0]-=t,e[2]-=t)}function mg(e,t,n,i){let r=1/0,s=-1/0,o=1/0,a=-1/0;for(let A=0;A<n;A+=t){const t=e[A],n=e[A+1];r=t<r?t:r,s=t>s?t:s,o=n<o?n:o,a=n>a?n:a}return i[0][0]=r,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}function _g(e,t){for(let n=0;n<t.length;n++)e.push(t[n]);return e}function vg(e,t,n,i){let r=-1,s=-1;for(let o=n+1;o<i;o+=t){const t=Math.abs(e[o]);t>r&&(r=t,s=o-1)}return s}function yg(e,t,n,i,r=85.051129){const s=e[n],o=e[i-t];if(Math.abs(s-o)>180){const i=lg(e,0,t,n);i[0]+=360*Math.round((o-s)/360),ag(e,i),i[1]=Math.sign(i[1])*r,ag(e,i),i[0]=s,ag(e,i)}}function bg(e,t,n,i){let r,s=e[0];for(let o=n;o<i;o+=t){r=e[o];const t=r-s;(t>180||t<-180)&&(r-=360*Math.round(t/360)),e[o]=s=r}}function wg(e,t){let n;const i=e.length/t;for(let s=0;s<i&&(n=e[s*t],(n+180)%360==0);s++);const r=360*-Math.round(n/360);if(0!==r)for(let s=0;s<i;s++)e[s*t]+=r}class Eg extends tu{constructor(e){const{indices:t,attributes:n}=function(e){const{radius:t,height:n=1,nradial:i=10}=e;let{vertices:r}=e;r&&(Mt.assert(r.length>=i),r=r.flatMap(e=>[e[0],e[1]]),sg(r,rg));const s=n>0,o=i+1,a=s?3*o+1:i,A=2*Math.PI/i,l=new Uint16Array(s?3*i*2:0),c=new Float32Array(3*a),u=new Float32Array(3*a);let h=0;if(s){for(let e=0;e<o;e++){const s=e*A,o=e%i,a=Math.sin(s),l=Math.cos(s);for(let e=0;e<2;e++)c[h+0]=r?r[2*o]:l*t,c[h+1]=r?r[2*o+1]:a*t,c[h+2]=(.5-e)*n,u[h+0]=r?r[2*o]:l,u[h+1]=r?r[2*o+1]:a,h+=3}c[h+0]=c[h-3],c[h+1]=c[h-2],c[h+2]=c[h-1],h+=3}for(let d=s?0:1;d<o;d++){const e=Math.floor(d/2)*Math.sign(.5-d%2),s=e*A,o=(e+i)%i,a=Math.sin(s),l=Math.cos(s);c[h+0]=r?r[2*o]:l*t,c[h+1]=r?r[2*o+1]:a*t,c[h+2]=n/2,u[h+2]=1,h+=3}if(s){let e=0;for(let t=0;t<i;t++)l[e++]=2*t+0,l[e++]=2*t+2,l[e++]=2*t+0,l[e++]=2*t+1,l[e++]=2*t+1,l[e++]=2*t+3}return{indices:l,attributes:{POSITION:{size:3,value:c},NORMAL:{size:3,value:u}}}}(e);super({...e,indices:t,attributes:n})}}const xg="uniform columnUniforms {\n  float radius;\n  float angle;\n  vec2 offset;\n  bool extruded;\n  bool stroked;\n  bool isStroke;\n  float coverage;\n  float elevationScale;\n  float edgeDistance;\n  float widthScale;\n  float widthMinPixels;\n  float widthMaxPixels;\n  highp int radiusUnits;\n  highp int widthUnits;\n} column;\n",Tg={name:"column",vs:xg,fs:xg,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},Sg=[0,0,0,255],Cg={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:Sg},getLineColor:{type:"accessor",value:Sg},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Pg extends Op{getShaders(){const e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:"#version 300 es\n#define SHADER_NAME column-layer-vertex-shader\nin vec3 positions;\nin vec3 normals;\nin vec3 instancePositions;\nin float instanceElevations;\nin vec3 instancePositions64Low;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin float instanceStrokeWidths;\nin vec3 instancePickingColors;\nout vec4 vColor;\n#ifdef FLAT_SHADING\nout vec3 cameraPosition;\nout vec4 position_commonspace;\n#endif\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nvec4 color = column.isStroke ? instanceLineColors : instanceFillColors;\nmat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));\nfloat elevation = 0.0;\nfloat strokeOffsetRatio = 1.0;\nif (column.extruded) {\nelevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;\n} else if (column.stroked) {\nfloat widthPixels = clamp(\nproject_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),\ncolumn.widthMinPixels, column.widthMaxPixels) / 2.0;\nfloat halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);\nif (column.isStroke) {\nstrokeOffsetRatio -= sign(positions.z) * halfOffset;\n} else {\nstrokeOffsetRatio -= halfOffset;\n}\n}\nfloat shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\nfloat dotRadius = column.radius * column.coverage * shouldRender;\ngeometry.pickingColor = instancePickingColors;\nvec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\nvec3 centroidPosition64Low = instancePositions64Low;\nvec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;\nif (column.radiusUnits == UNIT_METERS) {\noffset = project_size(offset);\n}\nvec3 pos = vec3(offset, 0.);\nDECKGL_FILTER_SIZE(pos, geometry);\ngl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\ngeometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (column.extruded && !column.isStroke) {\n#ifdef FLAT_SHADING\ncameraPosition = project.cameraPosition;\nposition_commonspace = geometry.position;\nvColor = vec4(color.rgb, color.a * layer.opacity);\n#else\nvec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, color.a * layer.opacity);\n#endif\n} else {\nvColor = vec4(color.rgb, color.a * layer.opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME column-layer-fragment-shader\nprecision highp float;\nout vec4 fragColor;\nin vec4 vColor;\n#ifdef FLAT_SHADING\nin vec3 cameraPosition;\nin vec4 position_commonspace;\n#endif\nvoid main(void) {\nfragColor = vColor;\ngeometry.uv = vec2(0.);\n#ifdef FLAT_SHADING\nif (column.extruded && !column.isStroke && !bool(picking.isActive)) {\nvec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\nfragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);\n}\n#endif\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:e,modules:[ZA,t?Ta:xa,Nl,Tg]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:Sg},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:Sg},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var t;super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=r.extensionsChanged||n.flatShading!==i.flatShading;s&&(null==(t=this.state.models)||t.forEach(e=>e.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const o=this.getNumInstances();this.state.fillModel.setInstanceCount(o),this.state.wireframeModel.setInstanceCount(o),(s||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices||(n.extruded||n.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(n)}getGeometry(e,t,n){const i=new Eg({radius:1,height:n?2:0,vertices:t,nradial:e});let r=0;if(t)for(let s=0;s<e;s++){const n=t[s];r+=Math.sqrt(n[0]*n[0]+n[1]*n[1])/e}else r=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*r}),i}_getModels(){const e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),n=new Kc(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:t,isInstanced:!0}),i=new Kc(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:t,isInstanced:!0});return{fillModel:n,wireframeModel:i,models:[i,n]}}_updateGeometry({diskResolution:e,vertices:t,extruded:n,stroked:i}){const r=this.getGeometry(e,t,n||i);this.setState({fillVertexCount:r.attributes.POSITION.value.length/3});const s=this.state.fillModel,o=this.state.wireframeModel;s.setGeometry(r),s.setTopology("triangle-strip"),s.setIndexBuffer(null),o.setGeometry(r),o.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:t,lineWidthScale:n,lineWidthMinPixels:i,lineWidthMaxPixels:r,radiusUnits:s,elevationScale:o,extruded:a,filled:A,stroked:l,wireframe:c,offset:u,coverage:h,radius:d,angle:f}=this.props,p=this.state.fillModel,g=this.state.wireframeModel,{fillVertexCount:m,edgeDistance:_}=this.state,v={radius:d,angle:f/180*Math.PI,offset:u,extruded:a,stroked:l,coverage:h,elevationScale:o,edgeDistance:_,radiusUnits:LA[s],widthUnits:LA[t],widthScale:n,widthMinPixels:i,widthMaxPixels:r};a&&c&&(g.shaderInputs.setProps({column:{...v,isStroke:!0}}),g.draw(this.context.renderPass)),A&&(p.setVertexCount(m),p.shaderInputs.setProps({column:{...v,isStroke:!1}}),p.draw(this.context.renderPass)),!a&&l&&(p.setVertexCount(2*m/3),p.shaderInputs.setProps({column:{...v,isStroke:!0}}),p.draw(this.context.renderPass))}}function Rg(e,t,n,i){let r;if(Array.isArray(e[0])){const n=e.length*t;r=new Array(n);for(let i=0;i<e.length;i++)for(let n=0;n<t;n++)r[i*t+n]=e[i][n]||0}else r=e;return n?hg(r,{size:t,gridResolution:n}):i?function(e,t){const{size:n=2,startIndex:i=0,endIndex:r=e.length,normalize:s=!0}=t||{},o=e.slice(i,r);bg(o,n,0,r-i);const a=hg(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const A of a)wg(A,n);return a}(r,{size:t}):r}Pg.layerName="ColumnLayer",Pg.defaultProps=Cg;class Ig extends zp{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?Rg(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(Mg(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&Mg(e))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const n=this.attributes.segmentTypes,i=!!e&&this.isClosed(e),{vertexStart:r,geometrySize:s}=t;n.fill(0,r,r+s),i?(n[r]=4,n[r+s-2]=4):(n[r]+=1,n[r+s-2]+=2),n[r+s-1]=4}_updatePositions(e,t){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:i,geometrySize:r}=t,s=new Array(3);for(let o=i,a=0;a<r;o++,a++)this.getPointOnPath(e,a,s),n[3*o]=s[0],n[3*o+1]=s[1],n[3*o+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,n=[]){const{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);const r=t*i;return n[0]=e[r],n[1]=e[r+1],n[2]=3===i&&e[r+2]||0,n}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:t}=this,n=e.length-t;return e[0]===e[n]&&e[1]===e[n+1]&&(2===t||e[2]===e[n+2])}}function Mg(e){return Array.isArray(e[0])}const kg="uniform pathUniforms {\n  float widthScale;\n  float widthMinPixels;\n  float widthMaxPixels;\n  float jointType;\n  float capType;\n  float miterLimit;\n  bool billboard;\n  highp int widthUnits;\n} path;\n",Lg={name:"path",vs:kg,fs:kg,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},Bg=[0,0,0,255],Dg={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:Bg},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Og={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class Ng extends Op{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME path-layer-vertex-shader\nin vec2 positions;\nin float instanceTypes;\nin vec3 instanceStartPositions;\nin vec3 instanceEndPositions;\nin vec3 instanceLeftPositions;\nin vec3 instanceRightPositions;\nin vec3 instanceLeftPositions64Low;\nin vec3 instanceStartPositions64Low;\nin vec3 instanceEndPositions64Low;\nin vec3 instanceRightPositions64Low;\nin float instanceStrokeWidths;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nuniform float opacity;\nout vec4 vColor;\nout vec2 vCornerOffset;\nout float vMiterLength;\nout vec2 vPathPosition;\nout float vPathLength;\nout float vJointType;\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\nfloat flipIfTrue(bool flag) {\nreturn -(float(flag) * 2. - 1.);\n}\nvec3 getLineJoinOffset(\nvec3 prevPoint, vec3 currPoint, vec3 nextPoint,\nvec2 width\n) {\nbool isEnd = positions.x > 0.0;\nfloat sideOfPath = positions.y;\nfloat isJoint = float(sideOfPath == 0.0);\nvec3 deltaA3 = (currPoint - prevPoint);\nvec3 deltaB3 = (nextPoint - currPoint);\nmat3 rotationMatrix;\nbool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);\nif (needsRotation) {\ndeltaA3 = deltaA3 * rotationMatrix;\ndeltaB3 = deltaB3 * rotationMatrix;\n}\nvec2 deltaA = deltaA3.xy / width;\nvec2 deltaB = deltaB3.xy / width;\nfloat lenA = length(deltaA);\nfloat lenB = length(deltaB);\nvec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\nvec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\nvec2 perpA = vec2(-dirA.y, dirA.x);\nvec2 perpB = vec2(-dirB.y, dirB.x);\nvec2 tangent = dirA + dirB;\ntangent = length(tangent) > 0. ? normalize(tangent) : perpA;\nvec2 miterVec = vec2(-tangent.y, tangent.x);\nvec2 dir = isEnd ? dirA : dirB;\nvec2 perp = isEnd ? perpA : perpB;\nfloat L = isEnd ? lenA : lenB;\nfloat sinHalfA = abs(dot(miterVec, perp));\nfloat cosHalfA = abs(dot(dirA, miterVec));\nfloat turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\nfloat cornerPosition = sideOfPath * turnDirection;\nfloat miterSize = 1.0 / max(sinHalfA, EPSILON);\nmiterSize = mix(\nmin(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\nmiterSize,\nstep(0.0, cornerPosition)\n);\nvec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n* (sideOfPath + isJoint * turnDirection);\nbool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\nbool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\nbool isCap = isStartCap || isEndCap;\nif (isCap) {\noffsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);\nvJointType = path.capType;\n} else {\nvJointType = path.jointType;\n}\nvPathLength = L;\nvCornerOffset = offsetVec;\nvMiterLength = dot(vCornerOffset, miterVec * turnDirection);\nvMiterLength = isCap ? isJoint : vMiterLength;\nvec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\nvPathPosition = vec2(\ndot(offsetFromStartOfPath, perp),\ndot(offsetFromStartOfPath, dir)\n);\ngeometry.uv = vPathPosition;\nfloat isValid = step(instanceTypes, 3.5);\nvec3 offset = vec3(offsetVec * width * isValid, 0.0);\nif (needsRotation) {\noffset = rotationMatrix * offset;\n}\nreturn offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\nif (position.w < EPSILON) {\nfloat r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\nposition = refPosition + (position - refPosition) * r;\n}\n}\nvoid main() {\ngeometry.pickingColor = instancePickingColors;\nvColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);\nfloat isEnd = positions.x;\nvec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\nvec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\nvec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\nvec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\nvec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\nvec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\ngeometry.worldPosition = currPosition;\nvec2 widthPixels = vec2(clamp(\nproject_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),\npath.widthMinPixels, path.widthMaxPixels) / 2.0);\nvec3 width;\nif (path.billboard) {\nvec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\nvec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\nvec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\nclipLine(prevPositionScreen, currPositionScreen);\nclipLine(nextPositionScreen, currPositionScreen);\nclipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\nwidth = vec3(widthPixels, 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(\nprevPositionScreen.xyz / prevPositionScreen.w,\ncurrPositionScreen.xyz / currPositionScreen.w,\nnextPositionScreen.xyz / nextPositionScreen.w,\nproject_pixel_size_to_clipspace(width.xy)\n);\nDECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);\ngl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);\n} else {\nprevPosition = project_position(prevPosition, prevPosition64Low);\ncurrPosition = project_position(currPosition, currPosition64Low);\nnextPosition = project_position(nextPosition, nextPosition64Low);\nwidth = vec3(project_pixel_size(widthPixels), 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);\ngeometry.position = vec4(currPosition + offset, 1.0);\ngl_Position = project_common_position_to_clipspace(geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME path-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 vCornerOffset;\nin float vMiterLength;\nin vec2 vPathPosition;\nin float vPathLength;\nin float vJointType;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = vPathPosition;\nif (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\nif (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\ndiscard;\n}\nif (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {\ndiscard;\n}\n}\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[ZA,Nl,Lg]})}get wrapLongitude(){return!1}getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["vertexPositions"])}initializeState(){const e=!0;this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Og,accessor:"getPath",update:this.calculatePositions,noAlloc:e,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:e},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Og,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Og,defaultValue:Bg},instancePickingColors:{size:4,type:"uint8",accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n)}}),this.setState({pathTesselator:new Ig({fp64:this.use64bitPositions()})})}updateState(e){var t;super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:e}=this.state,t=n.data.attributes||{};e.updateGeometry({data:n.data,geometryBuffer:t.getPath,buffers:t,normalize:!n._pathType,loop:"loop"===n._pathType,getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),i.dataChanged||r.invalidateAll()}i.extensionsChanged&&(null==(t=this.state.model)||t.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(e=>e.__source.index===n)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:n,billboard:i,miterLimit:r,widthUnits:s,widthScale:o,widthMinPixels:a,widthMaxPixels:A}=this.props,l=this.state.model,c={jointType:Number(t),capType:Number(n),billboard:i,widthUnits:LA[s],widthScale:o,miterLimit:r,widthMinPixels:a,widthMaxPixels:A};l.shaderInputs.setProps({path:c}),l.draw(this.context.renderPass)}_getModel(){return new Kc(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new tu({topology:"triangle-list",attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}Ng.defaultProps=Dg,Ng.layerName="PathLayer";var Fg,Ug={exports:{}};var Gg=function(){if(Fg)return Ug.exports;function e(e,n,r){r=r||2;var s,o,a,c,u,d,f,p=n&&n.length,g=p?n[0]*r:e.length,m=t(e,0,g,r,!0),_=[];if(!m||m.next===m.prev)return _;if(p&&(m=function(e,n,i,r){var s,o,a,c=[];for(s=0,o=n.length;s<o;s++)(a=t(e,n[s]*r,s<o-1?n[s+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),c.push(h(a));for(c.sort(A),s=0;s<c.length;s++)i=l(c[s],i);return i}(e,n,m,r)),e.length>80*r){s=a=e[0],o=c=e[1];for(var v=r;v<g;v+=r)(u=e[v])<s&&(s=u),(d=e[v+1])<o&&(o=d),u>a&&(a=u),d>c&&(c=d);f=0!==(f=Math.max(a-s,c-o))?32767/f:0}return i(m,_,r,s,o,f,0),_}function t(e,t,n,i,r){var s,o;if(r===T(e,t,n,i)>0)for(s=t;s<n;s+=i)o=w(s,e[s],e[s+1],o);else for(s=n-i;s>=t;s-=i)o=w(s,e[s],e[s+1],o);return o&&g(o,o.next)&&(E(o),o=o.next),o}function n(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!g(i,i.next)&&0!==p(i.prev,i,i.next))i=i.next;else{if(E(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function i(e,t,A,l,c,h,d){if(e){!d&&h&&function(e,t,n,i){var r=e;do{0===r.z&&(r.z=u(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,s,o,a,A,l=1;do{for(n=e,e=null,s=null,o=0;n;){for(o++,i=n,a=0,t=0;t<l&&(a++,i=i.nextZ);t++);for(A=l;a>0||A>0&&i;)0!==a&&(0===A||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,A--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;n=i}s.nextZ=null,l*=2}while(o>1)}(r)}(e,l,c,h);for(var f,p,g=e;e.prev!==e.next;)if(f=e.prev,p=e.next,h?s(e,l,c,h):r(e))t.push(f.i/A|0),t.push(e.i/A|0),t.push(p.i/A|0),E(e),e=p.next,g=p.next;else if((e=p)===g){d?1===d?i(e=o(n(e),t,A),t,A,l,c,h,2):2===d&&a(e,t,A,l,c,h):i(n(e),t,A,l,c,h,1);break}}}function r(e){var t=e.prev,n=e,i=e.next;if(p(t,n,i)>=0)return!1;for(var r=t.x,s=n.x,o=i.x,a=t.y,A=n.y,l=i.y,c=r<s?r<o?r:o:s<o?s:o,u=a<A?a<l?a:l:A<l?A:l,h=r>s?r>o?r:o:s>o?s:o,f=a>A?a>l?a:l:A>l?A:l,g=i.next;g!==t;){if(g.x>=c&&g.x<=h&&g.y>=u&&g.y<=f&&d(r,a,s,A,o,l,g.x,g.y)&&p(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function s(e,t,n,i){var r=e.prev,s=e,o=e.next;if(p(r,s,o)>=0)return!1;for(var a=r.x,A=s.x,l=o.x,c=r.y,h=s.y,f=o.y,g=a<A?a<l?a:l:A<l?A:l,m=c<h?c<f?c:f:h<f?h:f,_=a>A?a>l?a:l:A>l?A:l,v=c>h?c>f?c:f:h>f?h:f,y=u(g,m,t,n,i),b=u(_,v,t,n,i),w=e.prevZ,E=e.nextZ;w&&w.z>=y&&E&&E.z<=b;){if(w.x>=g&&w.x<=_&&w.y>=m&&w.y<=v&&w!==r&&w!==o&&d(a,c,A,h,l,f,w.x,w.y)&&p(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,E.x>=g&&E.x<=_&&E.y>=m&&E.y<=v&&E!==r&&E!==o&&d(a,c,A,h,l,f,E.x,E.y)&&p(E.prev,E,E.next)>=0)return!1;E=E.nextZ}for(;w&&w.z>=y;){if(w.x>=g&&w.x<=_&&w.y>=m&&w.y<=v&&w!==r&&w!==o&&d(a,c,A,h,l,f,w.x,w.y)&&p(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;E&&E.z<=b;){if(E.x>=g&&E.x<=_&&E.y>=m&&E.y<=v&&E!==r&&E!==o&&d(a,c,A,h,l,f,E.x,E.y)&&p(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function o(e,t,i){var r=e;do{var s=r.prev,o=r.next.next;!g(s,o)&&m(s,r,r.next,o)&&y(s,o)&&y(o,s)&&(t.push(s.i/i|0),t.push(r.i/i|0),t.push(o.i/i|0),E(r),E(r.next),r=e=o),r=r.next}while(r!==e);return n(r)}function a(e,t,r,s,o,a){var A=e;do{for(var l=A.next.next;l!==A.prev;){if(A.i!==l.i&&f(A,l)){var c=b(A,l);return A=n(A,A.next),c=n(c,c.next),i(A,t,r,s,o,a,0),void i(c,t,r,s,o,a,0)}l=l.next}A=A.next}while(A!==e)}function A(e,t){return e.x-t.x}function l(e,t){var i=function(e,t){var n,i=t,r=e.x,s=e.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>o&&(o=a,n=i.x<i.next.x?i:i.next,a===r))return n}i=i.next}while(i!==t);if(!n)return null;var A,l=n,u=n.x,h=n.y,f=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&d(s<h?r:o,s,u,h,s<h?o:r,s,i.x,i.y)&&(A=Math.abs(s-i.y)/(r-i.x),y(i,e)&&(A<f||A===f&&(i.x>n.x||i.x===n.x&&c(n,i)))&&(n=i,f=A)),i=i.next}while(i!==l);return n}(e,t);if(!i)return t;var r=b(i,e);return n(r,r.next),n(i,i.next)}function c(e,t){return p(e.prev,e,t.prev)<0&&p(t.next,e,e.next)<0}function u(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function h(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function d(e,t,n,i,r,s,o,a){return(r-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(i-a)>=(n-o)*(t-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function f(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&m(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(y(e,t)&&y(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(p(e.prev,e,t.prev)||p(e,t.prev,t))||g(e,t)&&p(e.prev,e,e.next)>0&&p(t.prev,t,t.next)>0)}function p(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function g(e,t){return e.x===t.x&&e.y===t.y}function m(e,t,n,i){var r=v(p(e,t,n)),s=v(p(e,t,i)),o=v(p(n,i,e)),a=v(p(n,i,t));return r!==s&&o!==a||(!(0!==r||!_(e,n,t))||(!(0!==s||!_(e,i,t))||(!(0!==o||!_(n,e,i))||!(0!==a||!_(n,t,i)))))}function _(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function v(e){return e>0?1:e<0?-1:0}function y(e,t){return p(e.prev,e,e.next)<0?p(e,t,e.next)>=0&&p(e,e.prev,t)>=0:p(e,t,e.prev)<0||p(e,e.next,t)<0}function b(e,t){var n=new x(e.i,e.x,e.y),i=new x(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function w(e,t,n,i){var r=new x(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function x(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(e,t,n,i){for(var r=0,s=t,o=n-i;s<n;s+=i)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}return Fg=1,Ug.exports=e,Ug.exports.default=e,e.deviation=function(e,t,n,i){var r=t&&t.length,s=r?t[0]*n:e.length,o=Math.abs(T(e,0,s,n));if(r)for(var a=0,A=t.length;a<A;a++){var l=t[a]*n,c=a<A-1?t[a+1]*n:e.length;o-=Math.abs(T(e,l,c,n))}var u=0;for(a=0;a<i.length;a+=3){var h=i[a]*n,d=i[a+1]*n,f=i[a+2]*n;u+=Math.abs((e[h]-e[f])*(e[d+1]-e[h+1])-(e[h]-e[d])*(e[f+1]-e[h+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++)for(var o=0;o<t;o++)n.vertices.push(e[r][s][o]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n},Ug.exports}();const zg=o(Gg),Vg=ig,Wg=rg,jg={};function Hg(e){return"positions"in e?e.positions:e}function Xg(e){return"holeIndices"in e?e.holeIndices:null}function Qg(e,t,n,i,r){let s=t;const o=n.length;for(let a=0;a<o;a++)for(let t=0;t<i;t++)e[s++]=n[a][t]||0;if(!function(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}(n))for(let a=0;a<i;a++)e[s++]=n[0][a]||0;return jg.start=t,jg.end=s,jg.size=i,sg(e,r,jg),s}function $g(e,t,n,i,r=0,s,o){const a=(s=s||n.length)-r;if(a<=0)return t;let A=t;for(let l=0;l<a;l++)e[A++]=n[r+l];if(!function(e,t,n,i){for(let r=0;r<t;r++)if(e[n+r]!==e[i-t+r])return!1;return!0}(n,i,r,s))for(let l=0;l<i;l++)e[A++]=n[r+l];return jg.start=t,jg.end=A,jg.size=i,sg(e,o,jg),A}function Yg(e,t){!function(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}(e);const n=[],i=[];if("positions"in e){const{positions:r,holeIndices:s}=e;if(s){let e=0;for(let o=0;o<=s.length;o++)e=$g(n,e,r,t,s[o-1],s[o],0===o?Vg:Wg),i.push(e);return i.pop(),{positions:n,holeIndices:i}}e=r}if(!function(e){return Array.isArray(e[0])}(e))return $g(n,0,e,t,0,n.length,Vg),n;if(!function(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}(e)){let r=0;for(const[s,o]of e.entries())r=Qg(n,r,o,t,0===s?Vg:Wg),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return Qg(n,0,e,t,Vg),n}function Kg(e,t,n){const i=e.length/3;let r=0;for(let s=0;s<i;s++){const o=(s+1)%i;r+=e[3*s+t]*e[3*o+n],r-=e[3*o+t]*e[3*s+n]}return Math.abs(r/2)}function Zg(e,t,n,i){const r=e.length/3;for(let s=0;s<r;s++){const r=3*s,o=e[r+0],a=e[r+1],A=e[r+2];e[r+t]=o,e[r+n]=a,e[r+i]=A}}class qg extends zp{constructor(e){const{fp64:t,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:t}=this;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=Yg(e,this.positionSize);return this.opts.resolution?dg(Hg(t),Xg(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?function(e,t=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};t=t||[];const o=[],a=[];let A=0,l=0;for(let u=0;u<=t.length;u++){const r=t[u]||e.length,s=l,c=vg(e,i,A,r);for(let t=c;t<r;t++)o[l++]=e[t];for(let t=A;t<c;t++)o[l++]=e[t];bg(o,i,s,l),yg(o,i,s,l,null==n?void 0:n.maxLatitude),A=r,a[u]=l}a.pop();const c=dg(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const u of c)wg(u.positions,i);return c}(Hg(t),Xg(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(Jg(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}return Hg(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&Jg(e))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const n=e;this._updateIndices(n,t),this._updatePositions(n,t),this._updateVertexValid(n,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:n,indexStart:i}){const{attributes:r,indexStarts:s,typedArrayManager:o}=this;let a=r.indices;if(!a||!e)return;let A=i;const l=function(e,t,n,i){let r=Xg(e);r&&(r=r.map(e=>e/t));let s=Hg(e);const o=i&&3===t;if(n){const e=s.length;s=s.slice();const i=[];for(let r=0;r<e;r+=t){i[0]=s[r],i[1]=s[r+1],o&&(i[2]=s[r+2]);const e=n(i);s[r]=e[0],s[r+1]=e[1],o&&(s[r+2]=e[2])}}if(o){const e=Kg(s,0,1),t=Kg(s,0,2),i=Kg(s,1,2);if(!e&&!t&&!i)return[];e>t&&e>i||(t>i?(n||(s=s.slice()),Zg(s,0,2,1)):(n||(s=s.slice()),Zg(s,2,0,1)))}return zg(s,r,t)}(e,this.positionSize,this.opts.preproject,this.opts.full3d);a=o.allocate(a,i+l.length,{copy:!0});for(let c=0;c<l.length;c++)a[A++]=l[c]+n;s[t+1]=i+l.length,r.indices=a}_updatePositions(e,{vertexStart:t,geometrySize:n}){const{attributes:{positions:i},positionSize:r}=this;if(!i||!e)return;const s=Hg(e);for(let o=t,a=0;a<n;o++,a++){const e=s[a*r],t=s[a*r+1],n=r>2?s[a*r+2]:0;i[3*o]=e,i[3*o+1]=t,i[3*o+2]=n}}_updateVertexValid(e,{vertexStart:t,geometrySize:n}){const{positionSize:i}=this,r=this.attributes.vertexValid,s=e&&Xg(e);if(e&&e.edgeTypes?r.set(e.edgeTypes,t):r.fill(1,t,t+n),s)for(let o=0;o<s.length;o++)r[t+s[o]/i-1]=0;r[t+n-1]=0}}function Jg(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}const em="uniform solidPolygonUniforms {\n  bool extruded;\n  bool isWireframe;\n  float elevationScale;\n} solidPolygon;\n",tm={name:"solidPolygon",vs:em,fs:em,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},nm="in vec4 fillColors;\nin vec4 lineColors;\nin vec3 pickingColors;\nout vec4 vColor;\nstruct PolygonProps {\nvec3 positions;\nvec3 positions64Low;\nvec3 normal;\nfloat elevations;\n};\nvec3 project_offset_normal(vec3 vector) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\nreturn normalize(vector * project.commonUnitsPerWorldUnit);\n}\nreturn project_normal(vector);\n}\nvoid calculatePosition(PolygonProps props) {\nvec3 pos = props.positions;\nvec3 pos64Low = props.positions64Low;\nvec3 normal = props.normal;\nvec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;\ngeometry.worldPosition = props.positions;\ngeometry.pickingColor = pickingColors;\nif (solidPolygon.extruded) {\npos.z += props.elevations * solidPolygon.elevationScale;\n}\ngl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (solidPolygon.extruded) {\n#ifdef IS_SIDE_VERTEX\nnormal = project_offset_normal(normal);\n#else\nnormal = project_normal(normal);\n#endif\ngeometry.normal = normal;\nvec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, colors.a * layer.opacity);\n} else {\nvColor = vec4(colors.rgb, colors.a * layer.opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",im=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader\nin vec3 vertexPositions;\nin vec3 vertexPositions64Low;\nin float elevations;\n${nm}\nvoid main(void) {\nPolygonProps props;\nprops.positions = vertexPositions;\nprops.positions64Low = vertexPositions64Low;\nprops.elevations = elevations;\nprops.normal = vec3(0.0, 0.0, 1.0);\ncalculatePosition(props);\n}\n`,rm=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\nin vec2 positions;\nin vec3 vertexPositions;\nin vec3 nextVertexPositions;\nin vec3 vertexPositions64Low;\nin vec3 nextVertexPositions64Low;\nin float elevations;\nin float instanceVertexValid;\n${nm}\nvoid main(void) {\nif(instanceVertexValid < 0.5){\ngl_Position = vec4(0.);\nreturn;\n}\nPolygonProps props;\nvec3 pos;\nvec3 pos64Low;\nvec3 nextPos;\nvec3 nextPos64Low;\n#if RING_WINDING_ORDER_CW == 1\npos = vertexPositions;\npos64Low = vertexPositions64Low;\nnextPos = nextVertexPositions;\nnextPos64Low = nextVertexPositions64Low;\n#else\npos = nextVertexPositions;\npos64Low = nextVertexPositions64Low;\nnextPos = vertexPositions;\nnextPos64Low = vertexPositions64Low;\n#endif\nprops.positions = mix(pos, nextPos, positions.x);\nprops.positions64Low = mix(pos64Low, nextPos64Low, positions.x);\nprops.normal = vec3(\npos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),\nnextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),\n0.0);\nprops.elevations = elevations * positions.y;\ncalculatePosition(props);\n}\n`,sm=[0,0,0,255],om={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:sm},getLineColor:{type:"accessor",value:sm},material:!0},am={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class Am extends Op{getShaders(e){return super.getShaders({vs:"top"===e?im:rm,fs:"#version 300 es\n#define SHADER_NAME solid-polygon-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\nfragColor = vColor;\ngeometry.uv = vec2(0.);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[ZA,xa,Nl,tm]})}get wrapLongitude(){return!1}getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:n}=this.props;let i;e.isGeospatial&&t===MA.DEFAULT&&(t=MA.LNGLAT),t===MA.LNGLAT&&(i=n?e.projectPosition.bind(e):e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new qg({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const r=this.getAttributeManager(),s=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:am,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,stepMode:"dynamic",transition:am,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:am,accessor:"getFillColor",defaultValue:sm},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:am,accessor:"getLineColor",defaultValue:sm},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find(e=>e.__source.index===n)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:n,wireframe:i,elevationScale:r}=this.props,{topModel:s,sideModel:o,wireframeModel:a,polygonTesselator:A}=this.state,l={extruded:Boolean(t),elevationScale:r,isWireframe:!1};a&&i&&(a.setInstanceCount(A.instanceCount-1),a.shaderInputs.setProps({solidPolygon:{...l,isWireframe:!0}}),a.draw(this.context.renderPass)),o&&n&&(o.setInstanceCount(A.instanceCount-1),o.shaderInputs.setProps({solidPolygon:l}),o.draw(this.context.renderPass)),s&&n&&(s.setVertexCount(A.vertexCount),s.shaderInputs.setProps({solidPolygon:l}),s.draw(this.context.renderPass))}updateState(e){var t;super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager();(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded)&&(null==(t=this.state.models)||t.forEach(e=>e.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:t}=this.state,i=e.data.attributes||{};t.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:n}=this.props;let i,r,s;if(t){const t=this.getShaders("top");t.defines.NON_INSTANCED_MODEL=1;const n=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new Kc(this.context.device,{...t,id:`${e}-top`,topology:"triangle-list",bufferLayout:n,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const t=this.getAttributeManager().getBufferLayouts({isInstanced:!0});r=new Kc(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:t,geometry:new tu({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),s=new Kc(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:t,geometry:new tu({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[r,s,i].filter(Boolean),topModel:i,sideModel:r,wireframeModel:s}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}Am.defaultProps=om,Am.layerName="SolidPolygonLayer";const lm=[0,0,0,255],cm={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:lm},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class um extends Np{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&Mt.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const t=this.state.paths.slice(),n=e.dataChanged.map(e=>function({data:e,getIndex:t,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,o=e.length;let a=o,A=o;for(let u=0;u<o;u++){const n=t(e[u]);if(a>u&&n>=r&&(a=u),n>=s){A=u;break}}let l=a;const c=A-a!==i.length?e.slice(A):void 0;for(let u=0;u<i.length;u++)e[l++]=i[u];if(c){for(let t=0;t<c.length;t++)e[l++]=c[t];e.length=l}return{startRow:a,endRow:a+i.length}}({data:t,getIndex:e=>e.__source.index,dataRange:e,replace:this._getPaths(e)}));this.setState({paths:t,pathsDiff:n})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:n,positionFormat:i,_normalize:r}=this.props,s=[],o="XY"===i?2:3,{startRow:a,endRow:A}=e,{iterable:l,objectInfo:c}=Rf(t,a,A);for(const u of l){c.index++;let e=n(u,c);r&&(e=Yg(e,o));const{holeIndices:t}=e,i=e.positions||e;if(t)for(let n=0;n<=t.length;n++){const e=i.slice(t[n-1]||0,t[n]||i.length);s.push(this.getSubLayerRow({path:e},u,c.index))}else s.push(this.getSubLayerRow({path:i},u,c.index))}return s}renderLayers(){const{data:e,_dataDiff:t,stroked:n,filled:i,extruded:r,wireframe:s,_normalize:o,_windingOrder:a,elevationScale:A,transitions:l,positionFormat:c}=this.props,{lineWidthUnits:u,lineWidthScale:h,lineWidthMinPixels:d,lineWidthMaxPixels:f,lineJointRounded:p,lineMiterLimit:g,lineDashJustified:m}=this.props,{getFillColor:_,getLineColor:v,getLineWidth:y,getLineDashArray:b,getElevation:w,getPolygon:E,updateTriggers:x,material:T}=this.props,{paths:S,pathsDiff:C}=this.state,P=this.getSubLayerClass("fill",Am),R=this.getSubLayerClass("stroke",Ng),I=this.shouldRenderSubLayer("fill",S)&&new P({_dataDiff:t,extruded:r,elevationScale:A,filled:i,wireframe:s,_normalize:o,_windingOrder:a,getElevation:w,getFillColor:_,getLineColor:r&&s?v:lm,material:T,transitions:l},this.getSubLayerProps({id:"fill",updateTriggers:x&&{getPolygon:x.getPolygon,getElevation:x.getElevation,getFillColor:x.getFillColor,lineColors:r&&s,getLineColor:x.getLineColor}}),{data:e,positionFormat:c,getPolygon:E});return[!r&&I,!r&&n&&this.shouldRenderSubLayer("stroke",S)&&new R({_dataDiff:C&&(()=>C),widthUnits:u,widthScale:h,widthMinPixels:d,widthMaxPixels:f,jointRounded:p,miterLimit:g,dashJustified:m,_pathType:"loop",transitions:l&&{getWidth:l.getLineWidth,getColor:l.getLineColor,getPath:l.getPolygon},getColor:this.getSubLayerAccessor(v),getWidth:this.getSubLayerAccessor(y),getDashArray:this.getSubLayerAccessor(b)},this.getSubLayerProps({id:"stroke",updateTriggers:x&&{getWidth:x.getLineWidth,getColor:x.getLineColor,getDashArray:x.getLineDashArray}}),{data:S,positionFormat:c,getPath:e=>e.path}),r&&I]}}um.layerName="PolygonLayer",um.defaultProps=cm;var hm=function(e){var t,n=void 0!==(e=e||{})?e:{},i={};for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);var r,s="";"undefined"!=typeof document&&document.currentScript&&(s=document.currentScript.src),s=0!==s.indexOf("blob:")?s.substr(0,s.lastIndexOf("/")+1):"",r=function(e,t,n){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){if(200==i.status||0==i.status&&i.response)t(i.response);else{var r=j(e);r?t(r.buffer):n()}},i.onerror=n,i.send(null)};var o=n.print||function(){}.bind(),a=n.printErr||function(){}.bind();for(t in i)i.hasOwnProperty(t)&&(n[t]=i[t]);i=null,n.arguments&&n.arguments;var A=0;var l=!1;function c(e){var t,i=n["_"+e];return t="Cannot call unknown function "+e+", make sure it is exported",i||ie("Assertion failed: "+t),i}function u(e,t,n,i,r){var s={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);(function(e,t,n){(function(e,t,n,i){if(!(i>0))return 0;for(var r=n,s=n+i-1,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343)a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o);if(a<=127){if(n>=s)break;t[n++]=a}else if(a<=2047){if(n+1>=s)break;t[n++]=192|a>>6,t[n++]=128|63&a}else if(a<=65535){if(n+2>=s)break;t[n++]=224|a>>12,t[n++]=128|a>>6&63,t[n++]=128|63&a}else{if(n+3>=s)break;t[n++]=240|a>>18,t[n++]=128|a>>12&63,t[n++]=128|a>>6&63,t[n++]=128|63&a}}t[n]=0})(e,f,t,n)})(e,t=Y(n),n)}return t},array:function(e){var t,n,i=Y(e.length);return t=e,n=i,d.set(t,n),i}};var o=c(e),a=[],A=0;if(i)for(var l=0;l<i.length;l++){var u=s[n[l]];u?(0===A&&(A=Z()),a[l]=u(i[l])):a[l]=i[l]}var h,p=o.apply(null,a);return h=p,p="string"===t?y(h):"boolean"===t?Boolean(h):h,0!==A&&K(A),p}var h,d,f,p,g,m,_,v="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function y(e,t){return e?function(e,t,n){for(var i=t+n,r=t;e[r]&&!(r>=i);)++r;if(r-t>16&&e.subarray&&v)return v.decode(e.subarray(t,r));for(var s="";t<r;){var o=e[t++];if(128&o){var a=63&e[t++];if(192!=(224&o)){var A=63&e[t++];if((o=224==(240&o)?(15&o)<<12|a<<6|A:(7&o)<<18|a<<12|A<<6|63&e[t++])<65536)s+=String.fromCharCode(o);else{var l=o-65536;s+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else s+=String.fromCharCode((31&o)<<6|a)}else s+=String.fromCharCode(o)}return s}(f,e,t):""}function b(e,t){return e%t>0&&(e+=t-e%t),e}function w(e){h=e,n.HEAP8=d=new Int8Array(e),n.HEAP16=p=new Int16Array(e),n.HEAP32=g=new Int32Array(e),n.HEAPU8=f=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=new Uint32Array(e),n.HEAPF32=m=new Float32Array(e),n.HEAPF64=_=new Float64Array(e)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var E=n.TOTAL_MEMORY||33554432;function x(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var i=t.func;"number"==typeof i?void 0===t.arg?n.dynCall_v(i):n.dynCall_vi(i,t.arg):i(void 0===t.arg?null:t.arg)}else t()}}E=(h=n.buffer?n.buffer:new ArrayBuffer(E)).byteLength,w(h),g[7156]=5271536;var T=[],S=[],C=[],P=[];function R(e){T.unshift(e)}function I(e){P.unshift(e)}var M=Math.abs,k=Math.ceil,L=Math.floor,B=Math.min,D=0,O=null;n.preloadedImages={},n.preloadedAudios={};var N,F,U=null,G="data:application/octet-stream;base64,";function z(e){return String.prototype.startsWith?e.startsWith(G):0===e.indexOf(G)}U="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAEAAAAAAAAAAAEAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAA6B6FaUp9QQTPXMuL4myJBraiDfBwx9UBYJseitzTIQOL5if9jqZtAnXX+Z+ycb0C3pucbhRBCQG8wJBYqpRRAlWbDCzCY5z/eFWBUEve6P/+qo4Q50Y4/D9YM3iCcYT8fcA2QJSA0P4ADxu0qAAc/BNcGolVJ2j5d9FACqwquPh9z7MthtI9CSUSYJke/YUJQ/64OyjU0Qpi0+HCmFQdCm3GfIVdh2kHsJ11kAyauQYC3UDFJOoFBSJsFV1OwU0FK5fcxX4AmQWhy/zZIt/lACqaCPsBjzUDbdUNIScugQMYQlVJ4MXNANiuq8GTvRUDxTXnulxEZQFZ8QX5kpuw/qmG/JwYFlEAluh3Q6DB+QKn4vyNq0GZAKOXekas+UUB8xabXXhI6QG63C2pLtSNAdDBtyNfLDUDyOcu67ID2P0rCMvRXAeE/Ki2TSVyzyT9Dk+8Sz2uzP5J+w5ARWp0/NQAoOiMuhj9YnP+RyMJwPxgW7TvQVFk/KgsLYF0kQz9g5dAC6IwzQcgHPVvDex1B1XjppodHBkHJq3OMM9fwQNvcmJ7wddlAInGPpQs/w0BRobq5EBmtQJZ2ai7n+ZVAtv2G5E+bgECG+gIfKBlpQK5f8jdI91JAL39sL/WpPEB8rGxhDqklQK6yUf43XhBAxL9y/tK8+D86XyZpgrHiPwAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAP////8AAAAAAAAAAAAAAAABAAAAAAAAAAAAAAD/////AAAAAAAAAAABAAAAAQAAAAAAAAAAAAAA/////wAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8FAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAQABAAABAQAAAAAAAQAAAAEAAAABAAEAAAAAAAAAAAAAAAAAAAAAquJYWJZl+D9jaeZNtj/zPwwdI9KqaeO/qGefXwdHdz+q4lhYlmX4P+OrlPMN3PI/DB0j0qpp47+7SQLV4VIEQKriWFiWZfg/r2kma3tz8T82eQmLqNIGwMRIWXMqSvo/fcCszPux9j+jara6ozTwP6hnn18HR3c/MSoKLequ8r+SabgA2nj0P7jBLbDOHO8/1Ym/ICfH4T+6lxjvlFXHv73m373LRPU/0vXyDVxo7T+ToKRHJXMAQF/33578aPE/pAyy64tD9T8+U/hCvyruPwxv8Y7YYwLAuXYr8NAiCEB4+LDK0Sn0P1Qeuy4j+eo/OMx50n7K7L+TrGB/nyf8v5ehC2fbYPM/aXMKexiT6z8mFRIMjg/zP7yUVwGGBNw/E6opHERf8z/z0wR2g9DqPw4pBpcOhvu/NbA29uWAA8DMaTExyXzyP02biiQ+Ruk/S8jz2/FKBEB1pzZnpbb9P7pQU4wLfPI//7ZcQXeG6D9CqEQvAYoIwDB2VB6sSgRAVyv8H5We8T+EHWF8XNPmPzB2wT8Nrrg/SEi+cX+w4L8of+GtdSDxP1sjk5AdouU/6ZjOVru13r8K0obqI6bxvwVbdNXyhfA/w5GG024n5z+rwmtMzP8BwLw9pSX49QXABe/2uQxP8D+b6wCzCvXkP7uGT87fK+Q/pz/JWw4coj+qoBf2J0nwP/yE3PUo0+I/vFJeHcaC+D96luSIqvntP/bf8sHUYu8/gZNN41mL4z9bhOqVOF4FwO6lmAh1hQhAbCVxbdhk7z+1C8NdDcfiPwG36x/0OQBAx0WJ76c2+D9nlSHXANfuP2HlfZ3gqOE/EwnVlVPg9r96+oHzEH//v5bXzdT1Auw/DM3GwLsA4D9p/8uoKcr+v+U9x5DQVAPAehjSdghb7D9sc1IetODgP8MVwwB1pu6/azPk6OGe978W8t/TUc3rP+0QMvYfP+A/RsG/QpSE8D+l3uwScxzgPwQaifgujuw/k1Vti1I43z8MAwLnSh0GQH5nYnwwZgJAiGUzWC5s6j8WyyI/BbLgPw4iUapGeQJAB3W+imnp/j9BLWR4ssrpP2t+gG5Pstk/cpBsfm6DCMCOpU9dOZsFQEv8nFypHeo/ehJ6i+6S2D9jqlGEmarLv7STC5TRiOa/bC+x8WZD6D9H3yUkWpDZP8gZvmCMuQLAreY19/eRBsCoPOc8UzzpP6KI/QV+y9g/t/MoboyWzT+Hv5q3Zu3Mvy2xROCT4uY/9gQitMMg1T9abAqhWMDkv1oLTavoUfG/PMUJP9CD5j+fHRX3t6fSPz7W2gk6bvs/WRnuHwqN9D8YFturGCTmP1EZczv0b9I/5t4exabB5D/1ESLh5fTEP9X2z6SYweQ/6lv3I2zT0D9zkRGNUNMAQKoSvc4EIfs/Xggt8wQI5T+mJHHg/w/SP4lhT/9t8vQ/DrZ/DbwH7D+XlhbYZrjkP34LIpFt6c4/lwfp8fLX9L+j96CTTf76v3WdNhEv9uM/d8c3o4lV0D/vFdCHVcsFwAHeDq0F1QhApbYqcZiN5D9KoilqByXLPwX0/diA0vq/0fo0GxnxAMBbaTkvlCzjP/RrFrWXrMs/UYTrky7jA0DB9f4FiZYAQEGAk/3QzeE/r/TeqE8t0D/OqjlsnPbvvz8RKU8JOfW/smSEbK/O4T8MzuyPm3DDP/rFtctq9gZAfb1EVEaSA0Dts5dVInnhP18SFMc79MM/7y34cw6LAMDFrRJsZO0DwC2KLvLSYuA/hx5wcUHewz+49SnK/4ruPyeS0PX9a+E/ZxaaLvvZ3z8WPu5T2QS8Pygo4RIvMqa/BJ0Kqsd0279cKW4ay8jdP3b05bmZ364/10/qtdxk2r+Bcz6CDMvpv54qOw+Amdw/qLV71pW7sT/YKc80nIPUP8OfIaBJ77G/LyTuD1un2z+diYu8efWzP1wU7ACkfwjAZroyPL1yBkAmv3lKJJbbPysKSE4W+p0/dIgqY79TA8ATLTOQ3tsGwJ2zweD/Xdg/XO/jXeFUaL8VW2qLFKfov1cA9Aa6XfK/tIa7YGgI2T+f3hu/sxqPv2nXdPpf3Pc/jkw8Jbda8j+tT/z8tGPVP1yBHpJd35k/KYvYOy1s8j/yz+kCQjPrP9+agH7x59g/PZfJ9aBhpr/rDKzvYBb+PwtkiaGCt/c/vb1mVr+f1T/JIHwHc8Govw7aeF6+9vG/Xv7kD6fp979isYioQYHVP7AIQZuSFrG/3z1AdUTnAUDN3XY9O7f9P0AdQ9ljYNQ/dJANJPTOrb8kLECUiiPlP4yF7UgmStA/9xGmXxCG1T9qZzix4W2zv2SGJRJVrPe/Fh9a2M/B/b8IexzFCoPSP9y1QFD2bLe/Q86cWLJe/b+mOOfYm78BwOTjkPAGE9E/8aPCUKu/ub9pPZyLCiUGwBA7Mev/BQlALOmrlRi+0j+AMJ/dKULBv7iLtL6a6QRAEMDV/yajAUDa62dE3crJP1P70RgBUbq/38hVnR6esT/s1tG10Z/Ov/zLwalHPss/dTS9NKTXx78nMcRzCIEHQAabxDsAmQRA0tyLK3gSyT+Aui7nOhDGv5Gs58z3WgHATN3forJuBMCAui7nOhDGP9Lciyt4Esm/WAJyHQ4c7z8UP5HFIs3iP3U0vTSk18c//MvBqUc+y7+cvv8HLg/Kvy1I/mHsI+K/U/vRGAFRuj/a62dE3crJv8p+WV8KlQjAuQ/nOP43B0CAMJ/dKULBPyzpq5UYvtK/ZoU+VoLh4L9etLlRUfvtv/GjwlCrv7k/5OOQ8AYT0b9DfT9FhufXPwUX8hJp+4u/3LVAUPZstz8IexzFCoPSv9+L609E5fQ/q9Fz7X2J7T9qZzix4W2zP/cRpl8QhtW/vtNilqGX+j8MOy7QJoL0P3SQDST0zq0/QB1D2WNg1L8IIjSvGNkDwGB8Jou2GAfAsAhBm5IWsT9isYioQYHVvyS9D3zb6uy/gnwRa7uM9L/JIHwHc8GoP729Zla/n9W/CsAHJZwmAEDEW6OYT1r6Pz2XyfWgYaY/35qAfvHn2L83Tdy4lS30vxf2/gZ0jPq/XIEekl3fmb+tT/z8tGPVvybPr2zJ1/+/K7mJ0ypVAsCf3hu/sxqPPwCGu2BoCNm/5oITrpZn+r+UDUyDP+n/v1zv413hVGg/nbPB4P9d2L9MlmkxNvgCQMtZlKE85v8/KwpIThb6nb8mv3lKJJbbv8+SZsTvOOc/pQCIIOYw0j+diYu8efWzvy8k7g9bp9u/kxYDa+pKtD9XlYvA8HnVv6i1e9aVu7G/nio7D4CZ3L/WR6rNh5EGwCkgQweBkghAdvTluZnfrr9cKW4ay8jdvxbjhr1f1QVAR5C0MzivAkAWPu5T2QS8v2cWmi772d+/cKj4lzLJCEBx2QJfYrMFQIcecHFB3sO/LYou8tJi4L+jr7lhO38BwIcI0Nb7xgTAXxIUxzv0w7/ts5dVInnhv0T+l8DZLfE/MP3FoFvS5D8MzuyPm3DDv7JkhGyvzuG/tzhzRIRc0b9Ovv3/0z7mv6/03qhPLdC/m4CT/dDN4b9dwjU5VCQBQBBJX1ntCv0/9GsWtZesy79baTkvlCzjv1mjYgEz++S/oW6KnOQW8b9KoilqByXLv6W2KnGYjeS/SmaKz3Vx9z+BZB5yxGHwP3fHN6OJVdC/dZ02ES/2478PuaBjLrXaP4/JU81pPaO/fgsikW3pzr+XlhbYZrjkv4tSn7YDbP0/f2LnFKlF9z+mJHHg/w/Sv14ILfMECOW/mfg4qYhR/b+OP+RQDCACwOpb9yNs09C/1fbPpJjB5L9pN2WOVZ3wv3hHy9nxIve/URlzO/Rv0r8YFturGCTmv1d1/KKR8QPA8gsy9qzSB8CfHRX3t6fSvzzFCT/Qg+a/EYStnrzV9r/2QJqI7Lb9v/YEIrTDINW/LbFE4JPi5r/7kQEs5fEDQHunnf4GeQBAooj9BX7L2L+oPOc8Uzzpv+ydYY2SSAfAL4HK6CRTB0BH3yUkWpDZv2wvsfFmQ+i/Ik0Yzruh6T8fM3LoGoDUP3oSeovukti/S/ycXKkd6r9rEv+7UWcHQCRIQe/GfwNAa36Abk+y2b9BLWR4ssrpv9KT87qa0bM/FTyktw823L8WyyI/BbLgv4hlM1gubOq/DizMp9Ki6r8b5ckdjVrzv5NVbYtSON+/BBqJ+C6O7L/dUBFqgyXYv00Wh18r7+q/7RAy9h8/4L8W8t/TUc3rv4RM5DKx3wDAfvWIj94aBcBsc1IetODgv3oY0nYIW+y/oGcTFF54AUDkJqS/FKX6PwzNxsC7AOC/ltfN1PUC7L+5Wrz/zHnzP6688w2rNOc/YeV9neCo4b9nlSHXANfuvw9RsxKjY/s/1V8GteXE8j+1C8NdDcfiv2wlcW3YZO+/IOywaA7Q8b9bFP+4Tg36v4GTTeNZi+O/9t/ywdRi77+tRc3yFR7eP2bkcHXJkLO//ITc9SjT4r+qoBf2J0nwv2YHKoswwfm/iQcLspCjAcCb6wCzCvXkvwXv9rkMT/C/YkuwYAMXBMApCNUai9kIwMORhtNuJ+e/BVt01fKF8L+ZqWEfvIjsP6h693QZYNk/WyOTkB2i5b8of+GtdSDxvwpaaulDSwVADMQAX+lOAECEHWF8XNPmv1cr/B+VnvG/XyFG6opcCMD/mtR32/UEQP+2XEF3hui/ulBTjAt88r/imfCfRP+yP9zbvtc8XeO/TZuKJD5G6b/MaTExyXzyvxiTQeElXOO/rbJRQVGN9L/z0wR2g9DqvxOqKRxEX/O/FDGCEei99j9x8zV4VYTmP2lzCnsYk+u/l6ELZ9tg878pRXacaDT/v3k6GZRqoQXAVB67LiP56r94+LDK0Sn0vwO6pZ9b7wFAvK0nKVcc9j8+U/hCvyruv6QMsuuLQ/W/FPhKFYv46j8MyxaDTOW/v9L18g1caO2/vebfvctE9b/7GD8ZrF3xv3gx1AR9bQDAuMEtsM4c77+SabgA2nj0v5xKFIwxsATArKNSBaKsB0Cjara6ozTwv33ArMz7sfa/dF2U0FcWCcDxL357DJX/P69pJmt7c/G/quJYWJZl+L/YntVJlnrSP4sRLzXM+fe/46uU8w3c8r+q4lhYlmX4v85lu5+QRwRAsI0H/WU8479jaeZNtj/zv6riWFiWZfi/sI0H/WU847/OZbufkEcEQHAoPUBrnss/9exKzDtFtT88wM8kax+gP9OqeKeAYog/MW0ItiZvcj+ph+smvt5bP2lCaV5dEUU/StaUmQDaLz+kK9y22BMYP0O3whZuMwI/IIbgZGWE6z7UkjYaEM3UPuezxwa9cr8+LybxRMnFpz6E1N8DbPiRPsYjySMvK3s+//////8fAAj//////zMQCP////9/MiAI/////28yMAj/////YzJACP///z9iMlAI////N2IyYAj///8zYjJwCP//vzNiMoAI//+rM2IykAj/f6szYjKgCP8PqzNiMrAI/wOrM2IywAi/A6szYjLQCJ8DqzNiMuAImQOrM2Iy8Aj//////z8PCP//////Kx8I/////38pLwj/////Pyk/CP////85KU8I////PzgpXwj///8POClvCP///w44KX8I//8fDjgpjwj//w8OOCmfCP9/DQ44Ka8I/w8NDjgpvwj/DQ0OOCnPCP8MDQ44Kd8IxwwNDjgp7wjEDA0OOCn/CAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAABgtRFT7Ifk/GC1EVPsh+b8YLURU+yEJQBgtRFT7IQnAYWxnb3MuYwBoM05laWdoYm9yUm90YXRpb25zAGNvb3JkaWprLmMAX3VwQXA3Q2hlY2tlZABfdXBBcDdyQ2hlY2tlZABkaXJlY3RlZEVkZ2UuYwBkaXJlY3RlZEVkZ2VUb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpclt0bXBGaWprLmZhY2VdW2ZpamsuZmFjZV0gPT0gS0kAZmFjZWlqay5jAF9mYWNlSWprUGVudFRvQ2VsbEJvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9DZWxsQm91bmRhcnkAaDNJbmRleC5jAGNvbXBhY3RDZWxscwBsYXRMbmdUb0NlbGwAY2VsbFRvQ2hpbGRQb3MAdmFsaWRhdGVDaGlsZFBvcwBsYXRMbmcuYwBjZWxsQXJlYVJhZHMyAHBvbHlnb24tPm5leHQgPT0gTlVMTABsaW5rZWRHZW8uYwBhZGROZXdMaW5rZWRQb2x5Z29uAG5leHQgIT0gTlVMTABsb29wICE9IE5VTEwAYWRkTmV3TGlua2VkTG9vcABwb2x5Z29uLT5maXJzdCA9PSBOVUxMAGFkZExpbmtlZExvb3AAY29vcmQgIT0gTlVMTABhZGRMaW5rZWRDb29yZABsb29wLT5maXJzdCA9PSBOVUxMAGlubmVyTG9vcHMgIT0gTlVMTABub3JtYWxpemVNdWx0aVBvbHlnb24AYmJveGVzICE9IE5VTEwAY2FuZGlkYXRlcyAhPSBOVUxMAGZpbmRQb2x5Z29uRm9ySG9sZQBjYW5kaWRhdGVCQm94ZXMgIT0gTlVMTAByZXZEaXIgIT0gSU5WQUxJRF9ESUdJVABsb2NhbGlqLmMAY2VsbFRvTG9jYWxJamsAYmFzZUNlbGwgIT0gb3JpZ2luQmFzZUNlbGwAIShvcmlnaW5PblBlbnQgJiYgaW5kZXhPblBlbnQpAGJhc2VDZWxsID09IG9yaWdpbkJhc2VDZWxsAGJhc2VDZWxsICE9IElOVkFMSURfQkFTRV9DRUxMAGxvY2FsSWprVG9DZWxsACFfaXNCYXNlQ2VsbFBlbnRhZ29uKGJhc2VDZWxsKQBiYXNlQ2VsbFJvdGF0aW9ucyA+PSAwAGdyaWRQYXRoQ2VsbHMAcG9seWZpbGwuYwBpdGVyU3RlcFBvbHlnb25Db21wYWN0ADAAdmVydGV4LmMAdmVydGV4Um90YXRpb25zAGNlbGxUb1ZlcnRleABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";function V(){return d.length}var W="function"==typeof atob?atob:function(e){var t,n,i,r,s,o,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",A="",l=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=a.indexOf(e.charAt(l++))<<2|(r=a.indexOf(e.charAt(l++)))>>4,n=(15&r)<<4|(s=a.indexOf(e.charAt(l++)))>>2,i=(3&s)<<6|(o=a.indexOf(e.charAt(l++))),A+=String.fromCharCode(t),64!==s&&(A+=String.fromCharCode(n)),64!==o&&(A+=String.fromCharCode(i))}while(l<e.length);return A};function j(e){if(z(e))return function(e){try{for(var t=W(e),n=new Uint8Array(t.length),i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}catch(r){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(G.length))}var H=function(e,t,n){var i=new e.Int8Array(n),r=new e.Int32Array(n);new e.Uint8Array(n),new e.Float32Array(n);var s=new e.Float64Array(n),o=0|t.o,a=0|t.p,A=e.Math.floor,l=e.Math.abs,c=e.Math.sqrt,u=e.Math.pow,h=e.Math.cos,d=e.Math.sin,f=e.Math.tan,p=e.Math.acos,g=e.Math.asin,m=e.Math.atan,_=e.Math.atan2,v=e.Math.ceil,y=e.Math.imul,b=e.Math.min,w=e.Math.max,E=e.Math.clz32,x=t.b,T=t.c,S=t.d,C=t.e,P=t.f,R=t.g,I=t.h,M=t.i,k=28656;function L(e,t,n,i){return 0|B(e|=0,t|=0,n|=0,i|=0,0)}function B(e,t,n,i,s){var o,a=0,A=0,l=0,c=0;if(o=k,k=k+16|0,A=o,!(0|D(e|=0,t|=0,n|=0,i|=0,s|=0)))return k=o,0|(i=0);do{if((0|n)>=0){if((0|n)>13780509){if(0|(a=0|ct(15,A)))break;A=0|r[(l=A)>>2],l=0|r[l+4>>2]}else c=0|Jt(0|n,0|(a=((0|n)<0)<<31>>31),3,0),l=0|T(),a=0|$t(0|n,0|a,1,0),a=0|$t(0|(a=0|Jt(0|c,0|l,0|a,0|T())),0|T(),1,0),l=0|T(),r[A>>2]=a,r[A+4>>2]=l,A=a;if(un(0|i,0,A<<3),0|s){un(0|s,0,A<<2),a=0|O(e,t,n,i,s,A,l,0);break}(a=0|Qt(A,4))?(c=0|O(e,t,n,i,a,A,l,0),Xt(a),a=c):a=13}else a=2}while(0);return k=o,0|(c=a)}function D(e,t,n,i,s){e|=0,t|=0,n|=0,i|=0,s|=0;var o,a,A=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0;if(a=k,k=k+16|0,g=a+8|0,r[(p=o=a)>>2]=e,r[p+4>>2]=t,(0|n)<0)return k=a,0|(g=2);if(r[(A=i)>>2]=e,r[A+4>>2]=t,(A=!!(0|s))&&(r[s>>2]=0),0|ze(e,t))return k=a,0|(g=9);r[g>>2]=0;e:do{if((0|n)>=1)if(A)for(d=1,h=0,f=0,p=1,A=e;;){if(!(h|f)){if(0|(A=0|N(A,t,4,g,o)))break e;if(0|ze(A=0|r[(t=o)>>2],t=0|r[t+4>>2])){A=9;break e}}if(0|(A=0|N(A,t,0|r[26800+(f<<2)>>2],g,o)))break e;if(A=0|r[(t=o)>>2],t=0|r[t+4>>2],r[(e=i+(d<<3)|0)>>2]=A,r[e+4>>2]=t,r[s+(d<<2)>>2]=p,l=(0|(e=h+1|0))==(0|p),u=6==(0|(c=f+1|0)),0|ze(A,t)){A=9;break e}if((0|(p=p+(u&l&1)|0))>(0|n)){A=0;break}d=d+1|0,h=l?0:e,f=l?u?0:c:f}else for(d=1,h=0,f=0,p=1,A=e;;){if(!(h|f)){if(0|(A=0|N(A,t,4,g,o)))break e;if(0|ze(A=0|r[(t=o)>>2],t=0|r[t+4>>2])){A=9;break e}}if(0|(A=0|N(A,t,0|r[26800+(f<<2)>>2],g,o)))break e;if(A=0|r[(t=o)>>2],t=0|r[t+4>>2],r[(e=i+(d<<3)|0)>>2]=A,r[e+4>>2]=t,l=(0|(e=h+1|0))==(0|p),u=6==(0|(c=f+1|0)),0|ze(A,t)){A=9;break e}if((0|(p=p+(u&l&1)|0))>(0|n)){A=0;break}d=d+1|0,h=l?0:e,f=l?u?0:c:f}else A=0}while(0);return k=a,0|(g=A)}function O(e,t,n,i,s,o,a,A){n|=0,i|=0,s|=0,A|=0;var l,c,u,h=0,d=0,f=0,p=0,g=0,m=0,_=0;if(u=k,k=k+16|0,l=u+8|0,c=u,h=0|tn(0|(e|=0),0|(t|=0),0|(o|=0),0|(a|=0)),f=0|T(),!(!(0|(_=0|r[(m=p=i+(h<<3)|0)>>2]))&!(0|(m=0|r[m+4>>2]))|(d=(0|_)==(0|e)&(0|m)==(0|t))))do{h=0|en(0|(h=0|$t(0|h,0|f,1,0)),0|T(),0|o,0|a),f=0|T(),d=(0|(m=0|r[(_=p=i+(h<<3)|0)>>2]))==(0|e)&(0|(_=0|r[_+4>>2]))==(0|t)}while(!(!(0|m)&!(0|_)|d));if(h=s+(h<<2)|0,d&&(0|r[h>>2])<=(0|A))return k=u,0|(_=0);if(r[(_=p)>>2]=e,r[_+4>>2]=t,r[h>>2]=A,(0|A)>=(0|n))return k=u,0|(_=0);switch(d=A+1|0,r[l>>2]=0,0|(h=0|N(e,t,2,l,c))){case 9:g=9;break;case 0:(h=0|O(0|r[(h=c)>>2],0|r[h+4>>2],n,i,s,o,a,d))||(g=9)}e:do{if(9==(0|g)){switch(r[l>>2]=0,0|(h=0|N(e,t,3,l,c))){case 9:break;case 0:if(0|(h=0|O(0|r[(h=c)>>2],0|r[h+4>>2],n,i,s,o,a,d)))break e;break;default:break e}switch(r[l>>2]=0,0|(h=0|N(e,t,1,l,c))){case 9:break;case 0:if(0|(h=0|O(0|r[(h=c)>>2],0|r[h+4>>2],n,i,s,o,a,d)))break e;break;default:break e}switch(r[l>>2]=0,0|(h=0|N(e,t,5,l,c))){case 9:break;case 0:if(0|(h=0|O(0|r[(h=c)>>2],0|r[h+4>>2],n,i,s,o,a,d)))break e;break;default:break e}switch(r[l>>2]=0,0|(h=0|N(e,t,4,l,c))){case 9:break;case 0:if(0|(h=0|O(0|r[(h=c)>>2],0|r[h+4>>2],n,i,s,o,a,d)))break e;break;default:break e}switch(r[l>>2]=0,0|(h=0|N(e,t,6,l,c))){case 9:break;case 0:if(0|(h=0|O(0|r[(h=c)>>2],0|r[h+4>>2],n,i,s,o,a,d)))break e;break;default:break e}return k=u,0|(_=0)}}while(0);return k=u,0|(_=h)}function N(e,t,n,i,s){e|=0,t|=0,s|=0;var o,a,A=0,l=0,c=0,u=0,h=0,d=0,f=0;if((n|=0)>>>0>6)return 0|(s=1);if(h=(0|r[(i|=0)>>2])%6|0,r[i>>2]=h,(0|h)>0){A=0;do{n=0|ve(n),A=A+1|0}while((0|A)<(0|r[i>>2]))}if(h=0|rn(0|e,0|t,45),T(),(a=127&h)>>>0>121)return 0|(s=5);o=0|je(e,t),A=0|rn(0|e,0|t,52),T(),A&=15;e:do{if(A){for(;;){if(c=0|rn(0|e,0|t,0|(l=3*(15-A|0)|0)),T(),7==(0|(c&=7))){t=5;break}if(f=!(0|Ye(A)),A=A+-1|0,d=0|sn(7,0,0|l),t&=~T(),e=0|sn(0|r[(f?432:16)+(28*c|0)+(n<<2)>>2],0,0|l)|e&~d,t|=l=0|T(),!(n=0|r[(f?640:224)+(28*c|0)+(n<<2)>>2])){n=0;break e}if(!A){u=8;break e}}return 0|t}u=8}while(0);8==(0|u)&&(e|=0|sn(0|(f=0|r[848+(28*a|0)+(n<<2)>>2]),0,45),t=T()|-1040385&t,n=0|r[4272+(28*a|0)+(n<<2)>>2],127&~f||(f=0|sn(0|r[848+(28*a|0)+20>>2],0,45),t=T()|-1040385&t,n=0|r[4272+(28*a|0)+20>>2],e=0|Xe(f|e,t),t=0|T(),r[i>>2]=1+(0|r[i>>2]))),c=0|rn(0|e,0|t,45),T(),c&=127;e:do{if(0|z(c)){t:do{if(1==(0|je(e,t))){if((0|a)!=(0|c)){if(0|H(c,0|r[7696+(28*a|0)>>2])){e=0|$e(e,t),l=1,t=0|T();break}S(27795,26864,533,26872)}switch(0|o){case 3:e=0|Xe(e,t),t=0|T(),r[i>>2]=1+(0|r[i>>2]),l=0;break t;case 5:e=0|$e(e,t),t=0|T(),r[i>>2]=5+(0|r[i>>2]),l=0;break t;case 0:return 0|(f=9);default:return 0|(f=1)}}else l=0}while(0);if((0|n)>0){A=0;do{e=0|He(e,t),t=0|T(),A=A+1|0}while((0|A)!=(0|n))}if((0|a)!=(0|c)){if(!(0|V(c))){if(!!(0|l)|5!=(0|je(e,t)))break;r[i>>2]=1+(0|r[i>>2]);break}switch(127&h){case 8:case 118:break e}3!=(0|je(e,t))&&(r[i>>2]=1+(0|r[i>>2]))}}else if((0|n)>0){A=0;do{e=0|Xe(e,t),t=0|T(),A=A+1|0}while((0|A)!=(0|n))}}while(0);return r[i>>2]=((0|r[i>>2])+n|0)%6|0,r[(f=s)>>2]=e,r[f+4>>2]=t,0|(f=0)}function F(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var s,o,a=0,A=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0;if(o=k,k=k+16|0,p=o+8|0,r[(f=s=o)>>2]=e,r[f+4>>2]=t,(0|n)<0)return k=o,0|(p=2);if(!n)return r[(p=i)>>2]=e,r[p+4>>2]=t,k=o,0|(p=0);r[p>>2]=0;e:do{if(0|ze(e,t))e=9;else{a=0,f=e;do{if(0|(e=0|N(f,t,4,p,s)))break e;if(a=a+1|0,0|ze(f=0|r[(t=s)>>2],t=0|r[t+4>>2])){e=9;break e}}while((0|a)<(0|n));r[(d=i)>>2]=f,r[d+4>>2]=t,d=n+-1|0,h=0,e=1;do{if(a=26800+(h<<2)|0,5==(0|h))for(l=0|r[a>>2],A=0,a=e;;){if(0|(e=0|N(0|r[(e=s)>>2],0|r[e+4>>2],l,p,s)))break e;if((0|A)!=(0|d)){if(c=0|r[(u=s)>>2],u=0|r[u+4>>2],r[(e=i+(a<<3)|0)>>2]=c,r[e+4>>2]=u,0|ze(c,u)){e=9;break e}e=a+1|0}else e=a;if((0|(A=A+1|0))>=(0|n))break;a=e}else for(l=s,u=0|r[a>>2],c=0,a=e,A=0|r[l>>2],l=0|r[l+4>>2];;){if(0|(e=0|N(A,l,u,p,s)))break e;if(A=0|r[(l=s)>>2],l=0|r[l+4>>2],r[(e=i+(a<<3)|0)>>2]=A,r[e+4>>2]=l,e=a+1|0,0|ze(A,l)){e=9;break e}if((0|(c=c+1|0))>=(0|n))break;a=e}h=h+1|0}while(h>>>0<6);e=(0|f)==(0|r[(e=s)>>2])&&(0|t)==(0|r[e+4>>2])?0:9}}while(0);return k=o,0|(p=e)}function U(e,t,n,i){n|=0,i|=0;var s,o,a,A=0,l=0;for(a=k,k=k+16|0,s=a,o=a+8|0,A=(A=!(0|ze(e|=0,t|=0)))?1:2;;){if(r[o>>2]=0,!(0|N(e,t,A,o,s))&((0|r[(l=s)>>2])==(0|n)?(0|r[l+4>>2])==(0|i):0)){e=4;break}if((A=A+1|0)>>>0>=7){A=7,e=4;break}}return 4==(0|e)?(k=a,0|A):0}function G(e,t,n,i,o,a,A){t|=0,n|=0,i|=0,o|=0,a|=0,A|=0;var l,c,u,h,d,f,p,g,m,_,v=0,y=0,b=0,w=0,E=0,x=0,S=0,C=0,P=0,R=0,I=0,M=0,L=0,B=0,D=0,O=0,N=0,F=0,U=0;if(_=k,k=k+64|0,p=_+48|0,g=_+32|0,m=_+24|0,l=_+8|0,c=_,(0|(y=0|r[(e|=0)>>2]))<=0)return k=_,0|(D=0);for(u=e+4|0,h=p+8|0,d=g+8|0,f=l+8|0,v=0,L=0;;){M=(b=0|r[u>>2])+(L<<4)|0,r[p>>2]=r[M>>2],r[p+4>>2]=r[M+4>>2],r[p+8>>2]=r[M+8>>2],r[p+12>>2]=r[M+12>>2],(0|L)==(y+-1|0)?(r[g>>2]=r[b>>2],r[g+4>>2]=r[b+4>>2],r[g+8>>2]=r[b+8>>2],r[g+12>>2]=r[b+12>>2]):(M=b+(L+1<<4)|0,r[g>>2]=r[M>>2],r[g+4>>2]=r[M+4>>2],r[g+8>>2]=r[M+8>>2],r[g+12>>2]=r[M+12>>2]),y=0|ne(p,g,i,m);e:do{if(y)b=0,v=y;else if(b=0|r[(y=m)>>2],(0|(y=0|r[y+4>>2]))>0|!(0|y)&b>>>0>0){I=0,M=0;t:for(;;){if(N=1/(+(b>>>0)+4294967296*+(0|y)),U=+s[p>>3],F=+((y=0|Yt(0|b,0|y,0|I,0|M))>>>0)+4294967296*+(0|T()),O=+(I>>>0)+4294967296*+(0|M),s[l>>3]=N*(U*F)+N*(+s[g>>3]*O),s[f>>3]=N*(+s[h>>3]*F)+N*(+s[d>>3]*O),0|(y=0|Ke(l,i,c))){v=y;break}x=0|tn(0|(P=0|r[(R=c)>>2]),0|(R=0|r[R+4>>2]),0|t,0|n),w=0|T(),b=0|r[(E=y=A+(x<<3)|0)>>2],E=0|r[E+4>>2];n:do{if(!(0|b)&!(0|E))B=y,D=16;else for(S=0,C=0;;){if((0|S)>(0|n)|(0|S)==(0|n)&C>>>0>t>>>0){v=1;break t}if((0|b)==(0|P)&(0|E)==(0|R))break n;if(x=0|en(0|(y=0|$t(0|x,0|w,1,0)),0|T(),0|t,0|n),w=0|T(),C=0|$t(0|C,0|S,1,0),S=0|T(),!(0|(b=0|r[(E=y=A+(x<<3)|0)>>2]))&!(0|(E=0|r[E+4>>2]))){B=y,D=16;break}}}while(0);if(16!=(0|D)||(D=0,!(0|P)&!(0|R))||(r[(C=B)>>2]=P,r[C+4>>2]=R,C=a+(r[o>>2]<<3)|0,r[C>>2]=P,r[C+4>>2]=R,C=0|$t(0|r[(C=o)>>2],0|r[C+4>>2],1,0),P=0|T(),r[(R=o)>>2]=C,r[R+4>>2]=P),I=0|$t(0|I,0|M,1,0),M=0|T(),b=0|r[(y=m)>>2],!((0|(y=0|r[y+4>>2]))>(0|M)|(0|y)==(0|M)&b>>>0>I>>>0)){b=1;break e}}b=0}else b=1}while(0);if(L=L+1|0,!b){D=21;break}if((0|L)>=(0|(y=0|r[e>>2]))){v=0,D=21;break}}return 21==(0|D)?(k=_,0|v):0}function z(e){return(e|=0)>>>0>121?0|(e=0):0|(e=0|r[7696+(28*e|0)+16>>2])}function V(e){return 4==(0|(e|=0))|117==(0|e)|0}function W(e){return 0|r[11120+(216*(0|r[(e|=0)>>2])|0)+(72*(0|r[e+4>>2])|0)+(24*(0|r[e+8>>2])|0)+(r[e+12>>2]<<3)>>2]}function j(e){return 0|r[11120+(216*(0|r[(e|=0)>>2])|0)+(72*(0|r[e+4>>2])|0)+(24*(0|r[e+8>>2])|0)+(r[e+12>>2]<<3)+4>>2]}function H(e,t){return t|=0,(0|r[7696+(28*(e|=0)|0)+20>>2])==(0|t)?0|(t=1):0|(t=(0|r[7696+(28*e|0)+24>>2])==(0|t))}function X(e,t){return 0|r[848+(28*(e|=0)|0)+((t|=0)<<2)>>2]}function Q(e,t){return t|=0,(0|r[848+(28*(e|=0)|0)>>2])==(0|t)?0|(t=0):(0|r[848+(28*e|0)+4>>2])==(0|t)?0|(t=1):(0|r[848+(28*e|0)+8>>2])==(0|t)?0|(t=2):(0|r[848+(28*e|0)+12>>2])==(0|t)?0|(t=3):(0|r[848+(28*e|0)+16>>2])==(0|t)?0|(t=4):(0|r[848+(28*e|0)+20>>2])==(0|t)?0|(t=5):0|((0|r[848+(28*e|0)+24>>2])==(0|t)?6:7)}function $(e){var t,n,i;return t=(i=+s[(e|=0)+16>>3])-(n=+s[e+24>>3]),+(i<n?t+6.283185307179586:t)}function Y(e){return+s[(e|=0)+16>>3]<+s[e+24>>3]|0}function K(e){return+(+s[(e|=0)>>3]-+s[e+8>>3])}function Z(e,t){e|=0;var n,i,r=0;return(r=+s[(t|=0)>>3])>=+s[e+8>>3]&&r<=+s[e>>3]?(n=+s[e+16>>3],r=+s[e+24>>3],t=(i=+s[t+8>>3])>=r,e=i<=n&1,n<r?t&&(e=1):t||(e=0),0|(t=!!(0|e))):0|(t=0)}function q(e,t){t|=0;var n,i,r,o,a,A=0,l=0,c=0,u=0;return+s[(e|=0)>>3]<+s[t+8>>3]||+s[e+8>>3]>+s[t>>3]?0|(A=0):(r=(l=+s[e+16>>3])<(u=+s[(n=e+24|0)>>3]),c=(a=+s[(A=t+16|0)>>3])<(o=+s[(i=t+24|0)>>3]),t=u-a<o-l,e=r?c|t?1:2:0,t=c?r?1:t?2:1:0,(l=+at(l,e))<+at(+s[i>>3],t)||(u=+at(+s[n>>3],e))>+at(+s[A>>3],t)?0|(c=0):0|(c=1))}function J(e,t){t|=0;var n,i,r,o,a,A=0,l=0,c=0,u=0;return+s[(e|=0)>>3]<+s[t>>3]||+s[e+8>>3]>+s[t+8>>3]?0|(A=0):(r=(o=+s[(A=e+16|0)>>3])<(l=+s[e+24>>3]),c=(u=+s[(n=t+16|0)>>3])<(a=+s[(i=t+24|0)>>3]),t=l-u<a-o,e=r?c|t?1:2:0,t=c?r?1:t?2:1:0,(l=+at(l,e))<=+at(+s[i>>3],t)?0|(c=(u=+at(+s[A>>3],e))>=+at(+s[n>>3],t)):0|(c=0))}function ee(e,t){e|=0,t|=0;var n,i,o,a,A,l=0;o=k,k=k+176|0,r[(i=o)>>2]=4,l=+s[t>>3],s[i+8>>3]=l,a=+s[t+16>>3],s[i+16>>3]=a,s[i+24>>3]=l,l=+s[t+24>>3],s[i+32>>3]=l,A=+s[t+8>>3],s[i+40>>3]=A,s[i+48>>3]=l,s[i+56>>3]=A,s[i+64>>3]=a,n=(t=i+72|0)+96|0;do{r[t>>2]=0,t=t+4|0}while((0|t)<(0|n));cn(0|e,0|i,168),k=o}function te(e,t,n){e|=0,t|=0,n|=0;var i,a,c,u,h,d,f,p=0,g=0,m=0,_=0,y=0,w=0,E=0;d=k,k=k+288|0,h=d+264|0,_=d+96|0,g=(p=m=d)+96|0;do{r[p>>2]=0,p=p+4|0}while((0|p)<(0|g));return 0|(t=0|tt(t,m))?(k=d,0|(w=t)):(Je(m=0|r[(g=m)>>2],g=0|r[g+4>>2],h),et(m,g,_),u=+At(h,_+8|0),s[h>>3]=+s[e>>3],s[(g=h+8|0)>>3]=+s[e+16>>3],s[_>>3]=+s[e+8>>3],s[(m=_+8|0)>>3]=+s[e+24>>3],a=+At(h,_),E=+s[g>>3]-+s[m>>3],c=+l(+E),f=+s[h>>3]-+s[_>>3],i=+l(+f),!(0==E|0==f)&&(E=+an(+c,+i),E=+v(+a*a/+An(+E/+An(+c,+i),3)/(u*(2.59807621135*u)*.8)),s[o>>3]=E,y=~~E>>>0,w=+l(E)>=1?E>0?~~+b(+A(E/4294967296),4294967295)>>>0:~~+v((E-+(~~E>>>0))/4294967296)>>>0:0,2146435072&~r[o+4>>2])?(_=!(0|y)&!(0|w),r[(t=n)>>2]=_?1:y,r[t+4>>2]=_?0:w,t=0):t=1,k=d,0|(w=t))}function ne(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var a,c,u,h,d=0,f=0,p=0;h=k,k=k+288|0,c=h+264|0,u=h+96|0,a=(d=f=h)+96|0;do{r[d>>2]=0,d=d+4|0}while((0|d)<(0|a));return 0|(n=0|tt(n,f))?(k=h,0|(i=n)):(Je(d=0|r[(n=f)>>2],n=0|r[n+4>>2],c),et(d,n,u),p=+At(c,u+8|0),p=+v(+ +At(e,t)/(2*p)),s[o>>3]=p,n=~~p>>>0,d=+l(p)>=1?p>0?~~+b(+A(p/4294967296),4294967295)>>>0:~~+v((p-+(~~p>>>0))/4294967296)>>>0:0,2146435072&~r[o+4>>2]?(f=!(0|n)&!(0|d),r[i>>2]=f?1:n,r[i+4>>2]=f?0:d,k=h,0|(i=0)):(k=h,0|(i=1)))}function ie(e,t,n,i){t|=0,n|=0,i|=0,r[(e|=0)>>2]=t,r[e+4>>2]=n,r[e+8>>2]=i}function re(e){var t,n=0,i=0,s=0,o=0,a=0;n=0|r[(e|=0)>>2],i=0|r[(t=e+4|0)>>2],(0|n)<0&&(i=i-n|0,r[t>>2]=i,r[(a=e+8|0)>>2]=(0|r[a>>2])-n,r[e>>2]=0,n=0),(0|i)<0?(n=n-i|0,r[e>>2]=n,o=(0|r[(a=e+8|0)>>2])-i|0,r[a>>2]=o,r[t>>2]=0,i=0):(a=o=e+8|0,o=0|r[o>>2]),(0|o)<0&&(n=n-o|0,r[e>>2]=n,i=i-o|0,r[t>>2]=i,r[a>>2]=0,o=0),(0|(s=(0|o)<(0|(s=(0|i)<(0|n)?i:n))?o:s))<=0||(r[e>>2]=n-s,r[t>>2]=i-s,r[a>>2]=o-s)}function se(e,t){t|=0;var n,i;i=0|r[(e|=0)+8>>2],n=+((0|r[e+4>>2])-i|0),s[t>>3]=+((0|r[e>>2])-i|0)-.5*n,s[t+8>>3]=.8660254037844386*n}function oe(e,t,n){e|=0,t|=0,r[(n|=0)>>2]=(0|r[t>>2])+(0|r[e>>2]),r[n+4>>2]=(0|r[t+4>>2])+(0|r[e+4>>2]),r[n+8>>2]=(0|r[t+8>>2])+(0|r[e+8>>2])}function ae(e,t,n){e|=0,t|=0,r[(n|=0)>>2]=(0|r[e>>2])-(0|r[t>>2]),r[n+4>>2]=(0|r[e+4>>2])-(0|r[t+4>>2]),r[n+8>>2]=(0|r[e+8>>2])-(0|r[t+8>>2])}function Ae(e,t){t|=0;var n,i=0;i=0|y(0|r[(e|=0)>>2],t),r[e>>2]=i,n=0|y(0|r[(i=e+4|0)>>2],t),r[i>>2]=n,t=0|y(0|r[(e=e+8|0)>>2],t),r[e>>2]=t}function le(e){var t,n,i=0,s=0,o=0,a=0,A=0;A=(0|(n=0|r[(e|=0)>>2]))<0,e=(e=(s=(0|(a=((t=(0|(o=(0|r[e+4>>2])-(A?n:0)|0))<0)?0-o|0:0)+((0|r[e+8>>2])-(A?n:0))|0))<0)?0:a)-((o=(0|(s=(0|e)<(0|(s=(0|(i=(t?0:o)-(s?a:0)|0))<(0|(a=(A?0:n)-(t?o:0)-(s?a:0)|0))?i:a))?e:s))>0)?s:0)|0,i=i-(o?s:0)|0;e:do{switch(a-(o?s:0)|0){case 0:switch(0|i){case 0:return 0|(A=0|e?1==(0|e)?1:7:0);case 1:return 0|(A=0|e?1==(0|e)?3:7:2);default:break e}case 1:switch(0|i){case 0:return 0|(A=0|e?1==(0|e)?5:7:4);case 1:if(e)break e;return 0|(e=6);default:break e}}}while(0);return 0|(A=7)}function ce(e){var t,n,i=0,s=0,o=0,a=0,A=0,l=0,c=0;if(l=0|r[(n=(e|=0)+8|0)>>2],(t=(0|r[e>>2])-l|0)>>>0>715827881|(l=(0|r[(c=e+4|0)>>2])-l|0)>>>0>715827881){if(a=2147483647-t|0,A=-2147483648-t|0,(o=(0|t)>0)?(0|a)<(0|t):(0|A)>(0|t))return 0|(c=1);if(s=t<<1,o?(2147483647-s|0)<(0|t):(-2147483648-s|0)>(0|t))return 0|(c=1);if((0|l)>0?(2147483647-l|0)<(0|l):(-2147483648-l|0)>(0|l))return 0|(c=1);if(i=3*t|0,s=l<<1,(o?(0|a)<(0|s):(0|A)>(0|s))||((0|t)>-1?(-2147483648|i)>=(0|l):(-2147483648^i)<(0|l)))return 0|(c=1)}else s=l<<1,i=3*t|0;return o=0|jt(.14285714285714285*+(i-l|0)),r[e>>2]=o,a=0|jt(.14285714285714285*+(s+t|0)),r[c>>2]=a,r[n>>2]=0,i=(s=(0|a)<(0|o))?o:a,(0|(s=s?a:o))<0&&((-2147483648==(0|s)||((0|i)>0?(2147483647-i|0)<(0|s):(-2147483648-i|0)>(0|s)))&&S(27795,26892,354,26903),((0|i)>-1?(-2147483648|i)>=(0|s):(-2147483648^i)<(0|s))&&S(27795,26892,354,26903)),i=a-o|0,(0|o)<0?(s=0-o|0,r[c>>2]=i,r[n>>2]=s,r[e>>2]=0,o=0):(i=a,s=0),(0|i)<0&&(o=o-i|0,r[e>>2]=o,s=s-i|0,r[n>>2]=s,r[c>>2]=0,i=0),A=o-s|0,a=i-s|0,(0|s)<0?(r[e>>2]=A,r[c>>2]=a,r[n>>2]=0,i=a,a=A,s=0):a=o,(0|(o=(0|s)<(0|(o=(0|i)<(0|a)?i:a))?s:o))<=0||(r[e>>2]=a-o,r[c>>2]=i-o,r[n>>2]=s-o),0|(c=0)}function ue(e){var t,n=0,i=0,s=0,o=0,a=0,A=0,l=0;if(o=0|r[(t=(e|=0)+8|0)>>2],(a=(0|r[e>>2])-o|0)>>>0>715827881|(o=(0|r[(A=e+4|0)>>2])-o|0)>>>0>715827881){if((i=(0|a)>0)?(2147483647-a|0)<(0|a):(-2147483648-a|0)>(0|a))return 0|(A=1);if(n=a<<1,(s=(0|o)>0)?(2147483647-o|0)<(0|o):(-2147483648-o|0)>(0|o))return 0|(A=1);if(l=o<<1,s?(2147483647-l|0)<(0|o):(-2147483648-l|0)>(0|o))return 0|(l=1);if(i?(2147483647-n|0)<(0|o):(-2147483648-n|0)>(0|o))return 0|(l=1);if(i=3*o|0,(0|o)>-1?(-2147483648|i)>=(0|a):(-2147483648^i)<(0|a))return 0|(l=1)}else i=3*o|0,n=a<<1;return s=0|jt(.14285714285714285*+(n+o|0)),r[e>>2]=s,o=0|jt(.14285714285714285*+(i-a|0)),r[A>>2]=o,r[t>>2]=0,n=(i=(0|o)<(0|s))?s:o,(0|(i=i?o:s))<0&&((-2147483648==(0|i)||((0|n)>0?(2147483647-n|0)<(0|i):(-2147483648-n|0)>(0|i)))&&S(27795,26892,402,26917),((0|n)>-1?(-2147483648|n)>=(0|i):(-2147483648^n)<(0|i))&&S(27795,26892,402,26917)),n=o-s|0,(0|s)<0?(i=0-s|0,r[A>>2]=n,r[t>>2]=i,r[e>>2]=0,s=0):(n=o,i=0),(0|n)<0&&(s=s-n|0,r[e>>2]=s,i=i-n|0,r[t>>2]=i,r[A>>2]=0,n=0),a=s-i|0,o=n-i|0,(0|i)<0?(r[e>>2]=a,r[A>>2]=o,r[t>>2]=0,n=o,o=a,i=0):o=s,(0|(s=(0|i)<(0|(s=(0|n)<(0|o)?n:o))?i:s))<=0||(r[e>>2]=o-s,r[A>>2]=n-s,r[t>>2]=i-s),0|(l=0)}function he(e){var t,n,i=0,s=0,o=0,a=0,A=0;s=0|r[(t=(e|=0)+8|0)>>2],o=0|jt(.14285714285714285*+((3*(i=(0|r[e>>2])-s|0)|0)-(s=(0|r[(n=e+4|0)>>2])-s|0)|0)),r[e>>2]=o,i=0|jt(.14285714285714285*+((s<<1)+i|0)),r[n>>2]=i,r[t>>2]=0,s=i-o|0,(0|o)<0?(A=0-o|0,r[n>>2]=s,r[t>>2]=A,r[e>>2]=0,i=s,o=0,s=A):s=0,(0|i)<0&&(o=o-i|0,r[e>>2]=o,s=s-i|0,r[t>>2]=s,r[n>>2]=0,i=0),A=o-s|0,a=i-s|0,(0|s)<0?(r[e>>2]=A,r[n>>2]=a,r[t>>2]=0,i=a,a=A,s=0):a=o,(0|(o=(0|s)<(0|(o=(0|i)<(0|a)?i:a))?s:o))<=0||(r[e>>2]=a-o,r[n>>2]=i-o,r[t>>2]=s-o)}function de(e){var t,n,i=0,s=0,o=0,a=0,A=0;s=0|r[(t=(e|=0)+8|0)>>2],o=0|jt(.14285714285714285*+(((i=(0|r[e>>2])-s|0)<<1)+(s=(0|r[(n=e+4|0)>>2])-s|0)|0)),r[e>>2]=o,i=0|jt(.14285714285714285*+((3*s|0)-i|0)),r[n>>2]=i,r[t>>2]=0,s=i-o|0,(0|o)<0?(A=0-o|0,r[n>>2]=s,r[t>>2]=A,r[e>>2]=0,i=s,o=0,s=A):s=0,(0|i)<0&&(o=o-i|0,r[e>>2]=o,s=s-i|0,r[t>>2]=s,r[n>>2]=0,i=0),A=o-s|0,a=i-s|0,(0|s)<0?(r[e>>2]=A,r[n>>2]=a,r[t>>2]=0,i=a,a=A,s=0):a=o,(0|(o=(0|s)<(0|(o=(0|i)<(0|a)?i:a))?s:o))<=0||(r[e>>2]=a-o,r[n>>2]=i-o,r[t>>2]=s-o)}function fe(e){var t,n,i,s=0,o=0,a=0,A=0;s=0|r[(e|=0)>>2],o=0|r[(n=e+4|0)>>2],a=0|r[(i=e+8|0)>>2],A=o+(3*s|0)|0,r[e>>2]=A,o=a+(3*o|0)|0,r[n>>2]=o,s=(3*a|0)+s|0,r[i>>2]=s,a=o-A|0,(0|A)<0?(s=s-A|0,r[n>>2]=a,r[i>>2]=s,r[e>>2]=0,o=a,a=0):a=A,(0|o)<0&&(a=a-o|0,r[e>>2]=a,s=s-o|0,r[i>>2]=s,r[n>>2]=0,o=0),t=a-s|0,A=o-s|0,(0|s)<0?(r[e>>2]=t,r[n>>2]=A,r[i>>2]=0,a=t,s=0):A=o,(0|(o=(0|s)<(0|(o=(0|A)<(0|a)?A:a))?s:o))<=0||(r[e>>2]=a-o,r[n>>2]=A-o,r[i>>2]=s-o)}function pe(e){var t,n,i,s=0,o=0,a=0,A=0;A=0|r[(e|=0)>>2],a=(3*(s=0|r[(n=e+4|0)>>2])|0)+A|0,A=(o=0|r[(i=e+8|0)>>2])+(3*A|0)|0,r[e>>2]=A,r[n>>2]=a,s=(3*o|0)+s|0,r[i>>2]=s,o=a-A|0,(0|A)<0?(s=s-A|0,r[n>>2]=o,r[i>>2]=s,r[e>>2]=0,A=0):o=a,(0|o)<0&&(A=A-o|0,r[e>>2]=A,s=s-o|0,r[i>>2]=s,r[n>>2]=0,o=0),t=A-s|0,a=o-s|0,(0|s)<0?(r[e>>2]=t,r[n>>2]=a,r[i>>2]=0,A=t,s=0):a=o,(0|(o=(0|s)<(0|(o=(0|a)<(0|A)?a:A))?s:o))<=0||(r[e>>2]=A-o,r[n>>2]=a-o,r[i>>2]=s-o)}function ge(e,t){e|=0;var n,i,s,o=0,a=0,A=0;((t|=0)+-1|0)>>>0>=6||(A=(0|r[15440+(12*t|0)>>2])+(0|r[e>>2])|0,r[e>>2]=A,s=e+4|0,a=(0|r[15440+(12*t|0)+4>>2])+(0|r[s>>2])|0,r[s>>2]=a,i=e+8|0,t=(0|r[15440+(12*t|0)+8>>2])+(0|r[i>>2])|0,r[i>>2]=t,o=a-A|0,(0|A)<0?(t=t-A|0,r[s>>2]=o,r[i>>2]=t,r[e>>2]=0,a=0):(o=a,a=A),(0|o)<0&&(a=a-o|0,r[e>>2]=a,t=t-o|0,r[i>>2]=t,r[s>>2]=0,o=0),n=a-t|0,A=o-t|0,(0|t)<0?(r[e>>2]=n,r[s>>2]=A,r[i>>2]=0,a=n,t=0):A=o,(0|(o=(0|t)<(0|(o=(0|A)<(0|a)?A:a))?t:o))<=0||(r[e>>2]=a-o,r[s>>2]=A-o,r[i>>2]=t-o))}function me(e){var t,n,i,s=0,o=0,a=0,A=0;A=0|r[(e|=0)>>2],a=(s=0|r[(n=e+4|0)>>2])+A|0,A=(o=0|r[(i=e+8|0)>>2])+A|0,r[e>>2]=A,r[n>>2]=a,s=o+s|0,r[i>>2]=s,o=a-A|0,(0|A)<0?(s=s-A|0,r[n>>2]=o,r[i>>2]=s,r[e>>2]=0,a=0):(o=a,a=A),(0|o)<0&&(a=a-o|0,r[e>>2]=a,s=s-o|0,r[i>>2]=s,r[n>>2]=0,o=0),t=a-s|0,A=o-s|0,(0|s)<0?(r[e>>2]=t,r[n>>2]=A,r[i>>2]=0,a=t,s=0):A=o,(0|(o=(0|s)<(0|(o=(0|A)<(0|a)?A:a))?s:o))<=0||(r[e>>2]=a-o,r[n>>2]=A-o,r[i>>2]=s-o)}function _e(e){var t,n,i,s=0,o=0,a=0,A=0;s=0|r[(e|=0)>>2],a=0|r[(n=e+4|0)>>2],o=0|r[(i=e+8|0)>>2],A=a+s|0,r[e>>2]=A,a=o+a|0,r[n>>2]=a,s=o+s|0,r[i>>2]=s,o=a-A|0,(0|A)<0?(s=s-A|0,r[n>>2]=o,r[i>>2]=s,r[e>>2]=0,a=0):(o=a,a=A),(0|o)<0&&(a=a-o|0,r[e>>2]=a,s=s-o|0,r[i>>2]=s,r[n>>2]=0,o=0),t=a-s|0,A=o-s|0,(0|s)<0?(r[e>>2]=t,r[n>>2]=A,r[i>>2]=0,a=t,s=0):A=o,(0|(o=(0|s)<(0|(o=(0|A)<(0|a)?A:a))?s:o))<=0||(r[e>>2]=a-o,r[n>>2]=A-o,r[i>>2]=s-o)}function ve(e){switch(0|(e|=0)){case 1:e=5;break;case 5:e=4;break;case 4:e=6;break;case 6:e=2;break;case 2:e=3;break;case 3:e=1}return 0|e}function ye(e){switch(0|(e|=0)){case 1:e=3;break;case 3:e=2;break;case 2:e=6;break;case 6:e=4;break;case 4:e=5;break;case 5:e=1}return 0|e}function be(e){var t,n,i,s=0,o=0,a=0,A=0;s=0|r[(e|=0)>>2],o=0|r[(n=e+4|0)>>2],a=0|r[(i=e+8|0)>>2],A=o+(s<<1)|0,r[e>>2]=A,o=a+(o<<1)|0,r[n>>2]=o,s=(a<<1)+s|0,r[i>>2]=s,a=o-A|0,(0|A)<0?(s=s-A|0,r[n>>2]=a,r[i>>2]=s,r[e>>2]=0,o=a,a=0):a=A,(0|o)<0&&(a=a-o|0,r[e>>2]=a,s=s-o|0,r[i>>2]=s,r[n>>2]=0,o=0),t=a-s|0,A=o-s|0,(0|s)<0?(r[e>>2]=t,r[n>>2]=A,r[i>>2]=0,a=t,s=0):A=o,(0|(o=(0|s)<(0|(o=(0|A)<(0|a)?A:a))?s:o))<=0||(r[e>>2]=a-o,r[n>>2]=A-o,r[i>>2]=s-o)}function we(e){var t,n,i,s=0,o=0,a=0,A=0;A=0|r[(e|=0)>>2],a=((s=0|r[(n=e+4|0)>>2])<<1)+A|0,A=(o=0|r[(i=e+8|0)>>2])+(A<<1)|0,r[e>>2]=A,r[n>>2]=a,s=(o<<1)+s|0,r[i>>2]=s,o=a-A|0,(0|A)<0?(s=s-A|0,r[n>>2]=o,r[i>>2]=s,r[e>>2]=0,A=0):o=a,(0|o)<0&&(A=A-o|0,r[e>>2]=A,s=s-o|0,r[i>>2]=s,r[n>>2]=0,o=0),t=A-s|0,a=o-s|0,(0|s)<0?(r[e>>2]=t,r[n>>2]=a,r[i>>2]=0,A=t,s=0):a=o,(0|(o=(0|s)<(0|(o=(0|a)<(0|A)?a:A))?s:o))<=0||(r[e>>2]=A-o,r[n>>2]=a-o,r[i>>2]=s-o)}function Ee(e,t){t|=0;var n,i,s,o=0,a=0,A=0;return s=(0|(i=(0|r[(e|=0)>>2])-(0|r[t>>2])|0))<0,n=(0|(a=(0|r[e+4>>2])-(0|r[t+4>>2])-(s?i:0)|0))<0,t=(t=(e=(0|(A=(s?0-i|0:0)+(0|r[e+8>>2])-(0|r[t+8>>2])+(n?0-a|0:0)|0))<0)?0:A)-((a=(0|(e=(0|t)<(0|(e=(0|(o=(n?0:a)-(e?A:0)|0))<(0|(A=(s?0:i)-(n?a:0)-(e?A:0)|0))?o:A))?t:e))>0)?e:0)|0,o=o-(a?e:0)|0,0|((0|(e=(0|(e=A-(a?e:0)|0))>-1?e:0-e|0))>(0|(t=(0|(o=(0|o)>-1?o:0-o|0))>(0|(t=(0|t)>-1?t:0-t|0))?o:t))?e:t)}function xe(e){var t,n,i,s;n=(s=0|r[(t=(e|=0)+8|0)>>2])-(0|r[e>>2])|0,r[e>>2]=n,e=(0|r[(i=e+4|0)>>2])-s|0,r[i>>2]=e,r[t>>2]=0-(e+n)}function Te(e){var t,n,i=0,s=0,o=0,a=0,A=0;i=0-(s=0|r[(e|=0)>>2])|0,r[e>>2]=i,r[(t=e+8|0)>>2]=0,a=(o=0|r[(n=e+4|0)>>2])+s|0,(0|s)>0?(r[n>>2]=a,r[t>>2]=s,r[e>>2]=0,i=0,o=a):s=0,(0|o)<0?(A=i-o|0,r[e>>2]=A,s=s-o|0,r[t>>2]=s,r[n>>2]=0,a=A-s|0,i=0-s|0,(0|s)<0?(r[e>>2]=a,r[n>>2]=i,r[t>>2]=0,o=i,s=0):(o=0,a=A)):a=i,(0|(i=(0|s)<(0|(i=(0|o)<(0|a)?o:a))?s:i))<=0||(r[e>>2]=a-i,r[n>>2]=o-i,r[t>>2]=s-i)}function Se(e,t){var n=0;switch(n=0|rn(0|(e|=0),0|(t|=0),56),T(),7&n){case 0:case 7:return 0|(n=0)}return n=-2130706433&t|134217728,!0&268435456==(2013265920&t)?!0&16777216==(117440512&t)&!!(0|ze(e,n))?0|(n=0):0|(n=0|Ne(e,n)):0|(n=0)}function Ce(e,t,n){n|=0;var i,s,o=0,a=0;return s=k,k=k+16|0,i=s,a=-2130706433&(t|=0)|134217728,!0&268435456==(2013265920&t)?(o=0|rn(0|(e|=0),0|t,56),T(),o=0|function(e,t,n){e|=0,t|=0,n|=0;var i=0,s=0,o=0;if(o=k,k=k+16|0,s=o,i=0|ze(e,t),(n+-1|0)>>>0>5)return k=o,0|(s=-1);if(i=!!(0|i),1==(0|n)&i)return k=o,0|(s=-1);do{if(!(0|Bt(e,t,s))){if(i){i=(5+(0|r[26352+(n<<2)>>2])-(0|r[s>>2])|0)%5|0;break}i=(6+(0|r[26384+(n<<2)>>2])-(0|r[s>>2])|0)%6|0;break}i=-1}while(0);return s=i,k=o,0|s}(e,a,7&o),-1==(0|o)?(r[n>>2]=0,k=s,0|(a=6)):(0|qe(e,a,i)&&S(27795,26932,282,26947),t=0|rn(0|e,0|t,52),T(),t&=15,0|ze(e,a)?Ie(i,t,o,2,n):Be(i,t,o,2,n),k=s,0|(a=0))):(k=s,0|(a=6))}function Pe(e,t,n){var i,o;i=k,k=k+16|0,function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var o=0,a=0,A=0,l=0,c=0;if(l=k,k=k+16|0,function(e,t,n){e|=0,t|=0,n|=0;var i=0,o=0,a=0;a=k,k=k+32|0,function(e,t){e|=0,t|=0;var n=0,i=0,r=0;n=+s[e>>3],i=+h(+n),n=+d(+n),s[t+16>>3]=n,n=+s[e+8>>3],r=i*+h(+n),s[t>>3]=r,n=i*+d(+n),s[t+8>>3]=n}(e,o=a),r[t>>2]=0,s[n>>3]=5,(i=+Lt(16400,o))<+s[n>>3]&&(r[t>>2]=0,s[n>>3]=i);(i=+Lt(16424,o))<+s[n>>3]&&(r[t>>2]=1,s[n>>3]=i);(i=+Lt(16448,o))<+s[n>>3]&&(r[t>>2]=2,s[n>>3]=i);(i=+Lt(16472,o))<+s[n>>3]&&(r[t>>2]=3,s[n>>3]=i);(i=+Lt(16496,o))<+s[n>>3]&&(r[t>>2]=4,s[n>>3]=i);(i=+Lt(16520,o))<+s[n>>3]&&(r[t>>2]=5,s[n>>3]=i);(i=+Lt(16544,o))<+s[n>>3]&&(r[t>>2]=6,s[n>>3]=i);(i=+Lt(16568,o))<+s[n>>3]&&(r[t>>2]=7,s[n>>3]=i);(i=+Lt(16592,o))<+s[n>>3]&&(r[t>>2]=8,s[n>>3]=i);(i=+Lt(16616,o))<+s[n>>3]&&(r[t>>2]=9,s[n>>3]=i);(i=+Lt(16640,o))<+s[n>>3]&&(r[t>>2]=10,s[n>>3]=i);(i=+Lt(16664,o))<+s[n>>3]&&(r[t>>2]=11,s[n>>3]=i);(i=+Lt(16688,o))<+s[n>>3]&&(r[t>>2]=12,s[n>>3]=i);(i=+Lt(16712,o))<+s[n>>3]&&(r[t>>2]=13,s[n>>3]=i);(i=+Lt(16736,o))<+s[n>>3]&&(r[t>>2]=14,s[n>>3]=i);(i=+Lt(16760,o))<+s[n>>3]&&(r[t>>2]=15,s[n>>3]=i);(i=+Lt(16784,o))<+s[n>>3]&&(r[t>>2]=16,s[n>>3]=i);(i=+Lt(16808,o))<+s[n>>3]&&(r[t>>2]=17,s[n>>3]=i);(i=+Lt(16832,o))<+s[n>>3]&&(r[t>>2]=18,s[n>>3]=i);if(!((i=+Lt(16856,o))<+s[n>>3]))return void(k=a);r[t>>2]=19,s[n>>3]=i,k=a}(e,n,c=l),(a=+p(+(1-.5*+s[c>>3])))<1e-16)return r[i>>2]=0,r[i+4>>2]=0,r[i+8>>2]=0,r[i+12>>2]=0,void(k=l);c=0|r[n>>2],o=+st((o=+s[15920+(24*c|0)>>3])-+st(+function(e,t){e|=0,t|=0;var n=0,i=0,r=0,o=0,a=0;return o=+s[t>>3],i=+h(+o),r=+s[t+8>>3]-+s[e+8>>3],a=i*+d(+r),n=+s[e>>3],+ +_(+a,+(+d(+o)*+h(+n)-+h(+r)*(i*+d(+n))))}(15600+(c<<4)|0,e))),A=0|Ye(t)?+st(o+-.3334731722518321):o;if(o=2.618033988749896*+f(+a),(0|t)>0){e=0;do{o*=2.6457513110645907,e=e+1|0}while((0|e)!=(0|t))}a=+h(+A)*o,s[i>>3]=a,A=+d(+A)*o,s[i+8>>3]=A,k=l}(e|=0,t|=0,n|=0,o=i),function(e,t){e|=0;var n,i,o,a,A=0,c=0,u=0,h=0,d=0,f=0,p=0;r[(a=8+(t|=0)|0)>>2]=0,i=+s[e>>3],h=+l(+i),o=+s[e+8>>3],h+=.5*(d=1.1547005383792515*+l(+o)),h-=+(0|(A=~~h)),d-=+(0|(e=~~d));do{if(h<.5){if(h<.3333333333333333){if(r[t>>2]=A,d<.5*(h+1)){r[t+4>>2]=e;break}e=e+1|0,r[t+4>>2]=e;break}if(e=(1&!(d<(p=1-h)))+e|0,r[t+4>>2]=e,p<=d&d<2*h){A=A+1|0,r[t>>2]=A;break}r[t>>2]=A;break}if(!(h<.6666666666666666)){if(A=A+1|0,r[t>>2]=A,d<.5*h){r[t+4>>2]=e;break}e=e+1|0,r[t+4>>2]=e;break}if(d<1-h){if(r[t+4>>2]=e,2*h-1<d){r[t>>2]=A;break}}else e=e+1|0,r[t+4>>2]=e;A=A+1|0,r[t>>2]=A}while(0);do{if(i<0){if(1&e){A=~~(+(0|A)-(2*(+((f=0|Yt(0|A,((0|A)<0)<<31>>31,0|(f=(e+1|0)/2|0),((0|f)<0)<<31>>31))>>>0)+4294967296*+(0|T()))+1)),r[t>>2]=A;break}A=~~(+(0|A)-2*(+((f=0|Yt(0|A,((0|A)<0)<<31>>31,0|(f=(0|e)/2|0),((0|f)<0)<<31>>31))>>>0)+4294967296*+(0|T()))),r[t>>2]=A;break}}while(0);f=t+4|0,o<0&&(A=A-((1|e<<1)/2|0)|0,r[t>>2]=A,e=0-e|0,r[f>>2]=e),c=e-A|0,(0|A)<0?(u=0-A|0,r[f>>2]=c,r[a>>2]=u,r[t>>2]=0,e=c,A=0):u=0,(0|e)<0&&(A=A-e|0,r[t>>2]=A,u=u-e|0,r[a>>2]=u,r[f>>2]=0,e=0),n=A-u|0,c=e-u|0,(0|u)<0&&(r[t>>2]=n,r[f>>2]=c,r[a>>2]=0,e=c,A=n,u=0),(0|(c=(0|u)<(0|(c=(0|e)<(0|A)?e:A))?u:c))<=0||(r[t>>2]=A-c,r[f>>2]=e-c,r[a>>2]=u-c)}(o,n+4|0),k=i}function Re(e,t,n,i,o){t|=0,n|=0,i|=0,o|=0;var a,A=0,u=0;if(A=+function(e){e|=0;var t=0,n=0;return n=+s[e>>3],t=+s[e+8>>3],+ +c(+(n*n+t*t))}(e|=0),A<1e-16)return t=15600+(t<<4)|0,r[o>>2]=r[t>>2],r[o+4>>2]=r[t+4>>2],r[o+8>>2]=r[t+8>>2],void(r[o+12>>2]=r[t+12>>2]);if(u=+_(+ +s[e+8>>3],+ +s[e>>3]),(0|n)>0){e=0;do{A*=.37796447300922725,e=e+1|0}while((0|e)!=(0|n))}a=.3333333333333333*A,i?(n=!(0|Ye(n)),A=+m(.381966011250105*(n?a:.37796447300922725*a))):(A=+m(.381966011250105*A),0|Ye(n)&&(u=+st(u+.3334731722518321))),function(e,t,n,i){e|=0,t=+t,n=+n,i|=0;var o=0,a=0,A=0,c=0;if(n<1e-16)return r[i>>2]=r[e>>2],r[i+4>>2]=r[e+4>>2],r[i+8>>2]=r[e+8>>2],void(r[i+12>>2]=r[e+12>>2]);a=t<0?t+6.283185307179586:t,a=t>=6.283185307179586?a+-6.283185307179586:a;do{if(!(a<1e-16)){if(o=+l(+(a+-3.141592653589793))<1e-16,t=+s[e>>3],o){t-=n,s[i>>3]=t,o=i;break}if(A=+h(+n),n=+d(+n),t=A*+d(+t)+ +h(+a)*(n*+h(+t)),t=+g(+((t=t>1?1:t)<-1?-1:t)),s[i>>3]=t,+l(+(t+-1.5707963267948966))<1e-16)return s[i>>3]=1.5707963267948966,void(s[i+8>>3]=0);if(+l(+(t+1.5707963267948966))<1e-16)return s[i>>3]=-1.5707963267948966,void(s[i+8>>3]=0);if(c=1/+h(+t),a=n*+d(+a)*c,n=+s[e>>3],t=c*((A-+d(+t)*+d(+n))/+h(+n)),A=a>1?1:a,t=t>1?1:t,(t=+s[e+8>>3]+ +_(+(A<-1?-1:A),+(t<-1?-1:t)))>3.141592653589793)do{t+=-6.283185307179586}while(t>3.141592653589793);if(t<-3.141592653589793)do{t+=6.283185307179586}while(t<-3.141592653589793);return void(s[i+8>>3]=t)}t=+s[e>>3]+n,s[i>>3]=t,o=i}while(0);if(+l(+(t+-1.5707963267948966))<1e-16)return s[o>>3]=1.5707963267948966,void(s[i+8>>3]=0);if(+l(+(t+1.5707963267948966))<1e-16)return s[o>>3]=-1.5707963267948966,void(s[i+8>>3]=0);if(t=+s[e+8>>3],t>3.141592653589793)do{t+=-6.283185307179586}while(t>3.141592653589793);if(t<-3.141592653589793)do{t+=6.283185307179586}while(t<-3.141592653589793);s[i+8>>3]=t}(15600+(t<<4)|0,+st(+s[15920+(24*t|0)>>3]-u),A,o)}function Ie(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var a,A,l,c,u,h,d,f,p,g,m,_,v,y,b,w,E,x,T,C,P,R,I=0,M=0,L=0,B=0,D=0,O=0;if(R=k,k=k+272|0,B=R+240|0,T=R,C=R+224|0,P=R+208|0,m=R+176|0,_=R+160|0,v=R+192|0,y=R+144|0,b=R+128|0,w=R+112|0,E=R+96|0,x=R+80|0,r[(I=R+256|0)>>2]=t,r[B>>2]=r[e>>2],r[B+4>>2]=r[e+4>>2],r[B+8>>2]=r[e+8>>2],r[B+12>>2]=r[e+12>>2],Me(B,I,T),r[o>>2]=0,(0|(B=i+n+(5==(0|i)&1)|0))<=(0|n))k=R;else{A=C+4|0,l=m+4|0,c=n+5|0,u=16880+((a=0|r[I>>2])<<2)|0,h=16960+(a<<2)|0,d=b+8|0,f=w+8|0,p=E+8|0,g=P+4|0,L=n;e:for(;;){M=T+((0|L)%5<<4)|0,r[P>>2]=r[M>>2],r[P+4>>2]=r[M+4>>2],r[P+8>>2]=r[M+8>>2],r[P+12>>2]=r[M+12>>2];do{}while(2==(0|ke(P,a,0,1)));if((0|L)>(0|n)&!!(0|Ye(t))){if(r[m>>2]=r[P>>2],r[m+4>>2]=r[P+4>>2],r[m+8>>2]=r[P+8>>2],r[m+12>>2]=r[P+12>>2],se(A,_),i=0|r[m>>2],I=0|r[17040+(80*i|0)+(r[C>>2]<<2)>>2],r[m>>2]=r[18640+(80*i|0)+(20*I|0)>>2],(0|(M=0|r[18640+(80*i|0)+(20*I|0)+16>>2]))>0){e=0;do{me(l),e=e+1|0}while((0|e)<(0|M))}switch(M=18640+(80*i|0)+(20*I|0)+4|0,r[v>>2]=r[M>>2],r[v+4>>2]=r[M+4>>2],r[v+8>>2]=r[M+8>>2],Ae(v,3*(0|r[u>>2])|0),oe(l,v,l),re(l),se(l,y),D=+(0|r[h>>2]),s[b>>3]=3*D,s[d>>3]=0,O=-1.5*D,s[w>>3]=O,s[f>>3]=2.598076211353316*D,s[E>>3]=O,s[p>>3]=-2.598076211353316*D,0|r[17040+(80*(0|r[m>>2])|0)+(r[P>>2]<<2)>>2]){case 1:e=w,i=b;break;case 3:e=E,i=w;break;case 2:e=b,i=E;break;default:e=12;break e}Mt(_,y,i,e,x),Re(x,0|r[m>>2],a,1,o+8+(r[o>>2]<<4)|0),r[o>>2]=1+(0|r[o>>2])}if((0|L)<(0|c)&&(se(g,m),Re(m,0|r[P>>2],a,1,o+8+(r[o>>2]<<4)|0),r[o>>2]=1+(0|r[o>>2])),r[C>>2]=r[P>>2],r[C+4>>2]=r[P+4>>2],r[C+8>>2]=r[P+8>>2],r[C+12>>2]=r[P+12>>2],(0|(L=L+1|0))>=(0|B)){e=3;break}}3!=(0|e)?12==(0|e)&&S(26970,27017,572,27027):k=R}}function Me(e,t,n){e|=0,t|=0,n|=0;var i,s=0,o=0,a=0,A=0,l=0;i=k,k=k+128|0,o=i,A=20240,l=(a=s=i+64|0)+60|0;do{r[a>>2]=r[A>>2],a=a+4|0,A=A+4|0}while((0|a)<(0|l));A=20304,l=(a=o)+60|0;do{r[a>>2]=r[A>>2],a=a+4|0,A=A+4|0}while((0|a)<(0|l));s=(l=!(0|Ye(0|r[t>>2])))?s:o,be(o=e+4|0),we(o),0|Ye(0|r[t>>2])&&(pe(o),r[t>>2]=1+(0|r[t>>2])),r[n>>2]=r[e>>2],oe(o,s,t=n+4|0),re(t),r[n+16>>2]=r[e>>2],oe(o,s+12|0,t=n+20|0),re(t),r[n+32>>2]=r[e>>2],oe(o,s+24|0,t=n+36|0),re(t),r[n+48>>2]=r[e>>2],oe(o,s+36|0,t=n+52|0),re(t),r[n+64>>2]=r[e>>2],oe(o,s+48|0,n=n+68|0),re(n),k=i}function ke(e,t,n,i){n|=0,i|=0;var s,o,a,A,l,c,u=0,h=0,d=0,f=0,p=0;if(c=k,k=k+32|0,l=c+12|0,o=c,p=(e|=0)+4|0,f=0|r[16960+((t|=0)<<2)>>2],f=(A=!!(0|i))?3*f|0:f,u=0|r[p>>2],s=0|r[(a=e+8|0)>>2],A){if((0|(u=s+u+(i=0|r[(h=e+12|0)>>2])|0))==(0|f))return k=c,0|(p=1);d=h}else u=s+u+(i=0|r[(d=e+12|0)>>2])|0;if((0|u)<=(0|f))return k=c,0|(p=0);do{if((0|i)>0){if(i=0|r[e>>2],(0|s)>0){h=18640+(80*i|0)+60|0,i=e;break}i=18640+(80*i|0)+40|0,n?(ie(l,f,0,0),ae(p,l,o),_e(o),oe(o,l,p),h=i,i=e):(h=i,i=e)}else h=18640+(80*(0|r[e>>2])|0)+20|0,i=e}while(0);if(r[i>>2]=r[h>>2],(0|r[(u=h+16|0)>>2])>0){i=0;do{me(p),i=i+1|0}while((0|i)<(0|r[u>>2]))}return e=h+4|0,r[l>>2]=r[e>>2],r[l+4>>2]=r[e+4>>2],r[l+8>>2]=r[e+8>>2],t=0|r[16880+(t<<2)>>2],Ae(l,A?3*t|0:t),oe(p,l,p),re(p),i=A&&((0|r[a>>2])+(0|r[p>>2])+(0|r[d>>2])|0)==(0|f)?1:2,k=c,0|(p=i)}function Le(e,t){e|=0,t|=0;var n=0;do{n=0|ke(e,t,0,1)}while(2==(0|n));return 0|n}function Be(e,t,n,i,o){e|=0,t|=0,n|=0,i|=0,o|=0;var a,A,l,c,u,h,d,f,p,g,m,_,v,y,b,w,E,x,T=0,C=0,P=0,R=0,I=0;if(x=k,k=k+240|0,y=x+208|0,b=x,w=x+192|0,E=x+176|0,p=x+160|0,g=x+144|0,m=x+128|0,_=x+112|0,v=x+96|0,r[(T=x+224|0)>>2]=t,r[y>>2]=r[e>>2],r[y+4>>2]=r[e+4>>2],r[y+8>>2]=r[e+8>>2],r[y+12>>2]=r[e+12>>2],De(y,T,b),r[o>>2]=0,(0|(f=i+n+(6==(0|i)&1)|0))<=(0|n))k=x;else{A=n+6|0,l=16960+((a=0|r[T>>2])<<2)|0,c=g+8|0,u=m+8|0,h=_+8|0,d=w+4|0,C=0,P=n,i=-1;e:for(;;){if(e=b+((T=(0|P)%6|0)<<4)|0,r[w>>2]=r[e>>2],r[w+4>>2]=r[e+4>>2],r[w+8>>2]=r[e+8>>2],r[w+12>>2]=r[e+12>>2],e=C,C=0|ke(w,a,0,1),(0|P)>(0|n)&!!(0|Ye(t))&&(1!=(0|e)&&(0|r[w>>2])!=(0|i))){switch(se(b+((T+5|0)%6<<4)+4|0,E),se(b+(T<<4)+4|0,p),R=+(0|r[l>>2]),s[g>>3]=3*R,s[c>>3]=0,I=-1.5*R,s[m>>3]=I,s[u>>3]=2.598076211353316*R,s[_>>3]=I,s[h>>3]=-2.598076211353316*R,T=0|r[y>>2],0|r[17040+(80*T|0)+(((0|i)==(0|T)?r[w>>2]:i)<<2)>>2]){case 1:e=m,i=g;break;case 3:e=_,i=m;break;case 2:e=g,i=_;break;default:e=8;break e}Mt(E,p,i,e,v),0|kt(E,v)||0|kt(p,v)||(Re(v,0|r[y>>2],a,1,o+8+(r[o>>2]<<4)|0),r[o>>2]=1+(0|r[o>>2]))}if((0|P)<(0|A)&&(se(d,E),Re(E,0|r[w>>2],a,1,o+8+(r[o>>2]<<4)|0),r[o>>2]=1+(0|r[o>>2])),(0|(P=P+1|0))>=(0|f)){e=3;break}i=0|r[w>>2]}3!=(0|e)?8==(0|e)&&S(27054,27017,737,27099):k=x}}function De(e,t,n){e|=0,t|=0,n|=0;var i,s=0,o=0,a=0,A=0,l=0;i=k,k=k+160|0,o=i,A=20368,l=(a=s=i+80|0)+72|0;do{r[a>>2]=r[A>>2],a=a+4|0,A=A+4|0}while((0|a)<(0|l));A=20448,l=(a=o)+72|0;do{r[a>>2]=r[A>>2],a=a+4|0,A=A+4|0}while((0|a)<(0|l));s=(l=!(0|Ye(0|r[t>>2])))?s:o,be(o=e+4|0),we(o),0|Ye(0|r[t>>2])&&(pe(o),r[t>>2]=1+(0|r[t>>2])),r[n>>2]=r[e>>2],oe(o,s,t=n+4|0),re(t),r[n+16>>2]=r[e>>2],oe(o,s+12|0,t=n+20|0),re(t),r[n+32>>2]=r[e>>2],oe(o,s+24|0,t=n+36|0),re(t),r[n+48>>2]=r[e>>2],oe(o,s+36|0,t=n+52|0),re(t),r[n+64>>2]=r[e>>2],oe(o,s+48|0,t=n+68|0),re(t),r[n+80>>2]=r[e>>2],oe(o,s+60|0,n=n+84|0),re(n),k=i}function Oe(e,t){return t=0|rn(0|(e|=0),0|(t|=0),45),T(),127&t}function Ne(e,t){e|=0;var n=0,r=0,s=0,o=0;return!0&134217728==(-16777216&(t|=0))?(r=0|rn(0|e,0|t,52),T(),r&=15,n=0|rn(0|e,0|t,45),T(),(n&=127)>>>0>121?0|(e=0):!(613566756&(o=0|sn(0|(s=0|rn(0|e,0|t,0|(o=3*(15^r)|0))),0|T(),0|o))&(0|Yt(-1227133514,-1171,0|o,0|(s=0|T()))))&!(4681&s&T())&&15==(0|r)|!(0|(o=0|rn(0|(0|sn(0|~e,0|~t,0|(o=19+(3*r|0)|0))),0|T(),0|o)))&!(0|T())?0|i[20528+n|0]?!(0|e)&!(0|(t&=8191))?0|(o=1):(o=0|on(0|e,0|t),T(),0|!!((63-o|0)%3|0)):0|(o=1):0|(o=0)):0|(e=0)}function Fe(e,t,n,i){e|=0,n|=0,i|=0;var s=0,o=0,a=0,A=0;if(s=0|sn(0|(t|=0),0,52),o=0|T(),n=0|sn(0|n,0,45),n=0|o|T()|134225919,(0|t)<1)return o=-1,i=n,r[(t=e)>>2]=o,void(r[(e=e+4|0)>>2]=i);for(o=1,s=-1;A=0|sn(7,0,0|(a=3*(15-o|0)|0)),n&=~T(),s=s&~A|(a=0|sn(0|i,0,0|a)),n=0|n|T(),(0|o)!=(0|t);)o=o+1|0;r[(a=A=e)>>2]=s,r[(A=A+4|0)>>2]=n}function Ue(e,t,n,i){n|=0,i|=0;var s=0,o=0;if(o=0|rn(0|(e|=0),0|(t|=0),52),T(),n>>>0>15)return 0|(i=4);if((0|(o&=15))<(0|n))return 0|(i=12);if((0|o)==(0|n))return r[i>>2]=e,r[i+4>>2]=t,0|(i=0);if(s=0|sn(0|n,0,52),s|=e,e=T()|-15728641&t,(0|o)>(0|n))do{t=0|sn(7,0,3*(14-n|0)|0),n=n+1|0,s|=t,e=0|T()|e}while((0|n)<(0|o));return r[i>>2]=s,r[i+4>>2]=e,0|(i=0)}function Ge(e,t,n,i){n|=0,i|=0;var s=0,o=0,a=0;if(o=0|rn(0|(e|=0),0|(t|=0),52),T(),!((0|n)<16&(0|(o&=15))<=(0|n)))return 0|(i=4);s=n-o|0,n=0|rn(0|e,0|t,45),T();e:do{if(0|z(127&n)){t:do{if(0|o){for(n=1;!((a=0|sn(7,0,3*(15-n|0)|0))&e|0)&!((0|T())&t);){if(!(n>>>0<o>>>0))break t;n=n+1|0}n=0|vt(7,0,s,((0|s)<0)<<31>>31),s=0|T();break e}}while(0);n=0|$t(0|(n=0|Jt(0|(n=0|vt(7,0,s,((0|s)<0)<<31>>31)),0|T(),5,0)),0|T(),-5,-1),n=0|$t(0|(n=0|qt(0|n,0|T(),6,0)),0|T(),1,0),s=0|T()}else n=0|vt(7,0,s,((0|s)<0)<<31>>31),s=0|T()}while(0);return r[(a=i)>>2]=n,r[a+4>>2]=s,0|(a=0)}function ze(e,t){var n=0,i=0,r=0;if(r=0|rn(0|(e|=0),0|(t|=0),45),T(),!(0|z(127&r)))return 0|(r=0);r=0|rn(0|e,0|t,52),T(),r&=15;e:do{if(r)for(i=1;;){if(n=0|rn(0|e,0|t,3*(15-i|0)|0),T(),0|(n&=7))break e;if(!(i>>>0<r>>>0)){n=0;break}i=i+1|0}else n=0}while(0);return 0|(r=1&!(0|n))}function Ve(e,t,n,i){return e|=0,t|=0,(0|(i|=0))<(0|(n|=0))?(i=e,x(0|(n=t)),0|i):(n=0|sn(-1,-1,3+(3*(i-n|0)|0)|0),i=0|sn(0|~n,0|~T(),3*(15-i|0)|0),n=~T()&t,i=~i&e,x(0|n),0|i)}function We(e,t,n,i){n|=0,i|=0;var s=0;return s=0|rn(0|(e|=0),0|(t|=0),52),T(),(0|n)<16&(0|(s&=15))<=(0|n)?((0|s)<(0|n)&&(s=0|sn(-1,-1,3+(3*(n+-1-s|0)|0)|0),s=0|sn(0|~s,0|~T(),3*(15-n|0)|0),t=~T()&t,e&=~s),s=0|sn(0|n,0,52),n=-15728641&t|T(),r[i>>2]=e|s,r[i+4>>2]=n,0|(i=0)):0|(i=4)}function je(e,t){var n=0,i=0,r=0;if(r=0|rn(0|(e|=0),0|(t|=0),52),T(),!(r&=15))return 0|(r=0);for(i=1;;){if(n=0|rn(0|e,0|t,3*(15-i|0)|0),T(),0|(n&=7)){i=5;break}if(!(i>>>0<r>>>0)){n=0,i=5;break}i=i+1|0}return 5==(0|i)?0|n:0}function He(e,t){var n=0,i=0,r=0,s=0,o=0,a=0,A=0;if(A=0|rn(0|(e|=0),0|(t|=0),52),T(),!(A&=15))return A=e,x(0|(a=t)),0|A;for(a=1,n=0;;){i=0|sn(7,0,0|(s=3*(15-a|0)|0)),r=0|T(),o=0|rn(0|e,0|t,0|s),T(),e=(s=0|sn(0|ve(7&o),0,0|s))|e&~i,t=(o=0|T())|t&~r;e:do{if(!n)if(!(s&i|0)&!(o&r|0))n=0;else if(i=0|rn(0|e,0|t,52),T(),i&=15){n=1;t:for(;;){switch(o=0|rn(0|e,0|t,3*(15-n|0)|0),T(),7&o){case 1:break t;case 0:break;default:n=1;break e}if(!(n>>>0<i>>>0)){n=1;break e}n=n+1|0}for(n=1;;){if(r=0|rn(0|e,0|t,0|(o=3*(15-n|0)|0)),T(),s=0|sn(7,0,0|o),t&=~T(),e=e&~s|(o=0|sn(0|ve(7&r),0,0|o)),t=0|t|T(),!(n>>>0<i>>>0)){n=1;break}n=n+1|0}}else n=1}while(0);if(!(a>>>0<A>>>0))break;a=a+1|0}return x(0|t),0|e}function Xe(e,t){var n=0,i=0,r=0,s=0,o=0;if(i=0|rn(0|(e|=0),0|(t|=0),52),T(),!(i&=15))return i=e,x(0|(n=t)),0|i;for(n=1;o=0|rn(0|e,0|t,0|(s=3*(15-n|0)|0)),T(),r=0|sn(7,0,0|s),t&=~T(),e=(s=0|sn(0|ve(7&o),0,0|s))|e&~r,t=0|T()|t,n>>>0<i>>>0;)n=n+1|0;return x(0|t),0|e}function Qe(e,t){var n=0,i=0,r=0,s=0,o=0,a=0,A=0;if(A=0|rn(0|(e|=0),0|(t|=0),52),T(),!(A&=15))return A=e,x(0|(a=t)),0|A;for(a=1,n=0;;){i=0|sn(7,0,0|(s=3*(15-a|0)|0)),r=0|T(),o=0|rn(0|e,0|t,0|s),T(),e=(s=0|sn(0|ye(7&o),0,0|s))|e&~i,t=(o=0|T())|t&~r;e:do{if(!n)if(!(s&i|0)&!(o&r|0))n=0;else if(i=0|rn(0|e,0|t,52),T(),i&=15){n=1;t:for(;;){switch(o=0|rn(0|e,0|t,3*(15-n|0)|0),T(),7&o){case 1:break t;case 0:break;default:n=1;break e}if(!(n>>>0<i>>>0)){n=1;break e}n=n+1|0}for(n=1;;){if(s=0|sn(7,0,0|(r=3*(15-n|0)|0)),o=t&~T(),t=0|rn(0|e,0|t,0|r),T(),e=e&~s|(t=0|sn(0|ye(7&t),0,0|r)),t=0|o|T(),!(n>>>0<i>>>0)){n=1;break}n=n+1|0}}else n=1}while(0);if(!(a>>>0<A>>>0))break;a=a+1|0}return x(0|t),0|e}function $e(e,t){var n=0,i=0,r=0,s=0,o=0;if(i=0|rn(0|(e|=0),0|(t|=0),52),T(),!(i&=15))return i=e,x(0|(n=t)),0|i;for(n=1;s=0|sn(7,0,0|(o=3*(15-n|0)|0)),r=t&~T(),t=0|rn(0|e,0|t,0|o),T(),e=(t=0|sn(0|ye(7&t),0,0|o))|e&~s,t=0|T()|r,n>>>0<i>>>0;)n=n+1|0;return x(0|t),0|e}function Ye(e){return(0|(e|=0))%2|0}function Ke(e,t,n){n|=0;var i,s=0;return i=k,k=k+16|0,s=i,(t|=0)>>>0>15?(k=i,0|(s=4)):2146435072&~r[(e|=0)+4>>2]&&2146435072&~r[e+8+4>>2]?(Pe(e,t,s),t=0|function(e,t){e|=0;var n,i=0,s=0,o=0,a=0,A=0,l=0,c=0,u=0;if(n=k,k=k+64|0,l=n+40|0,s=n+24|0,o=n+12|0,a=n,sn(0|(t|=0),0,52),i=134225919|T(),!t)return(0|r[e+4>>2])>2||(0|r[e+8>>2])>2||(0|r[e+12>>2])>2?(l=0,x(0|(A=0)),k=n,0|l):(sn(0|W(e),0,45),A=0|T()|i,l=-1,x(0|A),k=n,0|l);if(r[l>>2]=r[e>>2],r[l+4>>2]=r[e+4>>2],r[l+8>>2]=r[e+8>>2],r[l+12>>2]=r[e+12>>2],A=l+4|0,(0|t)>0)for(e=-1;r[s>>2]=r[A>>2],r[s+4>>2]=r[A+4>>2],r[s+8>>2]=r[A+8>>2],1&t?(he(A),r[o>>2]=r[A>>2],r[o+4>>2]=r[A+4>>2],r[o+8>>2]=r[A+8>>2],fe(o)):(de(A),r[o>>2]=r[A>>2],r[o+4>>2]=r[A+4>>2],r[o+8>>2]=r[A+8>>2],pe(o)),ae(s,o,a),re(a),c=0|sn(7,0,0|(u=3*(15-t|0)|0)),i&=~T(),e=(u=0|sn(0|le(a),0,0|u))|e&~c,i=0|T()|i,(0|t)>1;)t=t+-1|0;else e=-1;e:do{if((0|r[A>>2])<=2&&(0|r[l+8>>2])<=2&&(0|r[l+12>>2])<=2){if(t=0|sn(0|(s=0|W(l)),0,45),t|=e,e=T()|-1040385&i,a=0|j(l),!(0|z(s))){if((0|a)<=0)break;for(o=0;;){if(s=0|rn(0|t,0|e,52),T(),s&=15)for(i=1;l=0|rn(0|t,0|e,0|(u=3*(15-i|0)|0)),T(),c=0|sn(7,0,0|u),e&=~T(),t=t&~c|(u=0|sn(0|ve(7&l),0,0|u)),e=0|e|T(),i>>>0<s>>>0;)i=i+1|0;if((0|(o=o+1|0))==(0|a))break e}}o=0|rn(0|t,0|e,52),T(),o&=15;t:do{if(o){i=1;n:for(;;){switch(u=0|rn(0|t,0|e,3*(15-i|0)|0),T(),7&u){case 1:break n;case 0:break;default:break t}if(!(i>>>0<o>>>0))break t;i=i+1|0}if(0|H(s,0|r[l>>2]))for(i=1;c=0|sn(7,0,0|(l=3*(15-i|0)|0)),u=e&~T(),e=0|rn(0|t,0|e,0|l),T(),t=t&~c|(e=0|sn(0|ye(7&e),0,0|l)),e=0|u|T(),i>>>0<o>>>0;)i=i+1|0;else for(i=1;l=0|rn(0|t,0|e,0|(u=3*(15-i|0)|0)),T(),c=0|sn(7,0,0|u),e&=~T(),t=t&~c|(u=0|sn(0|ve(7&l),0,0|u)),e=0|e|T(),i>>>0<o>>>0;)i=i+1|0}}while(0);if((0|a)>0){i=0;do{t=0|He(t,e),e=0|T(),i=i+1|0}while((0|i)!=(0|a))}}else t=0,e=0}while(0);return u=t,x(0|(c=e)),k=n,0|u}(s,t),s=0|T(),r[n>>2]=t,r[n+4>>2]=s,!(0|t)&!(0|s)&&S(27795,27122,1050,27145),k=i,0|(s=0)):(k=i,0|(s=3))}function Ze(e,t,n){var i,s=0,o=0,a=0;if(i=(n|=0)+4|0,o=0|rn(0|(e|=0),0|(t|=0),52),T(),o&=15,a=0|rn(0|e,0|t,45),T(),s=!(0|o),0|z(127&a)){if(s)return 0|(a=1);s=1}else{if(s)return 0|(a=0);s=0|r[i>>2]||0|r[n+8>>2]?1:1&!!(0|r[n+12>>2])}for(n=1;1&n?fe(i):pe(i),a=0|rn(0|e,0|t,3*(15-n|0)|0),T(),ge(i,7&a),n>>>0<o>>>0;)n=n+1|0;return 0|s}function qe(e,t,n){n|=0;var i,s,o=0,a=0,A=0,l=0,c=0,u=0;if(s=k,k=k+16|0,i=s,u=0|rn(0|(e|=0),0|(t|=0),45),T(),(u&=127)>>>0>121)return r[n>>2]=0,r[n+4>>2]=0,r[n+8>>2]=0,r[n+12>>2]=0,k=s,0|(u=5);e:do{if(0|z(u)&&(A=0|rn(0|e,0|t,52),T(),0|(A&=15))){o=1;t:for(;;){switch(c=0|rn(0|e,0|t,3*(15-o|0)|0),T(),7&c){case 5:break t;case 0:break;default:o=t;break e}if(!(o>>>0<A>>>0)){o=t;break e}o=o+1|0}for(a=1,o=t;l=0|sn(7,0,0|(t=3*(15-a|0)|0)),c=o&~T(),o=0|rn(0|e,0|o,0|t),T(),e=e&~l|(o=0|sn(0|ye(7&o),0,0|t)),o=0|c|T(),a>>>0<A>>>0;)a=a+1|0}else o=t}while(0);if(c=7696+(28*u|0)|0,r[n>>2]=r[c>>2],r[n+4>>2]=r[c+4>>2],r[n+8>>2]=r[c+8>>2],r[n+12>>2]=r[c+12>>2],!(0|Ze(e,o,n)))return k=s,0|(u=0);if(l=n+4|0,r[i>>2]=r[l>>2],r[i+4>>2]=r[l+4>>2],r[i+8>>2]=r[l+8>>2],A=0|rn(0|e,0|o,52),T(),c=15&A,1&A?(pe(l),A=c+1|0):A=c,0|z(u)){e:do{if(c)for(t=1;;){if(a=0|rn(0|e,0|o,3*(15-t|0)|0),T(),0|(a&=7)){o=a;break e}if(!(t>>>0<c>>>0)){o=0;break}t=t+1|0}else o=0}while(0);o=4==(0|o)&1}else o=0;if(0|ke(n,A,o,0)){if(0|z(u))do{}while(0|ke(n,A,0,0));(0|A)!=(0|c)&&de(l)}else(0|A)!=(0|c)&&(r[l>>2]=r[i>>2],r[l+4>>2]=r[i+4>>2],r[l+8>>2]=r[i+8>>2]);return k=s,0|(u=0)}function Je(e,t,n){n|=0;var i,s,o=0;return s=k,k=k+16|0,0|(o=0|qe(e|=0,t|=0,i=s))?(k=s,0|o):(o=0|rn(0|e,0|t,52),T(),function(e,t,n){var i,s;t|=0,n|=0,i=k,k=k+16|0,se(4+(e|=0)|0,s=i),Re(s,0|r[e>>2],t,0,n),k=i}(i,15&o,n),k=s,0|(o=0))}function et(e,t,n){n|=0;var i,r=0,s=0,o=0;if(i=k,k=k+16|0,0|(r=0|qe(e|=0,t|=0,o=i)))return k=i,0|(o=r);r=0|rn(0|e,0|t,45),T(),r=!(0|z(127&r)),s=0|rn(0|e,0|t,52),T(),s&=15;e:do{if(!r){if(0|s)for(r=1;;){if(!(!((0|sn(7,0,3*(15-r|0)|0))&e|0)&!((0|T())&t)))break e;if(!(r>>>0<s>>>0))break;r=r+1|0}return Ie(o,s,0,5,n),k=i,0|0}}while(0);return Be(o,s,0,6,n),k=i,0|0}function tt(e,t){t|=0;var n=0,i=0,s=0,o=0,a=0,A=0,l=0;if((e|=0)>>>0>15)return 0|(A=4);if(sn(0|e,0,52),A=134225919|T(),!e){n=0,i=0;do{0|z(i)&&(sn(0|i,0,45),a=0|A|T(),r[(e=t+(n<<3)|0)>>2]=-1,r[e+4>>2]=a,n=n+1|0),i=i+1|0}while(122!=(0|i));return 0|(n=0)}n=0,a=0;do{if(0|z(a)){for(sn(0|a,0,45),i=1,s=-1,o=0|A|T();s&=~(l=0|sn(7,0,3*(15-i|0)|0)),o&=~T(),(0|i)!=(0|e);)i=i+1|0;r[(l=t+(n<<3)|0)>>2]=s,r[l+4>>2]=o,n=n+1|0}a=a+1|0}while(122!=(0|a));return 0|(n=0)}function nt(e,t,n,i){e|=0,i|=0;var s=0,o=0,a=0;s=0|rn(0|(t|=0),0|(n|=0),52),T(),!(0|t)&!(0|n)|(0|i)>15|(0|(s&=15))>(0|i)?(o=-1,t=-1,n=0,s=0):(t=0|Ve(t,n,s+1|0,i),a=-15728641&T(),n=0|sn(0|i,0,52),o=s,t=(t=!(0|ze(n|=t,a=0|a|T())))?-1:i,s=a),r[(a=e)>>2]=n,r[a+4>>2]=s,r[e+8>>2]=o,r[e+12>>2]=t}function it(e,t,n,i){n|=0,i|=0;var s=0,o=0;return s=0|rn(0|(e|=0),0|(t|=0),52),T(),s&=15,r[(o=i+8|0)>>2]=s,!(0|e)&!(0|t)|(0|n)>15|(0|s)>(0|n)?(r[(n=i)>>2]=0,r[n+4>>2]=0,r[o>>2]=-1,void(r[i+12>>2]=-1)):(e=0|Ve(e,t,s+1|0,n),o=-15728641&T(),s=0|sn(0|n,0,52),s|=e,o=0|o|T(),r[(e=i)>>2]=s,r[e+4>>2]=o,e=i+12|0,0|ze(s,o)?void(r[e>>2]=n):void(r[e>>2]=-1))}function rt(e){var t,n=0,i=0,s=0,o=0,a=0,A=0,l=0,c=0;if(!(!(0|(n=0|r[(i=e|=0)>>2]))&!(0|(i=0|r[i+4>>2]))||(s=0|rn(0|n,0|i,52),T(),n=0|$t(0|(l=0|sn(1,0,3*(15^(s&=15))|0)),0|T(),0|n,0|i),i=0|T(),r[(l=e)>>2]=n,r[l+4>>2]=i,(0|s)<(0|(A=0|r[(l=e+8|0)>>2]))))){for(t=e+12|0,a=s;;){if((0|a)==(0|A)){s=5;break}if(c=(0|a)==(0|r[t>>2]),s=0|rn(0|n,0|i,0|(o=3*(15-a|0)|0)),T(),c&1==(0|(s&=7))&!0){s=7;break}if(!(7==(0|s)&!0)){s=10;break}if(n=0|$t(0|n,0|i,0|(c=0|sn(1,0,0|o)),0|T()),i=0|T(),r[(c=e)>>2]=n,r[c+4>>2]=i,!((0|a)>(0|A))){s=10;break}a=a+-1|0}if(5==(0|s))return r[(c=e)>>2]=0,r[c+4>>2]=0,r[l>>2]=-1,void(r[t>>2]=-1);if(7==(0|s))return A=0|$t(0|n,0|i,0|(A=0|sn(1,0,0|o)),0|T()),l=0|T(),r[(c=e)>>2]=A,r[c+4>>2]=l,void(r[t>>2]=a+-1)}}function st(e){var t;return t=(e=+e)<0?e+6.283185307179586:e,+(e>=6.283185307179586?t+-6.283185307179586:t)}function ot(e,t){return t|=0,+l(+(+s[(e|=0)>>3]-+s[t>>3]))<17453292519943298e-27?0|(t=+l(+(+s[e+8>>3]-+s[t+8>>3]))<17453292519943298e-27):0|(t=0)}function at(e,t){switch(e=+e,0|(t|=0)){case 1:e=e<0?e+6.283185307179586:e;break;case 2:e=e>0?e+-6.283185307179586:e}return+e}function At(e,t){e|=0;var n,i,r,o=0;return i=+s[(t|=0)>>3],n=+s[e>>3],o=(r=+d(.5*(i-n)))*r+(o=+d(.5*(+s[t+8>>3]-+s[e+8>>3])))*(+h(+i)*+h(+n)*o),2*+_(+ +c(+o),+ +c(+(1-o)))*6371.007180918475}function lt(e,t){return t|=0,(e|=0)>>>0>15?0|(t=4):(s[t>>3]=+s[20656+(e<<3)>>3],0|(t=0))}function ct(e,t){t|=0;var n=0;return(e|=0)>>>0>15?0|(t=4):(n=0|Jt(0|(n=0|vt(7,0,e,((0|e)<0)<<31>>31)),0|T(),120,0),e=0|T(),r[t>>2]=2|n,r[t+4>>2]=e,0|(t=0))}function ut(e,t,n){e|=0,n|=0;var i,r,o,a,A=0,l=0,u=0,p=0,g=0,v=0;return v=+s[(t|=0)>>3],o=+s[e>>3],g=+d(.5*(v-o)),u=+s[t+8>>3],r=+s[e+8>>3],p=+d(.5*(u-r)),i=+h(+o),a=+h(+v),p=2*+_(+ +c(+(p=g*g+p*(a*i*p))),+ +c(+(1-p))),g=+s[n>>3],v=+d(.5*(g-v)),A=+s[n+8>>3],u=+d(.5*(A-u)),l=+h(+g),u=2*+_(+ +c(+(u=v*v+u*(a*l*u))),+ +c(+(1-u))),g=+d(.5*(o-g)),A=+d(.5*(r-A)),A=2*+_(+ +c(+(A=g*g+A*(i*l*A))),+ +c(+(1-A))),4*+m(+ +c(+ +f(.5*(l=.5*(p+u+A)))*+f(.5*(l-p))*+f(.5*(l-u))*+f(.5*(l-A))))}function ht(e,t,n){n|=0;var i,o,a,A=0,l=0;if(a=k,k=k+192|0,o=a,0|(l=0|Je(e|=0,t|=0,i=a+168|0)))return k=a,0|(n=l);if(0|et(e,t,o)&&S(27795,27190,415,27199),(0|(t=0|r[o>>2]))>0){if(A=+ut(o+8|0,o+8+((1!=(0|t)&1)<<4)|0,i)+0,1!=(0|t)){e=1;do{A+=+ut(o+8+((l=e)<<4)|0,o+8+((0|(e=e+1|0))%(0|t)<<4)|0,i)}while((0|e)<(0|t))}}else A=0;return s[n>>3]=A,k=a,0|(n=0)}function dt(e){e|=0;var t,n,i=0;return(t=0|Qt(1,12))||S(27280,27235,49,27293),0|(i=0|r[(n=e+4|0)>>2])?(r[(i=i+8|0)>>2]=t,r[n>>2]=t,0|t):(0|r[e>>2]&&S(27310,27235,61,27333),r[(i=e)>>2]=t,r[n>>2]=t,0|t)}function ft(e,t){e|=0,t|=0;var n,i;return(i=0|Ht(24))||S(27347,27235,78,27361),r[i>>2]=r[t>>2],r[i+4>>2]=r[t+4>>2],r[i+8>>2]=r[t+8>>2],r[i+12>>2]=r[t+12>>2],r[i+16>>2]=0,0|(n=0|r[(t=e+4|0)>>2])?(r[n+16>>2]=i,r[t>>2]=i,0|i):(0|r[e>>2]&&S(27376,27235,82,27361),r[e>>2]=i,r[t>>2]=i,0|i)}function pt(e){var t=0,n=0,i=0,s=0;if(e|=0)for(i=1;;){if(0|(t=0|r[e>>2]))do{if(0|(n=0|r[t>>2]))do{s=n,n=0|r[n+16>>2],Xt(s)}while(0|n);s=t,t=0|r[t+8>>2],Xt(s)}while(0|t);if(t=e,e=0|r[e+8>>2],i||Xt(t),!e)break;i=0}}function gt(e,t,n){e|=0;var i=0,o=0,a=0,A=0,l=0,c=0,u=0,h=0;if(!(0|Z(t|=0,n|=0)))return 0|(e=0);if(t=0|Y(t),i=+s[n>>3],o=t&(o=+s[n+8>>3])<0?o+6.283185307179586:o,!(e=0|r[e>>2]))return 0|(e=0);if(t){t=0,u=o,n=e;e:for(;;){for(;A=+s[n>>3],o=+s[n+8>>3],h=0|r[(n=n+16|0)>>2],a=+s[(h=0|h?h:e)>>3],l=+s[h+8>>3],A>a?(c=A,A=l):(c=a,a=A,A=o,o=l),(i=i==a|i==c?i+2220446049250313e-31:i)<a|i>c;)if(!(n=0|r[n>>2])){n=22;break e}if(((c=(l=A<0?A+6.283185307179586:A)+(i-a)/(c-a)*((A=o<0?o+6.283185307179586:o)-l))<0?c+6.283185307179586:c)>(u=l==u|A==u?u+-2220446049250313e-31:u)&&(t^=1),!(n=0|r[n>>2])){n=22;break}}if(22==(0|n))return 0|t}else{t=0,u=o,n=e;e:for(;;){for(;A=+s[n>>3],o=+s[n+8>>3],h=0|r[(n=n+16|0)>>2],a=+s[(h=0|h?h:e)>>3],l=+s[h+8>>3],A>a?(c=A,A=l):(c=a,a=A,A=o,o=l),(i=i==a|i==c?i+2220446049250313e-31:i)<a|i>c;)if(!(n=0|r[n>>2])){n=22;break e}if(A+(i-a)/(c-a)*(o-A)>(u=A==u|o==u?u+-2220446049250313e-31:u)&&(t^=1),!(n=0|r[n>>2])){n=22;break}}if(22==(0|n))return 0|t}return 0}function mt(e,t,n,s,o){n|=0,s|=0,o|=0;var a,A,l,c,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,y=0;if(c=k,k=k+32|0,y=c+16|0,l=c,u=0|rn(0|(e|=0),0|(t|=0),52),T(),u&=15,m=0|rn(0|n,0|s,52),T(),(0|u)!=(15&m))return k=c,0|(y=12);if(p=0|rn(0|e,0|t,45),T(),p&=127,g=0|rn(0|n,0|s,45),T(),p>>>0>121|(g&=127)>>>0>121)return k=c,0|(y=5);if(m=(0|p)!=(0|g)){if(7==(0|(d=0|Q(p,g))))return k=c,0|(y=1);7==(0|(f=0|Q(g,p)))?S(27514,27538,161,27548):(_=d,h=f)}else _=0,h=0;a=0|z(p),A=0|z(g),r[y>>2]=0,r[y+4>>2]=0,r[y+8>>2]=0,r[y+12>>2]=0;do{if(_){if(d=(0|(g=0|r[4272+(28*p|0)+(_<<2)>>2]))>0,A)if(d){p=0,f=n,d=s;do{f=0|Qe(f,d),d=0|T(),1==(0|(h=0|ye(h)))&&(h=0|ye(1)),p=p+1|0}while((0|p)!=(0|g));g=h,p=f,f=d}else g=h,p=n,f=s;else if(d){p=0,f=n,d=s;do{f=0|$e(f,d),d=0|T(),h=0|ye(h),p=p+1|0}while((0|p)!=(0|g));g=h,p=f,f=d}else g=h,p=n,f=s;if(Ze(p,f,y),m||S(27563,27538,191,27548),(d=!!(0|a))&(h=!!(0|A))&&S(27590,27538,192,27548),d){if(7==(0|(h=0|je(e,t)))){u=5;break}if(0|i[22e3+(7*h|0)+_|0]){u=1;break}p=f=0|r[21168+(28*h|0)+(_<<2)>>2]}else if(h){if(7==(0|(h=0|je(p,f)))){u=5;break}if(0|i[22e3+(7*h|0)+g|0]){u=1;break}p=0,f=0|r[21168+(28*g|0)+(h<<2)>>2]}else p=0,f=0;if((p|f|0)<0)u=5;else{if((0|f)>0){d=y+4|0,h=0;do{_e(d),h=h+1|0}while((0|h)!=(0|f))}if(r[l>>2]=0,r[l+4>>2]=0,r[l+8>>2]=0,ge(l,_),0|u)for(;0|Ye(u)?fe(l):pe(l),(0|u)>1;)u=u+-1|0;if((0|p)>0){u=0;do{_e(l),u=u+1|0}while((0|u)!=(0|p))}oe(v=y+4|0,l,v),re(v),v=51}}else if(Ze(n,s,y),!!(0|a)&!!(0|A))if((0|g)!=(0|p)&&S(27621,27538,261,27548),7==(0|(h=0|je(e,t)))|7==(0|(u=0|je(n,s))))u=5;else if(0|i[22e3+(7*h|0)+u|0])u=1;else if((0|(h=0|r[21168+(28*h|0)+(u<<2)>>2]))>0){d=y+4|0,u=0;do{_e(d),u=u+1|0}while((0|u)!=(0|h));v=51}else v=51;else v=51}while(0);return 51==(0|v)&&(u=y+4|0,r[o>>2]=r[u>>2],r[o+4>>2]=r[u+4>>2],r[o+8>>2]=r[u+8>>2],u=0),k=c,0|(y=u)}function _t(e,t,n,i){n|=0,i|=0;var s,o,a,A=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,y=0;if(a=k,k=k+48|0,s=a+36|0,c=a+24|0,u=a+12|0,h=a,A=0|rn(0|(e|=0),0|(t|=0),52),T(),A&=15,f=0|rn(0|e,0|t,45),T(),(f&=127)>>>0>121)return k=a,0|(i=5);if(o=0|z(f),sn(0|A,0,52),m=134225919|T(),r[(l=i)>>2]=-1,r[l+4>>2]=m,!A)return 7==(0|(A=0|le(n)))||127==(0|(A=0|X(f,A)))?(k=a,0|(m=1)):(p=0|sn(0|A,0,45),g=0|T(),g=-1040385&r[(f=i)+4>>2]|g,r[(m=i)>>2]=r[f>>2]|p,r[m+4>>2]=g,k=a,0|(m=0));for(r[s>>2]=r[n>>2],r[s+4>>2]=r[n+4>>2],r[s+8>>2]=r[n+8>>2],n=A;;){if(l=n,n=n+-1|0,r[c>>2]=r[s>>2],r[c+4>>2]=r[s+4>>2],r[c+8>>2]=r[s+8>>2],0|Ye(l)){if(0|(A=0|ce(s))){n=13;break}r[u>>2]=r[s>>2],r[u+4>>2]=r[s+4>>2],r[u+8>>2]=r[s+8>>2],fe(u)}else{if(0|(A=0|ue(s))){n=13;break}r[u>>2]=r[s>>2],r[u+4>>2]=r[s+4>>2],r[u+8>>2]=r[s+8>>2],pe(u)}if(ae(c,u,h),re(h),v=0|r[(A=i)>>2],A=0|r[A+4>>2],_=0|sn(7,0,0|(y=3*(15-l|0)|0)),A&=~T(),y=0|sn(0|le(h),0,0|y),A=0|T()|A,r[(m=i)>>2]=y|v&~_,r[m+4>>2]=A,(0|l)<=1){n=14;break}}e:do{if(13!=(0|n)&&14==(0|n))if((0|r[s>>2])<=1&&(0|r[s+4>>2])<=1&&(0|r[s+8>>2])<=1){h=127==(0|(A=0|X(f,n=0|le(s))))?0:0|z(A);t:do{if(n){if(o){if(7==(0|(A=0|je(e,t)))){A=5;break e}if((0|(l=0|r[21376+(28*A|0)+(n<<2)>>2]))>0){A=n,n=0;do{A=0|ve(A),n=n+1|0}while((0|n)!=(0|l))}else A=n;if(1==(0|A)){A=9;break e}127==(0|(n=0|X(f,A)))&&S(27648,27538,411,27678),0|z(n)?S(27693,27538,412,27678):(g=n,p=l,d=A)}else g=A,p=0,d=n;if((0|(u=0|r[4272+(28*f|0)+(d<<2)>>2]))<=-1&&S(27724,27538,419,27678),!h){if((0|p)<0){A=5;break e}if(0|p){A=0,n=0|r[(l=i)>>2],l=0|r[l+4>>2];do{n=0|Xe(n,l),l=0|T(),r[(y=i)>>2]=n,r[y+4>>2]=l,A=A+1|0}while((0|A)<(0|p))}if((0|u)<=0){A=g,n=58;break}for(A=0,n=0|r[(l=i)>>2],l=0|r[l+4>>2];;)if(n=0|Xe(n,l),l=0|T(),r[(y=i)>>2]=n,r[y+4>>2]=l,(0|(A=A+1|0))==(0|u)){A=g,n=58;break t}}if(7==(0|(c=0|Q(g,f)))&&S(27514,27538,428,27678),n=0|r[(A=i)>>2],A=0|r[A+4>>2],(0|u)>0){l=0;do{n=0|Xe(n,A),A=0|T(),r[(y=i)>>2]=n,r[y+4>>2]=A,l=l+1|0}while((0|l)!=(0|u))}if(7==(0|(A=0|je(n,A)))&&S(27795,27538,440,27678),n=0|V(g),(0|(n=0|r[(n?21792:21584)+(28*c|0)+(A<<2)>>2]))<0&&S(27795,27538,454,27678),n){A=0,l=0|r[(c=i)>>2],c=0|r[c+4>>2];do{l=0|He(l,c),c=0|T(),r[(y=i)>>2]=l,r[y+4>>2]=c,A=A+1|0}while((0|A)<(0|n));A=g,n=58}else A=g,n=58}else if(!!(0|o)&!!(0|h)){if(7==(0|(n=0|je(e,t)))|7==(0|(l=0|je(0|r[(l=i)>>2],0|r[l+4>>2])))){A=5;break e}if((0|(l=0|r[21376+(28*n|0)+(l<<2)>>2]))<0){A=5;break e}if(l){n=0,c=0|r[(u=i)>>2],u=0|r[u+4>>2];do{c=0|Xe(c,u),u=0|T(),r[(y=i)>>2]=c,r[y+4>>2]=u,n=n+1|0}while((0|n)<(0|l));n=58}else n=59}else n=58}while(0);if(58==(0|n)&&h&&(n=59),59==(0|n)&&1==(0|je(0|r[(y=i)>>2],0|r[y+4>>2]))){A=9;break}_=0|r[(y=i)>>2],y=-1040385&r[y+4>>2],v=0|sn(0|A,0,45),y=0|y|T(),r[(A=i)>>2]=_|v,r[A+4>>2]=y,A=0}else A=1}while(0);return k=a,0|(y=A)}function vt(e,t,n,i){e|=0,t|=0;var r=0,s=0,o=0;if(!(0|(n|=0))&!(0|(i|=0)))return s=1,x(0|(r=0)),0|s;s=e,r=t,e=1,t=0;do{e=0|Jt(0|((o=!0&!(1&n))?1:s),0|(o?0:r),0|e,0|t),t=0|T(),n=0|nn(0|n,0|i,1),i=0|T(),s=0|Jt(0|s,0|r,0|s,0|r),r=0|T()}while(!(!(0|n)&!(0|i)));return x(0|t),0|e}function yt(e,t,n,i){n|=0,i|=0;var o,a=0,A=0,l=0,c=0,u=0,d=0;o=k,k=k+16|0,A=o,l=0|rn(0|(e|=0),0|(t|=0),52),T(),l&=15;do{if(l){if(!(a=0|Je(e,t,A))){u=+s[A>>3],c=1/+h(+u),d=+s[25968+(l<<3)>>3],s[n>>3]=u+d,s[n+8>>3]=u-d,u=+s[A+8>>3],c*=d,s[n+16>>3]=c+u,s[n+24>>3]=u-c;break}return k=o,0|(l=a)}if(a=0|rn(0|e,0|t,45),T(),(a&=127)>>>0>121)return k=o,0|(l=5);A=22064+(a<<5)|0,r[n>>2]=r[A>>2],r[n+4>>2]=r[A+4>>2],r[n+8>>2]=r[A+8>>2],r[n+12>>2]=r[A+12>>2],r[n+16>>2]=r[A+16>>2],r[n+20>>2]=r[A+20>>2],r[n+24>>2]=r[A+24>>2],r[n+28>>2]=r[A+28>>2];break}while(0);return function(e,t){t=+t;var n,i,r,o,a,A,l,c=0,u=0;c=(o=+s[(r=16+(e|=0)|0)>>3])-(i=+s[(n=e+24|0)>>3]),c=o<i?c+6.283185307179586:c,u=+s[e>>3],c=.5*(c*t-c),u+=t=.5*((l=u-(A=+s[(a=e+8|0)>>3]))*t-l),s[e>>3]=u>1.5707963267948966?1.5707963267948966:u,t=A-t,s[a>>3]=t<-1.5707963267948966?-1.5707963267948966:t,t=(t=o+c)>3.141592653589793?t+-6.283185307179586:t,s[r>>3]=t<-3.141592653589793?t+6.283185307179586:t,t=(t=i-c)>3.141592653589793?t+-6.283185307179586:t,s[n>>3]=t<-3.141592653589793?t+6.283185307179586:t}(n,i?1.4:1.1),(0|r[(i=26096+(l<<3)|0)>>2])==(0|e)&&(0|r[i+4>>2])==(0|t)&&(s[n>>3]=1.5707963267948966),(0|r[(l=26224+(l<<3)|0)>>2])==(0|e)&&(0|r[l+4>>2])==(0|t)&&(s[n+8>>3]=-1.5707963267948966),1.5707963267948966!=+s[n>>3]&&-1.5707963267948966!=+s[n+8>>3]?(k=o,0|(l=0)):(s[n+16>>3]=3.141592653589793,s[n+24>>3]=-3.141592653589793,k=o,0|(l=0))}function bt(e){var t,n,s,o,a=0,A=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,y=0,b=0,w=0;if(o=k,k=k+336|0,t=o+168|0,n=o,!(0|(A=0|r[(l=e|=0)>>2]))&!(0|(l=0|r[l+4>>2])))k=o;else{if(0|i[(a=e+28|0)|0]?(A=0|wt(A,l),l=0|T()):i[a|0]=1,!(0|r[r[(s=e+20|0)>>2]>>2]))return 0|(A=0|r[(a=e+24|0)>>2])&&Xt(A),r[(w=e)>>2]=0,r[w+4>>2]=0,r[e+8>>2]=0,r[s>>2]=0,r[e+12>>2]=-1,r[e+16>>2]=0,r[a>>2]=0,void(k=o);c=15&(a=0|r[(w=e+16|0)>>2]);e:do{if(!(0|A)&!(0|l))b=e+24|0;else{v=e+12|0,m=3==(0|c),g=255&a,f=3==(1|c),_=e+24|0,p=(c+-1|0)>>>0<3,h=3==(2|c),d=n+8|0;t:for(;;){if(u=0|rn(0|A,0|l,52),T(),(0|(u&=15))==(0|r[v>>2])){switch(15&g){case 0:case 2:case 3:if(0|(c=0|Je(A,l,t))){y=15;break t}if(0|Ct(0|r[s>>2],0|r[_>>2],t)){y=19;break t}}if(f&&(c=0|r[4+(0|r[s>>2])>>2],r[t>>2]=r[c>>2],r[t+4>>2]=r[c+4>>2],r[t+8>>2]=r[c+8>>2],r[t+12>>2]=r[c+12>>2],0|Z(26832,t))){if(0|Ke(0|r[4+(0|r[s>>2])>>2],u,n)){y=25;break}if((0|r[(c=n)>>2])==(0|A)&&(0|r[c+4>>2])==(0|l)){y=29;break}}if(p){if(0|(c=0|et(A,l,t))){y=32;break}if(0|yt(A,l,n,0)){y=36;break}if(h&&0|Pt(0|r[s>>2],0|r[_>>2],t,n)){y=42;break}if(f&&0|It(0|r[s>>2],0|r[_>>2],t,n)){y=42;break}}if(m){if(a=0|yt(A,l,t,1),c=0|r[_>>2],0|a){y=45;break}if(0|q(c,t)){if(ee(n,t),0|J(t,0|r[_>>2])){y=53;break}if(0|Ct(0|r[s>>2],0|r[_>>2],d)){y=53;break}if(0|It(0|r[s>>2],0|r[_>>2],n,t)){y=53;break}}}}do{if((0|u)<(0|r[v>>2])){if(a=0|yt(A,l,t,1),c=0|r[_>>2],0|a){y=58;break t}if(!(0|q(c,t))){y=73;break}if(0|J(0|r[_>>2],t)&&(ee(n,t),0|Pt(0|r[s>>2],0|r[_>>2],n,t))){y=65;break t}if(0|(A=0|We(A,l,u+1|0,n))){y=67;break t}A=0|r[(l=n)>>2],l=0|r[l+4>>2]}else y=73}while(0);if(73==(0|y)&&(y=0,A=0|wt(A,l),l=0|T()),!(0|A)&!(0|l)){b=_;break e}}switch(0|y){case 15:0|(a=0|r[_>>2])&&Xt(a),r[(y=e)>>2]=0,r[y+4>>2]=0,r[s>>2]=0,r[v>>2]=-1,r[w>>2]=0,r[_>>2]=0,r[e+8>>2]=c,y=20;break;case 19:r[e>>2]=A,r[e+4>>2]=l,y=20;break;case 25:S(27795,27761,470,27772);break;case 29:case 42:return r[e>>2]=A,r[e+4>>2]=l,void(k=o);case 32:return 0|(a=0|r[_>>2])&&Xt(a),r[(b=e)>>2]=0,r[b+4>>2]=0,r[s>>2]=0,r[v>>2]=-1,r[w>>2]=0,r[_>>2]=0,r[e+8>>2]=c,void(k=o);case 36:S(27795,27761,493,27772);break;case 45:0|c&&Xt(c),r[(y=e)>>2]=0,r[y+4>>2]=0,r[s>>2]=0,r[v>>2]=-1,r[w>>2]=0,r[_>>2]=0,r[e+8>>2]=a,y=55;break;case 53:r[e>>2]=A,r[e+4>>2]=l,y=55;break;case 58:0|c&&Xt(c),r[(y=e)>>2]=0,r[y+4>>2]=0,r[s>>2]=0,r[v>>2]=-1,r[w>>2]=0,r[_>>2]=0,r[e+8>>2]=a,y=71;break;case 65:r[e>>2]=A,r[e+4>>2]=l,y=71;break;case 67:return 0|(a=0|r[_>>2])&&Xt(a),r[(b=e)>>2]=0,r[b+4>>2]=0,r[s>>2]=0,r[v>>2]=-1,r[w>>2]=0,r[_>>2]=0,r[e+8>>2]=A,void(k=o)}if(20==(0|y))return void(k=o);if(55==(0|y))return void(k=o);if(71==(0|y))return void(k=o)}}while(0);0|(a=0|r[b>>2])&&Xt(a),r[(y=e)>>2]=0,r[y+4>>2]=0,r[e+8>>2]=0,r[s>>2]=0,r[e+12>>2]=-1,r[w>>2]=0,r[b>>2]=0,k=o}}function wt(e,t){var n,i=0,s=0,o=0,a=0,A=0,l=0,c=0,u=0,h=0;n=k,k=k+16|0,h=n,s=0|rn(0|(e|=0),0|(t|=0),52),T(),s&=15,i=0|rn(0|e,0|t,45),T();do{if(s){for(;i=0|sn(s+4095|0,0,52),o=T()|-15728641&t,i=i|e|(A=0|sn(7,0,0|(a=3*(15-s|0)|0))),o|=l=0|T(),c=0|rn(0|e,0|t,0|a),T(),s=s+-1|0,!((c&=7)>>>0<6);){if(!s){u=4;break}t=o,e=i}if(4==(0|u)){i=0|rn(0|i,0|o,45),T();break}return h=0|sn(((h=!(0|c)&!!(0|ze(i,o)))?2:1)+c|0,0,0|a),u=0|T()|t&~l,h|=e&~A,x(0|u),k=n,0|h}}while(0);return(i&=127)>>>0>120?(h=0,x(0|(u=0)),k=n,0|h):(Fe(h,0,i+1|0,0),u=0|r[h+4>>2],h=0|r[h>>2],x(0|u),k=n,0|h)}function Et(e,t,n){e|=0;var i,o=0,a=0,A=0,l=0,c=0,u=0,h=0,d=0,f=0;if(!(0|Z(t|=0,n|=0)))return 0|(f=0);if(t=0|Y(t),o=+s[n>>3],a=t&(a=+s[n+8>>3])<0?a+6.283185307179586:a,(0|(f=0|r[e>>2]))<=0)return 0|(f=0);if(i=0|r[e+4>>2],t){t=0,d=a,n=-1,e=0;e:for(;;){for(h=e;l=+s[i+(h<<4)>>3],a=+s[i+(h<<4)+8>>3],A=+s[i+((e=(n+2|0)%(0|f)|0)<<4)>>3],c=+s[i+(e<<4)+8>>3],l>A?(u=l,l=c):(u=A,A=l,l=a,a=c),(o=o==A|o==u?o+2220446049250313e-31:o)<A|o>u;){if((0|(n=h+1|0))>=(0|f)){n=22;break e}e=h,h=n,n=e}if(((u=(c=l<0?l+6.283185307179586:l)+(o-A)/(u-A)*((l=a<0?a+6.283185307179586:a)-c))<0?u+6.283185307179586:u)>(d=c==d|l==d?d+-2220446049250313e-31:d)&&(t^=1),(0|(e=h+1|0))>=(0|f)){n=22;break}n=h}if(22==(0|n))return 0|t}else{t=0,d=a,n=-1,e=0;e:for(;;){for(h=e;l=+s[i+(h<<4)>>3],a=+s[i+(h<<4)+8>>3],A=+s[i+((e=(n+2|0)%(0|f)|0)<<4)>>3],c=+s[i+(e<<4)+8>>3],l>A?(u=l,l=c):(u=A,A=l,l=a,a=c),(o=o==A|o==u?o+2220446049250313e-31:o)<A|o>u;){if((0|(n=h+1|0))>=(0|f)){n=22;break e}e=h,h=n,n=e}if(l+(o-A)/(u-A)*(a-l)>(d=l==d|a==d?d+-2220446049250313e-31:d)&&(t^=1),(0|(e=h+1|0))>=(0|f)){n=22;break}n=h}if(22==(0|n))return 0|t}return 0}function xt(e,t){t|=0;var n,i,o,a,A,c=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,y=0,b=0;if(!(i=0|r[(e|=0)>>2]))return r[t>>2]=0,r[t+4>>2]=0,r[t+8>>2]=0,r[t+12>>2]=0,r[t+16>>2]=0,r[t+20>>2]=0,r[t+24>>2]=0,void(r[t+28>>2]=0);if(s[(o=t+8|0)>>3]=17976931348623157e292,s[(a=t+24|0)>>3]=17976931348623157e292,s[t>>3]=-17976931348623157e292,s[(A=t+16|0)>>3]=-17976931348623157e292,!((0|i)<=0)){for(n=0|r[e+4>>2],m=17976931348623157e292,_=-17976931348623157e292,v=0,e=-1,d=17976931348623157e292,f=17976931348623157e292,g=-17976931348623157e292,u=-17976931348623157e292,y=0;c=+s[n+(y<<4)>>3],p=+s[n+(y<<4)+8>>3],h=+s[n+(((0|(e=e+2|0))==(0|i)?0:e)<<4)+8>>3],c<d&&(s[o>>3]=c,d=c),p<f&&(s[a>>3]=p,f=p),c>g?s[t>>3]=c:c=g,p>u&&(s[A>>3]=p,u=p),m=p>0&p<m?p:m,_=p<0&p>_?p:_,v|=+l(+(p-h))>3.141592653589793,(0|(e=y+1|0))!=(0|i);)b=y,g=c,y=e,e=b;v&&(s[A>>3]=_,s[a>>3]=m)}}function Tt(e){return 0|((e|=0)>>>0<4?0:15)}function St(e,t){t|=0;var n,i=0,o=0,a=0,A=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,y=0,b=0,w=0,E=0,x=0,T=0,S=0;if(_=0|r[(e|=0)>>2]){if(s[(v=t+8|0)>>3]=17976931348623157e292,s[(y=t+24|0)>>3]=17976931348623157e292,s[t>>3]=-17976931348623157e292,s[(b=t+16|0)>>3]=-17976931348623157e292,(0|_)>0){for(a=0|r[e+4>>2],g=17976931348623157e292,m=-17976931348623157e292,o=0,i=-1,h=17976931348623157e292,d=17976931348623157e292,p=-17976931348623157e292,c=-17976931348623157e292,w=0;A=+s[a+(w<<4)>>3],f=+s[a+(w<<4)+8>>3],u=+s[a+(((0|(T=i+2|0))==(0|_)?0:T)<<4)+8>>3],A<h&&(s[v>>3]=A,h=A),f<d&&(s[y>>3]=f,d=f),A>p?s[t>>3]=A:A=p,f>c&&(s[b>>3]=f,c=f),g=f>0&f<g?f:g,m=f<0&f>m?f:m,o|=+l(+(f-u))>3.141592653589793,(0|(i=w+1|0))!=(0|_);)T=w,p=A,w=i,i=T;o&&(s[b>>3]=m,s[y>>3]=g)}}else r[t>>2]=0,r[t+4>>2]=0,r[t+8>>2]=0,r[t+12>>2]=0,r[t+16>>2]=0,r[t+20>>2]=0,r[t+24>>2]=0,r[t+28>>2]=0;if(!((0|(i=0|r[(T=e+8|0)>>2]))<=0)){n=e+12|0,x=0;do{if(a=0|r[n>>2],o=x,y=t+((x=x+1|0)<<5)|0,b=0|r[a+(o<<3)>>2]){if(s[(w=t+(x<<5)+8|0)>>3]=17976931348623157e292,s[(e=t+(x<<5)+24|0)>>3]=17976931348623157e292,s[y>>3]=-17976931348623157e292,s[(E=t+(x<<5)+16|0)>>3]=-17976931348623157e292,(0|b)>0){for(_=0|r[a+(o<<3)+4>>2],g=17976931348623157e292,m=-17976931348623157e292,a=0,o=-1,v=0,h=17976931348623157e292,d=17976931348623157e292,f=-17976931348623157e292,c=-17976931348623157e292;A=+s[_+(v<<4)>>3],p=+s[_+(v<<4)+8>>3],u=+s[_+(((0|(o=o+2|0))==(0|b)?0:o)<<4)+8>>3],A<h&&(s[w>>3]=A,h=A),p<d&&(s[e>>3]=p,d=p),A>f?s[y>>3]=A:A=f,p>c&&(s[E>>3]=p,c=p),g=p>0&p<g?p:g,m=p<0&p>m?p:m,a|=+l(+(p-u))>3.141592653589793,(0|(o=v+1|0))!=(0|b);)S=v,v=o,f=A,o=S;a&&(s[E>>3]=m,s[e>>3]=g)}}else r[y>>2]=0,r[y+4>>2]=0,r[y+8>>2]=0,r[y+12>>2]=0,r[y+16>>2]=0,r[y+20>>2]=0,r[y+24>>2]=0,r[y+28>>2]=0,i=0|r[T>>2]}while((0|x)<(0|i))}}function Ct(e,t,n){var i=0,s=0,o=0;if(!(0|Et(e|=0,t|=0,n|=0)))return 0|(s=0);if((0|r[(s=e+8|0)>>2])<=0)return 0|(s=1);for(i=e+12|0,e=0;;){if(o=e,e=e+1|0,0|Et((0|r[i>>2])+(o<<3)|0,t+(e<<5)|0,n)){e=0,i=6;break}if((0|e)>=(0|r[s>>2])){e=1,i=6;break}}return 6==(0|i)?0|e:0}function Pt(e,t,n,i){i|=0;var s,o,a=0,A=0,l=0,c=0,u=0;if(o=k,k=k+16|0,s=o,!(0|Et(e|=0,t|=0,l=(n|=0)+8|0)))return k=o,0|(c=0);c=e+8|0;e:do{if((0|r[c>>2])>0){for(A=e+12|0,a=0;;){if(u=a,a=a+1|0,0|Et((0|r[A>>2])+(u<<3)|0,t+(a<<5)|0,l)){a=0;break}if((0|a)>=(0|r[c>>2]))break e}return k=o,0|a}}while(0);if(0|Rt(e,t,n,i))return k=o,0|(u=0);r[s>>2]=r[n>>2],r[s+4>>2]=l,a=0|r[c>>2];e:do{if((0|a)>0)for(e=e+12|0,l=0,A=a;;){if(a=0|r[e>>2],(0|r[a+(l<<3)>>2])>0){if(0|Et(s,i,0|r[a+(l<<3)+4>>2])){a=0;break e}if(a=l+1|0,0|Rt((0|r[e>>2])+(l<<3)|0,t+(a<<5)|0,n,i)){a=0;break e}A=0|r[c>>2]}else a=l+1|0;if(!((0|a)<(0|A))){a=1;break}l=a}else a=1}while(0);return k=o,0|(u=a)}function Rt(e,t,n,i){e|=0,n|=0;var o,a,A,l,c,u,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,y=0,b=0,w=0,E=0,x=0,T=0,S=0;if(u=k,k=k+176|0,l=u+172|0,h=u+168|0,c=u,!(0|q(t|=0,i|=0)))return k=u,0|(e=0);if(function(e,t,n,i){var o,a,A,l,c;t|=0,n|=0,i|=0,e=(a=+s[16+(e|=0)>>3])<(c=+s[e+24>>3]),o=(l=+s[t+16>>3])<(A=+s[t+24>>3]),t=c-l<A-a,r[n>>2]=e?o|t?1:2:0,r[i>>2]=o?e?1:t?2:1:0}(t,i,l,h),cn(0|c,0|n,168),(0|r[n>>2])>0){t=0;do{w=+at(+s[(T=c+8+(t<<4)+8|0)>>3],0|r[h>>2]),s[T>>3]=w,t=t+1|0}while((0|t)<(0|r[n>>2]))}a=+s[i>>3],A=+s[i+8>>3],w=+at(+s[i+16>>3],0|r[h>>2]),o=+at(+s[i+24>>3],0|r[h>>2]);e:do{if((0|r[e>>2])>0){if(i=e+4|0,(0|(h=0|r[c>>2]))<=0)for(t=0;;)if((0|(t=t+1|0))>=(0|r[e>>2])){t=0;break e}for(n=0;;){if(t=0|r[i>>2],y=+s[t+(n<<4)>>3],b=+at(+s[t+(n<<4)+8>>3],0|r[l>>2]),t=0|r[i>>2],T=(0|(n=n+1|0))%(0|r[e>>2])|0,d=+s[t+(T<<4)>>3],f=+at(+s[t+(T<<4)+8>>3],0|r[l>>2]),!(y>=a)|!(d>=a)&&!(y<=A)|!(d<=A)&&!(b<=o)|!(f<=o)&&!(b>=w)|!(f>=w)){v=d-y,m=f-b,t=0;do{if(S=t,T=(0|(t=t+1|0))==(0|h)?0:t,d=+s[c+8+(S<<4)+8>>3],f=+s[c+8+(T<<4)+8>>3]-d,p=+s[c+8+(S<<4)>>3],!(0==(_=v*f-m*(g=+s[c+8+(T<<4)>>3]-p))||(E=b-d,x=y-p,g=(E*g-f*x)/_,g<0|g>1))&&(_=(v*E-m*x)/_)>=0&_<=1){t=1;break e}}while((0|t)<(0|h))}if((0|n)>=(0|r[e>>2])){t=0;break}}}else t=0}while(0);return k=u,0|(S=t)}function It(e,t,n,i){var s=0,o=0,a=0;if(0|Rt(e|=0,t|=0,n|=0,i|=0))return 0|(o=1);if((0|r[(o=e+8|0)>>2])<=0)return 0|(o=0);for(s=e+12|0,e=0;;){if(a=e,e=e+1|0,0|Rt((0|r[s>>2])+(a<<3)|0,t+(e<<5)|0,n,i)){e=1,s=6;break}if((0|e)>=(0|r[o>>2])){e=0,s=6;break}}return 6==(0|s)?0|e:0}function Mt(e,t,n,i,r){t|=0,n|=0,i|=0,r|=0;var o,a,A,l,c,u,h,d=0;l=+s[(e|=0)>>3],A=+s[t>>3]-l,a=+s[e+8>>3],o=+s[t+8>>3]-a,u=+s[n>>3],d=((d=+s[i>>3]-u)*(a-(h=+s[n+8>>3]))-(l-u)*(c=+s[i+8>>3]-h))/(A*c-o*d),s[r>>3]=l+A*d,s[r+8>>3]=a+o*d}function kt(e,t){return t|=0,+l(+(+s[(e|=0)>>3]-+s[t>>3]))<1.1920928955078125e-7?0|(t=+l(+(+s[e+8>>3]-+s[t+8>>3]))<1.1920928955078125e-7):0|(t=0)}function Lt(e,t){t|=0;var n,i,r;return+((r=+s[(e|=0)>>3]-+s[t>>3])*r+(i=+s[e+8>>3]-+s[t+8>>3])*i+(n=+s[e+16>>3]-+s[t+16>>3])*n)}function Bt(e,t,n){n|=0;var i,s,o,a,A=0,l=0,c=0,u=0;if(a=k,k=k+32|0,u=a,0|(A=0|qe(e|=0,t|=0,s=a+16|0)))return k=a,0|(n=A);i=0|Oe(e,t),o=0|je(e,t),function(e,t){e=7696+(28*(e|=0)|0)|0,r[(t|=0)>>2]=r[e>>2],r[t+4>>2]=r[e+4>>2],r[t+8>>2]=r[e+8>>2],r[t+12>>2]=r[e+12>>2]}(i,u),A=0|function(e,t){e|=0;var n=0,i=0;if((t|=0)>>>0>20)return-1;do{if((0|r[11120+(216*t|0)>>2])!=(0|e))if((0|r[11120+(216*t|0)+8>>2])!=(0|e))if((0|r[11120+(216*t|0)+16>>2])!=(0|e))if((0|r[11120+(216*t|0)+24>>2])!=(0|e))if((0|r[11120+(216*t|0)+32>>2])!=(0|e))if((0|r[11120+(216*t|0)+40>>2])!=(0|e))if((0|r[11120+(216*t|0)+48>>2])!=(0|e))if((0|r[11120+(216*t|0)+56>>2])!=(0|e))if((0|r[11120+(216*t|0)+64>>2])!=(0|e))if((0|r[11120+(216*t|0)+72>>2])!=(0|e))if((0|r[11120+(216*t|0)+80>>2])!=(0|e))if((0|r[11120+(216*t|0)+88>>2])!=(0|e))if((0|r[11120+(216*t|0)+96>>2])!=(0|e))if((0|r[11120+(216*t|0)+104>>2])!=(0|e))if((0|r[11120+(216*t|0)+112>>2])!=(0|e))if((0|r[11120+(216*t|0)+120>>2])!=(0|e))if((0|r[11120+(216*t|0)+128>>2])!=(0|e)){if((0|r[11120+(216*t|0)+136>>2])!=(0|e)){if((0|r[11120+(216*t|0)+144>>2])==(0|e)){e=0,n=2,i=0;break}if((0|r[11120+(216*t|0)+152>>2])==(0|e)){e=0,n=2,i=1;break}if((0|r[11120+(216*t|0)+160>>2])==(0|e)){e=0,n=2,i=2;break}if((0|r[11120+(216*t|0)+168>>2])==(0|e)){e=1,n=2,i=0;break}if((0|r[11120+(216*t|0)+176>>2])==(0|e)){e=1,n=2,i=1;break}if((0|r[11120+(216*t|0)+184>>2])==(0|e)){e=1,n=2,i=2;break}if((0|r[11120+(216*t|0)+192>>2])==(0|e)){e=2,n=2,i=0;break}if((0|r[11120+(216*t|0)+200>>2])==(0|e)){e=2,n=2,i=1;break}if((0|r[11120+(216*t|0)+208>>2])==(0|e)){e=2,n=2,i=2;break}return-1}e=2,n=1,i=2}else e=2,n=1,i=1;else e=2,n=1,i=0;else e=1,n=1,i=2;else e=1,n=1,i=1;else e=1,n=1,i=0;else e=0,n=1,i=2;else e=0,n=1,i=1;else e=0,n=1,i=0;else e=2,n=0,i=2;else e=2,n=0,i=1;else e=2,n=0,i=0;else e=1,n=0,i=2;else e=1,n=0,i=1;else e=1,n=0,i=0;else e=0,n=0,i=2;else e=0,n=0,i=1;else e=0,n=0,i=0}while(0);return 0|r[11120+(216*t|0)+(72*n|0)+(24*e|0)+(i<<3)+4>>2]}(i,0|r[s>>2]);do{if(0|z(i)){switch(0|i){case 4:l=0;break;case 14:l=1;break;case 24:l=2;break;case 38:l=3;break;case 49:l=4;break;case 58:l=5;break;case 63:l=6;break;case 72:l=7;break;case 83:l=8;break;case 97:l=9;break;case 107:l=10;break;case 117:l=11;break;default:S(27795,27797,75,27806)}if(c=0|r[26416+(24*l|0)+8>>2],t=0|r[26416+(24*l|0)+16>>2],(0|(e=0|r[s>>2]))!=(0|r[u>>2])&&(u=0|V(i))|(0|(e=0|r[s>>2]))==(0|t)&&(A=(A+1|0)%6|0),3==(0|o)&(0|e)==(0|t)){A=(A+5|0)%6|0;break}5==(0|o)&(0|e)==(0|c)&&(A=(A+1|0)%6|0)}}while(0);return r[n>>2]=A,k=a,0|(n=0)}function Dt(e,t,n,i){n|=0,i|=0;var s,o,a,A,l,c=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,y=0;if(l=k,k=k+32|0,y=l+24|0,A=l+20|0,a=l+8|0,o=l+16|0,s=l,f=(f=!(0|ze(e|=0,t|=0)))?6:5,g=0|rn(0|e,0|t,52),T(),f>>>0<=n>>>0)return k=l,0|(i=2);!(m=!(0|(g&=15)))&&!((_=0|sn(7,0,3*(15^g)|0))&e|0)&!((0|T())&t)?c=n:u=4;e:do{if(4==(0|u)){if((0|((c=!!(0|ze(e,t)))?4:5))<(0|n))return k=l,0|(i=1);if(0|Bt(e,t,y))return k=l,0|(i=1);if(u=(0|r[y>>2])+n|0,7==(0|(_=0|r[(c=c?26704+((0|u)%5<<2)|0:26736+((0|u)%6<<2)|0)>>2])))return k=l,0|(i=1);r[A>>2]=0,c=0|N(e,t,_,A,a);do{if(!c){if(p=0|r[(d=a)>>2],u=(h=(d=0|r[d+4>>2])>>>0<t>>>0|(0|d)==(0|t)&p>>>0<e>>>0)?p:e,h=h?d:t,!m&&!(p&(m=0|sn(7,0,3*(15^g)|0))|0)&!(d&(0|T())))c=n;else{if(d=(n+-1+f|0)%(0|f)|0,c=0|ze(e,t),(0|d)<0&&S(27795,27797,248,27822),(0|((f=!!(0|c))?4:5))<(0|d)&&S(27795,27797,248,27822),0|Bt(e,t,y)&&S(27795,27797,248,27822),c=(0|r[y>>2])+d|0,7==(0|(d=0|r[(c=f?26704+((0|c)%5<<2)|0:26736+((0|c)%6<<2)|0)>>2]))&&S(27795,27797,248,27822),r[o>>2]=0,0|(c=0|N(e,t,d,o,s)))break;f=0|r[(p=s)>>2],p=0|r[p+4>>2];do{if(p>>>0<h>>>0|(0|p)==(0|h)&f>>>0<u>>>0){if(u=0|ze(f,p)?0|U(f,p,e,t):0|r[26800+(((0|r[o>>2])+(0|r[26768+(d<<2)>>2])|0)%6<<2)>>2],c=0|ze(f,p),(u+-1|0)>>>0>5){c=-1,u=f,h=p;break}if(1==(0|u)&(c=!!(0|c))){c=-1,u=f,h=p;break}do{if(!(0|Bt(f,p,y))){if(c){c=(5+(0|r[26352+(u<<2)>>2])-(0|r[y>>2])|0)%5|0;break}c=(6+(0|r[26384+(u<<2)>>2])-(0|r[y>>2])|0)%6|0;break}c=-1}while(0);u=f,h=p}else c=n}while(0);p=0|r[(d=a)>>2],d=0|r[d+4>>2]}if((0|u)==(0|p)&(0|h)==(0|d)){if(e=(f=!!(0|ze(p,d)))?0|U(p,d,e,t):0|r[26800+(((0|r[A>>2])+(0|r[26768+(_<<2)>>2])|0)%6<<2)>>2],c=0|ze(p,d),(e+-1|0)>>>0<=5&&!(1==(0|e)&(v=!!(0|c))))do{if(!(0|Bt(p,d,y))){if(v){c=(5+(0|r[26352+(e<<2)>>2])-(0|r[y>>2])|0)%5|0;break}c=(6+(0|r[26384+(e<<2)>>2])-(0|r[y>>2])|0)%6|0;break}c=-1}while(0);else c=-1;c=6==(0|(c=c+1|0))|f&5==(0|c)?0:c}t=h,e=u;break e}}while(0);return k=l,0|(i=c)}}while(0);return v=0|sn(0|c,0,56),y=T()|-2130706433&t|536870912,r[i>>2]=v|e,r[i+4>>2]=y,k=l,0|(i=0)}function Ot(e,t){e|=0;var n,i,s=0,o=0;return i=k,k=k+16|0,n=i,!0&536870912==(2013265920&(t|=0))&&0|Ne(e,s=-2130706433&t|134217728)?(o=0|rn(0|e,0|t,56),T(),s=(o=!(0|Dt(e,s,7&o,n)))&((0|r[(s=n)>>2])==(0|e)?(0|r[s+4>>2])==(0|t):0)&1,k=i,0|s):(k=i,0|(s=0))}function Nt(e,t,n){e|=0,n|=0;var i=0;(0|(t|=0))>0?(i=0|Qt(t,4),r[e>>2]=i,i||S(27835,27858,40,27872)):r[e>>2]=0,r[e+4>>2]=t,r[e+8>>2]=0,r[e+12>>2]=n}function Ft(e){var t,n,i,o=0,a=0,A=0,c=0;t=(e|=0)+4|0,n=e+12|0,i=e+8|0;e:for(;;){for(a=0|r[t>>2],o=0;;){if((0|o)>=(0|a))break e;if(A=0|r[e>>2],c=0|r[A+(o<<2)>>2])break;o=o+1|0}o=A+(~~(+l(+ +u(10,+ +(15-(0|r[n>>2])|0))*(+s[c>>3]+ +s[c+8>>3]))%+(0|a))>>>0<<2)|0,a=0|r[o>>2];t:do{if(0|a){if(A=c+32|0,(0|a)==(0|c))r[o>>2]=r[A>>2];else{if(!(o=0|r[(a=a+32|0)>>2]))break;for(;(0|o)!=(0|c);)if(!(o=0|r[(a=o+32|0)>>2]))break t;r[a>>2]=r[A>>2]}Xt(c),r[i>>2]=(0|r[i>>2])-1}}while(0)}Xt(0|r[e>>2])}function Ut(e){var t,n=0,i=0;for(t=0|r[(e|=0)+4>>2],i=0;;){if((0|i)>=(0|t)){n=0,i=4;break}if(n=0|r[(0|r[e>>2])+(i<<2)>>2]){i=4;break}i=i+1|0}return 4==(0|i)?0|n:0}function Gt(e,t){t|=0;var n=0,i=0,o=0,a=0;if(n=~~(+l(+ +u(10,+ +(15-(0|r[(e|=0)+12>>2])|0))*(+s[t>>3]+ +s[t+8>>3]))%+(0|r[e+4>>2]))>>>0,n=(0|r[e>>2])+(n<<2)|0,!(i=0|r[n>>2]))return 0|(a=1);a=t+32|0;do{if((0|i)!=(0|t)){if(!(n=0|r[i+32>>2]))return 0|(a=1);for(o=n;;){if((0|o)==(0|t)){o=8;break}if(!(n=0|r[o+32>>2])){n=1,o=10;break}i=o,o=n}if(8==(0|o)){r[i+32>>2]=r[a>>2];break}if(10==(0|o))return 0|n}else r[n>>2]=r[a>>2]}while(0);return Xt(t),r[(a=e+8|0)>>2]=(0|r[a>>2])-1,0|(a=0)}function zt(e,t,n){e|=0,t|=0,n|=0;var i,o=0,a=0,A=0;(i=0|Ht(40))||S(27888,27858,98,27901),r[i>>2]=r[t>>2],r[i+4>>2]=r[t+4>>2],r[i+8>>2]=r[t+8>>2],r[i+12>>2]=r[t+12>>2],r[(a=i+16|0)>>2]=r[n>>2],r[a+4>>2]=r[n+4>>2],r[a+8>>2]=r[n+8>>2],r[a+12>>2]=r[n+12>>2],r[i+32>>2]=0,a=~~(+l(+ +u(10,+ +(15-(0|r[e+12>>2])|0))*(+s[t>>3]+ +s[t+8>>3]))%+(0|r[e+4>>2]))>>>0,a=(0|r[e>>2])+(a<<2)|0,o=0|r[a>>2];do{if(o){for(;!(0|ot(o,t)&&0|ot(o+16|0,n));)if(a=0|r[o+32>>2],!(0|r[(o=0|a?a:o)+32>>2])){A=10;break}if(10==(0|A)){r[o+32>>2]=i;break}return Xt(i),0|(A=o)}r[a>>2]=i}while(0);return r[(A=e+8|0)>>2]=1+(0|r[A>>2]),0|(A=i)}function Vt(e,t,n){t|=0,n|=0;var i=0,o=0;if(o=~~(+l(+ +u(10,+ +(15-(0|r[(e|=0)+12>>2])|0))*(+s[t>>3]+ +s[t+8>>3]))%+(0|r[e+4>>2]))>>>0,!(o=0|r[(0|r[e>>2])+(o<<2)>>2]))return 0|(n=0);if(!n){for(e=o;;){if(0|ot(e,t)){i=10;break}if(!(e=0|r[e+32>>2])){e=0,i=10;break}}if(10==(0|i))return 0|e}for(e=o;;){if(0|ot(e,t)&&0|ot(e+16|0,n)){i=10;break}if(!(e=0|r[e+32>>2])){e=0,i=10;break}}return 10==(0|i)?0|e:0}function Wt(e,t){t|=0;var n=0;if(n=~~(+l(+ +u(10,+ +(15-(0|r[(e|=0)+12>>2])|0))*(+s[t>>3]+ +s[t+8>>3]))%+(0|r[e+4>>2]))>>>0,!(e=0|r[(0|r[e>>2])+(n<<2)>>2]))return 0|(n=0);for(;;){if(0|ot(e,t)){t=5;break}if(!(e=0|r[e+32>>2])){e=0,t=5;break}}return 5==(0|t)?0|e:0}function jt(e){return 0|+hn(+(e=+e))}function Ht(e){e|=0;var t,n=0,i=0,s=0,o=0,a=0,A=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,y=0,b=0,w=0;t=k,k=k+16|0,f=t;do{if(e>>>0<245){if(e=(u=e>>>0<11?16:e+11&-8)>>>3,3&(i=(d=0|r[6981])>>>e))return s=0|r[(i=(e=27964+((n=(1&i^1)+e|0)<<1<<2)|0)+8|0)>>2],(0|(a=0|r[(o=s+8|0)>>2]))==(0|e)?r[6981]=d&~(1<<n):(r[a+12>>2]=e,r[i>>2]=a),w=n<<3,r[s+4>>2]=3|w,r[(w=s+w+4|0)>>2]=1|r[w>>2],k=t,0|(w=o);if(u>>>0>(h=0|r[6983])>>>0){if(0|i)return n=((n=i<<e&((n=2<<e)|0-n))&0-n)-1|0,a=0|r[(e=(n=27964+((s=((i=(n>>>=l=n>>>12&16)>>>5&8)|l|(a=(n>>>=i)>>>2&4)|(e=(n>>>=a)>>>1&2)|(s=(n>>>=e)>>>1&1))+(n>>>s)|0)<<1<<2)|0)+8|0)>>2],(0|(i=0|r[(l=a+8|0)>>2]))==(0|n)?(e=d&~(1<<s),r[6981]=e):(r[i+12>>2]=n,r[e>>2]=i,e=d),A=(w=s<<3)-u|0,r[a+4>>2]=3|u,r[(o=a+u|0)+4>>2]=1|A,r[a+w>>2]=A,0|h&&(s=0|r[6986],i=27964+((n=h>>>3)<<1<<2)|0,e&(n=1<<n)?n=0|r[(e=i+8|0)>>2]:(r[6981]=e|n,n=i,e=i+8|0),r[e>>2]=s,r[n+12>>2]=s,r[s+8>>2]=n,r[s+12>>2]=i),r[6983]=A,r[6986]=o,k=t,0|(w=l);if(a=0|r[6982]){for(i=(a&0-a)-1|0,i=c=0|r[28228+(((s=(i>>>=o=i>>>12&16)>>>5&8)|o|(A=(i>>>=s)>>>2&4)|(l=(i>>>=A)>>>1&2)|(c=(i>>>=l)>>>1&1))+(i>>>c)<<2)>>2],l=c,c=(-8&r[c+4>>2])-u|0;(e=0|r[i+16>>2])||(e=0|r[i+20>>2]);)i=e,l=(o=(A=(-8&r[e+4>>2])-u|0)>>>0<c>>>0)?e:l,c=o?A:c;if((A=l+u|0)>>>0>l>>>0){o=0|r[l+24>>2],n=0|r[l+12>>2];do{if((0|n)==(0|l)){if(!(n=0|r[(e=l+20|0)>>2])&&!(n=0|r[(e=l+16|0)>>2])){i=0;break}for(;;)if(i=0|r[(s=n+20|0)>>2])n=i,e=s;else{if(!(i=0|r[(s=n+16|0)>>2]))break;n=i,e=s}r[e>>2]=0,i=n}else i=0|r[l+8>>2],r[i+12>>2]=n,r[n+8>>2]=i,i=n}while(0);do{if(0|o){if(n=0|r[l+28>>2],(0|l)==(0|r[(e=28228+(n<<2)|0)>>2])){if(r[e>>2]=i,!i){r[6982]=a&~(1<<n);break}}else if(r[((0|r[(w=o+16|0)>>2])==(0|l)?w:o+20)>>2]=i,!i)break;r[i+24>>2]=o,0|(n=0|r[l+16>>2])&&(r[i+16>>2]=n,r[n+24>>2]=i),0|(n=0|r[l+20>>2])&&(r[i+20>>2]=n,r[n+24>>2]=i)}}while(0);return c>>>0<16?(w=c+u|0,r[l+4>>2]=3|w,r[(w=l+w+4|0)>>2]=1|r[w>>2]):(r[l+4>>2]=3|u,r[A+4>>2]=1|c,r[A+c>>2]=c,0|h&&(s=0|r[6986],i=27964+((n=h>>>3)<<1<<2)|0,(n=1<<n)&d?n=0|r[(e=i+8|0)>>2]:(r[6981]=n|d,n=i,e=i+8|0),r[e>>2]=s,r[n+12>>2]=s,r[s+8>>2]=n,r[s+12>>2]=i),r[6983]=c,r[6986]=A),k=t,0|(w=l+8|0)}d=u}else d=u}else d=u}else if(e>>>0<=4294967231)if(u=-8&(e=e+11|0),s=0|r[6982]){o=0-u|0,c=(e>>>=8)?u>>>0>16777215?31:u>>>((c=14-((l=((m=e<<(d=(e+1048320|0)>>>16&8))+520192|0)>>>16&4)|d|(c=((m<<=l)+245760|0)>>>16&2))+(m<<c>>>15)|0)+7|0)&1|c<<1:0,i=0|r[28228+(c<<2)>>2];e:do{if(i)for(e=0,l=u<<(31==(0|c)?0:25-(c>>>1)|0),a=0;;){if((A=(-8&r[i+4>>2])-u|0)>>>0<o>>>0){if(!A){e=i,o=0,m=65;break e}e=i,o=A}if(a=!(0|(m=0|r[i+20>>2]))|(0|m)==(0|(i=0|r[i+16+(l>>>31<<2)>>2]))?a:m,!i){i=a,m=61;break}l<<=1}else i=0,e=0,m=61}while(0);if(61==(0|m)){if(!(0|i)&!(0|e)){if(!(e=((e=2<<c)|0-e)&s)){d=u;break}d=(e&0-e)-1|0,e=0,i=0|r[28228+(((a=(d>>>=A=d>>>12&16)>>>5&8)|A|(l=(d>>>=a)>>>2&4)|(c=(d>>>=l)>>>1&2)|(i=(d>>>=c)>>>1&1))+(d>>>i)<<2)>>2]}i?m=65:(l=e,A=o)}if(65==(0|m))for(a=i;;){if(o=(i=(d=(-8&r[a+4>>2])-u|0)>>>0<o>>>0)?d:o,e=i?a:e,(i=0|r[a+16>>2])||(i=0|r[a+20>>2]),!i){l=e,A=o;break}a=i}if(0|l&&A>>>0<((0|r[6983])-u|0)>>>0&&(h=l+u|0)>>>0>l>>>0){a=0|r[l+24>>2],n=0|r[l+12>>2];do{if((0|n)==(0|l)){if(!(n=0|r[(e=l+20|0)>>2])&&!(n=0|r[(e=l+16|0)>>2])){n=0;break}for(;;)if(i=0|r[(o=n+20|0)>>2])n=i,e=o;else{if(!(i=0|r[(o=n+16|0)>>2]))break;n=i,e=o}r[e>>2]=0}else w=0|r[l+8>>2],r[w+12>>2]=n,r[n+8>>2]=w}while(0);do{if(a){if(e=0|r[l+28>>2],(0|l)==(0|r[(i=28228+(e<<2)|0)>>2])){if(r[i>>2]=n,!n){s&=~(1<<e),r[6982]=s;break}}else if(r[((0|r[(w=a+16|0)>>2])==(0|l)?w:a+20)>>2]=n,!n)break;r[n+24>>2]=a,0|(e=0|r[l+16>>2])&&(r[n+16>>2]=e,r[e+24>>2]=n),(e=0|r[l+20>>2])&&(r[n+20>>2]=e,r[e+24>>2]=n)}}while(0);e:do{if(A>>>0<16)w=A+u|0,r[l+4>>2]=3|w,r[(w=l+w+4|0)>>2]=1|r[w>>2];else{if(r[l+4>>2]=3|u,r[h+4>>2]=1|A,r[h+A>>2]=A,n=A>>>3,A>>>0<256){i=27964+(n<<1<<2)|0,(e=0|r[6981])&(n=1<<n)?n=0|r[(e=i+8|0)>>2]:(r[6981]=e|n,n=i,e=i+8|0),r[e>>2]=h,r[n+12>>2]=h,r[h+8>>2]=n,r[h+12>>2]=i;break}if(n=28228+((i=(n=A>>>8)?A>>>0>16777215?31:A>>>((i=14-((y=((w=n<<(b=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|b|(i=((w<<=y)+245760|0)>>>16&2))+(w<<i>>>15)|0)+7|0)&1|i<<1:0)<<2)|0,r[h+28>>2]=i,r[(e=h+16|0)+4>>2]=0,r[e>>2]=0,!(s&(e=1<<i))){r[6982]=s|e,r[n>>2]=h,r[h+24>>2]=n,r[h+12>>2]=h,r[h+8>>2]=h;break}n=0|r[n>>2];t:do{if((-8&r[n+4>>2])!=(0|A)){for(s=A<<(31==(0|i)?0:25-(i>>>1)|0);e=0|r[(i=n+16+(s>>>31<<2)|0)>>2];){if((-8&r[e+4>>2])==(0|A)){n=e;break t}s<<=1,n=e}r[i>>2]=h,r[h+24>>2]=n,r[h+12>>2]=h,r[h+8>>2]=h;break e}}while(0);w=0|r[(b=n+8|0)>>2],r[w+12>>2]=h,r[b>>2]=h,r[h+8>>2]=w,r[h+12>>2]=n,r[h+24>>2]=0}}while(0);return k=t,0|(w=l+8|0)}d=u}else d=u;else d=-1}while(0);if((i=0|r[6983])>>>0>=d>>>0)return n=i-d|0,e=0|r[6986],n>>>0>15?(w=e+d|0,r[6986]=w,r[6983]=n,r[w+4>>2]=1|n,r[e+i>>2]=n,r[e+4>>2]=3|d):(r[6983]=0,r[6986]=0,r[e+4>>2]=3|i,r[(w=e+i+4|0)>>2]=1|r[w>>2]),k=t,0|(w=e+8|0);if((A=0|r[6984])>>>0>d>>>0)return y=A-d|0,r[6984]=y,b=(w=0|r[6987])+d|0,r[6987]=b,r[b+4>>2]=1|y,r[w+4>>2]=3|d,k=t,0|(w=w+8|0);if(0|r[7099]?e=0|r[7101]:(r[7101]=4096,r[7100]=4096,r[7102]=-1,r[7103]=-1,r[7104]=0,r[7092]=0,r[7099]=-16&f^1431655768,e=4096),l=d+48|0,(u=(a=e+(c=d+47|0)|0)&(o=0-e|0))>>>0<=d>>>0)return k=t,0|(w=0);if(0|(e=0|r[7091])&&(f=(h=0|r[7089])+u|0)>>>0<=h>>>0|f>>>0>e>>>0)return k=t,0|(w=0);e:do{if(4&r[7092])n=0,m=143;else{i=0|r[6987];t:do{if(i){for(s=28372;!((f=0|r[s>>2])>>>0<=i>>>0&&(f+(0|r[s+4>>2])|0)>>>0>i>>>0);){if(!(e=0|r[s+8>>2])){m=128;break t}s=e}if((n=a-A&o)>>>0<2147483647)if((0|(e=0|dn(0|n)))==((0|r[s>>2])+(0|r[s+4>>2])|0)){if(-1!=(0|e)){A=n,a=e,m=145;break e}}else s=e,m=136;else n=0}else m=128}while(0);do{if(128==(0|m))if(-1!=(0|(i=0|dn(0)))&&(n=i,g=(n=((g=(p=0|r[7100])+-1|0)&n|0?(g+n&0-p)-n|0:0)+u|0)+(p=0|r[7089])|0,n>>>0>d>>>0&n>>>0<2147483647)){if(0|(f=0|r[7091])&&g>>>0<=p>>>0|g>>>0>f>>>0){n=0;break}if((0|(e=0|dn(0|n)))==(0|i)){A=n,a=i,m=145;break e}s=e,m=136}else n=0}while(0);do{if(136==(0|m)){if(i=0-n|0,!(l>>>0>n>>>0&n>>>0<2147483647&-1!=(0|s))){if(-1==(0|s)){n=0;break}A=n,a=s,m=145;break e}if((e=c-n+(e=0|r[7101])&0-e)>>>0>=2147483647){A=n,a=s,m=145;break e}if(-1==(0|dn(0|e))){dn(0|i),n=0;break}A=e+n|0,a=s,m=145;break e}}while(0);r[7092]=4|r[7092],m=143}}while(0);if(143==(0|m)&&u>>>0<2147483647&&!(-1==(0|(y=0|dn(0|u)))|1^(v=(_=(g=0|dn(0))-y|0)>>>0>(d+40|0)>>>0)|y>>>0<g>>>0&-1!=(0|y)&-1!=(0|g)^1)&&(A=v?_:n,a=y,m=145),145==(0|m)){n=(0|r[7089])+A|0,r[7089]=n,n>>>0>(0|r[7090])>>>0&&(r[7090]=n),c=0|r[6987];e:do{if(c){for(n=28372;;){if((0|a)==((e=0|r[n>>2])+(i=0|r[n+4>>2])|0)){m=154;break}if(!(s=0|r[n+8>>2]))break;n=s}if(!(154!=(0|m)||(b=n+4|0,8&r[n+12>>2]))&&a>>>0>c>>>0&e>>>0<=c>>>0){r[b>>2]=i+A,b=c+(y=7&(y=c+8|0)?0-y&7:0)|0,y=(w=(0|r[6984])+A|0)-y|0,r[6987]=b,r[6984]=y,r[b+4>>2]=1|y,r[c+w+4>>2]=40,r[6988]=r[7103];break}for(a>>>0<(0|r[6985])>>>0&&(r[6985]=a),i=a+A|0,n=28372;;){if((0|r[n>>2])==(0|i)){m=162;break}if(!(e=0|r[n+8>>2]))break;n=e}if(162==(0|m)&&!(8&r[n+12>>2])){r[n>>2]=a,r[(h=n+4|0)>>2]=(0|r[h>>2])+A,u=(h=a+(7&(h=a+8|0)?0-h&7:0)|0)+d|0,l=(n=i+(7&(n=i+8|0)?0-n&7:0)|0)-h-d|0,r[h+4>>2]=3|d;t:do{if((0|c)==(0|n))w=(0|r[6984])+l|0,r[6984]=w,r[6987]=u,r[u+4>>2]=1|w;else{if((0|r[6986])==(0|n)){w=(0|r[6983])+l|0,r[6983]=w,r[6986]=u,r[u+4>>2]=1|w,r[u+w>>2]=w;break}if(1==(3&(e=0|r[n+4>>2]))){A=-8&e,s=e>>>3;n:do{if(e>>>0<256){if(e=0|r[n+8>>2],(0|(i=0|r[n+12>>2]))==(0|e)){r[6981]=r[6981]&~(1<<s);break}r[e+12>>2]=i,r[i+8>>2]=e;break}a=0|r[n+24>>2],e=0|r[n+12>>2];do{if((0|e)==(0|n)){if(e=0|r[(s=(i=n+16|0)+4|0)>>2])i=s;else if(!(e=0|r[i>>2])){e=0;break}for(;;)if(s=0|r[(o=e+20|0)>>2])e=s,i=o;else{if(!(s=0|r[(o=e+16|0)>>2]))break;e=s,i=o}r[i>>2]=0}else w=0|r[n+8>>2],r[w+12>>2]=e,r[e+8>>2]=w}while(0);if(!a)break;s=28228+((i=0|r[n+28>>2])<<2)|0;do{if((0|r[s>>2])==(0|n)){if(r[s>>2]=e,0|e)break;r[6982]=r[6982]&~(1<<i);break n}if(r[((0|r[(w=a+16|0)>>2])==(0|n)?w:a+20)>>2]=e,!e)break n}while(0);if(r[e+24>>2]=a,0|(s=0|r[(i=n+16|0)>>2])&&(r[e+16>>2]=s,r[s+24>>2]=e),!(i=0|r[i+4>>2]))break;r[e+20>>2]=i,r[i+24>>2]=e}while(0);n=n+A|0,o=A+l|0}else o=l;if(r[(n=n+4|0)>>2]=-2&r[n>>2],r[u+4>>2]=1|o,r[u+o>>2]=o,n=o>>>3,o>>>0<256){i=27964+(n<<1<<2)|0,(e=0|r[6981])&(n=1<<n)?n=0|r[(e=i+8|0)>>2]:(r[6981]=e|n,n=i,e=i+8|0),r[e>>2]=u,r[n+12>>2]=u,r[u+8>>2]=n,r[u+12>>2]=i;break}n=o>>>8;do{if(n){if(o>>>0>16777215){s=31;break}s=o>>>((s=14-((y=((w=n<<(b=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|b|(s=((w<<=y)+245760|0)>>>16&2))+(w<<s>>>15)|0)+7|0)&1|s<<1}else s=0}while(0);if(n=28228+(s<<2)|0,r[u+28>>2]=s,r[(e=u+16|0)+4>>2]=0,r[e>>2]=0,!((e=0|r[6982])&(i=1<<s))){r[6982]=e|i,r[n>>2]=u,r[u+24>>2]=n,r[u+12>>2]=u,r[u+8>>2]=u;break}n=0|r[n>>2];n:do{if((-8&r[n+4>>2])!=(0|o)){for(s=o<<(31==(0|s)?0:25-(s>>>1)|0);e=0|r[(i=n+16+(s>>>31<<2)|0)>>2];){if((-8&r[e+4>>2])==(0|o)){n=e;break n}s<<=1,n=e}r[i>>2]=u,r[u+24>>2]=n,r[u+12>>2]=u,r[u+8>>2]=u;break t}}while(0);w=0|r[(b=n+8|0)>>2],r[w+12>>2]=u,r[b>>2]=u,r[u+8>>2]=w,r[u+12>>2]=n,r[u+24>>2]=0}}while(0);return k=t,0|(w=h+8|0)}for(n=28372;!((e=0|r[n>>2])>>>0<=c>>>0&&(w=e+(0|r[n+4>>2])|0)>>>0>c>>>0);)n=0|r[n+8>>2];n=(e=(e=(o=w+-47|0)+(7&(e=o+8|0)?0-e&7:0)|0)>>>0<(o=c+16|0)>>>0?c:e)+8|0,b=a+(y=7&(y=a+8|0)?0-y&7:0)|0,y=(i=A+-40|0)-y|0,r[6987]=b,r[6984]=y,r[b+4>>2]=1|y,r[a+i+4>>2]=40,r[6988]=r[7103],r[(i=e+4|0)>>2]=27,r[n>>2]=r[7093],r[n+4>>2]=r[7094],r[n+8>>2]=r[7095],r[n+12>>2]=r[7096],r[7093]=a,r[7094]=A,r[7096]=0,r[7095]=n,n=e+24|0;do{b=n,r[(n=n+4|0)>>2]=7}while((b+8|0)>>>0<w>>>0);if((0|e)!=(0|c)){if(a=e-c|0,r[i>>2]=-2&r[i>>2],r[c+4>>2]=1|a,r[e>>2]=a,n=a>>>3,a>>>0<256){i=27964+(n<<1<<2)|0,(e=0|r[6981])&(n=1<<n)?n=0|r[(e=i+8|0)>>2]:(r[6981]=e|n,n=i,e=i+8|0),r[e>>2]=c,r[n+12>>2]=c,r[c+8>>2]=n,r[c+12>>2]=i;break}if(i=28228+((s=(n=a>>>8)?a>>>0>16777215?31:a>>>((s=14-((y=((w=n<<(b=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|b|(s=((w<<=y)+245760|0)>>>16&2))+(w<<s>>>15)|0)+7|0)&1|s<<1:0)<<2)|0,r[c+28>>2]=s,r[c+20>>2]=0,r[o>>2]=0,!((n=0|r[6982])&(e=1<<s))){r[6982]=n|e,r[i>>2]=c,r[c+24>>2]=i,r[c+12>>2]=c,r[c+8>>2]=c;break}n=0|r[i>>2];t:do{if((-8&r[n+4>>2])!=(0|a)){for(s=a<<(31==(0|s)?0:25-(s>>>1)|0);e=0|r[(i=n+16+(s>>>31<<2)|0)>>2];){if((-8&r[e+4>>2])==(0|a)){n=e;break t}s<<=1,n=e}r[i>>2]=c,r[c+24>>2]=n,r[c+12>>2]=c,r[c+8>>2]=c;break e}}while(0);w=0|r[(b=n+8|0)>>2],r[w+12>>2]=c,r[b>>2]=c,r[c+8>>2]=w,r[c+12>>2]=n,r[c+24>>2]=0}}else!(0|(w=0|r[6985]))|a>>>0<w>>>0&&(r[6985]=a),r[7093]=a,r[7094]=A,r[7096]=0,r[6990]=r[7099],r[6989]=-1,r[6994]=27964,r[6993]=27964,r[6996]=27972,r[6995]=27972,r[6998]=27980,r[6997]=27980,r[7e3]=27988,r[6999]=27988,r[7002]=27996,r[7001]=27996,r[7004]=28004,r[7003]=28004,r[7006]=28012,r[7005]=28012,r[7008]=28020,r[7007]=28020,r[7010]=28028,r[7009]=28028,r[7012]=28036,r[7011]=28036,r[7014]=28044,r[7013]=28044,r[7016]=28052,r[7015]=28052,r[7018]=28060,r[7017]=28060,r[7020]=28068,r[7019]=28068,r[7022]=28076,r[7021]=28076,r[7024]=28084,r[7023]=28084,r[7026]=28092,r[7025]=28092,r[7028]=28100,r[7027]=28100,r[7030]=28108,r[7029]=28108,r[7032]=28116,r[7031]=28116,r[7034]=28124,r[7033]=28124,r[7036]=28132,r[7035]=28132,r[7038]=28140,r[7037]=28140,r[7040]=28148,r[7039]=28148,r[7042]=28156,r[7041]=28156,r[7044]=28164,r[7043]=28164,r[7046]=28172,r[7045]=28172,r[7048]=28180,r[7047]=28180,r[7050]=28188,r[7049]=28188,r[7052]=28196,r[7051]=28196,r[7054]=28204,r[7053]=28204,r[7056]=28212,r[7055]=28212,b=a+(y=7&(y=a+8|0)?0-y&7:0)|0,y=(w=A+-40|0)-y|0,r[6987]=b,r[6984]=y,r[b+4>>2]=1|y,r[a+w+4>>2]=40,r[6988]=r[7103]}while(0);if((n=0|r[6984])>>>0>d>>>0)return y=n-d|0,r[6984]=y,b=(w=0|r[6987])+d|0,r[6987]=b,r[b+4>>2]=1|y,r[w+4>>2]=3|d,k=t,0|(w=w+8|0)}return r[(w=27920)>>2]=12,k=t,0|(w=0)}function Xt(e){var t=0,n=0,i=0,s=0,o=0,a=0,A=0,l=0;if(e|=0){n=e+-8|0,s=0|r[6985],l=n+(t=-8&(e=0|r[e+-4>>2]))|0;do{if(1&e)A=n,a=n;else{if(i=0|r[n>>2],!(3&e))return;if(o=i+t|0,(a=n+(0-i)|0)>>>0<s>>>0)return;if((0|r[6986])==(0|a)){if(3&~(t=0|r[(e=l+4|0)>>2])){A=a,t=o;break}return r[6983]=o,r[e>>2]=-2&t,r[a+4>>2]=1|o,void(r[a+o>>2]=o)}if(n=i>>>3,i>>>0<256){if(e=0|r[a+8>>2],(0|(t=0|r[a+12>>2]))==(0|e)){r[6981]=r[6981]&~(1<<n),A=a,t=o;break}r[e+12>>2]=t,r[t+8>>2]=e,A=a,t=o;break}s=0|r[a+24>>2],e=0|r[a+12>>2];do{if((0|e)==(0|a)){if(e=0|r[(n=(t=a+16|0)+4|0)>>2])t=n;else if(!(e=0|r[t>>2])){e=0;break}for(;;)if(n=0|r[(i=e+20|0)>>2])e=n,t=i;else{if(!(n=0|r[(i=e+16|0)>>2]))break;e=n,t=i}r[t>>2]=0}else A=0|r[a+8>>2],r[A+12>>2]=e,r[e+8>>2]=A}while(0);if(s){if(t=0|r[a+28>>2],(0|r[(n=28228+(t<<2)|0)>>2])==(0|a)){if(r[n>>2]=e,!e){r[6982]=r[6982]&~(1<<t),A=a,t=o;break}}else if(r[((0|r[(A=s+16|0)>>2])==(0|a)?A:s+20)>>2]=e,!e){A=a,t=o;break}r[e+24>>2]=s,0|(n=0|r[(t=a+16|0)>>2])&&(r[e+16>>2]=n,r[n+24>>2]=e),(t=0|r[t+4>>2])?(r[e+20>>2]=t,r[t+24>>2]=e,A=a,t=o):(A=a,t=o)}else A=a,t=o}}while(0);if(!(a>>>0>=l>>>0)&&1&(i=0|r[(e=l+4|0)>>2])){if(2&i)r[e>>2]=-2&i,r[A+4>>2]=1|t,r[a+t>>2]=t,s=t;else{if((0|r[6987])==(0|l)){if(l=(0|r[6984])+t|0,r[6984]=l,r[6987]=A,r[A+4>>2]=1|l,(0|A)!=(0|r[6986]))return;return r[6986]=0,void(r[6983]=0)}if((0|r[6986])==(0|l))return l=(0|r[6983])+t|0,r[6983]=l,r[6986]=a,r[A+4>>2]=1|l,void(r[a+l>>2]=l);s=(-8&i)+t|0,n=i>>>3;do{if(i>>>0<256){if(t=0|r[l+8>>2],(0|(e=0|r[l+12>>2]))==(0|t)){r[6981]=r[6981]&~(1<<n);break}r[t+12>>2]=e,r[e+8>>2]=t;break}o=0|r[l+24>>2],e=0|r[l+12>>2];do{if((0|e)==(0|l)){if(e=0|r[(n=(t=l+16|0)+4|0)>>2])t=n;else if(!(e=0|r[t>>2])){n=0;break}for(;;)if(n=0|r[(i=e+20|0)>>2])e=n,t=i;else{if(!(n=0|r[(i=e+16|0)>>2]))break;e=n,t=i}r[t>>2]=0,n=e}else n=0|r[l+8>>2],r[n+12>>2]=e,r[e+8>>2]=n,n=e}while(0);if(0|o){if(e=0|r[l+28>>2],(0|r[(t=28228+(e<<2)|0)>>2])==(0|l)){if(r[t>>2]=n,!n){r[6982]=r[6982]&~(1<<e);break}}else if(r[((0|r[(i=o+16|0)>>2])==(0|l)?i:o+20)>>2]=n,!n)break;r[n+24>>2]=o,0|(t=0|r[(e=l+16|0)>>2])&&(r[n+16>>2]=t,r[t+24>>2]=n),0|(e=0|r[e+4>>2])&&(r[n+20>>2]=e,r[e+24>>2]=n)}}while(0);if(r[A+4>>2]=1|s,r[a+s>>2]=s,(0|A)==(0|r[6986]))return void(r[6983]=s)}if(e=s>>>3,s>>>0<256)return n=27964+(e<<1<<2)|0,(t=0|r[6981])&(e=1<<e)?e=0|r[(t=n+8|0)>>2]:(r[6981]=t|e,e=n,t=n+8|0),r[t>>2]=A,r[e+12>>2]=A,r[A+8>>2]=e,void(r[A+12>>2]=n);e=28228+((i=(e=s>>>8)?s>>>0>16777215?31:s>>>((i=14-((o=((l=e<<(a=(e+1048320|0)>>>16&8))+520192|0)>>>16&4)|a|(i=((l<<=o)+245760|0)>>>16&2))+(l<<i>>>15)|0)+7|0)&1|i<<1:0)<<2)|0,r[A+28>>2]=i,r[A+20>>2]=0,r[A+16>>2]=0,t=0|r[6982],n=1<<i;e:do{if(t&n){e=0|r[e>>2];t:do{if((-8&r[e+4>>2])!=(0|s)){for(i=s<<(31==(0|i)?0:25-(i>>>1)|0);t=0|r[(n=e+16+(i>>>31<<2)|0)>>2];){if((-8&r[t+4>>2])==(0|s)){e=t;break t}i<<=1,e=t}r[n>>2]=A,r[A+24>>2]=e,r[A+12>>2]=A,r[A+8>>2]=A;break e}}while(0);l=0|r[(a=e+8|0)>>2],r[l+12>>2]=A,r[a>>2]=A,r[A+8>>2]=l,r[A+12>>2]=e,r[A+24>>2]=0}else r[6982]=t|n,r[e>>2]=A,r[A+24>>2]=e,r[A+12>>2]=A,r[A+8>>2]=A}while(0);if(l=(0|r[6989])-1|0,r[6989]=l,!(0|l)){for(e=28380;e=0|r[e>>2];)e=e+8|0;r[6989]=-1}}}}function Qt(e,t){t|=0;var n=0;return(e|=0)?(n=0|y(t,e),(t|e)>>>0>65535&&(n=((n>>>0)/(e>>>0)|0)==(0|t)?n:-1)):n=0,(e=0|Ht(n))&&3&r[e+-4>>2]?(un(0|e,0,0|n),0|e):0|e}function $t(e,t,n,i){return 0|(x((t|=0)+(i|=0)+((n=(e|=0)+(n|=0)>>>0)>>>0<e>>>0|0)>>>0|0),n)}function Yt(e,t,n,i){return 0|(x(0|(i=(t|=0)-(i|=0)-((n|=0)>>>0>(e|=0)>>>0|0)>>>0)),e-n>>>0)}function Kt(e){return 0|((e|=0)?31-(0|E(e^e-1)):32)}function Zt(e,t,n,i,s){s|=0;var o=0,a=0,A=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0;if(u=e|=0,a=n|=0,A=d=i|=0,!(c=l=t|=0))return o=!!(0|s),A?o?(r[s>>2]=0|e,r[s+4>>2]=0&t,s=0,0|(x(0|(d=0)),s)):(s=0,0|(x(0|(d=0)),s)):(o&&(r[s>>2]=(u>>>0)%(a>>>0),r[s+4>>2]=0),s=(u>>>0)/(a>>>0)>>>0,0|(x(0|(d=0)),s));o=!(0|A);do{if(a){if(!o){if((o=(0|E(0|A))-(0|E(0|c))|0)>>>0<=31){a=h=o+1|0,e=u>>>(h>>>0)&(t=o-31>>31)|c<<(A=31-o|0),t&=c>>>(h>>>0),o=0,A=u<<A;break}return s?(r[s>>2]=0|e,r[s+4>>2]=l|0&t,s=0,0|(x(0|(d=0)),s)):(s=0,0|(x(0|(d=0)),s))}if((o=a-1|0)&a|0){a=A=33+(0|E(0|a))-(0|E(0|c))|0,e=(h=32-A|0)-1>>31&c>>>((f=A-32|0)>>>0)|(c<<h|u>>>(A>>>0))&(t=f>>31),t&=c>>>(A>>>0),o=u<<(p=64-A|0)&(l=h>>31),A=(c<<p|u>>>(f>>>0))&l|u<<h&A-33>>31;break}return 0|s&&(r[s>>2]=o&u,r[s+4>>2]=0),1==(0|a)?(p=0|e,0|(x(0|(f=l|0&t)),p)):(f=c>>>((p=0|Kt(0|a))>>>0)|0,p=c<<32-p|u>>>(p>>>0),0|(x(0|f),p))}if(o)return 0|s&&(r[s>>2]=(c>>>0)%(a>>>0),r[s+4>>2]=0),p=(c>>>0)/(a>>>0)>>>0,0|(x(0|(f=0)),p);if(!u)return 0|s&&(r[s>>2]=0,r[s+4>>2]=(c>>>0)%(A>>>0)),p=(c>>>0)/(A>>>0)>>>0,0|(x(0|(f=0)),p);if(!((o=A-1|0)&A))return 0|s&&(r[s>>2]=0|e,r[s+4>>2]=o&c|0&t),f=0,p=c>>>((0|Kt(0|A))>>>0),0|(x(0|f),p);if((o=(0|E(0|A))-(0|E(0|c))|0)>>>0<=30){a=t=o+1|0,e=c<<(A=31-o|0)|u>>>(t>>>0),t=c>>>(t>>>0),o=0,A=u<<A;break}return s?(r[s>>2]=0|e,r[s+4>>2]=l|0&t,p=0,0|(x(0|(f=0)),p)):(p=0,0|(x(0|(f=0)),p))}while(0);if(a){c=0|$t(0|(h=0|n),0|(u=d|0&i),-1,-1),n=0|T(),l=A,A=0;do{i=l,l=o>>>31|l<<1,o=A|o<<1,Yt(0|c,0|n,0|(i=e<<1|i>>>31),0|(d=e>>>31|t<<1)),A=1&(f=(p=0|T())>>31|((0|p)<0?-1:0)<<1),e=0|Yt(0|i,0|d,f&h|0,(((0|p)<0?-1:0)>>31|((0|p)<0?-1:0)<<1)&u),t=0|T(),a=a-1|0}while(0|a);c=l,l=0}else c=A,l=0,A=0;return a=0,0|s&&(r[s>>2]=e,r[s+4>>2]=t),p=o<<1&-2|A,0|(x(0|(f=(0|o)>>>31|(c|a)<<1|l)),p)}function qt(e,t,n,i){n|=0;var r,s,o,a,A;return s=(i|=0)>>31|((0|i)<0?-1:0)<<1,r=((0|i)<0?-1:0)>>31|((0|i)<0?-1:0)<<1,o=0|Yt((A=(t|=0)>>31|((0|t)<0?-1:0)<<1)^(e|=0)|0,(a=((0|t)<0?-1:0)>>31|((0|t)<0?-1:0)<<1)^t|0,0|A,0|a),e=s^A,t=r^a,0|Yt((0|Zt(o,0|T(),0|Yt(s^n|0,r^i|0,0|s,0|r),0|T(),0))^e,(0|T())^t,0|e,0|t)}function Jt(e,t,n,i){t|=0,i|=0;var r,s;return n=0|function(e,t){var n,i,r,s=0;return e=((n=0|y(s=65535&(t|=0),r=65535&(e|=0)))>>>16)+(0|y(s,i=e>>>16))|0,t=0|y(s=t>>>16,r),0|(x((e>>>16)+(0|y(s,i))+(((65535&e)+t|0)>>>16)|0),e+t<<16|65535&n)}(r=e|=0,s=n|=0),e=0|T(),0|(x((0|y(t,s))+(0|y(i,r))+e|0&e),n)}function en(e,t,n,i){n|=0;var s,o,a,A,l,c;return s=k,k=k+16|0,A=0|s,c=(i|=0)>>31|((0|i)<0?-1:0)<<1,l=((0|i)<0?-1:0)>>31|((0|i)<0?-1:0)<<1,Zt(e=0|Yt((a=(t|=0)>>31|((0|t)<0?-1:0)<<1)^(e|=0)|0,(o=((0|t)<0?-1:0)>>31|((0|t)<0?-1:0)<<1)^t|0,0|a,0|o),t=0|T(),0|Yt(c^n|0,l^i|0,0|c,0|l),0|T(),A),i=0|Yt(r[A>>2]^a|0,r[A+4>>2]^o|0,0|a,0|o),n=0|T(),k=s,0|(x(0|n),i)}function tn(e,t,n,i){var s,o;return o=k,k=k+16|0,Zt(e|=0,t|=0,n|=0,i|=0,s=0|o),k=o,0|(x(0|r[s+4>>2]),r[s>>2])}function nn(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(x(t>>n|0),e>>>n|(t&(1<<n)-1)<<32-n):(x(0|((0|t)<0?-1:0)),t>>n-32)}function rn(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(x(t>>>n|0),e>>>n|(t&(1<<n)-1)<<32-n):(x(0),t>>>n-32|0)}function sn(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(x(t<<n|(e&(1<<n)-1<<32-n)>>>32-n),e<<n):(x(e<<n-32),0)}function on(e,t,n){return e|=0,32==(0|(t=0|E(t|=0)))&&(t=t+(0|E(e))|0),x(0),0|t}function an(e,t){return t=+t,(e=+e)!=e?+t:t!=t?+e:+w(+e,+t)}function An(e,t){return t=+t,(e=+e)!=e?+t:t!=t?+e:+b(+e,+t)}function ln(e){return(e=+e)>=0?+A(e+.5):+v(e-.5)}function cn(e,t,n){e|=0,t|=0;var s,o,a=0;if((0|(n|=0))>=8192)return R(0|e,0|t,0|n),0|e;if(o=0|e,s=e+n|0,(3&e)==(3&t)){for(;3&e;){if(!n)return 0|o;i[e|0]=0|i[t|0],e=e+1|0,t=t+1|0,n=n-1|0}for(a=(n=-4&s)-64|0;(0|e)<=(0|a);)r[e>>2]=r[t>>2],r[e+4>>2]=r[t+4>>2],r[e+8>>2]=r[t+8>>2],r[e+12>>2]=r[t+12>>2],r[e+16>>2]=r[t+16>>2],r[e+20>>2]=r[t+20>>2],r[e+24>>2]=r[t+24>>2],r[e+28>>2]=r[t+28>>2],r[e+32>>2]=r[t+32>>2],r[e+36>>2]=r[t+36>>2],r[e+40>>2]=r[t+40>>2],r[e+44>>2]=r[t+44>>2],r[e+48>>2]=r[t+48>>2],r[e+52>>2]=r[t+52>>2],r[e+56>>2]=r[t+56>>2],r[e+60>>2]=r[t+60>>2],e=e+64|0,t=t+64|0;for(;(0|e)<(0|n);)r[e>>2]=r[t>>2],e=e+4|0,t=t+4|0}else for(n=s-4|0;(0|e)<(0|n);)i[e|0]=0|i[t|0],i[e+1|0]=0|i[t+1|0],i[e+2|0]=0|i[t+2|0],i[e+3|0]=0|i[t+3|0],e=e+4|0,t=t+4|0;for(;(0|e)<(0|s);)i[e|0]=0|i[t|0],e=e+1|0,t=t+1|0;return 0|o}function un(e,t,n){t|=0;var s,o=0,a=0,A=0;if(s=(e|=0)+(n|=0)|0,t&=255,(0|n)>=67){for(;3&e;)i[e|0]=t,e=e+1|0;for(A=t|t<<8|t<<16|t<<24,a=(o=-4&s)-64|0;(0|e)<=(0|a);)r[e>>2]=A,r[e+4>>2]=A,r[e+8>>2]=A,r[e+12>>2]=A,r[e+16>>2]=A,r[e+20>>2]=A,r[e+24>>2]=A,r[e+28>>2]=A,r[e+32>>2]=A,r[e+36>>2]=A,r[e+40>>2]=A,r[e+44>>2]=A,r[e+48>>2]=A,r[e+52>>2]=A,r[e+56>>2]=A,r[e+60>>2]=A,e=e+64|0;for(;(0|e)<(0|o);)r[e>>2]=A,e=e+4|0}for(;(0|e)<(0|s);)i[e|0]=t,e=e+1|0;return s-n|0}function hn(e){return(e=+e)>=0?+A(e+.5):+v(e-.5)}function dn(e){e|=0;var t,n,i;return i=0|P(),(0|e)>0&(0|(t=(n=0|r[a>>2])+e|0))<(0|n)|(0|t)<0?(M(0|t),C(12),-1):(0|t)>(0|i)&&!(0|I(0|t))?(C(12),-1):(r[a>>2]=t,0|n)}return{___divdi3:qt,___muldi3:Jt,___remdi3:en,___uremdi3:tn,_areNeighborCells:function(e,t,n,i,s){s|=0;var o,a,A,l=0,c=0,u=0,h=0;if(A=k,k=k+64|0,a=A,o=A+56|0,!(!0&134217728==(2013265920&(t|=0))&!0&134217728==(2013265920&(i|=0))))return k=A,0|(s=5);if((0|(e|=0))==(0|(n|=0))&(0|t)==(0|i))return r[s>>2]=0,k=A,0|(s=0);if(c=0|rn(0|e,0|t,52),T(),c&=15,h=0|rn(0|n,0|i,52),T(),(0|c)!=(15&h))return k=A,0|(s=12);if(l=c+-1|0,c>>>0>1){Ue(e,t,l,a),Ue(n,i,l,o),u=0|r[(h=a)>>2],h=0|r[h+4>>2];e:do{if((0|u)==(0|r[o>>2])&&(0|h)==(0|r[o+4>>2])){l=0|rn(0|e,0|t,0|(c=3*(15^c)|0)),T(),l&=7,c=0|rn(0|n,0|i,0|c),T(),c&=7;do{if(!(0|l)|!(0|c))r[s>>2]=1,l=0;else if(7==(0|l))l=5;else{if(1==(0|l)|1==(0|c)&&0|ze(u,h)){l=5;break}if((0|r[15536+(l<<2)>>2])!=(0|c)&&(0|r[15568+(l<<2)>>2])!=(0|c))break e;r[s>>2]=1,l=0}}while(0);return k=A,0|(s=l)}}while(0)}c=(l=a)+56|0;do{r[l>>2]=0,l=l+4|0}while((0|l)<(0|c));return L(e,t,1,a),l=(0|r[(t=a)>>2])==(0|n)&&(0|r[t+4>>2])==(0|i)||(0|r[(t=a+8|0)>>2])==(0|n)&&(0|r[t+4>>2])==(0|i)||(0|r[(t=a+16|0)>>2])==(0|n)&&(0|r[t+4>>2])==(0|i)||(0|r[(t=a+24|0)>>2])==(0|n)&&(0|r[t+4>>2])==(0|i)||(0|r[(t=a+32|0)>>2])==(0|n)&&(0|r[t+4>>2])==(0|i)||(0|r[(t=a+40|0)>>2])==(0|n)&&(0|r[t+4>>2])==(0|i)?1:1&((0|r[(l=a+48|0)>>2])==(0|n)?(0|r[l+4>>2])==(0|i):0),r[s>>2]=l,k=A,0|(s=0)},_bitshift64Ashr:nn,_bitshift64Lshr:rn,_bitshift64Shl:sn,_calloc:Qt,_cellAreaKm2:function(e,t,n){return 0|(e=0|ht(e|=0,t|=0,n|=0))||(s[n>>3]=6371.007180918475*+s[n>>3]*6371.007180918475),0|e},_cellAreaM2:function(e,t,n){return 0|(e=0|ht(e|=0,t|=0,n|=0))||(s[n>>3]=6371.007180918475*+s[n>>3]*6371.007180918475*1e3*1e3),0|e},_cellAreaRads2:ht,_cellToBoundary:et,_cellToCenterChild:We,_cellToChildPos:function(e,t,n,i){n|=0,i|=0;var s,o=0,a=0,A=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0;if(s=k,k=k+16|0,_=s,v=0|rn(0|(e|=0),0|(t|=0),52),T(),v&=15,n>>>0>15)return k=s,0|(v=4);if((0|v)<(0|n))return k=s,0|(v=12);if((0|v)!=(0|n))if(a=0|sn(0|n,0,52),a|=e,l=T()|-15728641&t,(0|v)>(0|n)){c=n;do{m=0|sn(7,0,3*(14-c|0)|0),c=c+1|0,a|=m,l=0|T()|l}while((0|c)<(0|v));m=a}else m=a;else m=e,l=t;g=0|rn(0|m,0|l,45),T();e:do{if(0|z(127&g)){if(c=0|rn(0|m,0|l,52),T(),0|(c&=15))for(a=1;;){if(!(!((g=0|sn(7,0,3*(15-a|0)|0))&m|0)&!((0|T())&l))){u=33;break e}if(!(a>>>0<c>>>0))break;a=a+1|0}if(r[(g=i)>>2]=0,r[g+4>>2]=0,(0|v)>(0|n)){for(g=-15728641&t,p=v;;){if(f=p,(p=p+-1|0)>>>0>15|(0|v)<(0|p)){u=19;break}if((0|v)!=(0|p))if(a=0|sn(0|p,0,52),a|=e,c=0|T()|g,(0|v)<(0|f))d=a;else{u=p;do{d=0|sn(7,0,3*(14-u|0)|0),u=u+1|0,a|=d,c=0|T()|c}while((0|u)<(0|v));d=a}else d=e,c=t;if(h=0|rn(0|d,0|c,45),T(),0|z(127&h)){h=0|rn(0|d,0|c,52),T(),h&=15;t:do{if(h)for(u=1;;){if(a=0|rn(0|d,0|c,3*(15-u|0)|0),T(),0|(a&=7))break t;if(!(u>>>0<h>>>0)){a=0;break}u=u+1|0}else a=0}while(0);a=1&!(0|a)}else a=0;if(c=0|rn(0|e,0|t,3*(15-f|0)|0),T(),7==(0|(c&=7))){o=5,u=42;break}if(1==(0|c)&(a=!!(0|a))){o=5,u=42;break}if(0|(d=c+((!!(0|c)&a)<<31>>31)|0)&&(u=0|vt(7,0,u=v-f|0,((0|u)<0)<<31>>31),h=0|T(),a?(a=0|$t(0|(a=0|Jt(0|u,0|h,5,0)),0|T(),-5,-1),a=0|$t(0|(a=0|qt(0|a,0|T(),6,0)),0|T(),1,0),c=0|T()):(a=u,c=h),f=0|$t(0|a,0|c,0|(f=0|Jt(0|u,0|h,0|(f=d+-1|0),((0|f)<0)<<31>>31)),0|T()),h=0|$t(0|f,0|(d=0|T()),0|r[(h=i)>>2],0|r[h+4>>2]),d=0|T(),r[(f=i)>>2]=h,r[f+4>>2]=d),(0|p)<=(0|n)){u=37;break}}if(19==(0|u))S(27795,27122,1367,27158);else{if(37==(0|u)){o=0|r[(A=i)+4>>2],A=0|r[A>>2];break}if(42==(0|u))return k=s,0|o}}else o=0,A=0}else u=33}while(0);e:do{if(33==(0|u)){if(r[(g=i)>>2]=0,r[g+4>>2]=0,(0|v)>(0|n)){for(a=v;;){if(o=0|rn(0|e,0|t,3*(15-a|0)|0),T(),7==(0|(o&=7))){o=5;break}if(o=0|Jt(0|(A=0|vt(7,0,A=v-a|0,((0|A)<0)<<31>>31)),0|T(),0|o,0),A=0|T(),A=0|$t(0|r[(g=i)>>2],0|r[g+4>>2],0|o,0|A),o=0|T(),r[(g=i)>>2]=A,r[g+4>>2]=o,(0|(a=a+-1|0))<=(0|n))break e}return k=s,0|o}o=0,A=0}}while(0);return 0|Ge(m,l,v,_)&&S(27795,27122,1327,27173),((0|o)>-1|-1==(0|o)&A>>>0>4294967295)&((0|(_=0|r[(v=_)+4>>2]))>(0|o)|((0|_)==(0|o)?(0|r[v>>2])>>>0>A>>>0:0))?(k=s,0|(v=0)):(S(27795,27122,1407,27158),0)},_cellToChildren:function(e,t,n,i){i|=0;var s,o,a=0,A=0;if(o=k,k=k+16|0,nt(s=o,e|=0,t|=0,n|=0),!(0|(e=0|r[(t=s)>>2]))&!(0|(t=0|r[t+4>>2])))return k=o,0;a=0,n=0;do{r[(A=i+(a<<3)|0)>>2]=e,r[A+4>>2]=t,a=0|$t(0|a,0|n,1,0),n=0|T(),rt(s),e=0|r[(A=s)>>2],t=0|r[A+4>>2]}while(!(!(0|e)&!(0|t)));return k=o,0},_cellToChildrenSize:Ge,_cellToLatLng:Je,_cellToLocalIj:function(e,t,n,i,s,o){var a,A;return e|=0,t|=0,n|=0,i|=0,o|=0,A=k,k=k+16|0,a=A,(s|=0)?e=15:(e=0|mt(e,t,n,i,a))||(!function(e,t){var n;t|=0,n=0|r[8+(e|=0)>>2],r[t>>2]=(0|r[e>>2])-n,r[t+4>>2]=(0|r[e+4>>2])-n}(a,o),e=0),k=A,0|e},_cellToParent:Ue,_cellToVertex:Dt,_cellToVertexes:function(e,t,n){n|=0;var i,s=0,o=0;return o=!(0|ze(e|=0,t|=0)),i=!(0|(s=0|Dt(e,t,0,n))),o?i?0|(s=0|Dt(e,t,1,n+8|0))||0|(s=0|Dt(e,t,2,n+16|0))||0|(s=0|Dt(e,t,3,n+24|0))||(s=0|Dt(e,t,4,n+32|0))?0|(o=s):0|Dt(e,t,5,n+40|0):0|(o=s):i?0|(s=0|Dt(e,t,1,n+8|0))||0|(s=0|Dt(e,t,2,n+16|0))||0|(s=0|Dt(e,t,3,n+24|0))||0|(s=0|Dt(e,t,4,n+32|0))?0|(o=s):(r[(o=n+40|0)>>2]=0,r[o+4>>2]=0,0|(o=0)):0|(o=s)},_cellsToDirectedEdge:function(e,t,n,i,s){return s|=0,7==(0|(n=0|U(e|=0,t|=0,n|=0,i|=0)))?0|(s=11):(i=0|sn(0|n,0,56),t=-2130706433&t|T()|268435456,r[s>>2]=e|i,r[s+4>>2]=t,0|(s=0))},_cellsToLinkedMultiPolygon:function(e,t,n){n|=0;var i,o,a,A=0;if(a=k,k=k+32|0,i=a,0|(e=0|function(e,t,n){e|=0,n|=0;var i,s,o=0,a=0,A=0,l=0,c=0,u=0;if(s=k,k=k+176|0,i=s,(0|(t|=0))<1)return Nt(n,0,0),k=s,0;for(c=0|rn(0|r[(c=e)>>2],0|r[c+4>>2],52),T(),Nt(n,(0|t)>6?t:6,15&c),c=0;!(0|(o=0|et(0|r[(o=e+(c<<3)|0)>>2],0|r[o+4>>2],i)));){if((0|(o=0|r[i>>2]))>0){l=0;do{A=i+8+(l<<4)|0,(a=0|Vt(n,o=i+8+((0|(l=l+1|0))%(0|o)<<4)|0,A))?Gt(n,a):zt(n,A,o),o=0|r[i>>2]}while((0|l)<(0|o))}if((0|(c=c+1|0))>=(0|t)){o=0,u=13;break}}return 13==(0|u)?(k=s,0|o):(Ft(n),k=s,0|(u=o))}(e|=0,t|=0,o=a+16|0)))return k=a,0|(n=e);if(r[n>>2]=0,r[n+4>>2]=0,r[n+8>>2]=0,0|(e=0|Ut(o)))do{t=0|dt(n);do{ft(t,e),A=e+16|0,r[i>>2]=r[A>>2],r[i+4>>2]=r[A+4>>2],r[i+8>>2]=r[A+8>>2],r[i+12>>2]=r[A+12>>2],Gt(o,e),e=0|Wt(o,i)}while(0|e);e=0|Ut(o)}while(0|e);return Ft(o),(e=0|function(e){e|=0;var t=0,n=0,i=0,o=0,a=0,A=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,y=0,b=0,w=0,E=0,x=0,T=0,C=0,P=0,R=0,I=0,M=0,k=0,L=0,B=0,D=0,O=0;if(o=e+8|0,0|r[o>>2])return 0|(O=1);if(i=0|r[e>>2],!i)return 0|(O=0);t=i,n=0;do{n=n+1|0,t=0|r[t+8>>2]}while(0|t);if(n>>>0<2)return 0|(O=0);B=0|Ht(n<<2),B||S(27396,27235,317,27415);L=0|Ht(n<<5),L||S(27437,27235,321,27415);r[e>>2]=0,T=e+4|0,r[T>>2]=0,r[o>>2]=0,n=0,k=0,x=0,f=0;e:for(;;){if(d=0|r[i>>2]){a=0,A=d;do{if(u=+s[A+8>>3],t=A,A=0|r[A+16>>2],c=+s[(o=(h=!(0|A))?d:A)+8>>3],+l(+(u-c))>3.141592653589793){O=14;break}a+=(c-u)*(+s[t>>3]+ +s[o>>3])}while(!h);if(14==(0|O)){O=0,a=0,t=d;do{E=+s[t+8>>3],I=0|r[(M=t+16|0)>>2],w=+s[(I=0|I?I:d)+8>>3],a+=(+s[t>>3]+ +s[I>>3])*((w<0?w+6.283185307179586:w)-(E<0?E+6.283185307179586:E)),t=0|r[(0|t?M:i)>>2]}while(0|t)}a>0?(r[B+(k<<2)>>2]=i,k=k+1|0,o=x,t=f):O=19}else O=19;if(19==(0|O)){O=0;do{if(!n){if(f){o=T,A=f+8|0,t=i,n=e;break}if(0|r[e>>2]){O=27;break e}o=T,A=e,t=i,n=e;break}if(0|r[(t=n+8|0)>>2]){O=21;break e}if(!(n=0|Qt(1,12))){O=23;break e}r[t>>2]=n,o=n+4|0,A=n,t=f}while(0);if(r[A>>2]=i,r[o>>2]=i,A=L+(x<<5)|0,h=0|r[i>>2]){for(s[(d=L+(x<<5)+8|0)>>3]=17976931348623157e292,s[(f=L+(x<<5)+24|0)>>3]=17976931348623157e292,s[A>>3]=-17976931348623157e292,s[(p=L+(x<<5)+16|0)>>3]=-17976931348623157e292,y=17976931348623157e292,b=-17976931348623157e292,o=0,g=h,u=17976931348623157e292,_=17976931348623157e292,v=-17976931348623157e292,c=-17976931348623157e292;a=+s[g>>3],E=+s[g+8>>3],g=0|r[g+16>>2],w=+s[((m=!(0|g))?h:g)+8>>3],a<u&&(s[d>>3]=a,u=a),E<_&&(s[f>>3]=E,_=E),a>v?s[A>>3]=a:a=v,E>c&&(s[p>>3]=E,c=E),y=E>0&E<y?E:y,b=E<0&E>b?E:b,o|=+l(+(E-w))>3.141592653589793,!m;)v=a;o&&(s[p>>3]=b,s[f>>3]=y)}else r[A>>2]=0,r[A+4>>2]=0,r[A+8>>2]=0,r[A+12>>2]=0,r[A+16>>2]=0,r[A+20>>2]=0,r[A+24>>2]=0,r[A+28>>2]=0;o=x+1|0}if(i=0|r[(M=i+8|0)>>2],r[M>>2]=0,!i){O=45;break}x=o,f=t}if(21==(0|O))S(27213,27235,35,27247);else if(23==(0|O))S(27267,27235,37,27247);else if(27==(0|O))S(27310,27235,61,27333);else if(45==(0|O)){e:do{if((0|k)>0){for(M=!(0|o),R=o<<2,I=!(0|e),P=0,t=0;;){if(C=0|r[B+(P<<2)>>2],M)O=73;else{if(!(x=0|Ht(R))){O=50;break}if(!(T=0|Ht(R))){O=52;break}t:do{if(I)n=0;else{for(o=0,n=0,A=e;i=L+(o<<5)|0,0|gt(0|r[A>>2],i,0|r[C>>2])?(r[x+(n<<2)>>2]=A,r[T+(n<<2)>>2]=i,m=n+1|0):m=n,A=0|r[A+8>>2];)o=o+1|0,n=m;if((0|m)>0)if(i=0|r[x>>2],1==(0|m))n=i;else for(p=0,g=-1,n=i,f=i;;){for(h=0|r[f>>2],i=0,A=0;d=(0|(o=0|r[r[x+(A<<2)>>2]>>2]))==(0|h)?i:i+(1&gt(o,0|r[T+(A<<2)>>2],0|r[h>>2]))|0,(0|(A=A+1|0))!=(0|m);)i=d;if(n=(o=(0|d)>(0|g))?f:n,(0|(i=p+1|0))==(0|m))break t;p=i,g=o?d:g,f=0|r[x+(i<<2)>>2]}else n=0}}while(0);if(Xt(x),Xt(T),n){if(i=0|r[(o=n+4|0)>>2])n=i+8|0;else if(0|r[n>>2]){O=70;break}r[n>>2]=C,r[o>>2]=C}else O=73}if(73==(0|O)){if(O=0,0|(t=0|r[C>>2]))do{T=t,t=0|r[t+16>>2],Xt(T)}while(0|t);Xt(C),t=1}if((0|(P=P+1|0))>=(0|k)){D=t;break e}}50==(0|O)?S(27452,27235,249,27471):52==(0|O)?S(27490,27235,252,27471):70==(0|O)&&S(27310,27235,61,27333)}else D=0}while(0);return Xt(B),Xt(L),0|(O=D)}return 0}(n))?(pt(n),k=a,0|(A=e)):(k=a,0|(A=0))},_childPosToCell:function(e,t,n,i,s,o){e|=0,t|=0,o|=0;var a,A=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0;if(a=k,k=k+16|0,A=a,(s|=0)>>>0>15)return k=a,0|(o=4);if(l=0|rn(0|(n|=0),0|(i|=0),52),T(),(0|(l&=15))>(0|s))return k=a,0|(o=12);if(0|Ge(n,i,s,A)&&S(27795,27122,1327,27173),!(((0|t)>-1|-1==(0|t)&e>>>0>4294967295)&((0|(u=0|r[(h=A)+4>>2]))>(0|t)|((0|u)==(0|t)?(0|r[h>>2])>>>0>e>>>0:0))))return k=a,0|(o=2);h=s-l|0,s=0|sn(0|s,0,52),c=T()|-15728641&i,r[(u=o)>>2]=s|n,r[u+4>>2]=c,u=0|rn(0|n,0|i,45),T();e:do{if(0|z(127&u)){if(0|l)for(A=1;;){if(!(!((u=0|sn(7,0,3*(15-A|0)|0))&n|0)&!((0|T())&i)))break e;if(!(A>>>0<l>>>0))break;A=A+1|0}if((0|h)<1)return k=a,0|(o=0);for(u=15^l,i=-1,c=1,A=1;;){l=0|vt(7,0,l=h-c|0,((0|l)<0)<<31>>31),n=0|T();do{if(A){if(A=0|qt(0|(A=0|$t(0|(A=0|Jt(0|l,0|n,5,0)),0|T(),-5,-1)),0|T(),6,0),(0|t)>(0|(s=0|T()))|(0|t)==(0|s)&e>>>0>A>>>0){t=0|Yt(0|(t=0|$t(0|e,0|t,-1,-1)),0|T(),0|A,0|s),A=0|T(),p=0|r[(d=o)>>2],d=0|r[d+4>>2],f=0|sn(7,0,0|(g=3*(u+i|0)|0)),d&=~T(),g=0|sn(0|(s=0|$t(0|(i=0|qt(0|t,0|A,0|l,0|n)),0|(e=0|T()),2,0)),0|T(),0|g),d=0|T()|d,r[(s=o)>>2]=g|p&~f,r[s+4>>2]=d,e=0|Yt(0|t,0|A,0|(e=0|Jt(0|i,0|e,0|l,0|n)),0|T()),A=0,t=0|T();break}f=0|r[(g=o)>>2],g=0|r[g+4>>2],p=0|sn(7,0,3*(u+i|0)|0),g&=~T(),r[(A=o)>>2]=f&~p,r[A+4>>2]=g,A=1;break}s=0|r[(f=o)>>2],f=0|r[f+4>>2],d=0|sn(7,0,0|(i=3*(u+i|0)|0)),f&=~T(),i=0|sn(0|(g=0|qt(0|e,0|t,0|l,0|n)),0|(A=0|T()),0|i),f=0|T()|f,r[(p=o)>>2]=i|s&~d,r[p+4>>2]=f,e=0|Yt(0|e,0|t,0|(A=0|Jt(0|g,0|A,0|l,0|n)),0|T()),A=0,t=0|T()}while(0);if(!((0|h)>(0|c))){t=0;break}i=~c,c=c+1|0}return k=a,0|t}}while(0);if((0|h)<1)return k=a,0|(g=0);for(s=15^l,A=1;;){if(p=0|vt(7,0,p=h-A|0,((0|p)<0)<<31>>31),g=0|T(),n=0|r[(c=o)>>2],c=0|r[c+4>>2],i=0|sn(7,0,0|(l=3*(s-A|0)|0)),c&=~T(),l=0|sn(0|(d=0|qt(0|e,0|t,0|p,0|g)),0|(f=0|T()),0|l),c=0|T()|c,r[(u=o)>>2]=l|n&~i,r[u+4>>2]=c,e=0|Yt(0|e,0|t,0|(g=0|Jt(0|d,0|f,0|p,0|g)),0|T()),t=0|T(),(0|h)<=(0|A)){t=0;break}A=A+1|0}return k=a,0|t},_compactCells:function(e,t,n,i){t|=0;var s,o=0,a=0,A=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,y=0,b=0,w=0,E=0,x=0,C=0,P=0,R=0,I=0,M=0,k=0;if(!(0|(n|=0))&!(0|(i|=0)))return 0|(k=0);if(a=0|r[(o=e|=0)>>2],!0&!(15728640&(o=0|r[o+4>>2]))){if(!((0|i)>0|!(0|i)&n>>>0>0))return 0|(k=0);if(r[(k=t)>>2]=a,r[k+4>>2]=o,1==(0|n)&!(0|i))return 0|(k=0);o=1,a=0;do{M=0|r[(I=e+(o<<3)|0)+4>>2],r[(k=t+(o<<3)|0)>>2]=r[I>>2],r[k+4>>2]=M,o=0|$t(0|o,0|a,1,0),a=0|T()}while((0|a)<(0|i)|(0|a)==(0|i)&o>>>0<n>>>0);return 0|(o=0)}if(!(M=0|Ht(s=n<<3)))return 0|(k=13);if(cn(0|M,0|e,0|s),!(I=0|Qt(n,8)))return Xt(M),0|(k=13);e:for(;;){P=0|rn(0|(u=0|r[(o=M)>>2]),0|(o=0|r[o+4>>2]),52),T(),R=(P&=15)+-1|0,C=!!(0|P),x=(0|i)>0|!(0|i)&n>>>0>0;t:do{if(C&x){if(y=0|sn(0|R,0,52),b=0|T(),R>>>0>15){if(!(!(0|u)&!(0|o))){k=16;break e}for(a=0,e=0;;){if(a=0|$t(0|a,0|e,1,0),!((0|(e=0|T()))<(0|i)|(0|e)==(0|i)&a>>>0<n>>>0))break t;if(!(!(0|(E=0|r[(A=M+(a<<3)|0)>>2]))&!(0|(A=0|r[A+4>>2])))){o=A,k=16;break e}}}for(l=u,e=o,a=0,A=0;;){if(!(!(0|l)&!(0|e))){if(!(!0&!(117440512&e))){k=21;break e}if(h=0|rn(0|l,0|e,52),T(),(0|(h&=15))<(0|R)){o=12,k=27;break e}if((0|h)!=(0|R)&&(l|=y,e=-15728641&e|b,h>>>0>=P>>>0)){c=R;do{E=0|sn(7,0,3*(14-c|0)|0),c=c+1|0,l|=E,e=0|T()|e}while(c>>>0<h>>>0)}if(f=0|tn(0|l,0|e,0|n,0|i),p=0|T(),!(!(0|(d=0|r[(h=c=I+(f<<3)|0)>>2]))&!(0|(h=0|r[h+4>>2])))){_=0,v=0;do{if((0|_)>(0|i)|(0|_)==(0|i)&v>>>0>n>>>0){k=31;break e}if((0|d)==(0|l)&(-117440513&h)==(0|e)){g=0|rn(0|d,0|h,56),T(),m=(g&=7)+1|0,E=0|rn(0|d,0|h,45),T();n:do{if(0|z(127&E)){if(d=0|rn(0|d,0|h,52),T(),!(d&=15)){h=6;break}for(h=1;;){if(!(!((E=0|sn(7,0,3*(15-h|0)|0))&l|0)&!((0|T())&e))){h=7;break n}if(!(h>>>0<d>>>0)){h=6;break}h=h+1|0}}else h=7}while(0);if((g+2|0)>>>0>h>>>0){k=41;break e}E=0|sn(0|m,0,56),e=T()|-117440513&e,r[(w=c)>>2]=0,r[w+4>>2]=0,l|=E}else f=0|en(0|(f=0|$t(0|f,0|p,1,0)),0|T(),0|n,0|i),p=0|T();v=0|$t(0|v,0|_,1,0),_=0|T(),d=0|r[(h=c=I+(f<<3)|0)>>2],h=0|r[h+4>>2]}while(!(!(0|d)&!(0|h)))}r[(E=c)>>2]=l,r[E+4>>2]=e}if(a=0|$t(0|a,0|A,1,0),!((0|(A=0|T()))<(0|i)|(0|A)==(0|i)&a>>>0<n>>>0))break t;l=0|r[(e=M+(a<<3)|0)>>2],e=0|r[e+4>>2]}}}while(0);if(E=0|$t(0|n,0|i,5,0),(w=0|T())>>>0<0|!(0|w)&E>>>0<11){k=85;break}if(E=0|qt(0|n,0|i,6,0),T(),!(E=0|Qt(E,8))){k=48;break}do{if(x){for(m=0,e=0,g=0,_=0;;){if(!(0|(a=0|r[(A=h=I+(m<<3)|0)>>2]))&!(0|(A=0|r[A+4>>2])))w=g;else{d=0|rn(0|a,0|A,56),T(),l=(d&=7)+1|0,f=-117440513&A,w=0|rn(0|a,0|A,45),T();t:do{if(0|z(127&w)){if(p=0|rn(0|a,0|A,52),T(),0|(p&=15))for(c=1;;){if(!(!(a&(w=0|sn(7,0,3*(15-c|0)|0))|0)&!(f&(0|T()))))break t;if(!(c>>>0<p>>>0))break;c=c+1|0}a|=A=0|sn(0|l,0,56),A=0|T()|f,r[(l=h)>>2]=a,r[l+4>>2]=A,l=d+2|0}}while(0);7==(0|l)?(r[(w=E+(e<<3)|0)>>2]=a,r[w+4>>2]=-117440513&A,e=0|$t(0|e,0|g,1,0),w=0|T()):w=g}if(m=0|$t(0|m,0|_,1,0),!((0|(_=0|T()))<(0|i)|(0|_)==(0|i)&m>>>0<n>>>0))break;g=w}if(x){if(v=R>>>0>15,y=0|sn(0|R,0,52),b=0|T(),!C){for(a=0,c=0,l=0,A=0;!(0|u)&!(0|o)||(r[(R=t+(a<<3)|0)>>2]=u,r[R+4>>2]=o,a=0|$t(0|a,0|c,1,0),c=0|T()),l=0|$t(0|l,0|A,1,0),(0|(A=0|T()))<(0|i)|(0|A)==(0|i)&l>>>0<n>>>0;)u=0|r[(o=M+(l<<3)|0)>>2],o=0|r[o+4>>2];o=w;break}for(a=0,c=0,A=0,l=0;;){do{if(!(!(0|u)&!(0|o))){if(p=0|rn(0|u,0|o,52),T(),v|(0|(p&=15))<(0|R)){k=80;break e}if((0|p)!=(0|R)){if(h=u|y,d=-15728641&o|b,p>>>0>=P>>>0){f=R;do{C=0|sn(7,0,3*(14-f|0)|0),f=f+1|0,h|=C,d=0|T()|d}while(f>>>0<p>>>0)}}else h=u,d=o;g=0|tn(0|h,0|d,0|n,0|i),f=0,p=0,_=0|T();do{if((0|f)>(0|i)|(0|f)==(0|i)&p>>>0>n>>>0){k=81;break e}if((-117440513&(m=0|r[(C=I+(g<<3)|0)+4>>2]))==(0|d)&&(0|r[C>>2])==(0|h)){k=65;break}g=0|en(0|(C=0|$t(0|g,0|_,1,0)),0|T(),0|n,0|i),_=0|T(),p=0|$t(0|p,0|f,1,0),f=0|T(),C=I+(g<<3)|0}while((0|r[C>>2])!=(0|h)||(0|r[C+4>>2])!=(0|d));if(65==(0|k)&&(k=0,!0&100663296==(117440512&m)))break;r[(C=t+(a<<3)|0)>>2]=u,r[C+4>>2]=o,a=0|$t(0|a,0|c,1,0),c=0|T()}}while(0);if(A=0|$t(0|A,0|l,1,0),!((0|(l=0|T()))<(0|i)|(0|l)==(0|i)&A>>>0<n>>>0))break;u=0|r[(o=M+(A<<3)|0)>>2],o=0|r[o+4>>2]}o=w}else a=0,o=w}else a=0,e=0,o=0}while(0);if(un(0|I,0,0|s),cn(0|M,0|E,e<<3),Xt(E),!(0|e)&!(0|o)){k=89;break}t=t+(a<<3)|0,i=o,n=e}if(16==(0|k))!0&!(117440512&o)?(o=4,k=27):k=21;else if(31==(0|k))S(27795,27122,620,27132);else{if(41==(0|k))return Xt(M),Xt(I),0|(k=10);if(48==(0|k))return Xt(M),Xt(I),0|(k=13);80==(0|k)?S(27795,27122,711,27132):81==(0|k)?S(27795,27122,723,27132):85==(0|k)&&(cn(0|t,0|M,n<<3),k=89)}return 21==(0|k)?(Xt(M),Xt(I),0|(k=5)):27==(0|k)?(Xt(M),Xt(I),0|(k=o)):89==(0|k)?(Xt(M),Xt(I),0|(k=0)):0},_constructCell:function(e,t,n,s){n|=0,s|=0;var o=0,a=0,A=0,l=0,c=0,u=0;if((e|=0)>>>0>15)return 0|(s=4);if((t|=0)>>>0>121)return 0|(s=17);A=0|sn(0|e,0,52),o=0|T(),l=0|sn(0|t,0,45),o=0|o|T()|134225919;e:do{if((0|e)>=1){for(l=1,A=!!(0|i[20528+t|0]),a=-1;;){if((t=0|r[n+(l+-1<<2)>>2])>>>0>6){o=18,t=10;break}if(!(!(0|t)|1^A)){if(1==(0|t)){o=19,t=10;break}A=0}if(c=0|sn(7,0,0|(u=3*(15-l|0)|0)),o&=~T(),a=(t=0|sn(0|t,((0|t)<0)<<31>>31,0|u))|a&~c,o=0|T()|o,!((0|l)<(0|e)))break e;l=l+1|0}if(10==(0|t))return 0|o}else a=-1}while(0);return r[(u=s)>>2]=a,r[u+4>>2]=o,0|(u=0)},_destroyLinkedMultiPolygon:pt,_directedEdgeToBoundary:Ce,_directedEdgeToCells:function(e,t,n){e|=0;var i,s,o,a=0;return i=k,k=k+16|0,a=i,!0&268435456==(2013265920&(t|=0))?(s=-2130706433&t|134217728,r[(o=n|=0)>>2]=e,r[o+4>>2]=s,r[a>>2]=0,t=0|rn(0|e,0|t,56),T(),a=0|N(e,s,7&t,a,n+8|0),k=i,0|a):(k=i,0|(a=6))},_edgeLengthKm:function(e,t,n){n|=0;var i,o=0,a=0,A=0,l=0,u=0,f=0,p=0;if(i=k,k=k+176|0,0|(e=0|Ce(e|=0,t|=0,l=i)))return l=e,A=+s[n>>3],A*=6371.007180918475,s[n>>3]=A,k=i,0|l;if(s[n>>3]=0,(0|(e=0|r[l>>2]))<=1)return l=0,A=0,A*=6371.007180918475,s[n>>3]=A,k=i,0|l;t=e+-1|0,e=0,o=+s[l+8>>3],a=+s[l+16>>3],A=0;do{f=o,o=+s[l+8+((e=e+1|0)<<4)>>3],p=+d(.5*(o-f)),u=a,a=+s[l+8+(e<<4)+8>>3],u=p*p+(u=+d(.5*(a-u)))*(+h(+f)*+h(+o)*u),A+=2*+_(+ +c(+u),+ +c(+(1-u)))}while((0|e)!=(0|t));return s[n>>3]=A,l=0,p=A,p*=6371.007180918475,s[n>>3]=p,k=i,0|l},_edgeLengthM:function(e,t,n){n|=0;var i,o=0,a=0,A=0,l=0,u=0,f=0,p=0;if(i=k,k=k+176|0,0|(e=0|Ce(e|=0,t|=0,l=i)))return l=e,A=+s[n>>3],A*=6371.007180918475,A*=1e3,s[n>>3]=A,k=i,0|l;if(s[n>>3]=0,(0|(e=0|r[l>>2]))<=1)return l=0,A=0,A*=6371.007180918475,A*=1e3,s[n>>3]=A,k=i,0|l;t=e+-1|0,e=0,o=+s[l+8>>3],a=+s[l+16>>3],A=0;do{f=o,o=+s[l+8+((e=e+1|0)<<4)>>3],p=+d(.5*(o-f)),u=a,a=+s[l+8+(e<<4)+8>>3],u=p*p+(u=+d(.5*(a-u)))*(+h(+f)*+h(+o)*u),A+=2*+_(+ +c(+u),+ +c(+(1-u)))}while((0|e)!=(0|t));return s[n>>3]=A,l=0,p=A,p*=6371.007180918475,p*=1e3,s[n>>3]=p,k=i,0|l},_edgeLengthRads:function(e,t,n){n|=0;var i,o=0,a=0,A=0,l=0,u=0,f=0,p=0;if(i=k,k=k+176|0,0|(e=0|Ce(e|=0,t|=0,l=i)))return k=i,0|(l=e);if(s[n>>3]=0,(0|(e=0|r[l>>2]))<=1)return k=i,0|(l=0);t=e+-1|0,e=0,o=+s[l+8>>3],a=+s[l+16>>3],A=0;do{f=o,o=+s[l+8+((e=e+1|0)<<4)>>3],p=+d(.5*(o-f)),u=a,a=+s[l+8+(e<<4)+8>>3],u=p*p+(u=+d(.5*(a-u)))*(+h(+o)*+h(+f)*u),A+=2*+_(+ +c(+u),+ +c(+(1-u)))}while((0|e)<(0|t));return s[n>>3]=A,k=i,0|(l=0)},_emscripten_replace_memory:function(e){return i=new Int8Array(e),r=new Int32Array(e),s=new Float64Array(e),n=e,!0},_free:Xt,_getBaseCellNumber:Oe,_getDirectedEdgeDestination:function(e,t,n){e|=0,t|=0,n|=0;var i,s,o=0;return i=k,k=k+16|0,r[(o=i)>>2]=0,!0&268435456==(2013265920&t)?(s=0|rn(0|e,0|t,56),T(),o=0|N(e,-2130706433&t|134217728,7&s,o,n),k=i,0|o):(k=i,0|(o=6))},_getDirectedEdgeOrigin:function(e,t,n){return e|=0,n|=0,!0&268435456==(2013265920&(t|=0))?(r[n>>2]=e,r[n+4>>2]=-2130706433&t|134217728,0|(n=0)):0|(n=6)},_getHexagonAreaAvgKm2:lt,_getHexagonAreaAvgM2:function(e,t){return t|=0,(e|=0)>>>0>15?0|(t=4):(s[t>>3]=+s[20784+(e<<3)>>3],0|(t=0))},_getHexagonEdgeLengthAvgKm:function(e,t){return t|=0,(e|=0)>>>0>15?0|(t=4):(s[t>>3]=+s[20912+(e<<3)>>3],0|(t=0))},_getHexagonEdgeLengthAvgM:function(e,t){return t|=0,(e|=0)>>>0>15?0|(t=4):(s[t>>3]=+s[21040+(e<<3)>>3],0|(t=0))},_getIcosahedronFaces:function e(t,n,i){i|=0;var s,o=0,a=0,A=0,l=0,c=0,u=0,h=0,d=0;s=k,k=k+128|0,h=s+112|0,A=s+96|0,d=s,a=0|rn(0|(t|=0),0|(n|=0),52),T(),c=15&a,r[h>>2]=c,l=0|rn(0|t,0|n,45),T(),l&=127;e:do{if(0|z(l)){if(0|c)for(o=1;;){if(!(!((u=0|sn(7,0,3*(15-o|0)|0))&t|0)&!((0|T())&n))){a=0;break e}if(!(o>>>0<c>>>0))break;o=o+1|0}if(!(1&a))return u=0|sn(c+1|0,0,52),d=T()|-15728641&n,d=0|e((u|t)&~(h=0|sn(7,0,3*(14-c|0)|0)),d&~T(),i),k=s,0|d;a=1}else a=0}while(0);if(!(o=0|qe(t,n,A))){a?(Me(A,h,d),u=5):(De(A,h,d),u=6);e:do{if(0|z(l))if(c)for(o=1;;){if(!(!((l=0|sn(7,0,3*(15-o|0)|0))&t|0)&!((0|T())&n))){t=2;break e}if(!(o>>>0<c>>>0)){t=5;break}o=o+1|0}else t=5;else t=2}while(0);un(0|i,-1,t<<2);e:do{if(a)for(A=0;;){if(Le(l=d+(A<<4)|0,0|r[h>>2]),l=0|r[l>>2],-1==(0|(c=0|r[i>>2]))|(0|c)==(0|l))o=i;else{a=0;do{if((a=a+1|0)>>>0>=t>>>0){o=1;break e}c=0|r[(o=i+(a<<2)|0)>>2]}while(!(-1==(0|c)|(0|c)==(0|l)))}if(r[o>>2]=l,(A=A+1|0)>>>0>=u>>>0){o=0;break}}else for(A=0;;){if(ke(l=d+(A<<4)|0,0|r[h>>2],0,1),l=0|r[l>>2],-1==(0|(c=0|r[i>>2]))|(0|c)==(0|l))o=i;else{a=0;do{if((a=a+1|0)>>>0>=t>>>0){o=1;break e}c=0|r[(o=i+(a<<2)|0)>>2]}while(!(-1==(0|c)|(0|c)==(0|l)))}if(r[o>>2]=l,(A=A+1|0)>>>0>=u>>>0){o=0;break}}}while(0)}return k=s,0|(d=o)},_getIndexDigit:function(e,t,n,i){return i|=0,((n|=0)+-1|0)>>>0>14?0|(i=4):(n=0|rn(0|(e|=0),0|(t|=0),3*(15-n|0)|0),T(),r[i>>2]=7&n,0|(i=0))},_getNumCells:ct,_getPentagons:tt,_getRes0Cells:function(e){e|=0;var t=0,n=0,i=0;t=0;do{sn(0|t,0,45),i=134225919|T(),r[(n=e+(t<<3)|0)>>2]=-1,r[n+4>>2]=i,t=t+1|0}while(122!=(0|t));return 0},_getResolution:function(e,t){return t=0|rn(0|(e|=0),0|(t|=0),52),T(),15&t},_greatCircleDistanceKm:At,_greatCircleDistanceM:function(e,t){e|=0;var n,i,r,o=0;return i=+s[(t|=0)>>3],n=+s[e>>3],o=(r=+d(.5*(i-n)))*r+(o=+d(.5*(+s[t+8>>3]-+s[e+8>>3])))*(+h(+i)*+h(+n)*o),2*+_(+ +c(+o),+ +c(+(1-o)))*6371.007180918475*1e3},_greatCircleDistanceRads:function(e,t){e|=0;var n,i,r,o=0;return i=+s[(t|=0)>>3],n=+s[e>>3],o=(r=+d(.5*(i-n)))*r+(o=+d(.5*(+s[t+8>>3]-+s[e+8>>3])))*(+h(+i)*+h(+n)*o),2*+_(+ +c(+o),+ +c(+(1-o)))},_gridDisk:L,_gridDiskDistances:B,_gridDistance:function(e,t,n,i,s){n|=0,i|=0,s|=0;var o,a,A=0,l=0;return a=k,k=k+32|0,l=a,0|(o=0|mt(e|=0,t|=0,e,t,A=a+12|0))?(k=a,0|(l=o)):0|(e=0|mt(e,t,n,i,l))?(k=a,0|(l=e)):(A=0|Ee(A,l),r[(l=s)>>2]=A,r[l+4>>2]=((0|A)<0)<<31>>31,k=a,0|(l=0))},_gridPathCells:function(e,t,n,i,s){n|=0,i|=0,s|=0;var o,a,A=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,y=0,b=0,w=0,E=0,x=0,C=0,P=0;if(a=k,k=k+48|0,c=a+12|0,C=a,!(A=0|mt(e|=0,t|=0,e,t,o=a+24|0))&&!(A=0|mt(e,t,n,i,c))){x=((0|(E=0|Ee(o,c)))<0)<<31>>31,r[o>>2]=0,r[o+4>>2]=0,r[o+8>>2]=0,r[c>>2]=0,r[c+4>>2]=0,r[c+8>>2]=0,0|mt(e,t,e,t,o)&&S(27795,27538,692,27747),0|mt(e,t,n,i,c)&&S(27795,27538,697,27747),xe(o),xe(c),f=0|E?1/+(0|E):0,n=0|r[o>>2],v=f*+((0|r[c>>2])-n|0),i=0|r[(y=o+4|0)>>2],b=f*+((0|r[c+4>>2])-i|0),A=0|r[(w=o+8|0)>>2],f*=+((0|r[c+8>>2])-A|0),r[C>>2]=n,r[(p=C+4|0)>>2]=i,r[(g=C+8|0)>>2]=A;e:do{if((0|E)<0)A=0;else for(m=0,_=0;;){P=v*(h=+(_>>>0)+4294967296*+(0|m))+ +(0|n),u=b*h+ +(0|i),h=f*h+ +(0|A),n=~~+ln(+P),c=~~+ln(+u),A=~~+ln(+h),P=+l(+(+(0|n)-P)),u=+l(+(+(0|c)-u)),h=+l(+(+(0|A)-h));do{if(!(P>u&P>h)){if(d=0-n|0,u>h){i=d-A|0;break}i=c,A=d-c|0;break}n=0-(c+A)|0,i=c}while(0);if(r[C>>2]=n,r[p>>2]=i,r[g>>2]=A,Te(C),0|(A=0|_t(e,t,C,s+(_<<3)|0)))break e;if(!((0|m)<(0|x)|(0|m)==(0|x)&_>>>0<E>>>0)){A=0;break e}n=0|$t(0|_,0|m,1,0),m=i=0|T(),_=n,n=0|r[o>>2],i=0|r[y>>2],A=0|r[w>>2]}}while(0);return k=a,0|(C=A)}return k=a,0|(C=A)},_gridPathCellsSize:function(e,t,n,i,s){n|=0,i|=0,s|=0;var o,a=0,A=0,l=0;return o=k,k=k+32|0,l=o,(a=0|mt(e|=0,t|=0,e,t,A=o+12|0))||(a=0|mt(e,t,n,i,l))?(k=o,0|(l=a)):(i=0|$t(0|(i=0|Ee(A,l)),((0|i)<0)<<31>>31,1,0),A=0|T(),r[(l=s)>>2]=i,r[l+4>>2]=A,k=o,0|(l=0))},_gridRing:function(e,t,n,i){return 0|F(e|=0,t|=0,n|=0,i|=0)?(un(0|i,0,48*n|0),0|(i=0|function(e,t,n,i){e|=0,t|=0,n|=0,i|=0;var s=0,o=0,a=0,A=0,l=0,c=0,u=0,h=0,d=0;if(h=k,k=k+16|0,a=h,!n)return r[i>>2]=e,r[i+4>>2]=t,k=h,0|(i=0);do{if((0|n)>=0){if((0|n)>13780509){if(0|(s=0|ct(15,a)))break;s=0|r[(o=a)>>2],o=0|r[o+4>>2]}else u=0|Jt(0|n,0|(s=((0|n)<0)<<31>>31),3,0),o=0|T(),s=0|$t(0|n,0|s,1,0),s=0|$t(0|(s=0|Jt(0|u,0|o,0|s,0|T())),0|T(),1,0),o=0|T(),r[(u=a)>>2]=s,r[u+4>>2]=o;if(c=0|Qt(s,8)){if(!(u=0|Qt(s,4))){Xt(c),s=13;break}if(0|(s=0|O(e,t,n,c,u,s,o,0))){Xt(c),Xt(u);break}if(t=0|r[a>>2],(0|(a=0|r[a+4>>2]))>0|!(0|a)&t>>>0>0){s=0,A=0,l=0;do{!(0|(o=0|r[(e=c+(A<<3)|0)>>2]))&!(0|(e=0|r[e+4>>2]))||(0|r[u+(A<<2)>>2])!=(0|n)||(r[(d=i+(s<<3)|0)>>2]=o,r[d+4>>2]=e,s=s+1|0),A=0|$t(0|A,0|l,1,0),l=0|T()}while((0|l)<(0|a)|(0|l)==(0|a)&A>>>0<t>>>0)}Xt(c),Xt(u),s=0}else s=13}else s=2}while(0);return k=h,0|(d=s)}(e,t,n,i))):0|(i=0)},_gridRingUnsafe:F,_i64Add:$t,_i64Subtract:Yt,_isPentagon:ze,_isResClassIII:function(e,t){return t=0|rn(0|(e|=0),0|(t|=0),52),T(),1&t},_isValidCell:Ne,_isValidDirectedEdge:Se,_isValidIndex:function(e,t){e|=0;var n=0,r=0,s=0,o=0;if(!0&134217728==(-16777216&(t|=0))&&(r=0|rn(0|e,0|t,52),T(),r&=15,n=0|rn(0|e,0|t,45),T(),(n&=127)>>>0<=121)&&!(613566756&(o=0|sn(0|(s=0|rn(0|e,0|t,0|(o=3*(15^r)|0))),0|T(),0|o))&(0|Yt(-1227133514,-1171,0|o,0|(s=0|T()))))&!(4681&s&T())&&15==(0|r)|!(0|(o=0|rn(0|(0|sn(0|~e,0|~t,0|(o=19+(3*r|0)|0))),0|T(),0|o)))&!(0|T())){if(!(0|i[20528+n|0]))return 0|(o=1);if(!(0|e)&!(0|(n=8191&t)))return 0|(o=1);if(o=0|on(0|e,0|n),T(),(63-o|0)%3|0)return 0|(o=1)}return 0|Se(e,t)?0|(o=1):0|(o=1&!!(0|Ot(e,t)))},_isValidVertex:Ot,_latLngToCell:Ke,_llvm_ctlz_i64:on,_llvm_maxnum_f64:an,_llvm_minnum_f64:An,_llvm_round_f64:ln,_localIjToCell:function(e,t,n,i,s){var o,a;return e|=0,t|=0,n|=0,s|=0,a=k,k=k+16|0,o=a,(i|=0)?n=15:(n=0|function(e,t){t|=0;var n,i,s,o=0,a=0,A=0;if(a=0|r[(e|=0)>>2],r[t>>2]=a,A=0|r[e+4>>2],r[(i=t+4|0)>>2]=A,r[(s=t+8|0)>>2]=0,e=(o=(0|A)<(0|a))?a:A,(0|(o=o?A:a))<0){if(-2147483648==(0|o)||((0|e)>0?(2147483647-e|0)<(0|o):(-2147483648-e|0)>(0|o)))return 1;if((0|e)>-1?(-2147483648|e)>=(0|o):(-2147483648^e)<(0|o))return 1}return e=A-a|0,(0|a)<0?(o=0-a|0,r[i>>2]=e,r[s>>2]=o,r[t>>2]=0,a=0):(e=A,o=0),(0|e)<0&&(a=a-e|0,r[t>>2]=a,o=o-e|0,r[s>>2]=o,r[i>>2]=0,e=0),n=a-o|0,A=e-o|0,(0|o)<0?(r[t>>2]=n,r[i>>2]=A,r[s>>2]=0,e=A,A=n,o=0):A=a,(0|(a=(0|o)<(0|(a=(0|e)<(0|A)?e:A))?o:a))<=0||(r[t>>2]=A-a,r[i>>2]=e-a,r[s>>2]=o-a),0}(n,o))||(n=0|_t(e,t,o,s)),k=a,0|n},_malloc:Ht,_maxFaceCount:function(e,t,n){n|=0;var i=0,s=0;if(s=0|rn(0|(e|=0),0|(t|=0),45),T(),!(0|z(127&s)))return s=2,r[n>>2]=s,0;if(s=0|rn(0|e,0|t,52),T(),!(s&=15))return s=5,r[n>>2]=s,0;for(i=1;;){if(!(!((0|sn(7,0,3*(15-i|0)|0))&e|0)&!((0|T())&t))){i=2,e=6;break}if(!(i>>>0<s>>>0)){i=5,e=6;break}i=i+1|0}return 6==(0|e)?(r[n>>2]=i,0):0},_maxGridDiskSize:function(e,t){t|=0;var n=0,i=0,s=0;return(0|(e|=0))<0?0|(t=2):(0|e)>13780509?0|(t=0|ct(15,t)):(s=0|Jt(0|e,0|(n=((0|e)<0)<<31>>31),3,0),i=0|T(),n=0|$t(0|e,0|n,1,0),n=0|$t(0|(n=0|Jt(0|s,0|i,0|n,0|T())),0|T(),1,0),e=0|T(),r[t>>2]=n,r[t+4>>2]=e,0|(t=0))},_maxPolygonToCellsSize:function(e,t,n,i){e|=0,t|=0,i|=0;var s,o=0,a=0,A=0,l=0,c=0;if(s=k,k=k+48|0,o=s+16|0,a=s+8|0,A=s,0|(n=0|Tt(n|=0)))return k=s,0|(A=n);if(l=0|r[(c=e)+4>>2],r[(n=a)>>2]=r[c>>2],r[n+4>>2]=l,xt(a,o),!(n=0|te(o,t,A))){if(t=0|r[a>>2],(0|(a=0|r[e+8>>2]))>0){o=0|r[e+12>>2],n=0;do{t=(0|r[o+(n<<3)>>2])+t|0,n=n+1|0}while((0|n)<(0|a))}o=0|r[(n=A)>>2],(0|(n=0|r[n+4>>2]))<(0|(a=((0|t)<0)<<31>>31))|(0|n)==(0|a)&o>>>0<t>>>0?(r[(n=A)>>2]=t,r[n+4>>2]=a,n=a):t=o,l=0|$t(0|t,0|n,12,0),c=0|T(),r[(n=A)>>2]=l,r[n+4>>2]=c,r[(n=i)>>2]=l,r[n+4>>2]=c,n=0}return k=s,0|(c=n)},_maxPolygonToCellsSizeExperimental:function(e,t,n,o){t|=0,n|=0,o|=0;var a,A,c=0,u=0,d=0,f=0,p=0,g=0,m=0,_=0;if(A=k,k=k+48|0,p=A+32|0,f=A+40|0,a=A,!(0|r[(e|=0)>>2]))return r[(g=o)>>2]=0,r[g+4>>2]=0,k=A,0|(g=0);Fe(p,0,0,0),c=0|r[(d=p)>>2],d=0|r[d+4>>2];do{if(t>>>0>15)r[(g=a)>>2]=0,r[g+4>>2]=0,r[a+8>>2]=4,r[a+12>>2]=-1,n=a+29|0,r[(g=a+16|0)>>2]=0,r[g+4>>2]=0,r[g+8>>2]=0,i[g+12|0]=0,i[n|0]=0|i[f|0],i[n+1|0]=0|i[f+1|0],i[n+2|0]=0|i[f+2|0],n=4,g=9;else{if(0|(n=0|Tt(n))){r[(p=a)>>2]=0,r[p+4>>2]=0,r[a+8>>2]=n,r[a+12>>2]=-1,g=a+29|0,r[(p=a+16|0)>>2]=0,r[p+4>>2]=0,r[p+8>>2]=0,i[p+12|0]=0,i[g|0]=0|i[f|0],i[g+1|0]=0|i[f+1|0],i[g+2|0]=0|i[f+2|0],g=9;break}if(!(n=0|Qt(1+(0|r[e+8>>2])|0,32))){r[(g=a)>>2]=0,r[g+4>>2]=0,r[a+8>>2]=13,r[a+12>>2]=-1,n=a+29|0,r[(g=a+16|0)>>2]=0,r[g+4>>2]=0,r[g+8>>2]=0,i[g+12|0]=0,i[n|0]=0|i[f|0],i[n+1|0]=0|i[f+1|0],i[n+2|0]=0|i[f+2|0],n=13,g=9;break}St(e,n),r[(_=a)>>2]=c,r[_+4>>2]=d,r[(d=a+8|0)>>2]=0,r[a+12>>2]=t,r[a+20>>2]=e,r[a+24>>2]=n,i[a+28|0]=0,i[(c=a+29|0)|0]=0|i[f|0],i[c+1|0]=0|i[f+1|0],i[c+2|0]=0|i[f+2|0],r[a+16>>2]=3,m=+K(n),m*=+$(n),u=+l(+ +s[n>>3]),u=m/+h(+ +An(+u,+ +l(+ +s[n+8>>3])))*6371.007180918475*6371.007180918475,n=0|r[(c=a+12|0)>>2];e:do{if((0|n)>0)do{if(lt(n+-1|0,p),!(u/+s[p>>3]>10))break e;n=(_=0|r[c>>2])+-1|0,r[c>>2]=n}while((0|_)>1)}while(0);if(bt(a),r[(c=o)>>2]=0,r[c+4>>2]=0,!(!(0|(n=0|r[(c=a)>>2]))&!(0|(c=0|r[c+4>>2]))))do{Ge(n,c,t,p),f=p,f=0|$t(0|r[(e=o)>>2],0|r[e+4>>2],0|r[f>>2],0|r[f+4>>2]),e=0|T(),r[(_=o)>>2]=f,r[_+4>>2]=e,bt(a),n=0|r[(_=a)>>2],c=0|r[_+4>>2]}while(!(!(0|n)&!(0|c)));n=0|r[d>>2]}}while(0);return k=A,0|(_=n)},_memcpy:cn,_memset:un,_originToDirectedEdges:function(e,t,n){n|=0;var i,s=0;return i=!(0|ze(e|=0,t|=0)),t&=-2130706433,r[(s=n)>>2]=i?e:0,r[s+4>>2]=i?285212672|t:0,r[(s=n+8|0)>>2]=e,r[s+4>>2]=301989888|t,r[(s=n+16|0)>>2]=e,r[s+4>>2]=318767104|t,r[(s=n+24|0)>>2]=e,r[s+4>>2]=335544320|t,r[(s=n+32|0)>>2]=e,r[s+4>>2]=352321536|t,r[(n=n+40|0)>>2]=e,r[n+4>>2]=369098752|t,0},_pentagonCount:function(){return 12},_polygonToCells:function(e,t,n,i){e|=0,t|=0,i|=0;var s,o,a,A,l=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,y=0,b=0,w=0,E=0,x=0,S=0,C=0,P=0,R=0,I=0,M=0,L=0,B=0,N=0,F=0,U=0;if(A=k,k=k+112|0,s=A+80|0,d=A+72|0,o=A,a=A+56|0,0|(l=0|Tt(n|=0)))return k=A,0|(U=l);if(!(U=0|Ht(32+(r[(f=e+8|0)>>2]<<5)|0)))return k=A,0|(U=13);if(St(e,U),!(l=0|Tt(n))){if(F=0|r[(N=e)+4>>2],r[(l=d)>>2]=r[N>>2],r[l+4>>2]=F,xt(d,s),l=0|te(s,t,o))N=0,F=0;else{if(l=0|r[d>>2],(0|(c=0|r[f>>2]))>0){u=0|r[e+12>>2],n=0;do{l=(0|r[u+(n<<3)>>2])+l|0,n=n+1|0}while((0|n)!=(0|c));n=l}else n=l;c=0|r[(l=o)>>2],(0|(l=0|r[l+4>>2]))<(0|(u=((0|n)<0)<<31>>31))|(0|l)==(0|u)&c>>>0<n>>>0?(r[(l=o)>>2]=n,r[l+4>>2]=u,l=u):n=c,N=0|$t(0|n,0|l,12,0),F=0|T(),r[(l=o)>>2]=N,r[l+4>>2]=F,l=0}if(!l){if(!(n=0|Qt(N,8)))return Xt(U),k=A,0|(U=13);if(!(h=0|Qt(N,8)))return Xt(U),Xt(n),k=A,0|(U=13);r[(L=s)>>2]=0,r[L+4>>2]=0,B=0|r[(L=e)+4>>2],r[(l=d)>>2]=r[L>>2],r[l+4>>2]=B,l=0|G(d,N,F,t,s,n,h);e:do{if(l)Xt(n),Xt(h),Xt(U);else{t:do{if((0|r[f>>2])>0){for(u=e+12|0,c=0;l=0|G((0|r[u>>2])+(c<<3)|0,N,F,t,s,n,h),c=c+1|0,!(0|l);)if((0|c)>=(0|r[f>>2]))break t;Xt(n),Xt(h),Xt(U);break e}}while(0);(0|F)>0|!(0|F)&N>>>0>0&&un(0|h,0,N<<3),L=0|r[(B=s)+4>>2];t:do{if((0|L)>0|!(0|L)&(0|r[B>>2])>>>0>0){R=n,I=h,M=n,L=h,B=n,l=n,S=n,C=h,P=h,n=h;n:for(;;){for(b=0,w=0,E=0,x=0,c=0,u=0;;){d=(h=o)+56|0;do{r[h>>2]=0,h=h+4|0}while((0|h)<(0|d));if(0|D(f=0|r[(t=R+(b<<3)|0)>>2],t=0|r[t+4>>2],1,o,0)){d=(h=o)+56|0;do{r[h>>2]=0,h=h+4|0}while((0|h)<(0|d));0|(h=0|Qt(7,4))&&(O(f,t,1,o,h,7,0,0),Xt(h))}for(y=0;;){_=0|r[(v=o+(y<<3)|0)>>2],v=0|r[v+4>>2];i:do{if(!(0|_)&!(0|v))h=c,d=u;else{if(p=0|tn(0|_,0|v,0|N,0|F),f=0|T(),!(!(0|(d=0|r[(t=h=i+(p<<3)|0)>>2]))&!(0|(t=0|r[t+4>>2])))){g=0,m=0;do{if((0|g)>(0|F)|(0|g)==(0|F)&m>>>0>N>>>0)break n;if((0|d)==(0|_)&(0|t)==(0|v)){h=c,d=u;break i}p=0|en(0|(h=0|$t(0|p,0|f,1,0)),0|T(),0|N,0|F),f=0|T(),m=0|$t(0|m,0|g,1,0),g=0|T(),d=0|r[(t=h=i+(p<<3)|0)>>2],t=0|r[t+4>>2]}while(!(!(0|d)&!(0|t)))}if(!(0|_)&!(0|v)){h=c,d=u;break}Je(_,v,a),0|Ct(e,U,a)&&(m=0|$t(0|c,0|u,1,0),u=0|T(),r[(g=h)>>2]=_,r[g+4>>2]=v,r[(c=I+(c<<3)|0)>>2]=_,r[c+4>>2]=v,c=m),h=c,d=u}}while(0);if((y=y+1|0)>>>0>=7)break;c=h,u=d}if(b=0|$t(0|b,0|w,1,0),w=0|T(),E=0|$t(0|E,0|x,1,0),x=0|T(),c=0|r[(u=s)>>2],!((0|x)<(0|(u=0|r[u+4>>2]))|(0|x)==(0|u)&E>>>0<c>>>0))break;c=h,u=d}if((0|u)>0|!(0|u)&c>>>0>0){c=0,u=0;do{r[(x=R+(c<<3)|0)>>2]=0,r[x+4>>2]=0,c=0|$t(0|c,0|u,1,0),u=0|T(),E=0|r[(x=s)+4>>2]}while((0|u)<(0|E)|((0|u)==(0|E)?c>>>0<(0|r[x>>2])>>>0:0))}if(r[(x=s)>>2]=h,r[x+4>>2]=d,!((0|d)>0|!(0|d)&h>>>0>0))break t;y=n,b=P,w=B,E=C,x=I,n=S,P=l,C=M,S=y,l=b,B=L,L=w,M=E,I=R,R=x}Xt(M),Xt(L),Xt(U),l=1;break e}l=h}while(0);Xt(U),Xt(n),Xt(l),l=0}}while(0);return k=A,0|(U=l)}}return Xt(U),k=A,0|(U=l)},_polygonToCellsExperimental:function(e,t,n,s,o,a){s|=0,o|=0,a|=0;var A,l,c,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0;c=k,k=k+160|0,h=c+64|0,p=c+112|0,_=c,function(e,t,n,s){e|=0,t|=0,n|=0,s|=0;var o,a,A,l=0,c=0,u=0,h=0;A=k,k=k+48|0,o=A+40|0,a=A,Fe(c=A+32|0,0,0,0),u=0|r[c>>2],c=0|r[c+4>>2];do{if(n>>>0<=15){if(0|(l=0|Tt(s))){r[(s=a)>>2]=0,r[s+4>>2]=0,r[a+8>>2]=l,r[a+12>>2]=-1,u=a+29|0,r[(s=a+16|0)>>2]=0,r[s+4>>2]=0,r[s+8>>2]=0,i[s+12|0]=0,i[0|u]=0|i[0|o],i[u+1|0]=0|i[o+1|0],i[u+2|0]=0|i[o+2|0];break}if(l=0|Qt(1+(0|r[t+8>>2])|0,32)){St(t,l),r[(h=a)>>2]=u,r[h+4>>2]=c,r[a+8>>2]=0,r[a+12>>2]=n,r[a+16>>2]=s,r[a+20>>2]=t,r[a+24>>2]=l,i[a+28|0]=0,i[0|(u=a+29|0)]=0|i[0|o],i[u+1|0]=0|i[o+1|0],i[u+2|0]=0|i[o+2|0];break}r[(s=a)>>2]=0,r[s+4>>2]=0,r[a+8>>2]=13,r[a+12>>2]=-1,u=a+29|0,r[(s=a+16|0)>>2]=0,r[s+4>>2]=0,r[s+8>>2]=0,i[s+12|0]=0,i[0|u]=0|i[0|o],i[u+1|0]=0|i[o+1|0],i[u+2|0]=0|i[o+2|0];break}r[(u=a)>>2]=0,r[u+4>>2]=0,r[a+8>>2]=4,r[a+12>>2]=-1,h=a+29|0,r[(u=a+16|0)>>2]=0,r[u+4>>2]=0,r[u+8>>2]=0,i[u+12|0]=0,i[0|h]=0|i[0|o],i[h+1|0]=0|i[o+1|0],i[h+2|0]=0|i[o+2|0]}while(0);bt(a),r[e>>2]=r[a>>2],r[e+4>>2]=r[a+4>>2],r[e+8>>2]=r[a+8>>2],r[e+12>>2]=r[a+12>>2],r[e+16>>2]=r[a+16>>2],r[e+20>>2]=r[a+20>>2],r[e+24>>2]=r[a+24>>2],r[e+28>>2]=r[a+28>>2],k=A}(f=c+80|0,e|=0,t|=0,n|=0),nt(h,0|r[(d=f)>>2],0|r[d+4>>2],t),A=0|r[(d=h)>>2],d=0|r[d+4>>2],u=0|r[f+8>>2],r[(g=p+4|0)>>2]=r[f>>2],r[g+4>>2]=r[f+4>>2],r[g+8>>2]=r[f+8>>2],r[g+12>>2]=r[f+12>>2],r[g+16>>2]=r[f+16>>2],r[g+20>>2]=r[f+20>>2],r[g+24>>2]=r[f+24>>2],r[g+28>>2]=r[f+28>>2],r[(g=_)>>2]=A,r[g+4>>2]=d,r[(g=_+8|0)>>2]=u,t=p,n=(e=_+12|0)+36|0;do{r[e>>2]=r[t>>2],e=e+4|0,t=t+4|0}while((0|e)<(0|n));if(r[(p=_+48|0)>>2]=r[h>>2],r[p+4>>2]=r[h+4>>2],r[p+8>>2]=r[h+8>>2],r[p+12>>2]=r[h+12>>2],!(0|A)&!(0|d))return k=c,0|(_=u);n=_+16|0,l=_+24|0,f=_+28|0,u=0,h=0,t=A,e=d;do{if(!((0|u)<(0|o)|(0|u)==(0|o)&h>>>0<s>>>0)){m=4;break}if(d=h,h=0|$t(0|h,0|u,1,0),u=0|T(),r[(d=a+(d<<3)|0)>>2]=t,r[d+4>>2]=e,rt(p),!(0|(t=0|r[(e=p)>>2]))&!(0|(e=0|r[e+4>>2]))){if(bt(n),!(0|(e=0|r[(t=n)>>2]))&!(0|(t=0|r[t+4>>2]))){m=10;break}it(e,t,0|r[f>>2],p),t=0|r[(e=p)>>2],e=0|r[e+4>>2]}r[(d=_)>>2]=t,r[d+4>>2]=e}while(!(!(0|t)&!(0|e)));return 4==(0|m)?(0|(t=0|r[(e=_+40|0)>>2])&&Xt(t),r[(m=_+16|0)>>2]=0,r[m+4>>2]=0,r[l>>2]=0,r[_+36>>2]=0,r[f>>2]=-1,r[_+32>>2]=0,r[e>>2]=0,it(0,0,0,p),r[_>>2]=0,r[_+4>>2]=0,r[g>>2]=0,k=c,0|(_=14)):(10==(0|m)&&(r[_>>2]=0,r[_+4>>2]=0,r[g>>2]=r[l>>2]),_=0|r[g>>2],k=c,0|_)},_readInt64AsDoubleFromPointer:function(e){return+(+((0|r[(e|=0)>>2])>>>0)+4294967296*+(0|r[e+4>>2]))},_res0CellCount:function(){return 122},_round:hn,_sbrk:dn,_sizeOfCellBoundary:function(){return 168},_sizeOfCoordIJ:function(){return 8},_sizeOfGeoLoop:function(){return 8},_sizeOfGeoPolygon:function(){return 16},_sizeOfH3Index:function(){return 8},_sizeOfLatLng:function(){return 16},_sizeOfLinkedGeoPolygon:function(){return 12},_uncompactCells:function(e,t,n,i,s,o,a){e|=0,i|=0,s|=0,o|=0;var A,l=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0;if(A=k,k=k+16|0,g=A,!((0|(n|=0))>0|!(0|n)&(t|=0)>>>0>0))return k=A,0|(g=0);if((0|(a|=0))>=16)return k=A,0|(g=12);f=0,p=0,d=0,l=0;e:for(;;){if(h=0|rn(0|(c=0|r[(u=e+(f<<3)|0)>>2]),0|(u=0|r[u+4>>2]),52),T(),(15&h)>(0|a)){l=12,c=11;break}if(nt(g,c,u,a),!(0|(u=0|r[(h=g)>>2]))&!(0|(h=0|r[h+4>>2])))c=d;else{c=d;do{if(!((0|l)<(0|o)|(0|l)==(0|o)&c>>>0<s>>>0)){c=10;break e}r[(d=i+(c<<3)|0)>>2]=u,r[d+4>>2]=h,c=0|$t(0|c,0|l,1,0),l=0|T(),rt(g),u=0|r[(d=g)>>2],h=0|r[d+4>>2]}while(!(!(0|u)&!(0|h)))}if(f=0|$t(0|f,0|p,1,0),!((0|(p=0|T()))<(0|n)|(0|p)==(0|n)&f>>>0<t>>>0)){l=0,c=11;break}d=c}return 10==(0|c)?(k=A,0|(g=14)):11==(0|c)?(k=A,0|l):0},_uncompactCellsSize:function(e,t,n,i,s){e|=0,t|=0,n|=0,i|=0,s|=0;var o,a,A=0,l=0,c=0,u=0,h=0,d=0;a=k,k=k+16|0,o=a;e:do{if((0|n)>0|!(0|n)&t>>>0>0){for(h=0,l=0,A=0,d=0;;){if(!(!(0|(c=0|r[(u=e+(h<<3)|0)>>2]))&!(0|(u=0|r[u+4>>2]))||(u=!(0|Ge(c,u,i,o)),l=0|$t(0|r[(c=o)>>2],0|r[c+4>>2],0|l,0|A),A=0|T(),u))){A=12;break}if(h=0|$t(0|h,0|d,1,0),!((0|(d=0|T()))<(0|n)|(0|d)==(0|n)&h>>>0<t>>>0))break e}return k=a,0|A}l=0,A=0}while(0);return r[s>>2]=l,r[s+4>>2]=A,k=a,0|(s=0)},_vertexToLatLng:function(e,t,n){n|=0;var i,s,o,a,A=0,l=0;return a=k,k=k+192|0,s=a,o=a+168|0,A=0|rn(0|(e|=0),0|(t|=0),56),T(),A&=7,0|(i=0|qe(e,l=-2130706433&t|134217728,o))?(k=a,0|(l=i)):(t=0|rn(0|e,0|t,52),T(),t&=15,0|ze(e,l)?Ie(o,t,A,1,s):Be(o,t,A,1,s),l=s+8|0,r[n>>2]=r[l>>2],r[n+4>>2]=r[l+4>>2],r[n+8>>2]=r[l+8>>2],r[n+12>>2]=r[l+12>>2],k=a,0|(l=0))},establishStackSpace:function(e,t){k=e|=0},stackAlloc:function(e){var t;return t=k,k=(k=k+(e|=0)|0)+15&-16,0|t},stackRestore:function(e){k=e|=0},stackSave:function(){return 0|k}}}({Math:Math,Int8Array:Int8Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Float32Array:Float32Array,Float64Array:Float64Array},{b:function(e){A=e},c:function(){return A},d:function(e,t,n,i){ie("Assertion failed: "+y(e)+", at: "+[t?y(t):"unknown filename",n,i?y(i):"unknown function"])},e:function(e){return n.___errno_location&&(g[n.___errno_location()>>2]=e),e},f:V,g:function(e,t,n){f.set(f.subarray(t,t+n),e)},h:function(e){var t=V(),n=16777216,i=2130706432;if(e>i)return!1;for(var r=Math.max(t,16777216);r<e;)r=r<=536870912?b(2*r,n):Math.min(b((3*r+2147483648)/4,n),i);return!!function(e){try{var t=new ArrayBuffer(e);if(t.byteLength!=e)return;return new Int8Array(t).set(d),X(t),w(t),1}catch(Ar){}}(r)},i:function(e){ie("OOM")},o:28640,p:28624},h);n.___divdi3=H.___divdi3,n.___muldi3=H.___muldi3,n.___remdi3=H.___remdi3,n.___uremdi3=H.___uremdi3,n._areNeighborCells=H._areNeighborCells,n._bitshift64Ashr=H._bitshift64Ashr,n._bitshift64Lshr=H._bitshift64Lshr,n._bitshift64Shl=H._bitshift64Shl,n._calloc=H._calloc,n._cellAreaKm2=H._cellAreaKm2,n._cellAreaM2=H._cellAreaM2,n._cellAreaRads2=H._cellAreaRads2,n._cellToBoundary=H._cellToBoundary,n._cellToCenterChild=H._cellToCenterChild,n._cellToChildPos=H._cellToChildPos,n._cellToChildren=H._cellToChildren,n._cellToChildrenSize=H._cellToChildrenSize,n._cellToLatLng=H._cellToLatLng,n._cellToLocalIj=H._cellToLocalIj,n._cellToParent=H._cellToParent,n._cellToVertex=H._cellToVertex,n._cellToVertexes=H._cellToVertexes,n._cellsToDirectedEdge=H._cellsToDirectedEdge,n._cellsToLinkedMultiPolygon=H._cellsToLinkedMultiPolygon,n._childPosToCell=H._childPosToCell,n._compactCells=H._compactCells,n._constructCell=H._constructCell,n._destroyLinkedMultiPolygon=H._destroyLinkedMultiPolygon,n._directedEdgeToBoundary=H._directedEdgeToBoundary,n._directedEdgeToCells=H._directedEdgeToCells,n._edgeLengthKm=H._edgeLengthKm,n._edgeLengthM=H._edgeLengthM,n._edgeLengthRads=H._edgeLengthRads;var X=n._emscripten_replace_memory=H._emscripten_replace_memory;n._free=H._free,n._getBaseCellNumber=H._getBaseCellNumber,n._getDirectedEdgeDestination=H._getDirectedEdgeDestination,n._getDirectedEdgeOrigin=H._getDirectedEdgeOrigin,n._getHexagonAreaAvgKm2=H._getHexagonAreaAvgKm2,n._getHexagonAreaAvgM2=H._getHexagonAreaAvgM2,n._getHexagonEdgeLengthAvgKm=H._getHexagonEdgeLengthAvgKm,n._getHexagonEdgeLengthAvgM=H._getHexagonEdgeLengthAvgM,n._getIcosahedronFaces=H._getIcosahedronFaces,n._getIndexDigit=H._getIndexDigit,n._getNumCells=H._getNumCells,n._getPentagons=H._getPentagons,n._getRes0Cells=H._getRes0Cells,n._getResolution=H._getResolution,n._greatCircleDistanceKm=H._greatCircleDistanceKm,n._greatCircleDistanceM=H._greatCircleDistanceM,n._greatCircleDistanceRads=H._greatCircleDistanceRads,n._gridDisk=H._gridDisk,n._gridDiskDistances=H._gridDiskDistances,n._gridDistance=H._gridDistance,n._gridPathCells=H._gridPathCells,n._gridPathCellsSize=H._gridPathCellsSize,n._gridRing=H._gridRing,n._gridRingUnsafe=H._gridRingUnsafe,n._i64Add=H._i64Add,n._i64Subtract=H._i64Subtract,n._isPentagon=H._isPentagon,n._isResClassIII=H._isResClassIII,n._isValidCell=H._isValidCell,n._isValidDirectedEdge=H._isValidDirectedEdge,n._isValidIndex=H._isValidIndex,n._isValidVertex=H._isValidVertex,n._latLngToCell=H._latLngToCell,n._llvm_ctlz_i64=H._llvm_ctlz_i64,n._llvm_maxnum_f64=H._llvm_maxnum_f64,n._llvm_minnum_f64=H._llvm_minnum_f64,n._llvm_round_f64=H._llvm_round_f64,n._localIjToCell=H._localIjToCell,n._malloc=H._malloc,n._maxFaceCount=H._maxFaceCount,n._maxGridDiskSize=H._maxGridDiskSize,n._maxPolygonToCellsSize=H._maxPolygonToCellsSize,n._maxPolygonToCellsSizeExperimental=H._maxPolygonToCellsSizeExperimental,n._memcpy=H._memcpy,n._memset=H._memset,n._originToDirectedEdges=H._originToDirectedEdges,n._pentagonCount=H._pentagonCount,n._polygonToCells=H._polygonToCells,n._polygonToCellsExperimental=H._polygonToCellsExperimental,n._readInt64AsDoubleFromPointer=H._readInt64AsDoubleFromPointer,n._res0CellCount=H._res0CellCount,n._round=H._round,n._sbrk=H._sbrk,n._sizeOfCellBoundary=H._sizeOfCellBoundary,n._sizeOfCoordIJ=H._sizeOfCoordIJ,n._sizeOfGeoLoop=H._sizeOfGeoLoop,n._sizeOfGeoPolygon=H._sizeOfGeoPolygon,n._sizeOfH3Index=H._sizeOfH3Index,n._sizeOfLatLng=H._sizeOfLatLng,n._sizeOfLinkedGeoPolygon=H._sizeOfLinkedGeoPolygon,n._uncompactCells=H._uncompactCells,n._uncompactCellsSize=H._uncompactCellsSize,n._vertexToLatLng=H._vertexToLatLng,n.establishStackSpace=H.establishStackSpace;var Q,$,Y=n.stackAlloc=H.stackAlloc,K=n.stackRestore=H.stackRestore,Z=n.stackSave=H.stackSave;if(n.asm=H,n.cwrap=function(e,t,n,i){var r=(n=n||[]).every(function(e){return"number"===e});return"string"!==t&&r&&!i?c(e):function(){return u(e,t,n,arguments)}},n.setValue=function(e,t,n,i){switch("*"===(n=n||"i8").charAt(n.length-1)&&(n="i32"),n){case"i1":case"i8":d[e|0]=t;break;case"i16":p[e>>1]=t;break;case"i32":g[e>>2]=t;break;case"i64":F=[t>>>0,(N=t,+M(N)>=1?N>0?(0|B(+L(N/4294967296),4294967295))>>>0:~~+k((N-+(~~N>>>0))/4294967296)>>>0:0)],g[e>>2]=F[0],g[e+4>>2]=F[1];break;case"float":m[e>>2]=t;break;case"double":_[e>>3]=t;break;default:ie("invalid type for setValue: "+n)}},n.getValue=function(e,t,n){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return d[e|0];case"i16":return p[e>>1];case"i32":case"i64":return g[e>>2];case"float":return m[e>>2];case"double":return _[e>>3];default:ie("invalid type for getValue: "+t)}return null},U){z(U)||(Q=U,U=n.locateFile?n.locateFile(Q,s):s+Q),D++,n.monitorRunDependencies&&n.monitorRunDependencies(D);var q=function(e){e.byteLength&&(e=new Uint8Array(e)),f.set(e,8),n.memoryInitializerRequest&&delete n.memoryInitializerRequest.response,function(){if(D--,n.monitorRunDependencies&&n.monitorRunDependencies(D),0==D&&O){var e=O;O=null,e()}}()},J=function(){r(U,q,function(){throw"could not load memory initializer "+U})},ee=j(U);if(ee)q(ee.buffer);else if(n.memoryInitializerRequest){var te=function(){var e=n.memoryInitializerRequest,t=e.response;if(200!==e.status&&0!==e.status){var i=j(n.memoryInitializerRequestURL);if(!i)return void J();t=i.buffer}q(t)};n.memoryInitializerRequest.response?setTimeout(te,0):n.memoryInitializerRequest.addEventListener("load",te)}else J()}function ne(e){function t(){$||($=!0,l||(x(S),x(C),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)I(n.postRun.shift());x(P)}()))}D>0||(!function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)R(n.preRun.shift());x(T)}(),D>0||(n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),t()},1)):t()))}function ie(e){throw n.onAbort&&n.onAbort(e),o(e+=""),a(e),l=!0,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(O=function e(){$||ne(),$||(O=e)},n.run=ne,n.abort=ie,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return ne(),e}("object"==typeof hm?hm:{}),dm="number",fm={0:"Success",1:"The operation failed but a more specific error is not available",2:"Argument was outside of acceptable range",3:"Latitude or longitude arguments were outside of acceptable range",4:"Resolution argument was outside of acceptable range",5:"Cell argument was not valid",6:"Directed edge argument was not valid",7:"Undirected edge argument was not valid",8:"Vertex argument was not valid",9:"Pentagon distortion was encountered",10:"Duplicate input",11:"Cell arguments were not neighbors",12:"Cell arguments had incompatible resolutions",13:"Memory allocation failed",14:"Bounds of provided memory were insufficient",15:"Mode or flags argument was not valid",16:"Index argument was not valid",17:"Base cell number was outside of acceptable range",18:"Child indexing digits invalid",19:"Child indexing digits refer to a deleted subsequence"},pm={1e3:"Unknown unit",1001:"Array length out of bounds",1002:"Got unexpected null value for H3 index"};function gm(e,t,n){var i=n&&"value"in n,r=new Error((e[t]||"Unknown error")+" (code: "+t+(i?", value: "+n.value:"")+")");return r.code=t,r}function mm(e,t){return gm(fm,e,2===arguments.length?{value:t}:{})}function _m(e,t){return gm(pm,e,2===arguments.length?{value:t}:{})}function vm(e){if(0!==e)throw mm(e)}var ym={};[["sizeOfH3Index",dm],["sizeOfLatLng",dm],["sizeOfCellBoundary",dm],["sizeOfGeoLoop",dm],["sizeOfGeoPolygon",dm],["sizeOfLinkedGeoPolygon",dm],["sizeOfCoordIJ",dm],["readInt64AsDoubleFromPointer",dm],["isValidCell",dm,[dm,dm]],["isValidIndex",dm,[dm,dm]],["latLngToCell",dm,[dm,dm,dm,dm]],["cellToLatLng",dm,[dm,dm,dm]],["cellToBoundary",dm,[dm,dm,dm]],["maxGridDiskSize",dm,[dm,dm]],["gridDisk",dm,[dm,dm,dm,dm]],["gridDiskDistances",dm,[dm,dm,dm,dm,dm]],["gridRing",dm,[dm,dm,dm,dm]],["gridRingUnsafe",dm,[dm,dm,dm,dm]],["maxPolygonToCellsSize",dm,[dm,dm,dm,dm]],["polygonToCells",dm,[dm,dm,dm,dm]],["maxPolygonToCellsSizeExperimental",dm,[dm,dm,dm,dm]],["polygonToCellsExperimental",dm,[dm,dm,dm,dm,dm,dm]],["cellsToLinkedMultiPolygon",dm,[dm,dm,dm]],["destroyLinkedMultiPolygon",null,[dm]],["compactCells",dm,[dm,dm,dm,dm]],["uncompactCells",dm,[dm,dm,dm,dm,dm,dm]],["uncompactCellsSize",dm,[dm,dm,dm,dm,dm]],["isPentagon",dm,[dm,dm]],["isResClassIII",dm,[dm,dm]],["getBaseCellNumber",dm,[dm,dm]],["getResolution",dm,[dm,dm]],["getIndexDigit",dm,[dm,dm,dm]],["constructCell",dm,[dm,dm,dm,dm]],["maxFaceCount",dm,[dm,dm,dm]],["getIcosahedronFaces",dm,[dm,dm,dm]],["cellToParent",dm,[dm,dm,dm,dm]],["cellToChildren",dm,[dm,dm,dm,dm]],["cellToCenterChild",dm,[dm,dm,dm,dm]],["cellToChildrenSize",dm,[dm,dm,dm,dm]],["cellToChildPos",dm,[dm,dm,dm,dm]],["childPosToCell",dm,[dm,dm,dm,dm,dm,dm]],["areNeighborCells",dm,[dm,dm,dm,dm,dm]],["cellsToDirectedEdge",dm,[dm,dm,dm,dm,dm]],["getDirectedEdgeOrigin",dm,[dm,dm,dm]],["getDirectedEdgeDestination",dm,[dm,dm,dm]],["isValidDirectedEdge",dm,[dm,dm]],["directedEdgeToCells",dm,[dm,dm,dm]],["originToDirectedEdges",dm,[dm,dm,dm]],["directedEdgeToBoundary",dm,[dm,dm,dm]],["gridDistance",dm,[dm,dm,dm,dm,dm]],["gridPathCells",dm,[dm,dm,dm,dm,dm]],["gridPathCellsSize",dm,[dm,dm,dm,dm,dm]],["cellToLocalIj",dm,[dm,dm,dm,dm,dm,dm]],["localIjToCell",dm,[dm,dm,dm,dm,dm]],["getHexagonAreaAvgM2",dm,[dm,dm]],["getHexagonAreaAvgKm2",dm,[dm,dm]],["getHexagonEdgeLengthAvgM",dm,[dm,dm]],["getHexagonEdgeLengthAvgKm",dm,[dm,dm]],["greatCircleDistanceM",dm,[dm,dm]],["greatCircleDistanceKm",dm,[dm,dm]],["greatCircleDistanceRads",dm,[dm,dm]],["cellAreaM2",dm,[dm,dm,dm]],["cellAreaKm2",dm,[dm,dm,dm]],["cellAreaRads2",dm,[dm,dm,dm]],["edgeLengthM",dm,[dm,dm,dm]],["edgeLengthKm",dm,[dm,dm,dm]],["edgeLengthRads",dm,[dm,dm,dm]],["getNumCells",dm,[dm,dm]],["getRes0Cells",dm,[dm]],["res0CellCount",dm],["getPentagons",dm,[dm,dm]],["pentagonCount",dm],["cellToVertex",dm,[dm,dm,dm,dm]],["cellToVertexes",dm,[dm,dm,dm]],["vertexToLatLng",dm,[dm,dm,dm]],["isValidVertex",dm,[dm,dm]]].forEach(function(e){ym[e[0]]=hm.cwrap.apply(hm,e)});var bm=16,wm=ym.sizeOfH3Index(),Em=ym.sizeOfLatLng(),xm=ym.sizeOfCellBoundary();ym.sizeOfGeoPolygon(),ym.sizeOfGeoLoop(),ym.sizeOfLinkedGeoPolygon(),ym.sizeOfCoordIJ();var Tm="m",Sm="km";var Cm=/[^0-9a-fA-F]/;function Pm(e){if(Array.isArray(e)&&2===e.length&&Number.isInteger(e[0])&&Number.isInteger(e[1]))return e;if("string"!=typeof e||Cm.test(e))return[0,0];var t=parseInt(e.substring(0,e.length-8),bm);return[parseInt(e.substring(e.length-8),bm),t]}function Rm(e){if(e>=0)return e.toString(bm);var t=Im(8,(e&=2147483647).toString(bm));return t=(parseInt(t[0],bm)+8).toString(bm)+t.substring(1)}function Im(e,t){for(var n=e-t.length,i="",r=0;r<n;r++)i+="0";return i+=t}function Mm(e,t){void 0===t&&(t=0);var n=hm.getValue(e+wm*t,"i32"),i=hm.getValue(e+wm*t+4,"i32");return i?function(e,t){return Rm(t)+Im(8,Rm(e))}(n,i):null}function km(e){return 180*hm.getValue(e,"double")/Math.PI}function Lm(e){return[km(e+8),km(e)]}function Bm(e){var t=Pm(e),n=t[0],i=t[1];return Boolean(ym.isPentagon(n,i))}function Dm(e){var t=Pm(e),n=t[0],i=t[1];return ym.isValidCell(n,i)?ym.getResolution(n,i):-1}function Om(e,t,n){var i=hm._malloc(Em);hm.HEAPF64.set([e,t].map(zm),i/8);var r=hm._malloc(wm);try{return vm(ym.latLngToCell(i,n,r)),function(e){if(!e)throw _m(1002);return e}(Mm(r))}finally{hm._free(r),hm._free(i)}}function Nm(e){var t,n=hm._malloc(Em),i=Pm(e),r=i[0],s=i[1];try{return vm(ym.cellToLatLng(r,s,n)),[km(t=n),km(t+8)]}finally{hm._free(n)}}function Fm(e,t){var n=hm._malloc(xm),i=Pm(e),r=i[0],s=i[1];try{return vm(ym.cellToBoundary(r,s,n)),function(e){for(var t=hm.getValue(e,"i32"),n=e+8,i=[],r=Lm,s=0;s<2*t;s+=2)i.push(r(n+8*s));return i.push(i[0]),i}(n)}finally{hm._free(n)}}function Um(e,t){var n,i=Pm(e),r=i[0],s=i[1],o=Pm(t),a=o[0],A=o[1],l=hm._malloc(8);try{return vm(ym.gridDistance(r,s,a,A,l)),n=l,ym.readInt64AsDoubleFromPointer(n)}finally{hm._free(l)}}function Gm(e,t){!function(e){if("number"!=typeof e||e<0||e>15||Math.floor(e)!==e)throw mm(4,e)}(e);var n,i,r=hm._malloc(8);try{switch(t){case Tm:vm(ym.getHexagonEdgeLengthAvgM(e,r));break;case Sm:vm(ym.getHexagonEdgeLengthAvgKm(e,r));break;default:throw _m(1e3,t)}return n=r,void 0===i&&(i=0),hm.getValue(n+8*i,"double")}finally{hm._free(r)}}function zm(e){return e*Math.PI/180}function Vm(e,t){t=void 0===t?e[0][0]:t;for(const n of e){const e=n[0]-t;e>180?n[0]-=360:e<-180&&(n[0]+=360)}}function Wm(e,t,n){const i=e(t,n),[r,s]=Nm(i);return[s,r]}function jm(e,t=1){const n=Fm(e);return 1!==t?function(e,t,n){const[i,r]=Nm(e),s=t.length;Vm(t,r);const o=t[0]===t[s-1]?s-1:s;for(let a=0;a<o;a++)t[a][0]=To(r,t[a][0],n),t[a][1]=To(i,t[a][1],n)}(e,n,t):Vm(n),n}const Hm={...um.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:e=>e.hexagon},extruded:!0};class Xm extends Np{initializeState(){Xm._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:t}){if(!0!==e.highPrecision&&(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagon)){const e=this._calculateH3DataProps();this.setState(e)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,t=!1,n=!1;const{iterable:i,objectInfo:r}=Rf(this.props.data);for(const s of i){r.index++;const i=this.props.getHexagon(s,r),o=Dm(i);if(e<0){if(e=o,!this.props.highPrecision)break}else if(e!==o){n=!0;break}if(Bm(i)){t=!0;break}}return{resolution:e,edgeLengthKM:e>=0?Gm(e,"km"):0,hasMultipleRes:n,hasPentagon:t}}_shouldUseHighPrecision(){if("auto"===this.props.highPrecision){const{resolution:e,hasPentagon:t,hasMultipleRes:n}=this.state,{viewport:i}=this.context;return Boolean(null==i?void 0:i.resolution)||n||t||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:t,edgeLengthKM:n,centerHex:i}=this.state;if(t<0)return;const r=this.props.centerHexagon||Om(e.latitude,e.longitude,t);if(i===r)return;if(i)try{if(Um(i,r)*n<10)return}catch{}const{unitsPerMeter:s}=e.distanceScales;let o=jm(r);const[a,A]=Nm(r),[l,c]=e.projectFlat([A,a]);o=o.map(t=>{const n=e.projectFlat(t);return[(n[0]-l)/s[0],(n[1]-c)/s[1]]}),this.setState({centerHex:r,vertices:o})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:t,coverage:n,extruded:i,wireframe:r,stroked:s,filled:o,lineWidthUnits:a,lineWidthScale:A,lineWidthMinPixels:l,lineWidthMaxPixels:c,getFillColor:u,getElevation:h,getLineColor:d,getLineWidth:f,transitions:p,updateTriggers:g}=this.props;return{elevationScale:e,extruded:i,coverage:n,wireframe:r,stroked:s,filled:o,lineWidthUnits:a,lineWidthScale:A,lineWidthMinPixels:l,lineWidthMaxPixels:c,material:t,getElevation:h,getFillColor:u,getLineColor:d,getLineWidth:f,transitions:p,updateTriggers:{getFillColor:g.getFillColor,getElevation:g.getElevation,getLineColor:g.getLineColor,getLineWidth:g.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:t,updateTriggers:n,coverage:i}=this.props,r=this.getSubLayerClass("hexagon-cell-hifi",um),s=this._getForwardProps();return s.updateTriggers.getPolygon=function(e,t){let n;return n=null==e?t:"object"==typeof e?{...e,coverage:t}:{getHexagon:e,coverage:t},n}(n.getHexagon,i),new r(s,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:s.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(e,n)=>function(e){const t=new Float64Array(2*e.length);let n=0;for(const i of e)t[n++]=i[0],t[n++]=i[1];return t}(jm(t(e,n),i))})}_renderColumnLayer(){const{data:e,getHexagon:t,updateTriggers:n}=this.props,i=this.getSubLayerClass("hexagon-cell",Pg),r=this._getForwardProps();return r.updateTriggers.getPosition=n.getHexagon,new i(r,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:r.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:Wm.bind(null,t)})}}Xm.defaultProps=Hm,Xm.layerName="H3HexagonLayer",Xm._checkH3Lib=()=>{};const Qm=s.createContext(null);function $m(e,t){if(e===t)return!0;if(!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!$m(e[n],t[n]))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(const r of n){if(!t.hasOwnProperty(r))return!1;if(!$m(e[r],t[r]))return!1}return!0}return!1}function Ym(e){return{longitude:e.center.lng,latitude:e.center.lat,zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,padding:e.padding}}function Km(e,t){const n=t.viewState||t,i={};if("longitude"in n&&"latitude"in n&&(n.longitude!==e.center.lng||n.latitude!==e.center.lat)){const t=e.center.constructor;i.center=new t(n.longitude,n.latitude)}return"zoom"in n&&n.zoom!==e.zoom&&(i.zoom=n.zoom),"bearing"in n&&n.bearing!==e.bearing&&(i.bearing=n.bearing),"pitch"in n&&n.pitch!==e.pitch&&(i.pitch=n.pitch),n.padding&&e.padding&&!$m(n.padding,e.padding)&&(i.padding=n.padding),i}const Zm=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qm(e){if(!e)return null;if("string"==typeof e)return e;if("toJS"in e&&(e=e.toJS()),!e.layers)return e;const t={};for(const i of e.layers)t[i.id]=i;const n=e.layers.map(e=>{let n=null;"interactive"in e&&(n=Object.assign({},e),delete n.interactive);const i=t[e.ref];if(i){n=n||Object.assign({},e),delete n.ref;for(const e of Zm)e in i&&(n[e]=i[e])}return n||e});return{...e,layers:n}}const Jm={version:8,sources:{},layers:[]},e_={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},t_={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},n_={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},i_=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],r_=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class s_{constructor(e,t,n){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=e=>{const t=this.props[n_[e.type]];t?t(e):e.type},this._onCameraEvent=e=>{if(this._internalUpdate)return;e.viewState=this._propsedCameraUpdate||Ym(this._map.transform);const t=this.props[t_[e.type]];t&&t(e)},this._onCameraUpdate=e=>this._internalUpdate?e:(this._propsedCameraUpdate=Ym(e),Km(e,this.props)),this._onPointerEvent=e=>{"mousemove"!==e.type&&"mouseout"!==e.type||this._updateHover(e);const t=this.props[e_[e.type]];t&&(this.props.interactiveLayerIds&&"mouseover"!==e.type&&"mouseout"!==e.type&&(e.features=this._hoveredFeatures||this._queryRenderedFeatures(e.point)),t(e),delete e.features)},this._MapClass=e,this.props=t,this._initialize(n)}get map(){return this._map}setProps(e){const t=this.props;this.props=e;const n=this._updateSettings(e,t),i=this._updateSize(e),r=this._updateViewState(e);this._updateStyle(e,t),this._updateStyleComponents(e),this._updateHandlers(e,t),(n||i||r&&!this._map.isMoving())&&this.redraw()}static reuse(e,t){const n=s_.savedMaps.pop();if(!n)return null;const i=n.map,r=i.getContainer();for(t.className=r.className;r.childNodes.length>0;)t.appendChild(r.childNodes[0]);i._container=t;const s=i._resizeObserver;s&&(s.disconnect(),s.observe(t)),n.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:o}=e;return o&&(o.bounds?i.fitBounds(o.bounds,{...o.fitBoundsOptions,duration:0}):n._updateViewState(o)),i.isStyleLoaded()?i.fire("load"):i.once("style.load",()=>i.fire("load")),i._update(),n}_initialize(e){const{props:t}=this,{mapStyle:n=Jm}=t,i={...t,...t.initialViewState,container:e,style:qm(n)},r=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),t.gl){const e=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=e,t.gl)}const s=new this._MapClass(i);r.padding&&s.setPadding(r.padding),t.cursor&&(s.getCanvas().style.cursor=t.cursor),s.transformCameraUpdate=this._onCameraUpdate,s.on("style.load",()=>{var e;this._styleComponents={light:s.getLight(),sky:s.getSky(),projection:null==(e=s.getProjection)?void 0:e.call(s),terrain:s.getTerrain()},this._updateStyleComponents(this.props)}),s.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const o in e_)s.on(o,this._onPointerEvent);for(const o in t_)s.on(o,this._onCameraEvent);for(const o in n_)s.on(o,this._onEvent);this._map=s}recycle(){const e=this.map.getContainer().querySelector("[mapboxgl-children]");null==e||e.remove(),s_.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:t}=e;if(t){const e=this._map;if(t.width!==e.transform.width||t.height!==e.transform.height)return e.resize(),!0}return!1}_updateViewState(e){const t=this._map,n=t.transform;if(!t.isMoving()){const i=Km(n,e);if(Object.keys(i).length>0)return this._internalUpdate=!0,t.jumpTo(i),this._internalUpdate=!1,!0}return!1}_updateSettings(e,t){const n=this._map;let i=!1;for(const r of i_)if(r in e&&!$m(e[r],t[r])){i=!0;const t=n[`set${r[0].toUpperCase()}${r.slice(1)}`];null==t||t.call(n,e[r])}return i}_updateStyle(e,t){if(e.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==t.mapStyle){const{mapStyle:t=Jm,styleDiffing:n=!0}=e,i={diff:n};"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(qm(t),i)}}_updateStyleComponents({light:e,projection:t,sky:n,terrain:i}){var r,s;const o=this._map,a=this._styleComponents;o.style._loaded&&(e&&!$m(e,a.light)&&(a.light=e,o.setLight(e)),t&&!$m(t,a.projection)&&t!==(null==(r=a.projection)?void 0:r.type)&&(a.projection="string"==typeof t?{type:t}:t,null==(s=o.setProjection)||s.call(o,a.projection)),n&&!$m(n,a.sky)&&(a.sky=n,o.setSky(n)),void 0===i||$m(i,a.terrain)||i&&!o.getSource(i.source)||(a.terrain=i,o.setTerrain(i)))}_updateHandlers(e,t){const n=this._map;for(const i of r_){const r=e[i]??!0;$m(r,t[i]??!0)||(r?n[i].enable(r):n[i].disable())}}_queryRenderedFeatures(e){const t=this._map,{interactiveLayerIds:n=[]}=this.props;try{return t.queryRenderedFeatures(e,{layers:n.filter(t.getLayer.bind(t))})}catch{return[]}}_updateHover(e){var t;const{props:n}=this;if(n.interactiveLayerIds&&(n.onMouseMove||n.onMouseEnter||n.onMouseLeave)){const n=e.type,i=(null==(t=this._hoveredFeatures)?void 0:t.length)>0,r=this._queryRenderedFeatures(e.point),s=r.length>0;!s&&i&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=r,s&&!i&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=n}else this._hoveredFeatures=null}}s_.savedMaps=[];const o_=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function a_(e){if(!e)return null;const t=e.map,n={getMap:()=>t};for(const i of function(e){const t=new Set;let n=e;for(;n;){for(const i of Object.getOwnPropertyNames(n))"_"!==i[0]&&"function"==typeof e[i]&&"fire"!==i&&"setEventedParent"!==i&&t.add(i);n=Object.getPrototypeOf(n)}return Array.from(t)}(t))i in n||o_.includes(i)||(n[i]=t[i].bind(t));return n}const A_="undefined"!=typeof document?s.useLayoutEffect:s.useEffect;const l_=s.createContext(null);const c_=s.forwardRef(function(e,t){const n=s.useContext(Qm),[i,r]=s.useState(null),o=s.useRef(),{current:a}=s.useRef({mapLib:null,map:null});s.useEffect(()=>{const t=e.mapLib;let i,s=!0;return Promise.resolve(t||A(()=>import("./maplibre-gl-Buh2kDHp.js").then(e=>e.m),__vite__mapDeps([0,1]))).then(t=>{if(!s)return;if(!t)throw new Error("Invalid mapLib");const A="Map"in t?t:t.default;if(!A.Map)throw new Error("Invalid mapLib");!function(e,t){const{RTLTextPlugin:n,maxParallelImageRequests:i,workerCount:r,workerUrl:s}=t;if(n&&e.getRTLTextPluginStatus&&"unavailable"===e.getRTLTextPluginStatus()){const{pluginUrl:t,lazy:i=!0}="string"==typeof n?{pluginUrl:n}:n;e.setRTLTextPlugin(t,e=>{},i)}void 0!==i&&e.setMaxParallelImageRequests(i),void 0!==r&&e.setWorkerCount(r),void 0!==s&&e.setWorkerUrl(s)}(A,e),e.reuseMaps&&(i=s_.reuse(e,o.current)),i||(i=new s_(A.Map,e,o.current)),a.map=a_(i),a.mapLib=A,r(i),null==n||n.onMapMount(a.map,e.id)}).catch(t=>{const{onError:n}=e;n&&n({type:"error",target:null,originalEvent:null,error:t})}),()=>{s=!1,i&&(null==n||n.onMapUnmount(e.id),e.reuseMaps?i.recycle():i.destroy())}},[]),A_(()=>{i&&i.setProps(e)}),s.useImperativeHandle(t,()=>a.map,[i]);const l=s.useMemo(()=>({position:"relative",width:"100%",height:"100%",...e.style}),[e.style]);return s.createElement("div",{id:e.id,ref:o,style:l},i&&s.createElement(l_.Provider,{value:a},s.createElement("div",{"mapboxgl-children":"",style:{height:"100%"}},e.children)))}),u_=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function h_(e,t){if(!e||!t)return;const n=e.style;for(const i in t){const e=t[i];Number.isFinite(e)&&!u_.test(i)?n[i]=`${e}px`:n[i]=e}}function d_(e,t){if(e===t)return null;const n=f_(e),i=f_(t),r=[];for(const s of i)n.has(s)||r.push(s);for(const s of n)i.has(s)||r.push(s);return 0===r.length?null:r}function f_(e){return new Set(e?e.trim().split(/\s+/):[])}function p_(e,t,n,i){const r=s.useContext(l_),o=s.useMemo(()=>e(r),[]);return s.useEffect(()=>{const e=t,n=null,i="function"==typeof t?t:null,{map:s}=r;return s.hasControl(o)||(s.addControl(o,null==e?void 0:e.position),n&&n(r)),()=>{i&&i(r),s.hasControl(o)&&s.removeControl(o)}},[]),o}s.memo(s.forwardRef((e,t)=>{const{map:n,mapLib:i}=s.useContext(l_),r=s.useRef({props:e}),o=s.useMemo(()=>{let t=!1;s.Children.forEach(e.children,e=>{e&&(t=!0)});const n={...e,element:t?document.createElement("div"):void 0},a=new i.Marker(n);return a.setLngLat([e.longitude,e.latitude]),a.getElement().addEventListener("click",e=>{var t,n;null==(n=(t=r.current.props).onClick)||n.call(t,{type:"click",target:a,originalEvent:e})}),a.on("dragstart",e=>{var t,n;const i=e;i.lngLat=o.getLngLat(),null==(n=(t=r.current.props).onDragStart)||n.call(t,i)}),a.on("drag",e=>{var t,n;const i=e;i.lngLat=o.getLngLat(),null==(n=(t=r.current.props).onDrag)||n.call(t,i)}),a.on("dragend",e=>{var t,n;const i=e;i.lngLat=o.getLngLat(),null==(n=(t=r.current.props).onDragEnd)||n.call(t,i)}),a},[]);s.useEffect(()=>(o.addTo(n.getMap()),()=>{o.remove()}),[]);const{longitude:A,latitude:l,offset:c,style:u,draggable:h=!1,popup:d=null,rotation:f=0,rotationAlignment:p="auto",pitchAlignment:g="auto"}=e;s.useEffect(()=>{h_(o.getElement(),u)},[u]),s.useImperativeHandle(t,()=>o,[]);const m=r.current.props;o.getLngLat().lng===A&&o.getLngLat().lat===l||o.setLngLat([A,l]),c&&!function(e,t){const n=Array.isArray(e)?e[0]:e?e.x:0,i=Array.isArray(e)?e[1]:e?e.y:0,r=Array.isArray(t)?t[0]:t?t.x:0,s=Array.isArray(t)?t[1]:t?t.y:0;return n===r&&i===s}(o.getOffset(),c)&&o.setOffset(c),o.isDraggable()!==h&&o.setDraggable(h),o.getRotation()!==f&&o.setRotation(f),o.getRotationAlignment()!==p&&o.setRotationAlignment(p),o.getPitchAlignment()!==g&&o.setPitchAlignment(g),o.getPopup()!==d&&o.setPopup(d);const _=d_(m.className,e.className);if(_)for(const s of _)o.toggleClassName(s);return r.current.props=e,a.createPortal(e.children,o.getElement())})),s.memo(s.forwardRef((e,t)=>{const{map:n,mapLib:i}=s.useContext(l_),r=s.useMemo(()=>document.createElement("div"),[]),o=s.useRef({props:e}),A=s.useMemo(()=>{const t={...e},n=new i.Popup(t);return n.setLngLat([e.longitude,e.latitude]),n.once("open",e=>{var t,n;null==(n=(t=o.current.props).onOpen)||n.call(t,e)}),n},[]);if(s.useEffect(()=>{const e=e=>{var t,n;null==(n=(t=o.current.props).onClose)||n.call(t,e)};return A.on("close",e),A.setDOMContent(r).addTo(n.getMap()),()=>{A.off("close",e),A.isOpen()&&A.remove()}},[]),s.useEffect(()=>{h_(A.getElement(),e.style)},[e.style]),s.useImperativeHandle(t,()=>A,[]),A.isOpen()){const t=o.current.props;A.getLngLat().lng===e.longitude&&A.getLngLat().lat===e.latitude||A.setLngLat([e.longitude,e.latitude]),e.offset&&!$m(t.offset,e.offset)&&A.setOffset(e.offset),t.anchor===e.anchor&&t.maxWidth===e.maxWidth||(A.options.anchor=e.anchor,A.setMaxWidth(e.maxWidth));const n=d_(t.className,e.className);if(n)for(const e of n)A.toggleClassName(e);o.current.props=e}return a.createPortal(e.children,r)})),s.memo(function(e){const t=p_(({mapLib:t})=>new t.AttributionControl(e),{position:e.position});return s.useEffect(()=>{h_(t._container,e.style)},[e.style]),null}),s.memo(function(e){const t=p_(({mapLib:t})=>new t.FullscreenControl({container:e.containerId&&document.getElementById(e.containerId)}),{position:e.position});return s.useEffect(()=>{h_(t._controlContainer,e.style)},[e.style]),null}),s.memo(s.forwardRef(function(e,t){const n=s.useRef({props:e}),i=p_(({mapLib:t})=>{const i=new t.GeolocateControl(e),r=i._setupUI;return i._setupUI=()=>{i._container.hasChildNodes()||r()},i.on("geolocate",e=>{var t,i;null==(i=(t=n.current.props).onGeolocate)||i.call(t,e)}),i.on("error",e=>{var t,i;null==(i=(t=n.current.props).onError)||i.call(t,e)}),i.on("outofmaxbounds",e=>{var t,i;null==(i=(t=n.current.props).onOutOfMaxBounds)||i.call(t,e)}),i.on("trackuserlocationstart",e=>{var t,i;null==(i=(t=n.current.props).onTrackUserLocationStart)||i.call(t,e)}),i.on("trackuserlocationend",e=>{var t,i;null==(i=(t=n.current.props).onTrackUserLocationEnd)||i.call(t,e)}),i},{position:e.position});return n.current.props=e,s.useImperativeHandle(t,()=>i,[]),s.useEffect(()=>{h_(i._container,e.style)},[e.style]),null})),s.memo(function(e){const t=p_(({mapLib:t})=>new t.NavigationControl(e),{position:e.position});return s.useEffect(()=>{h_(t._container,e.style)},[e.style]),null}),s.memo(function(e){const t=p_(({mapLib:t})=>new t.ScaleControl(e),{position:e.position}),n=s.useRef(e),i=n.current;n.current=e;const{style:r}=e;return void 0!==e.maxWidth&&e.maxWidth!==i.maxWidth&&(t.options.maxWidth=e.maxWidth),void 0!==e.unit&&e.unit!==i.unit&&t.setUnit(e.unit),s.useEffect(()=>{h_(t._container,r)},[r]),null}),s.memo(function(e){const t=p_(({mapLib:t})=>new t.TerrainControl(e),{position:e.position});return s.useEffect(()=>{h_(t._container,e.style)},[e.style]),null}),s.memo(function(e){const t=p_(({mapLib:t})=>new t.LogoControl(e),{position:e.position});return s.useEffect(()=>{h_(t._container,e.style)},[e.style]),null});const g_=new Float32Array(12);function m_(e,t=2){let n=0;for(const i of e)for(let e=0;e<t;e++)g_[n++]=i[e]||0;return g_}const __="uniform triangleUniforms {\n  float aggregationMode;\n  vec2 colorDomain;\n  float intensity;\n  float threshold;\n} triangle;\n",v_={name:"triangle",vs:__,fs:__,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class y_ extends Op{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME heatp-map-layer-vertex-shader\nuniform sampler2D maxTexture;\nin vec3 positions;\nin vec2 texCoords;\nout vec2 vTexCoords;\nout float vIntensityMin;\nout float vIntensityMax;\nvoid main(void) {\ngl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));\nvTexCoords = texCoords;\nvec4 maxTexture = texture(maxTexture, vec2(0.5));\nfloat maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;\nfloat minValue = maxValue * triangle.threshold;\nif (triangle.colorDomain[1] > 0.) {\nmaxValue = triangle.colorDomain[1];\nminValue = triangle.colorDomain[0];\n}\nvIntensityMax = triangle.intensity / maxValue;\nvIntensityMin = triangle.intensity / minValue;\n}\n",fs:"#version 300 es\n#define SHADER_NAME triangle-layer-fragment-shader\nprecision highp float;\nuniform sampler2D weightsTexture;\nuniform sampler2D colorTexture;\nin vec2 vTexCoords;\nin float vIntensityMin;\nin float vIntensityMax;\nout vec4 fragColor;\nvec4 getLinearColor(float value) {\nfloat factor = clamp(value * vIntensityMax, 0., 1.);\nvec4 color = texture(colorTexture, vec2(factor, 0.5));\ncolor.a *= min(value * vIntensityMin, 1.0);\nreturn color;\n}\nvoid main(void) {\nvec4 weights = texture(weightsTexture, vTexCoords);\nfloat weight = weights.r;\nif (triangle.aggregationMode > 0.5) {\nweight /= max(1.0, weights.a);\n}\nif (weight <= 0.) {\ndiscard;\n}\nvec4 linearColor = getLinearColor(weight);\nlinearColor.a *= layer.opacity;\nfragColor = linearColor;\n}\n",modules:[ZA,v_]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:t,data:n}=this.props;return new Kc(e,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:t})}draw(){const{model:e}=this.state,{aggregationMode:t,colorDomain:n,intensity:i,threshold:r,colorTexture:s,maxTexture:o,weightsTexture:a}=this.props,A={aggregationMode:t,colorDomain:n,intensity:i,threshold:r,colorTexture:s,maxTexture:o,weightsTexture:a};e.shaderInputs.setProps({triangle:A}),e.draw(this.context.renderPass)}}function b_(e,t){const n={};for(const i in e)t.includes(i)||(n[i]=e[i]);return n}y_.layerName="TriangleLayer";class w_ extends Np{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:b_(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const e=this.getShaders({});e&&e.defines&&(e.defines.NON_INSTANCED_MODEL=1),this.updateShaders(e)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:n,oldProps:i,changeFlags:r}=e,{compareAll:s=!1,dimension:o}=t,{ignoreProps:a}=this.state,{props:A,accessors:l=[]}=o,{updateTriggersChanged:c}=r;if(r.dataChanged)return!0;if(c){if(c.all)return!0;for(const e of l)if(c[e])return!0}if(s)return!!r.extensionsChanged||Ap({oldProps:i,newProps:n,ignoreProps:a,propTypes:this.constructor._propTypes});for(const u of A)if(n[u]!==i[u])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&void 0!==t[e]:!function(e){let t=!0;for(const n in e){t=!1;break}return t}(t)}_getAttributeManager(){return new ep(this.context.device,{id:this.props.id,stats:this.context.stats})}}w_.layerName="AggregationLayer";const E_="#version 300 es\nin vec3 positions;\nin vec3 positions64Low;\nin float weights;\nout vec4 weightsTexture;\nvoid main()\n{\nweightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);\nfloat radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);\ngl_PointSize = radiusTexels * 2.;\nvec3 commonPosition = project_position(positions, positions64Low);\ngl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;\ngl_Position.xy = (gl_Position.xy * 2.) - (1.);\ngl_Position.w = 1.0;\n}\n",x_="#version 300 es\nin vec4 weightsTexture;\nout vec4 fragColor;\nfloat gaussianKDE(float u){\nreturn pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);\n}\nvoid main()\n{\nfloat dist = length(gl_PointCoord - vec2(0.5, 0.5));\nif (dist > 0.5) {\ndiscard;\n}\nfragColor = weightsTexture * gaussianKDE(2. * dist);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",T_={name:"weight",vs:"uniform weightUniforms {\n  vec4 commonBounds;\n  float radiusPixels;\n  float textureWidth;\n  float weightsScale;\n} weight;\n",uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},S_={name:"maxWeight",vs:"uniform maxWeightUniforms {\n  float textureSize;\n} maxWeight;\n",uniformTypes:{textureSize:"f32"}},C_={format:"rgba8unorm",dimension:"2d",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},P_=[0,0],R_={SUM:0,MEAN:1},I_={getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},M_=["float32-renderable-webgl","texture-blend-float-webgl"],k_={data:{props:["radiusPixels"]}};class L_ extends w_{getShaders(e){let t=[ZA];return e.modules&&(t=[...t,...e.modules]),super.getShaders({...e,modules:t})}initializeState(){super.initializeAggregationLayer(k_),this.setState({colorDomain:P_}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:t,oldProps:n}=e,i=this._getChangeFlags(e);if((i.dataChanged||i.viewportChanged)&&(i.boundsChanged=this._updateBounds(i.dataChanged),this._updateTextureRenderingBounds()),i.dataChanged||i.boundsChanged){if(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0}),i.dataChanged){const e=this.getShaders({vs:E_,fs:x_});this._createWeightsTransform(e)}}else i.viewportZoomChanged&&this._debouncedUpdateWeightmap();t.colorRange!==n.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:n,maxWeightsTexture:i,colorTexture:r,colorDomain:s}=this.state,{updateTriggers:o,intensity:a,threshold:A,aggregation:l}=this.props;return new(this.getSubLayerClass("triangle",y_))(this.getSubLayerProps({id:"triangle-layer",updateTriggers:o}),{coordinateSystem:MA.DEFAULT,data:{attributes:{positions:t,texCoords:n}},vertexCount:4,maxTexture:i,colorTexture:r,aggregationMode:R_[l]||0,weightsTexture:e,intensity:a,threshold:A,colorDomain:s})}finalizeState(e){super.finalizeState(e);const{weightsTransform:t,weightsTexture:n,maxWeightTransform:i,maxWeightsTexture:r,triPositionBuffer:s,triTexCoordBuffer:o,colorTexture:a,updateTimer:A}=this.state;null==t||t.destroy(),null==n||n.destroy(),null==i||i.destroy(),null==r||r.destroy(),null==s||s.destroy(),null==o||o.destroy(),null==a||a.destroy(),A&&clearTimeout(A)}_getAttributeManager(){return new ep(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const t={},{dimensions:n}=this.state;t.dataChanged=this.isAttributeChanged()?"attribute changed":this.isAggregationDirty(e,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;const{zoom:i}=this.state;return e.context.viewport&&e.context.viewport.zoom===i||(t.viewportZoomChanged=!0),t}_createTextures(){const{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...C_,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({...C_,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:t}=this.props,n=Math.min(t,e.limits.maxTextureDimension2D),i=M_.every(t=>e.features.has(t)),r=i?"rgba32float":"rgba8unorm",s=i?1:1/255;this.setState({textureSize:n,format:r,weightsScale:s}),i||Mt.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state;const{weightsTexture:n}=this.state,i=this.getAttributeManager();null==t||t.destroy(),t=new eu(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:i.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,T_]}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:t,weightsTexture:n,maxWeightsTexture:i}=this.state,r=this.getShaders({vs:E_,fs:x_});this._createWeightsTransform(r);const s=this.getShaders({vs:"#version 300 es\nuniform sampler2D inTexture;\nout vec4 outTexture;\nvoid main()\n{\nint yIndex = gl_VertexID / int(maxWeight.textureSize);\nint xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));\nvec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;\noutTexture = texture(inTexture, uv);\ngl_Position = vec4(0.0, 0.0, 0.0, 1.0);\ngl_PointSize = 1.0;\n}\n",fs:"#version 300 es\nin vec4 outTexture;\nout vec4 fragColor;\nvoid main() {\nfragColor = outTexture;\nfragColor.g = outTexture.r / max(1.0, outTexture.a);\n}\n",modules:[S_]}),o=new eu(e,{id:`${this.id}-max-weights-transform`,targetTexture:i,...s,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),a={inTexture:n,textureSize:t};o.model.shaderInputs.setProps({maxWeight:a}),this.setState({weightsTexture:n,maxWeightsTexture:i,maxWeightTransform:o,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:E_,fs:x_,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:t}=this.context,n=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])].map(e=>e.map(Math.fround)),i=function(e){const t=e.map(e=>e[0]),n=e.map(e=>e[1]),i=Math.min.apply(null,t),r=Math.max.apply(null,t);return[i,Math.min.apply(null,n),r,Math.max.apply(null,n)]}(n),r={visibleWorldBounds:i,viewportCorners:n};let s=!1;if(e||!this.state.worldBounds||(o=this.state.worldBounds,!((a=i)[0]>=o[0]&&a[2]<=o[2]&&a[1]>=o[1]&&a[3]<=o[3]))){const e=this._worldToCommonBounds(i),t=this._commonToWorldBounds(e);this.props.coordinateSystem===MA.LNGLAT&&(t[1]=Math.max(t[1],-85.051129),t[3]=Math.min(t[3],85.051129),t[0]=Math.max(t[0],-360),t[2]=Math.min(t[2],360));const n=this._worldToCommonBounds(t);r.worldBounds=t,r.normalizedCommonBounds=n,s=!0}var o,a;return this.setState(r),s}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:n,viewportCorners:i}=this.state,{viewport:r}=this.context;e.write(m_(i,3));const s=i.map(e=>function(e,t){const[n,i,r,s]=t;return[(e[0]-n)/(r-n),(e[1]-i)/(s-i)]}(r.projectPosition(e),n));t.write(m_(s,2))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:n}=this.state;const i=function(e,t=!1,n=Float32Array){let i;if(Number.isFinite(e[0]))i=new n(e);else{i=new n(4*e.length);let t=0;for(let n=0;n<e.length;n++){const r=e[n];i[t++]=r[0],i[t++]=r[1],i[t++]=r[2],i[t++]=Number.isFinite(r[3])?r[3]:255}}if(t)for(let r=0;r<i.length;r++)i[r]/=255;return i}(t,!1,Uint8Array);null==n||n.destroy(),n=this.context.device.createTexture({...C_,data:i,width:t.length,height:1}),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:e,colorDomain:t,aggregation:n}=this.props,{worldBounds:i,textureSize:r,weightsScale:s,weightsTexture:o}=this.state,a=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const A=this._worldToCommonBounds(i,{useLayerCoordinateSystem:!0});if(t&&"SUM"===n){const{viewport:e}=this.context,n=e.distanceScales.metersPerUnit[2]*(A[2]-A[0])/r;this.state.colorDomain=t.map(e=>e*n*s)}else this.state.colorDomain=t||P_;const l=this.getAttributeManager().getAttributes(),c=this.getModuleSettings();this._setModelAttributes(a.model,l),a.model.setVertexCount(this.getNumInstances());const u={radiusPixels:e,commonBounds:A,textureWidth:r,weightsScale:s,weightsTexture:o},{viewport:h,devicePixelRatio:d,coordinateSystem:f,coordinateOrigin:p}=c,{modelMatrix:g}=this.props;a.model.shaderInputs.setProps({project:{viewport:h,devicePixelRatio:d,modelMatrix:g,coordinateSystem:f,coordinateOrigin:p},weight:u}),a.run({parameters:{viewport:[0,0,r,r]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state;const{debounceTimeout:n}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){const{useLayerCoordinateSystem:n=!1}=t,[i,r,s,o]=e,{viewport:a}=this.context,{textureSize:A}=this.state,{coordinateSystem:l}=this.props,c=n&&(l===MA.LNGLAT_OFFSETS||l===MA.METER_OFFSETS),u=c?a.projectPosition(this.props.coordinateOrigin):[0,0],h=2*A/a.scale;let d,f;return n&&!c?(d=this.projectPosition([i,r,0]),f=this.projectPosition([s,o,0])):(d=a.projectPosition([i,r,0]),f=a.projectPosition([s,o,0])),function(e,t,n){const[i,r,s,o]=e,a=s-i,A=o-r;let l=a,c=A;a/A<t/n?l=t/n*A:c=n/t*a,l<t&&(l=t,c=n);const u=(s+i)/2,h=(o+r)/2;return[u-l/2,h-c/2,u+l/2,h+c/2]}([d[0]-u[0],d[1]-u[1],f[0]-u[0],f[1]-u[1]],h,h)}_commonToWorldBounds(e){const[t,n,i,r]=e,{viewport:s}=this.context,o=s.unprojectPosition([t,n]),a=s.unprojectPosition([i,r]);return o.slice(0,2).concat(a.slice(0,2))}}L_.layerName="HeatmapLayer",L_.defaultProps=I_;const B_={"Kamrup Metropolitan":{lat:26.1445,lng:91.7362},Dibrugarh:{lat:27.4728,lng:94.912},Jorhat:{lat:26.7509,lng:94.2037},Sivasagar:{lat:26.98,lng:94.64},Tinsukia:{lat:27.4886,lng:95.3558},Cachar:{lat:24.8333,lng:92.7789},"Papum Pare":{lat:27.0844,lng:93.6053},Tawang:{lat:27.5861,lng:91.8594},"West Kameng":{lat:27.2645,lng:92.4159},Changlang:{lat:27.1247,lng:95.7181},"Imphal West":{lat:24.817,lng:93.9368},"Imphal East":{lat:24.82,lng:94},Churachandpur:{lat:24.3333,lng:93.6833},Thoubal:{lat:24.6333,lng:94.0167},"East Khasi Hills":{lat:25.5788,lng:91.8933},"West Garo Hills":{lat:25.5144,lng:90.2025},"Ri Bhoi":{lat:25.9,lng:91.8833},Aizawl:{lat:23.7307,lng:92.7176},Lunglei:{lat:22.8896,lng:92.7441},Champhai:{lat:23.4733,lng:93.3283},Kohima:{lat:25.6701,lng:94.1077},Dimapur:{lat:25.906,lng:93.7346},Mokokchung:{lat:26.3267,lng:94.5205},Gangtok:{lat:27.3389,lng:88.6065},Namchi:{lat:27.1667,lng:88.35},Gyalshing:{lat:27.2833,lng:88.2333},"West Tripura":{lat:23.8315,lng:91.2868},Gomati:{lat:23.5364,lng:91.488},"North Tripura":{lat:24.3757,lng:92.1642}},D_={longitude:93.9368,latitude:24.817,zoom:7,pitch:45,bearing:0},O_=[{hex:"895ba24892bffff",score:.9},{hex:"895ba248927ffff",score:.7},{hex:"895ba248937ffff",score:.3},{hex:"895ba248967ffff",score:.1}],N_=[{name:"National Highway 2",path:[[93.8,24.8],[94,24.9],[94.2,25.1]],color:[255,255,255,100],type:"highway"},{name:"Regional Bridge Hub",path:[[93.9,24.85],[93.95,24.85]],color:[255,200,0,150],type:"bridge"}];function F_({data:e=[],district:t,velocity:n=0,className:i,layerMode:o="hex"}){const[a,A]=s.useState(D_),[f,p]=s.useState(e&&e.length>0?e:O_),[g,m]=s.useState(null),[_,v]=s.useState([]),[y,b]=s.useState(!1);s.useEffect(()=>{e&&e.length>0?p(e):async function(){if(t)try{const e=await fetch(`http://localhost:8000/api/risk-map/${t}`);if(!e.ok)throw new Error("Failed to fetch map data");const n=await e.json();p(n)}catch(e){p(O_)}}()},[t,e]),s.useEffect(()=>{if(t&&B_[t]){const{lat:e,lng:n}=B_[t];A(t=>({...t,longitude:n,latitude:e,zoom:10,transitionDuration:2e3,transitionInterpolator:new Gp}))}},[t]);const w=n>5?[239,68,68]:[34,197,94],E=e=>{if(e.object&&e.object.hex){const n=e.object.hex;m(n),b(!0);(async()=>{try{const e=await fetch(`http://localhost:8000/api/signals/h3/${n}?district=${t||""}`),i=await e.json();v(i.signals||[])}catch(e){}finally{b(!1)}})()}},x=[new Ng({id:"infrastructure-layer",data:N_,getPath:e=>e.path,getColor:e=>e.color,getWidth:20,widthMinPixels:2,pickable:!0}),"hex"===o&&new Xm({id:"h3-hexagon-layer",data:f,pickable:!0,wireframe:!1,filled:!0,extruded:!0,getHexagon:e=>e.hex,getFillColor:e=>{if(e.hex===g)return[59,130,246];const t=e.score;return t>.8?[239,68,68]:t>.5?[245,158,11]:[16,185,129]},getElevation:e=>1e3*e.score,elevationScale:20,opacity:.6,onClick:E}),"heatmap"===o&&new L_({id:"risk-heatmap",data:f.map(e=>{const t=Nm(e.hex);return{position:[t[1],t[0]],weight:e.score}}),getPosition:e=>e.position,getWeight:e=>e.weight,radiusPixels:60,intensity:1,threshold:.05}),"markers"===o&&new ng({id:"risk-markers",data:f.map(e=>{const t=Nm(e.hex);return{position:[t[1],t[0]],score:e.score,hex:e.hex}}),getPosition:e=>e.position,getFillColor:e=>e.score>.8?[239,68,68]:[245,158,11],getRadius:300,radiusMinPixels:5,pickable:!0,onClick:E,opacity:.8}),t&&B_[t]?new ng({id:"district-highlight",data:[B_[t]],getPosition:e=>[e.lng,e.lat],getRadius:5e3,stroked:!0,filled:!0,lineWidthMinPixels:2,getLineColor:w,getFillColor:[...w,50],opacity:1}):null].filter(Boolean);return r.jsxs("div",{className:l("relative rounded border border-border overflow-hidden h-full w-full min-h-[300px]",i),children:[r.jsx(Zp,{viewState:a,onViewStateChange:({viewState:e})=>A(e),controller:!0,layers:x,getTooltip:({object:e})=>e&&(e.hex?`Hex: ${e.hex}\nRisk: ${e.score}`:e.name),children:r.jsx(c_,{mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",reuseMaps:!0})}),g&&r.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-72 bg-card/95 backdrop-blur-md border-l border-border z-20 flex flex-col shadow-2xl animate-in slide-in-from-right duration-300",children:[r.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between bg-primary/5",children:[r.jsxs("div",{className:"flex flex-col",children:[r.jsx("h3",{className:"text-xs font-bold text-primary uppercase tracking-widest",children:"Signal Intelligence"}),r.jsx("span",{className:"text-[10px] text-foreground-tertiary font-mono",children:g})]}),r.jsxs("button",{title:"Close signal details","aria-label":"Close signal details",type:"button",onClick:()=>m(null),className:"p-1 hover:bg-background rounded-full transition-colors",children:[r.jsx("span",{className:"sr-only",children:"Close signal details"}),r.jsx(c,{className:"w-4 h-4"})]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:y?r.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-3",children:[r.jsx(u,{className:"w-6 h-6 animate-spin text-primary"}),r.jsx("span",{className:"text-xs text-foreground-secondary",children:"Analyzing local signals..."})]}):_.length>0?_.map((e,t)=>r.jsxs("div",{className:"p-3 bg-background border border-border rounded-lg space-y-2 hover:border-primary/30 transition-colors",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(h,{className:l("w-3 h-3",e.severity>3?"text-red-500":"text-amber-500")}),r.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-wider text-foreground-secondary",children:["Severity: ",e.severity]})]}),r.jsxs("div",{className:"flex items-center gap-1 text-[9px] text-foreground-tertiary font-medium",children:[r.jsx(d,{className:"w-2.5 h-2.5"}),new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),r.jsx("p",{className:"text-xs text-foreground leading-snug",children:e.text}),r.jsxs("div",{className:"text-[9px] text-primary/70 font-semibold uppercase tracking-widest",children:["Source: ",e.source]})]},t)):r.jsx("div",{className:"text-center py-12",children:r.jsx("p",{className:"text-xs text-foreground-tertiary italic",children:"No specific signals detected in this cell."})})})]}),r.jsxs("div",{className:"absolute top-2 left-2 bg-card/90 backdrop-blur p-2 rounded text-[10px] border border-border z-10 space-y-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-white opacity-60"}),r.jsx("span",{className:"text-foreground-secondary underline decoration-dotted",children:"Infrastructure Activity"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-primary opacity-80 animate-pulse"}),r.jsx("span",{className:"text-foreground-secondary",children:"Cognitive Pulse"})]})]}),r.jsxs("div",{className:"absolute top-2 right-2 bg-card/90 backdrop-blur p-2 rounded text-xs border border-border z-10 pointer-events-none",children:[r.jsx("div",{className:"font-semibold mb-1",children:"Risk Extrusion"}),r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-sm"})," High Conflict Probability"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-sm"})," Baseline Calm"]})]})]})}export{F_ as RiskMap};
